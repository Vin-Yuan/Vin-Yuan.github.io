<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Vin&#39;s Blog</title>
  
  
  <link href="http://yoursite.com/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2025-05-22T05:50:40.060Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>GPT</title>
    <link href="http://yoursite.com/2025/05/21/GPT/"/>
    <id>http://yoursite.com/2025/05/21/GPT/</id>
    <published>2025-05-21T04:02:14.000Z</published>
    <updated>2025-05-22T05:50:40.060Z</updated>
    
    <content type="html"><![CDATA[<h2 id="cross_entropyçš„åº”ç”¨">cross_entropyçš„åº”ç”¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BigramLanguageModel</span>(nn.Module):</span><br><span class="line">â€¦â€¦</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, idx, targets=<span class="literal">None</span></span>):</span><br><span class="line">            B, T, C = logits.shape</span><br><span class="line">            logits = logits.view(B*T, C)</span><br><span class="line">            targets = targets.view(B*T)</span><br><span class="line">            loss = F.cross_entropy(logits, targets)</span><br><span class="line"></span><br><span class="line">m = BigramLanguageModel(vocab_size)</span><br><span class="line">logits, loss = m(xb, yb)</span><br><span class="line"><span class="built_in">print</span>(logits.shape)</span><br><span class="line"><span class="built_in">print</span>(loss)</span><br><span class="line"></span><br><span class="line"><span class="comment"># output</span></span><br><span class="line">torch.Size([<span class="number">32</span>, <span class="number">65</span>])</span><br><span class="line">tensor(<span class="number">4.8786</span>, grad_fn=&lt;NllLossBackward0&gt;)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss = F.cross_entropy(logits, targets)</span><br></pre></td></tr></table></figure><p>å…¶å®è®¡ç®—çš„æ˜¯ <span class="math display">\[\text{CrossEntropy}(p,y) =-log(p_y)\]</span></p><p>å…¶ä¸­ï¼š</p><p><span class="math inline">\(p\)</span> æ˜¯ softmax åçš„æ¦‚ç‡åˆ†å¸ƒ<br /><span class="math inline">\(y\)</span> æ˜¯ ground-truth label(ç›®æ ‡token)<br /><span class="math inline">\(p_y\)</span> æ˜¯å¯¹åº”ground-truthç±»åˆ«çš„æ¦‚ç‡</p><p>å¯¹äºè¿™ä¸ªLosså¦‚æœæˆ‘ä»¬æƒ³ä¼°è®¡ä¸€ä¸‹æ˜¯ä»€ä¹ˆæ°´å¹³ï¼Œé‚£å°±å¯¹æ¯”éšæœºçŒœçš„æƒ…å†µ,ï¼Œè¿™ä¸ªå¯ä»¥ä½œä¸ºbaseline</p><p><span class="math display">\[ \text{loss} = -\text{log}(\frac{1}{65})= \text{log}(65) \approx 4.17 \]</span></p><span id="more"></span><p>å¦‚æœæ¨¡å‹åˆšåˆå§‹åŒ–ï¼Œæˆ–è€…æ¯«æ— å­¦ä¹ èƒ½åŠ›ï¼Œå…¶äº¤å‰ç†µæŸå¤±å‡½æ•°å°±ä¼šéå¸¸æ¥è¿‘è¿™ä¸ªå€¼</p><p>why loss=4.87 &gt; 4.17 ?è¿™æ˜¯å› ä¸ºï¼šæ¨¡å‹è¿˜æ²¡å¼€å§‹è®­ç»ƒï¼ˆåˆšåˆå§‹åŒ–ï¼‰ï¼Œé¢„æµ‹å¯èƒ½ä¸å‡åŒ€åˆ†å¸ƒï¼Œè€Œæ˜¯æ›´ç³Ÿç³•çš„â€œé”™è¯¯åˆ†å¸ƒâ€ï¼Œè¿™ä¼šå¯¼è‡´é¢„æµ‹ç›®æ ‡tokenæ¦‚ç‡<span class="math inline">\(p_y \lt fra\)</span></p><h2 id="multitorch.multinomial">multitorch.multinomial</h2><p>è¿™ä¸ªå‡½æ•°ç”¨æ¥é‡‡æ ·ï¼Œä¼šæ ¹æ®ä¼ å…¥çš„æ•°æ®æ‰€æä¾›çš„æ¦‚ç‡æ¥é‡‡æ ·<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€ç»´æ¦‚ç‡åˆ†å¸ƒ</span></span><br><span class="line">probs = torch.tensor([<span class="number">0.2</span>, <span class="number">0.5</span>, <span class="number">0.3</span>])</span><br><span class="line"><span class="comment"># é‡‡æ · 3 ä¸ªæ ·æœ¬ï¼Œä¸é‡å¤é‡‡æ ·</span></span><br><span class="line">samples = torch.multinomial(probs, num_samples=<span class="number">3</span>, replacement=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Samples:&quot;</span>, samples)</span><br><span class="line"></span><br><span class="line"><span class="comment"># äºŒç»´æ¦‚ç‡åˆ†å¸ƒ</span></span><br><span class="line">probs = torch.tensor([[<span class="number">0.2</span>, <span class="number">0.5</span>, <span class="number">0.3</span>], [<span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">0.2</span>]])</span><br><span class="line"><span class="comment"># é‡‡æ · 2 ä¸ªæ ·æœ¬ï¼Œå…è®¸é‡å¤é‡‡æ ·</span></span><br><span class="line">samples = torch.multinomial(probs, num_samples=<span class="number">2</span>, replacement=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Samples:&quot;</span>, samples)</span><br></pre></td></tr></table></figure></p><h2 id="temperature">temperature</h2><p><span class="math display">\[\text{adjusted logits} =\frac{logits}{T} \]</span> temperatureé€šè¿‡åœ¨softmaxä¹‹å‰ä¿®æ”¹logitsæ¥å¹³æ»‘æˆ–å°–é”logitsåˆ†å¸ƒ<br />T=1.5ï¼šè°ƒæ•´åçš„ logitsæ›´å°ï¼Œæ¦‚ç‡åˆ†å¸ƒæ›´åŠ å¹³æ»‘ï¼Œæ‰€æœ‰ç±»åˆ«çš„æ¦‚ç‡æ›´åŠ æ¥è¿‘ã€‚<br />T=0.5ï¼šè°ƒæ•´åçš„ logits æ›´å¤§ï¼Œæ¦‚ç‡åˆ†å¸ƒæ›´åŠ å°–é”ï¼Œæœ€é«˜æ¦‚ç‡çš„ç±»åˆ«æ›´åŠ çªå‡ºã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰åŸå§‹ logits</span></span><br><span class="line">logits = torch.tensor([[<span class="number">0.1</span>, <span class="number">0.7</span>, <span class="number">0.2</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ¸©åº¦å‚æ•°</span></span><br><span class="line">temperature_high = <span class="number">1.5</span></span><br><span class="line">temperature_low = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒæ•´ logits</span></span><br><span class="line">adjusted_logits_high = logits / temperature_high</span><br><span class="line">adjusted_logits_low = logits / temperature_low</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢ä¸ºæ¦‚ç‡åˆ†å¸ƒ</span></span><br><span class="line">probs_high = F.softmax(adjusted_logits_high, dim=-<span class="number">1</span>)</span><br><span class="line">probs_low = F.softmax(adjusted_logits_low, dim=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Original logits:&quot;</span>, logits)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Adjusted logits (T=1.5):&quot;</span>, adjusted_logits_high)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Adjusted logits (T=0.5):&quot;</span>, adjusted_logits_low)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Probs (T=1.5):&quot;</span>, probs_high)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Probs (T=0.5):&quot;</span>, probs_low)</span><br></pre></td></tr></table></figure></p><h2 id="weighted-sum">weighted sum</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">B, T, C = <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span></span><br><span class="line">x = torch.arange(<span class="number">0</span>, B*T*C, <span class="number">1</span>, dtype=torch.float32).reshape(B, T, C)</span><br><span class="line">wei = torch.tril(torch.ones(T,T))</span><br><span class="line">wei = wei/wei.<span class="built_in">sum</span>(<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">res = wei @ x</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;wei = &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(wei)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;x = &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;res = &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>èƒ½ç†è§£åˆ°æŠŠxçš„æ¯ä¸€è¡Œçœ‹åšä¸€ä¸ª2ç»´å‘é‡ï¼ŒWæ¯ä¸€è¡Œå¯¹4ä¸ª2ç»´å‘é‡åŠ æƒæ±‚å’Œï¼Œå¦‚æœä»çŸ©é˜µä¹˜æ³•è§’åº¦å»æ¨å¯¼ï¼Œç”¨åˆ†å—çŸ©é˜µæ–¹å¼å¦‚ä½•å…·è±¡åŒ–è¿™ä¸€è¿‡ç¨‹ï¼Ÿå…³é”®çš„åœ°æ–¹æ˜¯åªå°†wåˆ†å—åŒ–ï¼Œçœ‹åšè¡Œå‘é‡çš„stack,è€Œxä¸åšåˆ†å—è€ƒè™‘ï¼Œè¿™æ ·å°±ç›´è§‚äº†. æ¯ä¸€è¡Œ output æ˜¯å¯¹æ‰€æœ‰ xáµ¢ï¼ˆ2Då‘é‡ï¼‰çº¿æ€§åŠ æƒæ±‚å’Œï¼Œæƒé‡æ˜¯ W çš„ä¸€è¡Œï¼Œè¿™å°±æ˜¯ attention æœºåˆ¶é‡Œ â€œåŠ æƒæ±‚å’Œâ€çš„æœ¬è´¨ã€‚ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">W =</span><br><span class="line">â¡ wâ‚€áµ€ â¤</span><br><span class="line">â¢ wâ‚áµ€ â¥</span><br><span class="line">â¢ wâ‚‚áµ€ â¥</span><br><span class="line">â£ wâ‚ƒáµ€ â¦   âˆˆ â„^&#123;<span class="number">4</span>Ã—<span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line">W @ x =</span><br><span class="line">â¡ wâ‚€áµ€ @ x â¤</span><br><span class="line">â¢ wâ‚áµ€ @ x â¥</span><br><span class="line">â¢ wâ‚‚áµ€ @ x â¥</span><br><span class="line">â£ wâ‚ƒáµ€ @ x â¦</span><br></pre></td></tr></table></figure></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;cross_entropyçš„åº”ç”¨&quot;&gt;cross_entropyçš„åº”ç”¨&lt;/h2&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;BigramLanguageModel&lt;/span&gt;(nn.Module):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;â€¦â€¦&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;forward&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;self, idx, targets=&lt;span class=&quot;literal&quot;&gt;None&lt;/span&gt;&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            B, T, C = logits.shape&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            logits = logits.view(B*T, C)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            targets = targets.view(B*T)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            loss = F.cross_entropy(logits, targets)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;m = BigramLanguageModel(vocab_size)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;logits, loss = m(xb, yb)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(logits.shape)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(loss)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# output&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;torch.Size([&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;65&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tensor(&lt;span class=&quot;number&quot;&gt;4.8786&lt;/span&gt;, grad_fn=&amp;lt;NllLossBackward0&amp;gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;loss = F.cross_entropy(logits, targets)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶å®è®¡ç®—çš„æ˜¯ &lt;span class=&quot;math display&quot;&gt;\[\text{CrossEntropy}(p,y) =
-log(p_y)\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math inline&quot;&gt;\(p\)&lt;/span&gt; æ˜¯ softmax åçš„æ¦‚ç‡åˆ†å¸ƒ&lt;br /&gt;
&lt;span class=&quot;math inline&quot;&gt;\(y\)&lt;/span&gt; æ˜¯ ground-truth label
(ç›®æ ‡token)&lt;br /&gt;
&lt;span class=&quot;math inline&quot;&gt;\(p_y\)&lt;/span&gt; æ˜¯å¯¹åº”ground-truth
ç±»åˆ«çš„æ¦‚ç‡&lt;/p&gt;
&lt;p&gt;å¯¹äºè¿™ä¸ªLosså¦‚æœæˆ‘ä»¬æƒ³ä¼°è®¡ä¸€ä¸‹æ˜¯ä»€ä¹ˆæ°´å¹³ï¼Œé‚£å°±å¯¹æ¯”éšæœºçŒœçš„æƒ…å†µ,ï¼Œè¿™ä¸ªå¯ä»¥ä½œä¸ºbaseline&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ \text{loss} = -\text{log}(\frac{1}{65})
= \text{log}(65) \approx 4.17 \]&lt;/span&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="LLM" scheme="http://yoursite.com/categories/LLM/"/>
    
    
    <category term="LLM" scheme="http://yoursite.com/tags/LLM/"/>
    
  </entry>
  
  <entry>
    <title>Normlization</title>
    <link href="http://yoursite.com/2025/05/19/Normlization/"/>
    <id>http://yoursite.com/2025/05/19/Normlization/</id>
    <published>2025-05-19T04:05:44.000Z</published>
    <updated>2025-05-22T05:50:40.062Z</updated>
    
    <content type="html"><![CDATA[<p>éªŒè¯LayerNormçš„ï¼Œé€šè¿‡ä½¿ç”¨torch.meanå’Œtorch.varå¤ç°çš„æ—¶å€™å‘ç°ä¸ä¸€è‡´LayerNormé»˜è®¤ä½¿ç”¨çš„æ˜¯biasçš„æ•´ä½“æ–¹å·®, divided by Ntorch.varé»˜è®¤ä½¿ç”¨çš„æ˜¯æ— biasçš„æ ·æœ¬æ–¹å·®, devided by N-1</p><p>å¯¹äºæ¯ä¸€ä¸ªæ ·æœ¬çš„ç‰¹å¾å‘é‡ <span class="math inline">\(x \in\mathbb{R}^d\)</span> ï¼ŒLayerNorm æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p><span class="math display">\[\operatorname{LayerNorm}(x)=\gamma \cdot\frac{x-\mu}{\sqrt{\sigma^2+\epsilon}}+\beta\]</span></p><ul><li><span class="math inline">\(\mu, \sigma^2\)</span>ï¼šå½“å‰æ ·æœ¬çš„å‡å€¼å’Œæ–¹å·®ï¼ˆä»…ç”¨äºå½’ä¸€åŒ–ï¼‰</li><li><span class="math inline">\(\gamma\)</span>ï¼šå¯å­¦ä¹ çš„ç¼©æ”¾å‚æ•°ï¼ˆscaleï¼Œç±»ä¼¼äºæƒé‡ï¼‰</li><li><span class="math inline">\(\beta\)</span>ï¼šå¯å­¦ä¹ çš„åç§»å‚æ•°ï¼ˆbiasï¼Œåç½®ï¼‰</li></ul><p><ahref="https://docs.pytorch.org/docs/stable/generated/torch.nn.LayerNorm.html"><imgsrc="https://docs.pytorch.org/docs/stable/_images/layer_norm.jpg"alt="LayerNomr" /></a></p><span id="more"></span><p>å¯¹äºè¿™ä¸¤ä¸ªåç§»å‚æ•°å¦‚ä½•æ›´æ–°ï¼Œæ¢ç©¶äº†ä¸€ä¸‹åº•å±‚å®ç° <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"></span><br><span class="line">layer_norm = nn.LayerNorm(<span class="number">2</span>)</span><br><span class="line">x = torch.tensor([[<span class="number">1.0</span>, <span class="number">2.0</span>], [<span class="number">2.0</span>, <span class="number">3.0</span>]], requires_grad=<span class="literal">True</span>)</span><br><span class="line">target = torch.tensor([[<span class="number">0.0</span>, <span class="number">0.0</span>], [<span class="number">0.0</span>, <span class="number">0.0</span>]])  <span class="comment"># ç›®æ ‡å…¨ä¸º 0</span></span><br><span class="line"></span><br><span class="line">optimizer = optim.SGD(layer_norm.parameters(), lr=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    optimizer.zero_grad()</span><br><span class="line">    out = layer_norm(x)</span><br><span class="line">    loss = ((out - target)**<span class="number">2</span>).mean()</span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Step <span class="subst">&#123;i&#125;</span>, beta: <span class="subst">&#123;layer_norm.bias.data&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p><span class="math inline">\(\gamma\)</span> å’Œ <spanclass="math inline">\(\beta\)</span> çš„ç»´åº¦æ˜¯ (batch_size, seq_len)<span class="math inline">\(\sigma\)</span> ä»¥åŠ <spanclass="math inline">\(\mu\)</span> çš„ç»´åº¦æ˜¯ (batch_size, seq_len,feature_dim), åœ¨å®Œæˆæ ‡å‡†åŒ–åï¼Œè¿™ä¸¤ä¸ªä¼šä»¥å‘é‡çš„å½¢å¼ ä¾‹å¦‚: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">x = [[<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>],</span><br><span class="line">     [<span class="number">5.0</span>, <span class="number">6.0</span>, <span class="number">7.0</span>, <span class="number">8.0</span>]]</span><br><span class="line"></span><br><span class="line">LayerNorm ä¼šå¯¹æ¯ä¸€è¡Œåšæ ‡å‡†åŒ–ï¼š</span><br><span class="line">=&gt; æ¯è¡Œå˜æˆå‡å€¼=<span class="number">0</span>ï¼Œæ–¹å·®=<span class="number">1</span> çš„å‘é‡</span><br><span class="line"></span><br><span class="line">gamma, beta = [Î³<span class="number">1</span>, Î³<span class="number">2</span>, Î³<span class="number">3</span>, Î³<span class="number">4</span>], [Î²<span class="number">1</span>, Î²<span class="number">2</span>, Î²<span class="number">3</span>, Î²<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">æœ€åè¾“å‡º = normalized * gamma + beta</span><br></pre></td></tr></table></figure>åº•å±‚åœ¨ç›¸ä¹˜çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå‘é‡åŒ– $ * {}^{T} + $ å…¶ä¸­ <spanclass="math inline">\(\hat{x} ,\gamma, \beta \in\mathbb{R}^d\)</span></p><p><span class="math inline">\(\hat{x} =\frac{x-\mu}{\sqrt{\sigma^2}}\)</span> $ y = + $ å¯¹äº<spanclass="math inline">\(\beta\)</span>, åå‘ä¼ æ’­çš„æ¢¯åº¦ï¼š <spanclass="math inline">\(\frac{\partial L}{\partial \beta}=\frac{\partialL}{\partial y}\)</span> å¯¹äº<span class="math inline">\(\gamma\)</span>,åå‘ä¼ æ’­æ¢¯åº¦ï¼š <span class="math inline">\(\frac{\partial L}{\partial\gamma}=\frac{\partial L}{\partial y} \cdot \hat{x}\)</span></p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆ Î³ å’Œ Î² è¦å…±äº«ï¼Ÿ ### 1.å½’ä¸€åŒ–åä¸¢å¤±äº†å°ºåº¦å’Œåç§»ä¿¡æ¯ï¼Œéœ€è¦ Î³ã€Î² æ¥æ¢å¤è¡¨è¾¾èƒ½åŠ›å½’ä¸€åŒ–æœ¬è´¨ä¸Šæ˜¯æŠŠæ•°æ®å˜æˆäº†é›¶å‡å€¼ã€å•ä½æ–¹å·®ã€‚</p><p>è¿™æ ·è™½ç„¶æœ‰åŠ©äºç¨³å®šè®­ç»ƒï¼Œä½†ä¼šæŸå¤±ä¸€äº›ç‰¹å¾çš„è¡¨è¾¾èƒ½åŠ›ï¼ˆä¾‹å¦‚ï¼Œâ€œè¿™ä¸ªç¥ç»å…ƒåŸæœ¬è¾“å‡ºå¾ˆå¤§æ˜¯æœ‰æ„ä¹‰çš„â€ï¼‰ã€‚</p><p>æ‰€ä»¥é€šè¿‡å¼•å…¥ Î³ å’Œ Î² è¿™ä¸¤ä¸ªå¯å­¦ä¹ å‚æ•°ï¼Œç½‘ç»œå¯ä»¥åœ¨è®­ç»ƒä¸­å­¦ä¹ â€œæ˜¯å¦éœ€è¦æ”¾å¤§æŸäº›ç»´åº¦â€æˆ–â€œæ•´ä½“å¹³ç§»â€ï¼Œä»¥æ¢å¤è¿™ç§è¡¨è¾¾èƒ½åŠ›ã€‚</p><p>ğŸ¯ å…³é”®ç‚¹ï¼šÎ³ å’Œ Î² æ˜¯æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸æ˜¯ç”¨æ¥é€‚é…æ¯ä¸ªæ ·æœ¬ï¼Œè€Œæ˜¯å­¦ä¹ ä¸€ç§åœ¨æ‰€æœ‰æ ·æœ¬ä¸Šéƒ½æœ‰æ•ˆçš„å˜æ¢æ–¹å¼ï¼Œè¿™ç¬¦åˆæ·±åº¦å­¦ä¹ æ¨¡å‹â€œå…±äº«å‚æ•°â€çš„ç†å¿µã€‚### 2. ä¸å¯¹æ¯ä¸ªæ ·æœ¬å•ç‹¬å­¦ä¹  Î³ å’Œ Î² æ˜¯ä¸ºäº†é¿å…è¿‡æ‹Ÿåˆ + ä¿æŒå‚æ•°æ•ˆç‡ å¦‚æœÎ³ å’Œ Î² å¯¹æ¯ä¸ªæ ·æœ¬éƒ½æœ‰ç‹¬ç«‹çš„ä¸€å¥—ï¼Œé‚£æ„å‘³ç€å‚æ•°é‡å°†éšç€ batch sizeæˆå€å¢é•¿ã€‚</p><p>è¿™ä¼šï¼š</p><p>å¤§å¹…å¢åŠ è®¡ç®—å’Œå†…å­˜è´Ÿæ‹…</p><p>ç ´åæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼ˆç›¸å½“äºä¸ºæ¯ä¸ªæ ·æœ¬å®šåˆ¶å½’ä¸€åŒ–ï¼Œå¯èƒ½ä¼šè¿‡æ‹Ÿåˆï¼‰</p><p>æ‰€ä»¥ï¼šå…±äº« Î³ å’Œ Î² æ˜¯ä¸€ç§åœ¨ä¿æŒæ¨¡å‹è¡¨è¾¾èƒ½åŠ›å’Œè®¡ç®—æ•ˆç‡ä¹‹é—´çš„æƒè¡¡ã€‚</p><h3 id="ä¸-batchnorm-çš„åŒºåˆ«ä¹Ÿä½“ç°å‡ºè¿™ç§è®¾è®¡å“²å­¦">3. ä¸ BatchNormçš„åŒºåˆ«ä¹Ÿä½“ç°å‡ºè¿™ç§è®¾è®¡å“²å­¦</h3><p>BatchNorm ä½¿ç”¨çš„æ˜¯ batchå†…çš„ç»Ÿè®¡é‡ï¼ˆè·¨æ ·æœ¬ç»Ÿè®¡ï¼‰ï¼Œé€‚ç”¨äºå›¾åƒç­‰åŒåˆ†å¸ƒæ ·æœ¬ã€‚</p><p>LayerNorm ä½¿ç”¨çš„æ˜¯ æ ·æœ¬å†…çš„ç»Ÿè®¡é‡ï¼Œé¿å…ä¾èµ– batch å¤§å°ï¼ˆé€‚åˆTransformer è¿™ç§åºåˆ—å»ºæ¨¡ï¼‰ã€‚</p><p>ä½†æ— è®ºå“ªç§å½’ä¸€åŒ–ï¼ŒÎ³ å’Œ Î²å§‹ç»ˆæ˜¯å…±äº«çš„å‚æ•°ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æ¨¡å‹æœ¬èº«çš„ä¸€éƒ¨åˆ†ï¼Œä¸ä¾èµ–äºè¾“å…¥æ ·æœ¬ã€‚</p><p>ğŸ§ª ä¸¾ä¸ªæ¯”å–»ï¼š ä½ æœ‰ä¸€ä¸ªå½’ä¸€åŒ–åçš„å›¾åƒæ•°æ®é›†ï¼Œæ¯å¼ å›¾éƒ½è¢«æ ‡å‡†åŒ–æˆäº®åº¦ä¸º0ï¼Œæ ‡å‡†å·®ä¸º1ã€‚ä½†ä½ çŸ¥é“æœ‰äº›å›¾åƒæœ¬è¯¥äº®ä¸€äº›ã€æœ‰äº›æœ¬è¯¥æš—ä¸€äº›ã€‚äºæ˜¯ä½ è®­ç»ƒä¸€ä¸ªâ€œäº®åº¦å¢ç›Šâ€å’Œâ€œäº®åº¦åç§»â€å‚æ•°ï¼Œç”¨æ¥ç»Ÿä¸€åœ°è°ƒæ•´æ‰€æœ‰å›¾åƒã€‚ä½ ä¸ä¼šä¸ºæ¯å¼ å›¾å­¦ä¸€ä¸ªå¢ç›Šï¼Œè€Œæ˜¯æ‰¾å‡ºä¸€ç»„å¯¹æ‰€æœ‰å›¾éƒ½é€‚ç”¨çš„å‚æ•°ã€‚</p><p>âœ… æ€»ç»“ï¼š é—®é¢˜ è§£é‡Š ä¸ºä»€ä¹ˆ Î³ å’Œ Î² è¦ batch å…±äº«ï¼Ÿå› ä¸ºå®ƒä»¬æ˜¯æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæ¢å¤è¡¨è¾¾èƒ½åŠ›ï¼Œä¸æ˜¯è¾“å…¥çš„ä¸€éƒ¨åˆ†ï¼›å…±äº«å¯ä»¥å‡å°‘å‚æ•°é‡ã€é¿å…è¿‡æ‹Ÿåˆä¸ºä»€ä¹ˆä¸å¯¹æ¯ä¸ªæ ·æœ¬ç‹¬ç«‹å­¦ä¹  Î³ å’Œ Î²ï¼Ÿè¿™æ ·ä¼šå¤§å¤§å¢åŠ å‚æ•°ã€å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œå¹¶ä¸”ä¸ç¬¦åˆæ·±åº¦å­¦ä¹ â€œå‚æ•°å…±äº«â€çš„æ ¸å¿ƒè®¾è®¡å“²å­¦Î³ å’Œ Î² çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿæ¢å¤å½’ä¸€åŒ–è¿‡ç¨‹ä¸¢å¤±çš„å°ºåº¦å’Œåç§»ä¿¡æ¯ï¼Œä½¿æ¨¡å‹ä¿ç•™å­¦ä¹ èƒ½åŠ›</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;éªŒè¯LayerNormçš„ï¼Œé€šè¿‡ä½¿ç”¨torch.meanå’Œtorch.varå¤ç°çš„æ—¶å€™å‘ç°ä¸ä¸€è‡´
LayerNormé»˜è®¤ä½¿ç”¨çš„æ˜¯biasçš„æ•´ä½“æ–¹å·®, divided by N
torch.varé»˜è®¤ä½¿ç”¨çš„æ˜¯æ— biasçš„æ ·æœ¬æ–¹å·®, devided by N-1&lt;/p&gt;
&lt;p&gt;å¯¹äºæ¯ä¸€ä¸ªæ ·æœ¬çš„ç‰¹å¾å‘é‡ &lt;span class=&quot;math inline&quot;&gt;\(x \in
\mathbb{R}^d\)&lt;/span&gt; ï¼ŒLayerNorm æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[
\operatorname{LayerNorm}(x)=\gamma \cdot
\frac{x-\mu}{\sqrt{\sigma^2+\epsilon}}+\beta
\]&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span class=&quot;math inline&quot;&gt;\(\mu, \sigma^2\)&lt;/span&gt;
ï¼šå½“å‰æ ·æœ¬çš„å‡å€¼å’Œæ–¹å·®ï¼ˆä»…ç”¨äºå½’ä¸€åŒ–ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;span class=&quot;math inline&quot;&gt;\(\gamma\)&lt;/span&gt;
ï¼šå¯å­¦ä¹ çš„ç¼©æ”¾å‚æ•°ï¼ˆscaleï¼Œç±»ä¼¼äºæƒé‡ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;span class=&quot;math inline&quot;&gt;\(\beta\)&lt;/span&gt;
ï¼šå¯å­¦ä¹ çš„åç§»å‚æ•°ï¼ˆbiasï¼Œåç½®ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a
href=&quot;https://docs.pytorch.org/docs/stable/generated/torch.nn.LayerNorm.html&quot;&gt;&lt;img
src=&quot;https://docs.pytorch.org/docs/stable/_images/layer_norm.jpg&quot;
alt=&quot;LayerNomr&quot; /&gt;&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="deeplearning LLM" scheme="http://yoursite.com/tags/deeplearning-LLM/"/>
    
  </entry>
  
  <entry>
    <title>Pytorchå¸¸ç”¨ä¾‹å­</title>
    <link href="http://yoursite.com/2025/02/19/Pytorch/"/>
    <id>http://yoursite.com/2025/02/19/Pytorch/</id>
    <published>2025-02-19T10:34:58.000Z</published>
    <updated>2025-05-22T05:50:40.064Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ¡£è®°å½•äº†ä¸€äº›pytorchå¸¸ç”¨æ“ä½œä»¥åŠæ¦‚å¿µ</p><span id="more"></span><h2 id="æ„é€ æ•°æ®">1. æ„é€ æ•°æ®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å…¨ 0 / å…¨ 1 / å¸¸æ•°</span></span><br><span class="line">torch.zeros(<span class="number">3</span>, <span class="number">4</span>)           <span class="comment"># shape=(3, 4)</span></span><br><span class="line">torch.ones(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">torch.full((<span class="number">2</span>, <span class="number">2</span>), <span class="number">7.0</span>)</span><br><span class="line">x = torch.randn(<span class="number">10</span>,<span class="number">8</span>,<span class="number">4</span>)</span><br><span class="line">y = torch.ones_like(x)   <span class="comment"># å¤åˆ¶shape</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. éšæœºæ•°æ®</span></span><br><span class="line">torch.randn(<span class="number">5</span>, <span class="number">10</span>)          <span class="comment"># æ ‡å‡†æ­£æ€åˆ†å¸ƒ N(0,1)</span></span><br><span class="line">torch.rand(<span class="number">3</span>, <span class="number">3</span>)            <span class="comment"># å‡åŒ€åˆ†å¸ƒ [0, 1)</span></span><br><span class="line">torch.randint(<span class="number">0</span>, <span class="number">10</span>, (<span class="number">2</span>, <span class="number">4</span>)) <span class="comment"># æ•´æ•°éšæœºæ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ç±»ä¼¼ numpy çš„æ–¹å¼</span></span><br><span class="line">torch.arange(<span class="number">0</span>, <span class="number">10</span>, <span class="number">2</span>)      <span class="comment"># [0, 2, 4, 6, 8]</span></span><br><span class="line">torch.linspace(<span class="number">0</span>, <span class="number">1</span>, <span class="number">5</span>)     <span class="comment"># [0., 0.25, 0.5, 0.75, 1.]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. ä» numpy è½¬æ¢</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">torch.from_numpy(np.array([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]]))</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨è¾“å…¥æ•°æ®">2. å¸¸ç”¨è¾“å…¥æ•°æ®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡æ•°æ®ï¼š10 å¼  RGB å›¾ç‰‡ï¼ˆ3 é€šé“ï¼Œ32x32ï¼‰ï¼Œæ¯å¼ å›¾ä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line">x = torch.randn(<span class="number">10</span>, <span class="number">3</span>, <span class="number">32</span>, <span class="number">32</span>)     <span class="comment"># å›¾åƒå¼ é‡</span></span><br><span class="line">y = torch.randint(<span class="number">0</span>, <span class="number">5</span>, (<span class="number">10</span>,))     <span class="comment"># æ ‡ç­¾ï¼š5 ç±»åˆ†ç±»ä»»åŠ¡</span></span><br></pre></td></tr></table></figure><h2 id="å‘é‡åŒ–æ“ä½œ">3. å‘é‡åŒ–æ“ä½œ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">a = torch.randn(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">b = torch.randn(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. çŸ©é˜µä¹˜æ³•</span></span><br><span class="line">out = a @ b                    <span class="comment"># shape=(3,5)</span></span><br><span class="line">out = torch.matmul(a, b)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å¹¿æ’­åŠ æ³•</span></span><br><span class="line">x = torch.randn(<span class="number">10</span>, <span class="number">5</span>)      <span class="comment"># å¹¿æ’­æœºåˆ¶ï¼Œè‡ªåŠ¨æ‰©å±•</span></span><br><span class="line">bias = torch.randn(<span class="number">5</span>)</span><br><span class="line">x = x + bias                  </span><br><span class="line">x = torch.arange(<span class="number">0</span>, <span class="number">10</span>, <span class="number">1</span>).reshape(<span class="number">2</span>, <span class="number">5</span>) </span><br><span class="line">bias = torch.tensor(<span class="number">1.0</span>)    <span class="comment"># å¹¿æ’­æœºåˆ¶ï¼Œscalar è‡ªåŠ¨æ‰©å±•</span></span><br><span class="line">y = x + bias</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æ‹¼æ¥</span></span><br><span class="line">torch.cat([a, a], dim=<span class="number">0</span>)      <span class="comment"># æ‹¼æ¥è¡Œ</span></span><br><span class="line">torch.cat([a, a], dim=<span class="number">1</span>)      <span class="comment"># æ‹¼æ¥åˆ—</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. reshape &amp; transpose</span></span><br><span class="line">x = torch.randn(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">x.view(<span class="number">6</span>, <span class="number">4</span>)                  <span class="comment"># æ”¹å½¢çŠ¶</span></span><br><span class="line">x.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>)            <span class="comment"># äº¤æ¢ç»´åº¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. é€‰æ‹©/æ©ç </span></span><br><span class="line">x = torch.randn(<span class="number">10</span>)</span><br><span class="line">mask = x &gt; <span class="number">0</span></span><br><span class="line">x[mask]                       <span class="comment"># é€‰å‡ºæ­£æ•°å…ƒç´ </span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="eval-å’Œ-trainçš„åˆ‡æ¢">eval å’Œ trainçš„åˆ‡æ¢</h2><p>evalå’Œtrainç±»ä¼¼ç°åœºä¿æŠ¤åŠŸèƒ½ï¼Œå¼€å…³åˆ‡æ¢switch off model.train()å°†æ¨¡å‹è®¾ç½®ä¸ºâ€œè®­ç»ƒæ¨¡å¼â€ã€‚è¿™ä¼šå¯ç”¨è¯¸å¦‚ Dropout å’Œ BatchNormè¿™æ ·çš„å±‚çš„è®­ç»ƒè¡Œä¸ºï¼ˆå¦‚å‚æ•°æ›´æ–°ã€éšæœºå¤±æ´»ç­‰ï¼‰ã€‚é€šå¸¸åœ¨è®­ç»ƒé˜¶æ®µè°ƒç”¨ã€‚</p><p>model.eval() å°†æ¨¡å‹è®¾ç½®ä¸ºâ€œè¯„ä¼°/æ¨ç†æ¨¡å¼â€ã€‚è¿™ä¼šå…³é—­ Dropoutã€BatchNormç­‰å±‚çš„è®­ç»ƒç‰¹æ€§ï¼Œä½¿ç”¨å›ºå®šå‚æ•°è¿›è¡Œæ¨ç†ã€‚é€šå¸¸åœ¨éªŒè¯æˆ–æµ‹è¯•é˜¶æ®µè°ƒç”¨<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line"><span class="keyword">for</span> split <span class="keyword">in</span> [<span class="string">&#x27;train&#x27;</span>, <span class="string">&#x27;val&#x27;</span>]:</span><br><span class="line">    losses = torch.zeros(eval_iters)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(eval_iters):</span><br><span class="line">        X, Y = get_batch(split)</span><br><span class="line">        logits, loss = model(X, Y)</span><br><span class="line">        losses[k] = loss.item()</span><br><span class="line">    out[split] = losses.mean()</span><br><span class="line">model.train()</span><br><span class="line"><span class="keyword">return</span> out</span><br></pre></td></tr></table></figure></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ–‡æ¡£è®°å½•äº†ä¸€äº›pytorchå¸¸ç”¨æ“ä½œä»¥åŠæ¦‚å¿µ&lt;/p&gt;</summary>
    
    
    
    
    <category term="pytorch" scheme="http://yoursite.com/tags/pytorch/"/>
    
  </entry>
  
  <entry>
    <title>integer solutions</title>
    <link href="http://yoursite.com/2024/11/08/integer-solutions/"/>
    <id>http://yoursite.com/2024/11/08/integer-solutions/</id>
    <published>2024-11-08T08:57:53.000Z</published>
    <updated>2025-05-22T05:50:40.064Z</updated>
    
    <content type="html"><![CDATA[<p>linear regession æˆ–è€…mpl ä¼šæ¶‰åŠåˆ°weight decay, æåŠæ•´æ•°è§£çš„é—®é¢˜ï¼škä¸ªå˜é‡ï¼Œdé˜¶çš„é¡¹ä¸€å…±æœ‰å¤šå°‘ç§ï¼Ÿ</p><p>é—®é¢˜æè¿° æˆ‘ä»¬æœ‰ $ k $ ä¸ªå˜é‡ $ x_1, x_2, , x_k $ï¼Œè¦æ±‚å®ƒä»¬çš„å’Œç­‰äº $d $ï¼Œå³ï¼š</p><p>$ x_1 + x_2 + + x_k = d $</p><h2 id="è‡ªç„¶æ•°è§£">è‡ªç„¶æ•°è§£</h2><p>ä» ( d - 1 ) ä¸ªä½ç½®ä¸­é€‰æ‹© ( k - 1 )ä¸ªä½ç½®æ”¾ç½®éš”æ¿ï¼Œå…¶ä½™çš„ä½ç½®æ”¾ç½®æ˜Ÿæ˜Ÿã€‚</p><p>è¿™å¯ä»¥ç”¨ç»„åˆæ•°è¡¨ç¤ºä¸ºï¼š</p><p>$ = $</p><h2 id="éè´Ÿæ•´æ•°è§£">éè´Ÿæ•´æ•°è§£</h2><p>åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæ¯ä¸ªå˜é‡ $ x_i $å¯ä»¥å–0ã€‚è¿™æ„å‘³ç€åœ¨åˆ†é…è¿‡ç¨‹ä¸­ï¼ŒæŸäº›å˜é‡å¯èƒ½ä¸ä¼šè·å¾—ä»»ä½•å•ä½ã€‚å› æ­¤ï¼Œä¸ºäº†è¡¨ç¤ºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ˜Ÿï¼ˆå•ä½ï¼‰ä¹‹é—´å…è®¸éš”æ¿ï¼ˆåˆ†éš”ç¬¦ï¼‰å½¼æ­¤ç›¸é‚»ï¼Œç”šè‡³ä½äºé¦–å°¾ä½ç½®ã€‚è¿™å°±å¢åŠ äº†æ’åˆ—ç»„åˆçš„çµæ´»æ€§ã€‚</p><span id="more"></span><p>å…·ä½“è§£é‡Šï¼š</p><p>å•ä½å’Œéš”æ¿çš„è¡¨ç¤ºï¼š</p><p>å•ä½ï¼ˆæ˜Ÿï¼‰ï¼šè¡¨ç¤ºè¦åˆ†é…çš„ $ d $ ä¸ªå•ä½ï¼Œç”¨ç¬¦å· <spanclass="math inline">\(\bullet\)</span> è¡¨ç¤ºã€‚ éš”æ¿ï¼ˆæ ï¼‰ï¼šç”¨äºåˆ†éš” $ k $ä¸ªå˜é‡ï¼Œç”¨ç¬¦å· <span class="math inline">\(|\)</span> è¡¨ç¤ºã€‚éœ€è¦ $ k - 1$ ä¸ªéš”æ¿æ¥åˆ†éš” $ k $ ä¸ªå˜é‡ã€‚ ä½ç½®æ€»æ•°ï¼š</p><p>æˆ‘ä»¬æœ‰ $ d $ ä¸ªå•ä½å’Œ $ k - 1 $ ä¸ªéš”æ¿ã€‚ å› æ­¤ï¼Œæ€»å…±æœ‰ $ d + k - 1 $ä¸ªä½ç½®ï¼Œç”¨äºæ”¾ç½®å•ä½å’Œéš”æ¿ã€‚ ç»„åˆæ•°è®¡ç®—ï¼š</p><p>åœ¨è¿™ $ d + k - 1 $ ä¸ªä½ç½®ä¸­ï¼Œé€‰æ‹© $ k - 1 $ä¸ªä½ç½®æ”¾ç½®éš”æ¿ï¼Œ<strong>å…¶ä½™ä½ç½®æ”¾ç½®å•ä½</strong>(æ³¨æ„è¿™é‡Œé€‰å®Œéš”æ¿çš„ä½ç½®åï¼Œå…¶ä»–çš„æ”¾ç½®å•ä½ç”¨æ¥æ”¾ç½®æ˜Ÿæ˜Ÿ)ã€‚è¿™ç§é€‰æ‹©çš„æ–¹å¼æ•°ä¸ºç»„åˆæ•°ï¼š $ = $</p><p>ä¾‹å­ å‡è®¾ $ k = 3 $ ä¸” $ d = 4 $ï¼Œæˆ‘ä»¬æœ‰ï¼š</p><p>$ x_1 + x_2 + x_3 = 4 $</p><p>ä½¿ç”¨æ˜Ÿä¸æ æ³•è¡¨ç¤ºä¸ºï¼š</p><p>$ | | $</p><p>è¿™è¡¨ç¤º $ x_1 = 2 <span class="math inline">\(ã€\)</span> x_2 = 1<span class="math inline">\(ã€\)</span> x_3 = 1 $ã€‚</p><p>å¦ä¸€ç§åˆ†é…æ–¹å¼ï¼š</p><p>$ | | $</p><p>è¿™è¡¨ç¤º $ x_1 = 3 <span class="math inline">\(ã€\)</span> x_2 = 0<span class="math inline">\(ã€\)</span> x_3 = 1 $ã€‚</p><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œéš”æ¿å’Œå•ä½è¦æ”¾åœ¨ä¸€èµ·è€ƒè™‘</p><h2 id="ä»kimiå¾—åˆ°çš„è§£é‡Š">ä»kimiå¾—åˆ°çš„è§£é‡Š:</h2><p>è¦ç†è§£ä¸ºä»€ä¹ˆæ–¹ç¨‹ <span class="math inline">\(x_1 + x_2 + \ldots + x_k= d\)</span> çš„éè´Ÿæ•´æ•°è§£çš„ä¸ªæ•°æ˜¯ <span class="math inline">\(\binom{d +k - 1}{k - 1}\)</span>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ˜Ÿæ¡å®šç†çš„ç›´è§‚è§£é‡Šã€‚</p><ol type="1"><li><p><strong>æ˜Ÿå·å’Œæ¡å½¢</strong>ï¼šæƒ³è±¡ä½ æœ‰ <spanclass="math inline">\(d\)</span>ä¸ªæ˜Ÿå·ï¼ˆä»£è¡¨æ€»å’Œï¼‰ï¼Œä½ éœ€è¦å°†è¿™äº›æ˜Ÿå·åˆ†é…åˆ° <spanclass="math inline">\(k\)</span>ä¸ªç®±å­ï¼ˆä»£è¡¨å˜é‡ï¼‰ä¸­ã€‚æ¯ä¸ªç®±å­è‡³å°‘å¯ä»¥æ”¾0ä¸ªæ˜Ÿå·ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¤„ç†çš„æ˜¯éè´Ÿæ•´æ•°è§£ã€‚</p></li><li><p><strong>æ”¾ç½®æ¡å½¢</strong>ï¼šä¸ºäº†å°†æ˜Ÿå·åˆ†æˆ <spanclass="math inline">\(k\)</span> ç»„ï¼Œä½ éœ€è¦ <spanclass="math inline">\(k-1\)</span>ä¸ªæ¡å½¢æ¥åˆ†éš”è¿™äº›ç»„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰3ä¸ªç®±å­ï¼Œä½ éœ€è¦2ä¸ªæ¡å½¢æ¥åˆ†éš”æ˜Ÿå·ã€‚</p></li><li><p><strong>æ€»ä½ç½®æ•°</strong>ï¼šç°åœ¨ï¼Œæˆ‘ä»¬æœ‰ <spanclass="math inline">\(d\)</span> ä¸ªæ˜Ÿå·å’Œ <spanclass="math inline">\(k-1\)</span> ä¸ªæ¡å½¢ï¼Œæ€»å…±æœ‰ <spanclass="math inline">\(d + k - 1\)</span> ä¸ªä½ç½®éœ€è¦å¡«å……ã€‚</p></li><li><p><strong>é€‰æ‹©æ¡å½¢ä½ç½®</strong>ï¼šé—®é¢˜ç°åœ¨å˜æˆäº†ä»è¿™ <spanclass="math inline">\(d + k - 1\)</span> ä¸ªä½ç½®ä¸­é€‰æ‹© <spanclass="math inline">\(k-1\)</span>ä¸ªä½ç½®æ¥æ”¾ç½®æ¡å½¢ã€‚<strong>å‰©ä¸‹çš„ä½ç½®å°†è‡ªåŠ¨è¢«æ˜Ÿå·å¡«å……</strong>ã€‚</p></li><li><p><strong>ç»„åˆè®¡ç®—</strong>ï¼šä» <span class="math inline">\(d + k -1\)</span> ä¸ªä½ç½®ä¸­é€‰æ‹© <span class="math inline">\(k-1\)</span>ä¸ªä½ç½®çš„æ–¹æ³•æ•°ç”±ç»„åˆå…¬å¼ <span class="math inline">\(\binom{d + k - 1}{k- 1}\)</span> ç»™å‡ºã€‚</p></li></ol><p>å› æ­¤ï¼Œæ–¹ç¨‹ <span class="math inline">\(x_1 + x_2 + \ldots + x_k =d\)</span> çš„éè´Ÿæ•´æ•°è§£çš„ä¸ªæ•°æ˜¯ <span class="math inline">\(\binom{d + k- 1}{k - 1}\)</span>ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;linear regession æˆ–è€…mpl ä¼šæ¶‰åŠåˆ°weight decay, æåŠæ•´æ•°è§£çš„é—®é¢˜ï¼š
kä¸ªå˜é‡ï¼Œdé˜¶çš„é¡¹ä¸€å…±æœ‰å¤šå°‘ç§ï¼Ÿ&lt;/p&gt;
&lt;p&gt;é—®é¢˜æè¿° æˆ‘ä»¬æœ‰ $ k $ ä¸ªå˜é‡ $ x_1, x_2, , x_k $ï¼Œè¦æ±‚å®ƒä»¬çš„å’Œç­‰äº $
d $ï¼Œå³ï¼š&lt;/p&gt;
&lt;p&gt;$ x_1 + x_2 + + x_k = d $&lt;/p&gt;
&lt;h2 id=&quot;è‡ªç„¶æ•°è§£&quot;&gt;è‡ªç„¶æ•°è§£&lt;/h2&gt;
&lt;p&gt;ä» ( d - 1 ) ä¸ªä½ç½®ä¸­é€‰æ‹© ( k - 1 )
ä¸ªä½ç½®æ”¾ç½®éš”æ¿ï¼Œå…¶ä½™çš„ä½ç½®æ”¾ç½®æ˜Ÿæ˜Ÿã€‚&lt;/p&gt;
&lt;p&gt;è¿™å¯ä»¥ç”¨ç»„åˆæ•°è¡¨ç¤ºä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$ = $&lt;/p&gt;
&lt;h2 id=&quot;éè´Ÿæ•´æ•°è§£&quot;&gt;éè´Ÿæ•´æ•°è§£&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæ¯ä¸ªå˜é‡ $ x_i $
å¯ä»¥å–0ã€‚è¿™æ„å‘³ç€åœ¨åˆ†é…è¿‡ç¨‹ä¸­ï¼ŒæŸäº›å˜é‡å¯èƒ½ä¸ä¼šè·å¾—ä»»ä½•å•ä½ã€‚å› æ­¤ï¼Œä¸ºäº†è¡¨ç¤ºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ˜Ÿï¼ˆå•ä½ï¼‰ä¹‹é—´å…è®¸éš”æ¿ï¼ˆåˆ†éš”ç¬¦ï¼‰å½¼æ­¤ç›¸é‚»ï¼Œç”šè‡³ä½äºé¦–å°¾ä½ç½®ã€‚è¿™å°±å¢åŠ äº†æ’åˆ—ç»„åˆçš„çµæ´»æ€§ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="math" scheme="http://yoursite.com/categories/math/"/>
    
    
    <category term="math,combination" scheme="http://yoursite.com/tags/math-combination/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨pandas å¯¹æ¯”csv æ–‡ä»¶</title>
    <link href="http://yoursite.com/2024/11/08/compare-csv-file/"/>
    <id>http://yoursite.com/2024/11/08/compare-csv-file/</id>
    <published>2024-11-08T05:43:34.000Z</published>
    <updated>2025-05-22T05:50:40.064Z</updated>
    
    <content type="html"><![CDATA[<p>é€šè¿‡pandas çš„compare functionï¼Œ å¯ä»¥å¯¹æ¯”ä¸¤ä¸ªcsv æ–‡ä»¶ç”¨é€”ï¼Œä¾‹å¦‚å‡çº§æˆ–ä¿®æ”¹codeä¹‹åï¼Œè¾“å‡ºæ˜¯csvæ–‡æœ¬æ–‡ä»¶ï¼Œå¯¹äºåŒæ ·inputçš„æ•°æ®ï¼Œé¢„æœŸåº”è¯¥ä¸€æ ·input -&gt; program -&gt; output input -&gt; program(optimize) -&gt;output_new expect output == output_new</p><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sample data</span></span><br><span class="line">data_control = &#123;</span><br><span class="line">    <span class="string">&#x27;ProductEntityId&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">    <span class="string">&#x27;ColumnA&#x27;</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>],</span><br><span class="line">    <span class="string">&#x27;ColumnB&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data_treatment = &#123;</span><br><span class="line">    <span class="string">&#x27;ProductEntityId&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">    <span class="string">&#x27;ColumnA&#x27;</span>: [<span class="number">10</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">40</span>],</span><br><span class="line">    <span class="string">&#x27;ColumnB&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">df_control = pd.DataFrame(data_control)</span><br><span class="line">df_treatment = pd.DataFrame(data_treatment)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set ProductEntityId as the index</span></span><br><span class="line">df_control.set_index(<span class="string">&#x27;ProductEntityId&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">df_treatment.set_index(<span class="string">&#x27;ProductEntityId&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find the intersection of the indices</span></span><br><span class="line">common_indices = df_control.index.intersection(df_treatment.index)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter both dataframes to only include the common indices</span></span><br><span class="line">df_control_common = df_control.loc[common_indices]</span><br><span class="line">df_treatment_common = df_treatment.loc[common_indices]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ensure both dataframes have the same columns</span></span><br><span class="line">df_treatment_common = df_treatment_common[df_control_common.columns]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compare the dataframes</span></span><br><span class="line">comparison_df = df_control_common.compare(df_treatment_common, keep_shape=<span class="literal">True</span>, keep_equal=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Highlight the differences</span></span><br><span class="line">first_level_columns = comparison_df.columns.get_level_values(<span class="number">0</span>).unique()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">highlight_differences</span>(<span class="params">row</span>):</span><br><span class="line">    styles = []</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> comparison_df.columns.levels[<span class="number">0</span>]:</span><br><span class="line">        self_val = row[(col, <span class="string">&#x27;self&#x27;</span>)]</span><br><span class="line">        other_val = row[(col, <span class="string">&#x27;other&#x27;</span>)]</span><br><span class="line">        <span class="keyword">if</span> (~pd.isna(self_val) <span class="keyword">or</span> ~pd.isna(other_val)) &amp; (self_val != other_val):</span><br><span class="line">            styles.append(<span class="string">&#x27;background-color: yellow&#x27;</span>)</span><br><span class="line">            styles.append(<span class="string">&#x27;background-color: yellow&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            styles.append(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            styles.append(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> styles</span><br><span class="line">highlighted_df = comparison_df.style.apply(highlight_differences, axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the highlighted dataframe</span></span><br><span class="line"><span class="comment"># highlighted_df</span></span><br><span class="line"><span class="comment"># write hightlighted dataframe to a file</span></span><br><span class="line">highlighted_df.to_excel(<span class="string">&quot;./highlighted_output.xlsx&quot;</span>, engine=<span class="string">&#x27;openpyxl&#x27;</span>, index=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;é€šè¿‡pandas çš„compare functionï¼Œ å¯ä»¥å¯¹æ¯”ä¸¤ä¸ªcsv æ–‡ä»¶
ç”¨é€”ï¼Œä¾‹å¦‚å‡çº§æˆ–ä¿®æ”¹codeä¹‹åï¼Œè¾“å‡ºæ˜¯csvæ–‡æœ¬æ–‡ä»¶ï¼Œå¯¹äºåŒæ ·inputçš„æ•°æ®ï¼Œé¢„æœŸåº”è¯¥ä¸€æ ·
input -&amp;gt; program -&amp;gt; output input -&amp;gt; program(optimize) -&amp;gt;
output_new expect output == output_new&lt;/p&gt;</summary>
    
    
    
    
    <category term="pandas" scheme="http://yoursite.com/tags/pandas/"/>
    
  </entry>
  
  <entry>
    <title>raspberry</title>
    <link href="http://yoursite.com/2024/06/04/raspberry/"/>
    <id>http://yoursite.com/2024/06/04/raspberry/</id>
    <published>2024-06-04T07:19:57.000Z</published>
    <updated>2025-05-22T05:50:40.080Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…">å®‰è£…</h2><p>64-bité•œåƒï¼š <ahref="https://downloads.raspberrypi.org/raspios_lite_arm64/images/raspios_lite_arm64-2021-05-28/"class="uri">https://downloads.raspberrypi.org/raspios_lite_arm64/images/raspios_lite_arm64-2021-05-28/</a></p><h2 id="è·å–æ ‘è“æ´¾ip">è·å–æ ‘è“æ´¾ip</h2><p>æ ‘è“æ´¾åœ¨æ¥å…¥è·¯ç”±å™¨åæ˜¯åŠ¨æ€åˆ†é…çš„ï¼Œéœ€è¦ä½¿ç”¨è·¯ç”±å™¨çš„ç®¡ç†ç•Œé¢æŸ¥çœ‹é“¾æ¥è®¾å¤‡çš„MACå’Œipåœ°å€å¦å¤–ä¸€ç§æ–¹å¼æ˜¯æ‰«æå½“å‰å±€åŸŸç½‘çš„è®¾å¤‡ä¿¡æ¯ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨IOSçš„FingAppå»å‘ç°å½“å‰è¿æ¥è®¾å¤‡ï¼Œä¸€èˆ¬æ ‘è“æ´¾çš„è®¾å¤‡åç§°æ˜¯Raspberryå¼€å¤´çš„</p><h2 id="æŒ‚è½½ç§»åŠ¨ç¡¬ç›˜">æŒ‚è½½ç§»åŠ¨ç¡¬ç›˜</h2><p><ahref="https://shumeipai.nxez.com/2013/09/08/raspberry-pi-to-mount-the-removable-hard-disk.html"class="uri">https://shumeipai.nxez.com/2013/09/08/raspberry-pi-to-mount-the-removable-hard-disk.html</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -o uid=pi,gid=pi /dev/sda1 /mnt/1GB_USB_flash</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="å®‰è£…samba">å®‰è£…samba</h2><p><a href="https://www.cnblogs.com/xiaowuyi/p/4051238.html"class="uri">https://www.cnblogs.com/xiaowuyi/p/4051238.html</a></p><h2 id="dlna">DLNA</h2><p><ahref="https://shumeipai.nxez.com/2015/07/12/raspberry-pi-install-dlna-streaming-media-server.html"class="uri">https://shumeipai.nxez.com/2015/07/12/raspberry-pi-install-dlna-streaming-media-server.html</a></p><h2 id="å¼€æœºæ‰§è¡ŒæŒ‡å®šè„šæœ¬">å¼€æœºæ‰§è¡ŒæŒ‡å®šè„šæœ¬</h2><p>ä¾‹å¦‚è„šæœ¬è·¯å¾„/home/pi/Documents/start.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">mount -o uid=pi,gid=pi /dev/sda1 /home/pi/Share</span><br><span class="line">/etc/init.d/smbd restart</span><br><span class="line">/etc/init.d/nmbd restart</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹æ–‡ä»¶ï¼š/etc/rc.local sudo vi /etc/rc.local åœ¨exit0ä¹‹å‰æ·»åŠ è¦æ‰§è¡Œè„šæœ¬çš„å‘½ä»¤å³å¯ï¼Œä¾‹å¦‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/rc.local</span></span><br><span class="line">â€¦â€¦</span><br><span class="line">sh /home/pi/Documents/start.sh</span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><h2 id="æ ¼å¼åŒ–uç›˜">æ ¼å¼åŒ–Uç›˜</h2><p>æ ¼å¼åŒ–ç¡¬ç›˜ï¼ˆUç›˜ï¼‰ 1.æ ‘è“æ´¾æˆåŠŸè¯†åˆ«ç¡¬ç›˜ sudo fdisk -l | grep '^Disk'2.æŸ¥çœ‹ç¡¬ç›˜æ ¼å¼ sudo blkid 3.æ ¼å¼åŒ–ä¸ºext4 sudo mkfs.ext4 /dev/sdaæŒ‚è½½ç¡¬ç›˜ï¼ˆUç›˜ï¼‰ 1.å»ºç«‹æŒ‚è½½ç‚¹ sudo mkdir /media/xxx#xxxä»£è¡¨ä½ çš„æŒ‚è½½ç‚¹åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰ 2.è®¾ç½®ç›®å½•çš„æ‰€æœ‰äººå’Œæ‰€æœ‰ç»„ sudo chownpi:pi /media/xxx 3.æŒ‚è½½ sudo mount -t ext4 /dev/sda /media/xxx4.ç¡®è®¤æŒ‚è½½ cd /media/xxx 5.å¸è½½ sudo umount /media/xxx 6.å¼€æœºè‡ªåŠ¨æŒ‚è½½æŸ¥çœ‹UUIDï¼šsudo blkid è®°ä¸‹UUIDï¼šå°†UUIDå¤åˆ¶ä¸‹æ¥ï¼ˆä¸è¦å¸¦å¼•å·ï¼‰å¤‡ä»½æ–‡ä»¶ï¼šsudo cp /etc/fstab /etc/fstab.bakup ç¼–è¾‘æ–‡ä»¶ï¼šsudo nano/etc/fstab æœ€åè¡ŒåŠ ä¸Šï¼š UUID=@@@ ï¼ˆ@@<span class="citation"data-cites="è¡¨ç¤ºåˆšåˆšå¤åˆ¶ä¸‹æ¥çš„UUID">@è¡¨ç¤ºåˆšåˆšå¤åˆ¶ä¸‹æ¥çš„UUID</span>ï¼‰ï¼ˆæ³¨æ„æ­¤å¤„æœ‰ä¸€ä¸ªç©ºæ ¼ï¼‰/media/xxxext4 defaults 0 0</p><h2 id="to-be-continue">To Be Continue</h2><p>å®‰è£…<a href="https://pigallery2.herokuapp.com/gallery/"class="uri">https://pigallery2.herokuapp.com/gallery/</a> <ahref="https://github.com/bpatrik/pigallery2/blob/master/docker/README.md"class="uri">https://github.com/bpatrik/pigallery2/blob/master/docker/README.md</a><a href="https://github.com/bpatrik/pigallery2"class="uri">https://github.com/bpatrik/pigallery2</a></p><h2 id="å‡ºç°é—®é¢˜">å‡ºç°é—®é¢˜</h2><p>docker å®‰è£…å®Œæˆåæµ‹è¯•hello-worldå‡ºç°é—®é¢˜ï¼ˆUnable to find image'hello-world:latest' locallyï¼‰ <ahref="https://blog.csdn.net/wireless911/article/details/88989620"class="uri">https://blog.csdn.net/wireless911/article/details/88989620</a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å®‰è£…&quot;&gt;å®‰è£…&lt;/h2&gt;
&lt;p&gt;64-bité•œåƒï¼š &lt;a
href=&quot;https://downloads.raspberrypi.org/raspios_lite_arm64/images/raspios_lite_arm64-2021-05-28/&quot;
class=&quot;uri&quot;&gt;https://downloads.raspberrypi.org/raspios_lite_arm64/images/raspios_lite_arm64-2021-05-28/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;è·å–æ ‘è“æ´¾ip&quot;&gt;è·å–æ ‘è“æ´¾ip&lt;/h2&gt;
&lt;p&gt;æ ‘è“æ´¾åœ¨æ¥å…¥è·¯ç”±å™¨åæ˜¯åŠ¨æ€åˆ†é…çš„ï¼Œéœ€è¦ä½¿ç”¨è·¯ç”±å™¨çš„ç®¡ç†ç•Œé¢æŸ¥çœ‹é“¾æ¥è®¾å¤‡çš„MACå’Œipåœ°å€
å¦å¤–ä¸€ç§æ–¹å¼æ˜¯æ‰«æå½“å‰å±€åŸŸç½‘çš„è®¾å¤‡ä¿¡æ¯ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨IOSçš„Fing
Appå»å‘ç°å½“å‰è¿æ¥è®¾å¤‡ï¼Œä¸€èˆ¬æ ‘è“æ´¾çš„è®¾å¤‡åç§°æ˜¯Raspberryå¼€å¤´çš„&lt;/p&gt;
&lt;h2 id=&quot;æŒ‚è½½ç§»åŠ¨ç¡¬ç›˜&quot;&gt;æŒ‚è½½ç§»åŠ¨ç¡¬ç›˜&lt;/h2&gt;
&lt;p&gt;&lt;a
href=&quot;https://shumeipai.nxez.com/2013/09/08/raspberry-pi-to-mount-the-removable-hard-disk.html&quot;
class=&quot;uri&quot;&gt;https://shumeipai.nxez.com/2013/09/08/raspberry-pi-to-mount-the-removable-hard-disk.html&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo mount -o uid=pi,gid=pi /dev/sda1 /mnt/1GB_USB_flash&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>computer_version</title>
    <link href="http://yoursite.com/2024/06/04/computer-version/"/>
    <id>http://yoursite.com/2024/06/04/computer-version/</id>
    <published>2024-06-04T07:18:59.000Z</published>
    <updated>2025-05-22T05:50:40.064Z</updated>
    
    <content type="html"><![CDATA[<h1 id="yolo">YOLO</h1><h2 id="yolo-æŸå¤±å‡½æ•°ç¬¬äºŒéƒ¨åˆ†">1. YOLO æŸå¤±å‡½æ•°ç¬¬äºŒéƒ¨åˆ†</h2><p>å¯¹äºwidth, heightçš„loss, ä½œè€…åœ¨è®ºæ–‡ä¸­è¯´æ˜ä½¿ç”¨square rootçš„åŸå› ï¼š&gt;Our error metric should reflect that small deviations in large boxesmatter less than in small boxes. To partially address this we predictthe square root of the bounding box width and height instead of thewidth and height directly. ç»è¿‡å®é™…è®¡ç®—æ¼”ç¤ºå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">width_height_loss</span>(<span class="params">w, h, error_shift=<span class="number">30</span></span>):</span><br><span class="line">    <span class="keyword">return</span> math.<span class="built_in">pow</span>((math.sqrt(w)-math.sqrt(w-erro_shift)),<span class="number">2</span>) + math.<span class="built_in">pow</span>((math.sqrt(h)-math.sqrt(h+erro_shift)),<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(width_height_loss(<span class="number">300</span>,<span class="number">500</span>))</span><br><span class="line"><span class="built_in">print</span>(width_height_loss(<span class="number">100</span>,<span class="number">150</span>))</span><br><span class="line">&gt;&gt; <span class="number">1.22700707099</span></span><br><span class="line">&gt;&gt; <span class="number">4.03446019009</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°å¦‚æ­¤è®¾è®¡åï¼Œç¡®å®èƒ½èµ·åˆ°å¦‚å…¶æ‰€è¯´losså¯¹å°çš„bboxæ¯”è¾ƒæ•æ„Ÿï¼Œæƒ©ç½šåº¦è¾ƒå¤§ï¼Œè€Œå¯¹å¤§bbboxåˆ™åä¹‹ã€‚ç©¶å…¶åŸå› ï¼Œéœ€è¦ç”»ä¸€ä¸‹æ­¤å‡½æ•°çš„æ›²çº¿ï¼š <span class="math display">\[f(x) = (\sqrt{x} -\sqrt{x-10})^2\]</span> ä»æ›²çº¿å¯ä»¥ç›´è§‚çš„çœ‹åˆ°å•è°ƒæ€§ <span id="more"></span></p><h1 id="yolov3">YOLOV3</h1><h2 id="èµ„æ–™é“¾æ¥">1. èµ„æ–™é“¾æ¥</h2><p>YOLO-V3 çš„ç½‘ç»œç»“æ„å›¾è§£æï¼š <ahref="https://blog.csdn.net/qq_37541097/article/details/81214953"class="uri">https://blog.csdn.net/qq_37541097/article/details/81214953</a></p><p><a href="https://zhuanlan.zhihu.com/p/25052190"class="uri">https://zhuanlan.zhihu.com/p/25052190</a> <ahref="https://zhuanlan.zhihu.com/p/70387154"class="uri">https://zhuanlan.zhihu.com/p/70387154</a> <ahref="https://zhuanlan.zhihu.com/p/76802514"class="uri">https://zhuanlan.zhihu.com/p/76802514</a></p><h2 id="ç½‘ç»œç»“æ„">2. ç½‘ç»œç»“æ„</h2><p>Yolov3 architecture <ahref="https://blog.csdn.net/qq_37541097/article/details/81214953"class="uri">https://blog.csdn.net/qq_37541097/article/details/81214953</a><imgsrc="https://img-blog.csdnimg.cn/2019040211084050.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3NTQxMDk3,size_16,color_FFFFFF,t_70"alt="æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°" /></p><h2 id="å®ç°éƒ¨åˆ†">3. å®ç°éƒ¨åˆ†</h2><p>Yolov3.cfgå„å‚æ•°è¯´æ˜ï¼š<ahref="https://blog.csdn.net/ll_master/article/details/81487844"class="uri">https://blog.csdn.net/ll_master/article/details/81487844</a>Yolov3.cfgè¾“å‡ºçš„ç½‘ç»œç»“æ„ï¼Œè¾“å…¥416x416x3ï¼Œä»£ç ï¼š<ahref="https://pjreddie.com/darknet/yolo/"class="uri">https://pjreddie.com/darknet/yolo/</a>è¿è¡Œdarknet.pyä¸­æ¥å£è¾“å‡ºçš„ç½‘ç»œç»“æ„ï¼Œå¯ä»¥å¯¹æ¯”ä¸Šé¢YOLOv3ç»“æ„ç†è§£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">Using TensorFlow backend.</span><br><span class="line">layer     filters    size              input                output</span><br><span class="line">    0 conv     32  3 x 3 / 1   416 x 416 x   3   -&gt;   416 x 416 x  32  0.299 BFLOPs</span><br><span class="line">    1 conv     64  3 x 3 / 2   416 x 416 x  32   -&gt;   208 x 208 x  64  1.595 BFLOPs</span><br><span class="line">    2 conv     32  1 x 1 / 1   208 x 208 x  64   -&gt;   208 x 208 x  32  0.177 BFLOPs</span><br><span class="line">    3 conv     64  3 x 3 / 1   208 x 208 x  32   -&gt;   208 x 208 x  64  1.595 BFLOPs</span><br><span class="line">    4 res    1                 208 x 208 x  64   -&gt;   208 x 208 x  64</span><br><span class="line">    5 conv    128  3 x 3 / 2   208 x 208 x  64   -&gt;   104 x 104 x 128  1.595 BFLOPs</span><br><span class="line">    6 conv     64  1 x 1 / 1   104 x 104 x 128   -&gt;   104 x 104 x  64  0.177 BFLOPs</span><br><span class="line">    7 conv    128  3 x 3 / 1   104 x 104 x  64   -&gt;   104 x 104 x 128  1.595 BFLOPs</span><br><span class="line">    8 res    5                 104 x 104 x 128   -&gt;   104 x 104 x 128</span><br><span class="line">    9 conv     64  1 x 1 / 1   104 x 104 x 128   -&gt;   104 x 104 x  64  0.177 BFLOPs</span><br><span class="line">   10 conv    128  3 x 3 / 1   104 x 104 x  64   -&gt;   104 x 104 x 128  1.595 BFLOPs</span><br><span class="line">   11 res    8                 104 x 104 x 128   -&gt;   104 x 104 x 128</span><br><span class="line">   12 conv    256  3 x 3 / 2   104 x 104 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">   13 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128  0.177 BFLOPs</span><br><span class="line">   14 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">   15 res   12                  52 x  52 x 256   -&gt;    52 x  52 x 256</span><br><span class="line">   16 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128  0.177 BFLOPs</span><br><span class="line">   17 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">   18 res   15                  52 x  52 x 256   -&gt;    52 x  52 x 256</span><br><span class="line">   19 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128  0.177 BFLOPs</span><br><span class="line">   20 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">   21 res   18                  52 x  52 x 256   -&gt;    52 x  52 x 256</span><br><span class="line">   22 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128  0.177 BFLOPs</span><br><span class="line">   23 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">   24 res   21                  52 x  52 x 256   -&gt;    52 x  52 x 256</span><br><span class="line">   25 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128  0.177 BFLOPs</span><br><span class="line">   26 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">   27 res   24                  52 x  52 x 256   -&gt;    52 x  52 x 256</span><br><span class="line">   28 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128  0.177 BFLOPs</span><br><span class="line">   29 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">   30 res   27                  52 x  52 x 256   -&gt;    52 x  52 x 256</span><br><span class="line">   31 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128  0.177 BFLOPs</span><br><span class="line">   32 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">   33 res   30                  52 x  52 x 256   -&gt;    52 x  52 x 256</span><br><span class="line">   34 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128  0.177 BFLOPs</span><br><span class="line">   35 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">   36 res   33                  52 x  52 x 256   -&gt;    52 x  52 x 256</span><br><span class="line">   37 conv    512  3 x 3 / 2    52 x  52 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   38 conv    256  1 x 1 / 1    26 x  26 x 512   -&gt;    26 x  26 x 256  0.177 BFLOPs</span><br><span class="line">   39 conv    512  3 x 3 / 1    26 x  26 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   40 res   37                  26 x  26 x 512   -&gt;    26 x  26 x 512</span><br><span class="line">   41 conv    256  1 x 1 / 1    26 x  26 x 512   -&gt;    26 x  26 x 256  0.177 BFLOPs</span><br><span class="line">   42 conv    512  3 x 3 / 1    26 x  26 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   43 res   40                  26 x  26 x 512   -&gt;    26 x  26 x 512</span><br><span class="line">   44 conv    256  1 x 1 / 1    26 x  26 x 512   -&gt;    26 x  26 x 256  0.177 BFLOPs</span><br><span class="line">   45 conv    512  3 x 3 / 1    26 x  26 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   46 res   43                  26 x  26 x 512   -&gt;    26 x  26 x 512</span><br><span class="line">   47 conv    256  1 x 1 / 1    26 x  26 x 512   -&gt;    26 x  26 x 256  0.177 BFLOPs</span><br><span class="line">   48 conv    512  3 x 3 / 1    26 x  26 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   49 res   46                  26 x  26 x 512   -&gt;    26 x  26 x 512</span><br><span class="line">   50 conv    256  1 x 1 / 1    26 x  26 x 512   -&gt;    26 x  26 x 256  0.177 BFLOPs</span><br><span class="line">   51 conv    512  3 x 3 / 1    26 x  26 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   52 res   49                  26 x  26 x 512   -&gt;    26 x  26 x 512</span><br><span class="line">   53 conv    256  1 x 1 / 1    26 x  26 x 512   -&gt;    26 x  26 x 256  0.177 BFLOPs</span><br><span class="line">   54 conv    512  3 x 3 / 1    26 x  26 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   55 res   52                  26 x  26 x 512   -&gt;    26 x  26 x 512</span><br><span class="line">   56 conv    256  1 x 1 / 1    26 x  26 x 512   -&gt;    26 x  26 x 256  0.177 BFLOPs</span><br><span class="line">   57 conv    512  3 x 3 / 1    26 x  26 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   58 res   55                  26 x  26 x 512   -&gt;    26 x  26 x 512</span><br><span class="line">   59 conv    256  1 x 1 / 1    26 x  26 x 512   -&gt;    26 x  26 x 256  0.177 BFLOPs</span><br><span class="line">   60 conv    512  3 x 3 / 1    26 x  26 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   61 res   58                  26 x  26 x 512   -&gt;    26 x  26 x 512</span><br><span class="line">   62 conv   1024  3 x 3 / 2    26 x  26 x 512   -&gt;    13 x  13 x1024  1.595 BFLOPs</span><br><span class="line">   63 conv    512  1 x 1 / 1    13 x  13 x1024   -&gt;    13 x  13 x 512  0.177 BFLOPs</span><br><span class="line">   64 conv   1024  3 x 3 / 1    13 x  13 x 512   -&gt;    13 x  13 x1024  1.595 BFLOPs</span><br><span class="line">   65 res   62                  13 x  13 x1024   -&gt;    13 x  13 x1024</span><br><span class="line">   66 conv    512  1 x 1 / 1    13 x  13 x1024   -&gt;    13 x  13 x 512  0.177 BFLOPs</span><br><span class="line">   67 conv   1024  3 x 3 / 1    13 x  13 x 512   -&gt;    13 x  13 x1024  1.595 BFLOPs</span><br><span class="line">   68 res   65                  13 x  13 x1024   -&gt;    13 x  13 x1024</span><br><span class="line">   69 conv    512  1 x 1 / 1    13 x  13 x1024   -&gt;    13 x  13 x 512  0.177 BFLOPs</span><br><span class="line">   70 conv   1024  3 x 3 / 1    13 x  13 x 512   -&gt;    13 x  13 x1024  1.595 BFLOPs</span><br><span class="line">   71 res   68                  13 x  13 x1024   -&gt;    13 x  13 x1024</span><br><span class="line">   72 conv    512  1 x 1 / 1    13 x  13 x1024   -&gt;    13 x  13 x 512  0.177 BFLOPs</span><br><span class="line">   73 conv   1024  3 x 3 / 1    13 x  13 x 512   -&gt;    13 x  13 x1024  1.595 BFLOPs</span><br><span class="line">   74 res   71                  13 x  13 x1024   -&gt;    13 x  13 x1024</span><br><span class="line">   --------------------------------------------------------------------------------</span><br><span class="line">   75 conv    512  1 x 1 / 1    13 x  13 x1024   -&gt;    13 x  13 x 512  0.177 BFLOPs</span><br><span class="line">   76 conv   1024  3 x 3 / 1    13 x  13 x 512   -&gt;    13 x  13 x1024  1.595 BFLOPs</span><br><span class="line">   77 conv    512  1 x 1 / 1    13 x  13 x1024   -&gt;    13 x  13 x 512  0.177 BFLOPs  Convolutional Set</span><br><span class="line">   78 conv   1024  3 x 3 / 1    13 x  13 x 512   -&gt;    13 x  13 x1024  1.595 BFLOPs</span><br><span class="line">   79 conv    512  1 x 1 / 1    13 x  13 x1024   -&gt;    13 x  13 x 512  0.177 BFLOPs</span><br><span class="line">   --------------------------------------------------------------------------------</span><br><span class="line">   80 conv   1024  3 x 3 / 1    13 x  13 x 512   -&gt;    13 x  13 x1024  1.595 BFLOPs</span><br><span class="line">   81 conv    255  1 x 1 / 1    13 x  13 x1024   -&gt;    13 x  13 x 255  0.088 BFLOPs</span><br><span class="line">   82 yolo</span><br><span class="line">   83 route  79</span><br><span class="line">   84 conv    256  1 x 1 / 1    13 x  13 x 512   -&gt;    13 x  13 x 256  0.044 BFLOPs</span><br><span class="line">   85 upsample            2x    13 x  13 x 256   -&gt;    26 x  26 x 256</span><br><span class="line">   86 route  85 61</span><br><span class="line">   --------------------------------------------------------------------------------</span><br><span class="line">   87 conv    256  1 x 1 / 1    26 x  26 x 768   -&gt;    26 x  26 x 256  0.266 BFLOPs</span><br><span class="line">   88 conv    512  3 x 3 / 1    26 x  26 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   89 conv    256  1 x 1 / 1    26 x  26 x 512   -&gt;    26 x  26 x 256  0.177 BFLOPs  Convolutional Set</span><br><span class="line">   90 conv    512  3 x 3 / 1    26 x  26 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   91 conv    256  1 x 1 / 1    26 x  26 x 512   -&gt;    26 x  26 x 256  0.177 BFLOPs</span><br><span class="line">   --------------------------------------------------------------------------------</span><br><span class="line">   92 conv    512  3 x 3 / 1    26 x  26 x 256   -&gt;    26 x  26 x 512  1.595 BFLOPs</span><br><span class="line">   93 conv    255  1 x 1 / 1    26 x  26 x 512   -&gt;    26 x  26 x 255  0.177 BFLOPs</span><br><span class="line">   94 yolo</span><br><span class="line">   95 route  91</span><br><span class="line">   96 conv    128  1 x 1 / 1    26 x  26 x 256   -&gt;    26 x  26 x 128  0.044 BFLOPs</span><br><span class="line">   97 upsample            2x    26 x  26 x 128   -&gt;    52 x  52 x 128</span><br><span class="line">   98 route  97 36</span><br><span class="line">   --------------------------------------------------------------------------------</span><br><span class="line">   99 conv    128  1 x 1 / 1    52 x  52 x 384   -&gt;    52 x  52 x 128  0.266 BFLOPs</span><br><span class="line">  100 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">  101 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128  0.177 BFLOPs  Convolutional Set</span><br><span class="line">  102 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">  103 conv    128  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 128  0.177 BFLOPs</span><br><span class="line">  --------------------------------------------------------------------------------</span><br><span class="line">  104 conv    256  3 x 3 / 1    52 x  52 x 128   -&gt;    52 x  52 x 256  1.595 BFLOPs</span><br><span class="line">  105 conv    255  1 x 1 / 1    52 x  52 x 256   -&gt;    52 x  52 x 255  0.353 BFLOPs</span><br><span class="line">  106 yolo</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;yolo&quot;&gt;YOLO&lt;/h1&gt;
&lt;h2 id=&quot;yolo-æŸå¤±å‡½æ•°ç¬¬äºŒéƒ¨åˆ†&quot;&gt;1. YOLO æŸå¤±å‡½æ•°ç¬¬äºŒéƒ¨åˆ†&lt;/h2&gt;
&lt;p&gt;å¯¹äºwidth, heightçš„loss, ä½œè€…åœ¨è®ºæ–‡ä¸­è¯´æ˜ä½¿ç”¨square rootçš„åŸå› ï¼š
&amp;gt;Our error metric should reflect that small deviations in large boxes
matter less than in small boxes. To partially address this we predict
the square root of the bounding box width and height instead of the
width and height directly. ç»è¿‡å®é™…è®¡ç®—æ¼”ç¤ºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;width_height_loss&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;w, h, error_shift=&lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; math.&lt;span class=&quot;built_in&quot;&gt;pow&lt;/span&gt;((math.sqrt(w)-math.sqrt(w-erro_shift)),&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;) + math.&lt;span class=&quot;built_in&quot;&gt;pow&lt;/span&gt;((math.sqrt(h)-math.sqrt(h+erro_shift)),&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(width_height_loss(&lt;span class=&quot;number&quot;&gt;300&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(width_height_loss(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;150&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt; &lt;span class=&quot;number&quot;&gt;1.22700707099&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt; &lt;span class=&quot;number&quot;&gt;4.03446019009&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥å‘ç°å¦‚æ­¤è®¾è®¡åï¼Œç¡®å®èƒ½èµ·åˆ°å¦‚å…¶æ‰€è¯´losså¯¹å°çš„bboxæ¯”è¾ƒæ•æ„Ÿï¼Œæƒ©ç½šåº¦è¾ƒå¤§ï¼Œè€Œå¯¹å¤§bbboxåˆ™åä¹‹ã€‚
ç©¶å…¶åŸå› ï¼Œéœ€è¦ç”»ä¸€ä¸‹æ­¤å‡½æ•°çš„æ›²çº¿ï¼š &lt;span class=&quot;math display&quot;&gt;\[
f(x) = (\sqrt{x} -\sqrt{x-10})^2
\]&lt;/span&gt; ä»æ›²çº¿å¯ä»¥ç›´è§‚çš„çœ‹åˆ°å•è°ƒæ€§</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>photograpy</title>
    <link href="http://yoursite.com/2024/06/04/photograpy/"/>
    <id>http://yoursite.com/2024/06/04/photograpy/</id>
    <published>2024-06-04T07:17:38.000Z</published>
    <updated>2025-05-22T05:50:40.080Z</updated>
    
    <content type="html"><![CDATA[<h2 id="camera-raw">Camera Raw</h2><p>Basic Panelä¸­ å¯¹äºæ¯ä¸€ä¸ªå¯è°ƒèŠ‚çš„æ»‘å—ï¼š</p><ul><li>åŒå‡»æ»‘å—å¯å›å¤åŸå§‹å€¼</li><li>æŒ‰ä½shiftåŒå‡»æ»‘å—å¯è‡ªåŠ¨è°ƒæ•´ <ahref="https://helpx.adobe.com/cn/camera-raw/using/make-color-tonal-adjustments-camera.html">å‚è€ƒ</a></li></ul><blockquote><p>åœ¨è‡ªåŠ¨è°ƒæ•´è‰²è°ƒæ—¶ï¼ŒCamera Rawå¿½ç•¥ä»¥å‰åœ¨å…¶å®ƒé€‰é¡¹å¡ä¸­è¿›è¡Œçš„ä»»ä½•è°ƒæ•´ï¼ˆå¦‚åœ¨â€œè‰²è°ƒæ›²çº¿â€é€‰é¡¹å¡ä¸­å¯¹è‰²è°ƒè¿›è¡Œçš„å¾®è°ƒï¼‰ã€‚å› æ­¤ï¼Œå…ˆåº”ç”¨è‡ªåŠ¨è‰²è°ƒè°ƒæ•´ï¼ˆå¦‚æœæœ‰ï¼‰ä»¥è·å–å›¾åƒæœ€ä½³è®¾ç½®çš„åˆå§‹è¿‘ä¼¼å€¼ã€‚å¦‚æœåœ¨æ‹æ‘„æ—¶å¾ˆç»†å¿ƒå¹¶æœ‰æ„ä½¿ç”¨ä¸åŒçš„æ›å…‰åº¦è¿›è¡Œæ‹æ‘„ï¼Œæ‚¨å¯èƒ½ä¸å¸Œæœ›åº”ç”¨è‡ªåŠ¨è‰²è°ƒè°ƒæ•´ä»¥æ”¾å¼ƒæ‰€åšçš„å·¥ä½œã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‚¨ä¸å–œæ¬¢æ‰€åšçš„è°ƒæ•´ï¼Œå¯éšæ—¶å°è¯•å•å‡»â€œè‡ªåŠ¨â€å¹¶æ’¤æ¶ˆè¿™äº›è°ƒæ•´ã€‚ä¸ºä»€ä¹ˆç™½å¹³è¡¡ä¸‹é¢éœ€è¦è®¾ç½®è‰²è°ƒè¡¥å¿ç»¿è‰²å¥½ç´«è‰²ï¼ˆtint)</p></blockquote><p><ahref="https://photo.stackexchange.com/questions/104920/why-does-white-balance-knob-have-green-and-purple-setting">æŸ¥é˜…</a>&gt;A daunting task, because humans see using an eye/brain combinationthat alters our visualization of the world. This mechanism is eyeindependent. Try this experiment. Procure some transparent colorfilters, cellophane (candy wrappers work nicely). Filter one eye onlywith a deep red filter. Keep the filter in place for about 2 minutes.Remove the filter and then peer about quickly looking with one eye, thenthe other. You will find that the filter eye has radically changed as toits color balance. That eye will see the world with a blue-green tint.Try this again with yellow or blue or green cellophane. Each filterrapidly alters the filtered eye color balance. This adaptive mechanismoccurs every minute of every day, to both eyes. You will be witnessingthe human ability to adapt and normalize when the ambient light isoff-color. &gt; With some minor exceptions (special color films) colorphotography had to wait till the advent of electronic imaging. Now wehave â€œwhite balanceâ€, a camera mechanism that attempts to mimic ourability to adapt to light source alterations. Photography adopted colorâ€œtemperatureâ€. Scientist verified that blacksmiths, glazers, potters andother workers (smiths) were able to regulate the temperatures of thematerials of their craft visually by color changes as the material isheated. Seems all materials glow with alike outputs as they are heatedto incandescence. Black red 426Â°C --- Dark red 593Â°C â€“ Cherry red 815Â°Câ€“ Yellow 1093Â°C â€“ White 1315Â°+ etc. Now physicists prefer the Celsiusscale and they respect an adaptation known as the Absolute Scale. Thisis the Celsius scale with zero set to -273Â°C. This is the rock-bottomtemperature so starting zero at this value avoids the possibility ofnegative temperatures. The champion of Absolute scale was WilliamThomson, 1st Baron Kelvin. In his honor, the Absolute scale was renamedKelvin scale. Color films and now digital imaging and light sources aretypically categorized using the Kelvin scale. Candle 1850K â€“ Standard60W tungsten lamp 2400K â€“ Studio tungsten bulb 3200K -- Daylight 5500K.Images taken under various lighting conditions often yield results thatare not faithful reproduction. The traditional countermeasure was tomount a color correction optical filter before the lens. These areshades of blue to reverse reddish ambient light from tungsten sourcesand salmon (pink-amber) to neutralize the excessive bluish tints ofnorth-sky daylight. Digital settings to correct off color lightingconditions are warming or cooling offsets.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;camera-raw&quot;&gt;Camera Raw&lt;/h2&gt;
&lt;p&gt;Basic Panelä¸­ å¯¹äºæ¯ä¸€ä¸ªå¯è°ƒèŠ‚çš„æ»‘å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŒå‡»æ»‘å—å¯å›å¤åŸå§‹å€¼&lt;/li&gt;
&lt;li&gt;æŒ‰ä½shiftåŒå‡»æ»‘å—å¯è‡ªåŠ¨è°ƒæ•´ &lt;a
href=&quot;https://hel</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>tensorflow</title>
    <link href="http://yoursite.com/2024/06/04/tensorflow/"/>
    <id>http://yoursite.com/2024/06/04/tensorflow/</id>
    <published>2024-06-04T07:14:36.000Z</published>
    <updated>2025-05-22T05:50:40.080Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸºæœ¬å…ƒç´ ">åŸºæœ¬å…ƒç´ </h2><h3 id="tf.variable">tf.Variable(â€¦â€¦)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">A = tf.Variable(<span class="number">3</span>, name=<span class="string">&quot;number&quot;</span>)</span><br><span class="line">B = tf.Variable([<span class="number">1</span>,<span class="number">3</span>], name=<span class="string">&quot;vector&quot;</span>)</span><br><span class="line">C = tf.Variable([[<span class="number">0</span>,<span class="number">1</span>],[<span class="number">2</span>,<span class="number">3</span>]], name=<span class="string">&quot;matrix&quot;</span>)</span><br><span class="line">D = tf.Variable(tf.zeros([<span class="number">100</span>]), name=<span class="string">&quot;zero&quot;</span>)</span><br><span class="line">E = tf.Variable(tf.random_normal([<span class="number">2</span>,<span class="number">3</span>], mean=<span class="number">1</span>, stddev=<span class="number">2</span>, dtype=tf.float32))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æŠŠå‡½æ•°variable()ç†è§£ä¸ºæ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°çš„ä½¿ç”¨éœ€è¦åˆå§‹å€¼ï¼Œè€Œè¿™ä¸ªåˆå§‹å€¼æ˜¯ä¸€ä¸ªä»»ä½•å½¢çŠ¶ã€ç±»å‹çš„Tensorã€‚å˜é‡æœ‰ä¸¤ä¸ªé‡è¦çš„æ­¥éª¤ï¼Œå…ˆåä¸ºï¼š</p><ul><li>åˆ›å»º</li><li>åˆå§‹åŒ–</li></ul><p>å˜é‡åœ¨ä½¿ç”¨å‰ä¸€å®šè¦è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸”å˜é‡çš„åˆå§‹åŒ–å¿…é¡»åœ¨æ¨¡å‹çš„å…¶å®ƒæ“ä½œè¿è¡Œä¹‹å‰å®Œæˆï¼Œé€šå¸¸ï¼Œå˜é‡çš„åˆå§‹åŒ–æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><ul><li>1.åˆå§‹åŒ–å…¨éƒ¨å˜é‡<code>init = tf.global_variables_initializer()</code>global_variables_initializer()æ–¹æ³•æ˜¯ä¸ç®¡å…¨å±€æœ‰å¤šå°‘ä¸ªå˜é‡ï¼Œå…¨éƒ¨è¿›è¡Œåˆå§‹åŒ–ï¼Œæ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ–¹å¼ï¼›</li><li>2.åˆå§‹åŒ–å˜é‡çš„å­é›†<code>init_subset=tf.variables_initializer([b,c], name="init_subset")</code>variables_initializer()æ˜¯åˆå§‹åŒ–å˜é‡çš„å­é›†ï¼Œç›¸æ¯”äºå…¨éƒ¨åˆå§‹åŒ–åŒ–çš„æ–¹å¼æ›´åŠ èŠ‚çº¦å†…å­˜</li><li>3.åˆå§‹åŒ–å•ä¸ªå˜é‡</li></ul><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nit_var = tf.Variable(tf.zeros([<span class="number">2</span>,<span class="number">5</span>]))</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(init_var.initializer)</span><br></pre></td></tr></table></figure><p>Variable()æ˜¯åˆå§‹åŒ–å•ä¸ªå˜é‡ï¼Œå‡½æ•°çš„å‚æ•°ä¾¿æ˜¯è¦åˆå§‹åŒ–çš„å˜é‡å†…å®¹ã€‚</p><h3id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨tf.global_variables_initializer">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨tf.global_variables_initializer()ï¼Ÿ</h3><p>å‚è€ƒåšå®¢<ahref="https://blog.csdn.net/qq_37285386/article/details/89054090">ã€ä»»æ„é—¨ã€‘</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="comment"># å¿…é¡»è¦ä½¿ç”¨global_variables_initializerçš„åœºåˆ</span></span><br><span class="line"><span class="comment"># å«æœ‰tf.Variableçš„ç¯å¢ƒä¸‹ï¼Œå› ä¸ºtfä¸­å»ºç«‹çš„å˜é‡æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨debugæ—¶è¿˜ä¸æ˜¯ä¸€ä¸ªtensoré‡ï¼Œè€Œæ˜¯ä¸€ä¸ªVariableå˜é‡ç±»å‹</span></span><br><span class="line">size_out = <span class="number">10</span></span><br><span class="line">tensor = tf.Variable(tf.random_normal(shape=[size_out]))</span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(init)  <span class="comment"># initialization variables</span></span><br><span class="line">    <span class="built_in">print</span>(sess.run(tensor))</span><br><span class="line"><span class="comment"># å¯ä»¥ä¸é€‚ç”¨åˆå§‹åŒ–çš„åœºåˆ</span></span><br><span class="line"><span class="comment"># ä¸å«æœ‰tf.Variableã€tf.get_Variableçš„ç¯å¢ƒä¸‹</span></span><br><span class="line"><span class="comment"># æ¯”å¦‚åªæœ‰tf.random_normalæˆ–tf.constantç­‰</span></span><br><span class="line">size_out = <span class="number">10</span></span><br><span class="line">tensor = tf.random_normal(shape=[size_out])  <span class="comment"># è¿™é‡Œdebugæ˜¯ä¸€ä¸ªtensoré‡å“¦</span></span><br><span class="line"><span class="comment">#init = tf.global_variables_initializer()</span></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    <span class="comment"># sess.run(init)  # initialization variables</span></span><br><span class="line">    <span class="built_in">print</span>(sess.run(tensor))</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯tf.placeholderä¹Ÿæ˜¯tensorï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼Œtf.Variableæ˜¯éœ€è¦ç”³è¯·å­˜å‚¨ï¼ˆæ˜¾å­˜/å†…å­˜ï¼‰çš„å˜é‡ï¼Œè€Œtensor:</p><ol type="1"><li>è®¡ç®—å›¾ä¸Šè®¡ç®—çš„ä¸­é—´ç»“æœï¼Œæ¯”å¦‚operation</li><li>å¸¸é‡ï¼Œæ¯”å¦‚tf.random_normal, tf.constant</li><li>ç­‰å¾…è¾“å…¥çš„placeholderï¼ˆä¸éœ€è¦åˆå§‹åŒ–ï¼Œç­‰å¾…feed data)å¸¸è§çš„è®¡ç®—ç³»ç»Ÿï¼Œæ— éæ˜¯æ“ä½œæ•°ï¼Œè¿ç®—ç¬¦ï¼Œç„¶åæ˜¯å­˜å‚¨å™¨ï¼Œå¦‚æœæ–½åŠ è¿ç®—ç¬¦çš„æ­¥éª¤ä¸å†ç«‹åˆ»æ‰§è¡Œï¼Œè€Œæ˜¯æœ€åè®¡ç®—ï¼Œé‚£ä¹ˆè¿™äº›ä¸­æ„ç»“æœå°±æ²¡å¿…è¦ä¸€å¼€å§‹ç”³è¯·å­˜å‚¨ï¼Œè¿™ä¾¿æ˜¯tensorçš„ç”±æ¥ã€‚</li></ol><h3 id="è·å–graphçš„åç§°">è·å–graphçš„åç§°</h3><p>å‚è€ƒ<ahref="https://stackoverflow.com/questions/36883949/in-tensorflow-get-the-names-of-all-the-tensors-in-a-graph">stackoverflow</a></p><ul><li>To get all nodes:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">all_nodes = [n <span class="keyword">for</span> n <span class="keyword">in</span> tf.get_default_graph().as_graph_def().node]</span><br><span class="line">These have the <span class="built_in">type</span> tensorflow.core.framework.node_def_pb2.NodeDef</span><br></pre></td></tr></table></figure><ul><li>To get all ops:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">all_ops = tf.get_default_graph().get_operations()</span><br><span class="line">These have the <span class="built_in">type</span> tensorflow.python.framework.ops.Operation</span><br></pre></td></tr></table></figure><ul><li>To get all variables:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">all_vars = tf.global_variables()</span><br><span class="line">These have the <span class="built_in">type</span> tensorflow.python.ops.resource_variable_ops.ResourceVariable</span><br></pre></td></tr></table></figure><ul><li>And finally, to answer the question, to get all tensors:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_tensors = [tensor <span class="keyword">for</span> op <span class="keyword">in</span> tf.get_default_graph().get_operations() <span class="keyword">for</span> tensor <span class="keyword">in</span> op.values()]</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•">æ–¹æ³•</h2><h3 id="tf.reduce_sumçš„ç†è§£">tf.reduce_sumçš„ç†è§£</h3><p><a href="https://www.jianshu.com/p/30b40b504bae"class="uri">https://www.jianshu.com/p/30b40b504bae</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tf.reduce_sum(</span><br><span class="line">    input_tensor, </span><br><span class="line">    axis=None, </span><br><span class="line">    keepdims=None,</span><br><span class="line">    name=None,</span><br><span class="line">    reduction_indices=None, </span><br><span class="line">    keep_dims=None)</span><br></pre></td></tr></table></figure><ul><li>0ç»´ï¼Œåˆç§°0ç»´å¼ é‡ï¼Œæ•°å­—ï¼Œæ ‡é‡ï¼š1</li><li>1ç»´ï¼Œåˆç§°1ç»´å¼ é‡ï¼Œæ•°ç»„ï¼Œvectorï¼š[1, 2, 3]</li><li>2ç»´ï¼Œåˆç§°2ç»´å¼ é‡ï¼ŒçŸ©é˜µï¼ŒäºŒç»´æ•°ç»„ï¼š[[1,2], [3,4]]</li><li>3ç»´ï¼Œåˆç§°3ç»´å¼ é‡ï¼Œç«‹æ–¹ï¼ˆcubeï¼‰ï¼Œä¸‰ç»´æ•°ç»„ï¼š[ [[1,2], [3,4]], [[5,6],[7,8]] ]</li><li>nç»´ï¼šä½ åº”è¯¥getåˆ°ç‚¹äº†å§~</li></ul><p><strong>å†å¤šçš„ç»´åªä¸è¿‡æ˜¯æ˜¯æŠŠä¸Šä¸€ä¸ªç»´åº¦å½“ä½œè‡ªå·±çš„å…ƒç´ </strong><strong>è¶Šå¾€é‡Œaxiså°±è¶Šå¤§ï¼Œä¾æ¬¡åŠ 1</strong>ä¸‹é¢ä¸¾ä¸ªå¤šç»´tensorä¾‹å­ç®€å•è¯´æ˜ã€‚ä¸‹é¢æ˜¯ä¸ª 2 <em>3</em> 4 çš„tensorã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[[[ 1   2   3   4]</span><br><span class="line">  [ 5   6   7   8]</span><br><span class="line">  [ 9   10 11 12]],</span><br><span class="line"> [[ 13  14 15 16]</span><br><span class="line">  [ 17  18 19 20]</span><br><span class="line">  [ 21  22 23 24]]]</span><br></pre></td></tr></table></figure><p>tf.reduce_sum(tensor, axis=0) axis=0è¯´æ˜æ˜¯æŒ‰ç¬¬ä¸€ä¸ªç»´åº¦è¿›è¡Œæ±‚å’Œã€‚é‚£ä¹ˆæ±‚å’Œç»“æœshapeæ˜¯3*4</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[1+13   2+14   3+15 4+16]</span><br><span class="line"> [5+17   6+18   7+19 8+20]</span><br><span class="line"> [9+21 10+22 11+23 12+24]]</span><br></pre></td></tr></table></figure><p>ä¾æ¬¡ç±»æ¨ï¼Œå¦‚æœaxis=1ï¼Œé‚£ä¹ˆæ±‚å’Œç»“æœshapeæ˜¯2*4ï¼Œå³ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[ 1 + 5 + 9   2 + 6+10   3 + 7+11   4 + 8+12]</span><br><span class="line"> [13+17+21     14+18+22   15+19+23   16+20+24]]</span><br></pre></td></tr></table></figure><p>å¦‚æœaxis=2ï¼Œé‚£ä¹ˆæ±‚å’Œç»“æœshapeæ˜¯2*3ï¼Œå³ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[1+2+3+4          5+6+7+8          9+10+11+12]</span><br><span class="line"> [13+14+15+16      17+18+19+20      1+22+23+24]]</span><br></pre></td></tr></table></figure><h3 id="tf.stackçš„ç†è§£">tf.stackçš„ç†è§£</h3><p><ahref="https://stackoverflow.com/questions/50820781/quesion-about-the-axis-of-tf-stack/50821422#50821422"class="uri">https://stackoverflow.com/questions/50820781/quesion-about-the-axis-of-tf-stack/50821422#50821422</a>tf.stackå¯ä»¥ç†è§£ä¸ºå…ˆå¯¹éœ€è¦stackçš„tensoråšexpand_dimsï¼Œæ·»åŠ ä¸€ç»´ï¼Œæ·»åŠ çš„ä½ç½®å³axisï¼Œç„¶ååœ¨è¿™ä¸€axisä¸Šåšconcate</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def tf.stack(tensors, axis=0):</span><br><span class="line">    return tf.concatenate([tf.expand_dims(t, axis=axis) for t in tensors], axis=axis)</span><br></pre></td></tr></table></figure><h3id="å…·æœ‰å…ˆåé¡ºåºsynchronizeçš„è®¡ç®—">å…·æœ‰å…ˆåé¡ºåºï¼Œsynchronizeçš„è®¡ç®—</h3><ul><li>tf.GraphKeys.UPDATE_OPS</li><li>tf.control_dependencies</li></ul><p><ahref="https://blog.csdn.net/huitailangyz/article/details/85015611">å‚è€ƒèµ„æ–™</a><code>tf.GraphKeys.UPDATE_OPS</code> å’Œ<code>tf.control_dependencies</code>æ­é…ä½¿ç”¨ï¼Œç”¨æ¥é™åˆ¶ä¸€äº›æœ‰å…ˆåå…³ç³»çš„èŠ‚ç‚¹è¿ç®—<code>tf.control_dependencies</code>ï¼Œè¯¥å‡½æ•°ä¿è¯å…¶<strong>ä½œç”¨åŸŸä¸­çš„æ“ä½œ</strong>å¿…é¡»è¦åœ¨è¯¥å‡½æ•°æ‰€ä¼ é€’çš„<strong>å‚æ•°ä¸­çš„æ“ä½œ</strong>å®Œæˆåå†è¿›è¡Œï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªè¿ç®—</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">a_1 = tf.Variable(<span class="number">1</span>)</span><br><span class="line">b_1 = tf.Variable(<span class="number">2</span>)</span><br><span class="line">update_op = tf.assign(a_1, <span class="number">10</span>)</span><br><span class="line">add = tf.add(a_1, b_1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒä¸ªè¿ç®—</span></span><br><span class="line">a_2 = tf.Variable(<span class="number">1</span>)</span><br><span class="line">b_2 = tf.Variable(<span class="number">2</span>)</span><br><span class="line">update_op = tf.assign(a_2, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">with</span> tf.control_dependencies([update_op]):</span><br><span class="line">    add_with_dependencies = tf.add(a_2, b_2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(tf.global_variables_initializer())</span><br><span class="line">    ans_1, ans_2 = sess.run([add, add_with_dependencies])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Add: &quot;</span>, ans_1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Add_with_dependency: &quot;</span>, ans_2)</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">Add:  <span class="number">3</span></span><br><span class="line">Add_with_dependency:  <span class="number">12</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¸Šé¢ä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªupdate_op å¯¹å˜é‡åšäº†åŠ ä¸€æ“ä½œï¼Œ<strong>ä½†æ­£å¸¸çš„è®¡ç®—å›¾åœ¨è®¡ç®—addæ—¶æ˜¯ä¸ä¼šç»è¿‡update_opæ“ä½œ</strong>ï¼Œæ‰€ä»¥æ²¡æœ‰ç”Ÿæ•ˆã€‚äºtf.GraphKeys.UPDATE_OPSï¼Œè¿™æ˜¯ä¸€ä¸ªtensorflowçš„è®¡ç®—å›¾ä¸­å†…ç½®çš„ä¸€ä¸ªé›†åˆï¼Œå…¶ä¸­ä¼šä¿å­˜ä¸€äº›éœ€è¦åœ¨è®­ç»ƒæ“ä½œä¹‹å‰å®Œæˆçš„æ“ä½œï¼Œå¹¶é…åˆtf.control_dependencieså‡½æ•°ä½¿ç”¨ã€‚è‡³äº<code>tf.GraphKeys.UPDATE_OPS</code>çš„ä½œç”¨ï¼Œå¯ä»¥åœ¨BatchNormalizationçš„ä¾‹å­ä¸­ç†è§£å…¶ä½œç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tf.add_to_collection(tf.GraphKeys.UPDATE_OPS, train_mean)</span><br><span class="line">â€¦â€¦</span><br><span class="line">update_ops = tf.get_collection(tf.GraphKeys.UPDATE_OPS)</span><br><span class="line"><span class="built_in">print</span>(update_ops)</span><br><span class="line"><span class="keyword">with</span> tf.control_dependencies(update_ops):</span><br><span class="line">    train_op = optimizer.minimize(loss)</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ª<code>tf.add_to_collection</code>åœ¨è¿™é‡Œæ˜¯å°†éœ€è¦å…ˆè®¡ç®—çš„Meanå’ŒvaråŠ å…¥UPDATE_OPSä¸­ï¼Œè¿™æ ·&gt;å¦‚æœä¸åœ¨ä½¿ç”¨æ—¶æ·»åŠ tf.control_dependencieså‡½æ•°ï¼Œå³åœ¨è®­ç»ƒæ—¶(training=True)æ¯æ‰¹æ¬¡æ—¶åªä¼šè®¡ç®—å½“æ‰¹æ¬¡çš„meanå’Œvarï¼Œå¹¶ä¼ é€’ç»™tf.nn.batch_normalizationè¿›è¡Œå½’ä¸€åŒ–ï¼Œç”±äºmean_updateå’Œvariance_updateåœ¨è®¡ç®—å›¾ä¸­å¹¶ä¸åœ¨ä¸Šè¿°æ“ä½œçš„ä¾èµ–è·¯å¾„ä¸Šï¼Œå› ä¸ºå¹¶ä¸ä¼šä¸»åŠ¨å®Œæˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è®­ç»ƒæ—¶mean_updateå’Œvariance_updateå¹¶ä¸ä¼šè¢«ä½¿ç”¨åˆ°ï¼Œå…¶å€¼sfsfafsfafafdafaä¸€ç›´æ˜¯åˆå§‹å€¼ã€‚å› æ­¤åœ¨æµ‹è¯•é˜¶æ®µ(training=False)ä½¿ç”¨è¿™ä¸¤ä¸ªä½œä¸ºmeanå’Œvarianceå¹¶è¿›è¡Œå½’ä¸€åŒ–æ“ä½œï¼Œè¿™æ ·å°±ä¼šå‡ºç°é”™è¯¯ã€‚è€Œå¦‚æœä½¿ç”¨tf.control_dependencieså‡½æ•°ï¼Œä¼šåœ¨è®­ç»ƒé˜¶æ®µæ¯æ¬¡è®­ç»ƒæ“ä½œæ‰§è¡Œå‰è¢«åŠ¨åœ°å»æ‰§è¡Œmean_updateå’Œvariance_updateï¼Œå› æ­¤moving_meanå’Œmoving_varianceä¼šè¢«ä¸æ–­æ›´æ–°ï¼Œåœ¨æµ‹è¯•æ—¶ä½¿ç”¨è¯¥å‚æ•°ä¹Ÿå°±ä¸ä¼šå‡ºç°é”™è¯¯ã€‚</p><h3 id="embedding-å’Œ-lookuptable-link">embedding å’Œ lookupTable [<ahref="https://gshtime.github.io/2018/06/01/tensorflow-embedding-lookup-sparse/">link</a>]</h3><p>feature_num : åŸå§‹ç‰¹å¾æ•° embedding_size: embeddingä¹‹åçš„ç‰¹å¾æ•°[feature_num, embedding_size] æƒé‡çŸ©é˜µshape [m, feature_num]è¾“å…¥çŸ©é˜µshapeï¼Œmä¸ºæ ·æœ¬æ•° [m, embedding_size]è¾“å‡ºçŸ©é˜µshapeï¼Œmä¸ºæ ·æœ¬æ•°</p><p>embedding_lookupä¸æ˜¯ç®€å•çš„æŸ¥è¡¨ï¼Œ<ahref="https://gshtime.github.io/2018/06/01/tensorflow-embedding-lookup-sparse/">paramså¯¹åº”çš„å‘é‡æ˜¯å¯ä»¥è®­ç»ƒçš„</a>ï¼Œè®­ç»ƒå‚æ•°ä¸ªæ•°åº”è¯¥æ˜¯ feature_num *embedding_sizeï¼Œå³å‰æ–‡è¡¨è¿°çš„embeddingå±‚æƒé‡çŸ©é˜µï¼Œå°±æ˜¯è¯´ lookupçš„æ˜¯ä¸€ç§å…¨è¿æ¥å±‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“è¾“å…¥å•ä¸ªtensoræ—¶ï¼Œpartition_strategyä¸èµ·ä½œç”¨ï¼Œä¸åš idï¼ˆç¼–å·ï¼‰ çš„åˆ‡åˆ†</span></span><br><span class="line">a = np.arange(<span class="number">20</span>).reshape(<span class="number">5</span>,<span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span> (a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‰é¢çš„ç¼–å·æ˜¯æˆ‘æ‰‹åŠ¨åŠ çš„ï¼Œæ„æ€æ˜¯ä¸åšåˆ‡åˆ†çš„æ—¶å€™å°±é¡ºåºç¼–å·å°±è¡Œ</span></span><br><span class="line"><span class="comment"># 0#[[ 0  1  2  3]</span></span><br><span class="line"><span class="comment"># 1# [ 4  5  6  7]</span></span><br><span class="line"><span class="comment"># 2# [ 8  9 10 11]</span></span><br><span class="line"><span class="comment"># 3# [12 13 14 15]</span></span><br><span class="line"><span class="comment"># 4# [16 17 18 19]]</span></span><br><span class="line"></span><br><span class="line">tensor_a = tf.Variable(a)</span><br><span class="line">embedded_tensor = tf.nn.embedding_lookup(params=tensor_a, ids=[<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>])</span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(init)</span><br><span class="line">    embedded_tensor = sess.run(embedded_tensor)</span><br><span class="line">    <span class="built_in">print</span>(embedded_tensor)</span><br><span class="line"><span class="comment"># æ ¹æ® ids å‚æ•°åšé€‰æ‹©</span></span><br><span class="line"><span class="comment">#[[ 0  1  2  3]  é€‰æ‹©äº† id 0</span></span><br><span class="line"><span class="comment"># [12 13 14 15]  é€‰æ‹©äº† id 3</span></span><br><span class="line"><span class="comment"># [ 8  9 10 11]  é€‰æ‹©äº† id 2</span></span><br><span class="line"><span class="comment"># [ 4  5  6  7]] é€‰æ‹©äº† id 1</span></span><br></pre></td></tr></table></figure><h3 id="loss-function">loss function</h3><p><a href="https://zhuanlan.zhihu.com/p/44216830"class="uri">https://zhuanlan.zhihu.com/p/44216830</a></p><h4 id="å›å½’">å›å½’</h4><p>tf.losses.mean_squared_error tf.losses.absolute_differencetf.losses.huber_lossï¼šHuber loss</p><h4 id="åˆ†ç±»">åˆ†ç±»</h4><p>tf.nn.sigmoid_cross_entropy_with_logits tf.losses.log_losstf.nn.softmax_cross_entropy_with_logits_v2tf.nn.sparse_softmax_cross_entropy_with_logitstf.nn.weighted_cross_entropy_with_logits tf.losses.hinge_loss</p><h5id="tf.softmax_cross_entropy_with_logits">tf.softmax_cross_entropy_with_logits</h5><p>tf.softmax_cross_entropy_with_logits()çš„è®¡ç®—è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥:</p><ul><li>1ï¼‰å°†logitsè½¬æ¢æˆæ¦‚ç‡ <span class="math display">\[ l_k =\frac{e^k}{\sum_{i=1}^{n}{e^i}} \]</span></li><li>2ï¼‰è®¡ç®—äº¤å‰ç†µæŸå¤± <span class="math display">\[ -\Sigma y&#39;*log(y)\]</span></li></ul><p>æ³¨æ„äº‹é¡¹ï¼š èˆ¬è®­ç»ƒæ—¶batchsizeä¸ä¼šä¸ºè®¾ä¸º1,æ‰€ä»¥è¦ä½¿ç”¨tf.reduce_mean()æ¥å¯¹tf.softmax_cross_entropy_with_logits()çš„ç»“æœå–å¹³å‡,å¾—åˆ°å…³äºæ ·æœ¬çš„å¹³å‡äº¤å‰ç†µæŸå¤±.</p><h2 id="è°ƒè¯•">è°ƒè¯•</h2><h3 id="tf.print">tf.Print</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â€¦â€¦</span><br><span class="line">var = tf.concat([var_a, var_b])</span><br><span class="line">var = tf.Print(var, [var_a, var_b], message=&quot;print message in there&quot;, summarized=10000)</span><br></pre></td></tr></table></figure><p>tf.Printç±»ä¼¼identityï¼ŒæŒ‚è½½åˆ°å›¾ä¸Šï¼Œä½†ä¸å½±å“å›¾ç»“æ„ï¼Œæ‰€ä»¥å³ä½¿æ˜¯checkpointä¹Ÿå¯ä»¥æ‰“å°è®¡ç®—çš„ä¸­é—´ç»“æœï¼Œæ–¹ä¾¿è¯Šæ–­é—®é¢˜ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¾…æ‰“å°çš„å˜é‡éœ€æ˜¯å›¾ä¸­æµè¿‡varçš„ä¸Šç«¯èŠ‚ç‚¹tensor</p><h3 id="tf.cond">tf.cond</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import tensorflow as tf</span><br><span class="line"></span><br><span class="line">a = tf.constant(2)</span><br><span class="line">b = tf.constant(3)</span><br><span class="line">x = tf.constant(4)</span><br><span class="line">y = tf.constant(5)</span><br><span class="line">z = tf.multiply(a, b)</span><br><span class="line">result = tf.cond(x &lt; y, lambda: tf.add(x, z), lambda: tf.square(y))</span><br><span class="line">with tf.Session() as session:</span><br><span class="line">    print(result.eval())</span><br></pre></td></tr></table></figure><h2 id="same-å’Œ-padding">same å’Œ padding</h2><p><span class="math display">\[\left\lceil\frac{n_{i}+p_{i}-k+1}{s}\right\rceil=n_{o}\]</span> <span class="math inline">\(n_i\)</span> ä¸ºinput_size <spanclass="math inline">\(n_o\)</span> ä¸ºoutput_size <spanclass="math inline">\(k\)</span> ä¸º kernel size <spanclass="math inline">\(s\)</span> ä¸º stride <spanclass="math inline">\(p_i\)</span> ä¸º padding size <ahref="https://www.jianshu.com/p/b9eb4758118d"class="uri">https://www.jianshu.com/p/b9eb4758118d</a></p><h2id="session.runabcä¸­å˜é‡çš„é¡ºåº">Session.run([a,b,c])ä¸­å˜é‡çš„é¡ºåº</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss_val, _ = sess.run([loss, optimizer])</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸Šé¢é‡åˆ°çš„é—®é¢˜ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ€€ç–‘ï¼Œè¿™ä¸ªLossåˆ°åº•æ˜¯backpropgationä¹‹å‰çš„è¿˜æ˜¯ä¹‹åçš„ï¼Ÿåœ¨æŸ¥çœ‹<ahref="https://stackoverflow.com/questions/53165418/order-of-sess-runop1-op2-in-tensorflow">stackoverflow</a>ä¸Šçš„è§£ç­”ï¼Œå‘ç°sess.runä¸­çš„å˜é‡æ±‚è§£æ˜¯ä¸ç¡®å®šçš„ã€‚ä¸Šé¢çš„ä»£ç æ±‚è§£çš„æ˜¯BPä¹‹å‰çš„ï¼Œtensorflowä¸ºäº†ä¿è¯ä¸é‡å¤è®¡ç®—ï¼Œå›¾ä¸­èŠ‚ç‚¹å·²ç»è®¡ç®—è¿‡çš„ä¼šç›´æ¥å–å‡ºï¼Œè‹¥æƒ³è·å–BPä¹‹åçš„Loss,å¯é€šè¿‡å¦‚ä¸‹æ–¹å¼ï¼š</p><ol type="1"><li>å†æ¬¡sess.run([loss])</li><li>å®šä¹‰ä¸€ä¸ªloss_end tensor,</li><li>ä½¿ç”¨tf.control_dependencies([optimizer])æ¥è§„å®šä¾èµ–</li></ol><h2 id="session-å’Œ-graph-çš„å…³ç³»">Session å’Œ Graph çš„å…³ç³»</h2><p><ahref="https://www.easy-tensorflow.com/tf-tutorials/basics/graph-and-session"class="uri">https://www.easy-tensorflow.com/tf-tutorials/basics/graph-and-session</a>ç½‘ç»œç»è¿‡å®šä¹‰ç„¶åè®­ç»ƒåå¾—çš„å‚æ•°ä¿å­˜åœ¨sessionä¸­è€Œégraphä¸­ï¼Œgraphåªæ˜¯ç½‘è·¯ç»“æ„çš„è¡¨è¿°ã€‚</p><h2 id="loss-function-1">Loss Function</h2><p><a href="https://zhuanlan.zhihu.com/p/44216830"class="uri">https://zhuanlan.zhihu.com/p/44216830</a></p><h3 id="tf.nn.sigmoid_cross_entropy_with_logits">1.tf.nn.sigmoid_cross_entropy_with_logits</h3><p>å…ˆ sigmoidå†æ±‚äº¤å‰ç†µ,äºŒåˆ†ç±»é—®é¢˜é¦–é€‰,ä½¿ç”¨æ—¶ï¼Œä¸€å®šä¸è¦å°†é¢„æµ‹å€¼ï¼ˆy_predï¼‰è¿›è¡Œ sigmoidå¤„ç†ï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°å·²ç»åŒ…å«äº†sigmoidè¿‡ç¨‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Tensorflowä¸­é›†æˆçš„å‡½æ•°</span><br><span class="line">sigmoids = tf.nn.sigmoid_cross_entropy_with_logits(labels=y, logits=y_pred)</span><br><span class="line">sigmoids_loss = tf.reduce_mean(sigmoids)</span><br><span class="line"></span><br><span class="line"># åˆ©ç”¨TensorflowåŸºç¡€å‡½æ•°æ‰‹å·¥å®ç°</span><br><span class="line">y_pred_si = 1.0/(1+tf.exp(-y_pred))</span><br><span class="line">sigmoids = -y_true*tf.log(y_pred_si) - (1-y_true)*tf.log(1-y_pred_si)</span><br><span class="line">sigmoids_loss = tf.reduce_mean(sigmoids)</span><br></pre></td></tr></table></figure><h3 id="tf.losses.log_loss">2. tf.losses.log_loss</h3><p>é¢„æµ‹å€¼ï¼ˆy_predï¼‰è®¡ç®—å®Œæˆåï¼Œè‹¥å·²å…ˆè¡Œè¿›è¡Œäº† sigmoidå¤„ç†ï¼Œåˆ™ä½¿ç”¨æ­¤å‡½æ•°æ±‚ loss ï¼Œè‹¥è¿˜æ²¡ç»è¿‡ sigmoid å¤„ç†ï¼Œå¯ç›´æ¥ä½¿ç”¨sigmoid_cross_entropy_with_logitsã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Tensorflowä¸­é›†æˆçš„å‡½æ•°</span><br><span class="line">logs = tf.losses.log_loss(labels=y, logits=y_pred)</span><br><span class="line">logs_loss = tf.reduce_mean(logs)</span><br><span class="line"></span><br><span class="line"># åˆ©ç”¨TensorflowåŸºç¡€å‡½æ•°æ‰‹å·¥å®ç°</span><br><span class="line">logs = -y_true*tf.log(y_pred) - (1-y_true)*tf.log(1-y_pred)</span><br><span class="line">logs_loss = tf.reduce_mean(logs)</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å‹å¯¼å‡ºå’Œæ¢å¤">æ¨¡å‹å¯¼å‡ºå’Œæ¢å¤</h2><p><ahref="https://www.jianshu.com/p/c3a7f5c47b83">TensorFlowï¼šä¿å­˜å’Œæå–æ¨¡å‹</a></p><h3 id="æ¨¡å‹æ¢å¤">æ¨¡å‹æ¢å¤</h3><h4 id="savedmodel">savedModel</h4><p><ahref="https://blog.csdn.net/mogoweb/article/details/83054861">å¦‚ä½•æŸ¥çœ‹TensorflowSavedModelæ ¼å¼æ¨¡å‹çš„ä¿¡æ¯</a>signatureå¹¶éæ˜¯ä¸ºäº†ä¿è¯æ¨¡å‹ä¸è¢«ä¿®æ”¹çš„é‚£ç§ç”µå­ç­¾åã€‚ç±»ä¼¼äºç¼–ç¨‹è¯­è¨€ä¸­æ¨¡å—çš„è¾“å…¥è¾“å‡ºä¿¡æ¯ï¼Œæ¯”å¦‚å‡½æ•°åï¼Œè¾“å…¥å‚æ•°ç±»å‹ï¼Œè¾“å‡ºå‚æ•°ç±»å‹ç­‰ç­‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.platform <span class="keyword">import</span> gfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.core.protobuf <span class="keyword">import</span> saved_model_pb2</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.util <span class="keyword">import</span> compat</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">  model_filename =<span class="string">&#x27;./model/saved_model.pb&#x27;</span></span><br><span class="line">  <span class="keyword">with</span> gfile.FastGFile(model_filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"></span><br><span class="line">    data = compat.as_bytes(f.read())</span><br><span class="line">    sm = saved_model_pb2.SavedModel()</span><br><span class="line">    sm.ParseFromString(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="number">1</span> != <span class="built_in">len</span>(sm.meta_graphs):</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;More than one graph found. Not sure which to write&#x27;</span>)</span><br><span class="line">      sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    g_in = tf.import_graph_def(sm.meta_graphs[<span class="number">0</span>].graph_def)</span><br><span class="line">LOGDIR=<span class="string">&#x27;./logdir&#x27;</span></span><br><span class="line">train_writer = tf.summary.FileWriter(LOGDIR)</span><br><span class="line">train_writer.add_graph(sess.graph)</span><br><span class="line">train_writer.flush()</span><br><span class="line">train_writer.close()</span><br></pre></td></tr></table></figure><p>å¦å¤–å¯å‚è€ƒstackoverflowçš„æ€»ç»“ <ahref="https://stackoverflow.com/questions/33759623/tensorflow-how-to-save-restore-a-model"class="uri">https://stackoverflow.com/questions/33759623/tensorflow-how-to-save-restore-a-model</a></p><h2 id="tensorflow-ä¸»æµç¨‹">Tensorflow ä¸»æµç¨‹</h2><h3 id="æ¢¯åº¦æ›´æ–°éƒ¨åˆ†">æ¢¯åº¦æ›´æ–°éƒ¨åˆ†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.control_dependencies(update_ops):</span><br><span class="line">    optimizer = tf.train.GradientDescentOptimizer(learning_rate)</span><br><span class="line"><span class="comment"># è®¡ç®—æ¢¯åº¦ï¼Œgrads_and_vars æ˜¯ä¸€ä¸ªlistï¼š(gradient, variable)ï¼Œå˜é‡å’Œå˜é‡å¯¹åº”çš„æ¢¯åº¦    </span></span><br><span class="line">grads_and_vars = optimizer.compute_gradients(loss)</span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># ...... (æ­¤å¤„å¯ä»¥åš æ¢¯åº¦ä¿®å»ºç­‰æ“ä½œï¼Œç„¶åå†å¯¹å˜é‡æ›´æ–°æ¢¯åº¦ï¼‰</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># æ‰§è¡Œå¯¹åº”å˜é‡çš„æ›´æ–°æ¢¯åº¦æ“ä½œ</span></span><br><span class="line">train_op = optimizer.apply_gradients(grad_vars, global_step=global_step)</span><br></pre></td></tr></table></figure><h3 id="tf.summary">tf.Summary</h3><p><a href="https://zhuanlan.zhihu.com/p/31459527"class="uri">https://zhuanlan.zhihu.com/p/31459527</a> <ahref="https://www.cnblogs.com/lyc-seu/p/8647792.html"class="uri">https://www.cnblogs.com/lyc-seu/p/8647792.html</a></p><h2 id="keras-backend-tensorflow">Keras backend tensorflow</h2><p>keras å’Œ tensorflow-gpuç‰ˆæœ¬å…¼å®¹åˆ—è¡¨ <ahref="https://docs.floydhub.com/guides/environments/"class="uri">https://docs.floydhub.com/guides/environments/</a>åº”å¯¹ä¸åŒtensorlow-gpuå¥½cudaç‰ˆæœ¬çš„å®‰è£…<code>conda install tensorflow-gpu==1.9.0 cudatoolkit==8.0</code></p><h2 id="tensorboard">Tensorboard</h2><p>å¤šä¸ªmodelå¯¹æ¯”train, validationæ•ˆæœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensorboard --logdir=name1:/path/to/logs/1,name2:/path/to/logs/2</span><br></pre></td></tr></table></figure><p>demo ä¾‹å­: <ahref="https://blog.csdn.net/qiu931110/article/details/80137287"class="uri">https://blog.csdn.net/qiu931110/article/details/80137287</a>è®²è§£ï¼š<a href="https://cloud.tencent.com/developer/section/1475708"class="uri">https://cloud.tencent.com/developer/section/1475708</a></p><h1 id="åˆ†å¸ƒå¼">åˆ†å¸ƒå¼</h1><h2 id="åˆ†å¸ƒå¼-1">åˆ†å¸ƒå¼</h2><p><ahref="https://yq.aliyun.com/articles/603370">å‚è€ƒèµ„æ–™:æµ…æ˜¾æ˜“æ‡‚çš„åˆ†å¸ƒå¼TensorFlowå…¥é—¨æ•™ç¨‹</a></p><h3 id="ç³»ç»Ÿä¼šåŒ…å«ä¸‰ç§ç±»å‹çš„èŠ‚ç‚¹">ç³»ç»Ÿä¼šåŒ…å«ä¸‰ç§ç±»å‹çš„èŠ‚ç‚¹</h3><ul><li><strong>ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°æœåŠ¡å™¨ï¼ˆps server)</strong>ï¼Œç”¨æ¥å­˜æ”¾æ¨¡å‹</li><li><strong>ä¸€ä¸ªä¸»worker</strong>ï¼Œç”¨æ¥åè°ƒè®­ç»ƒæ“ä½œï¼Œè´Ÿè´£æ¨¡å‹çš„åˆå§‹åŒ–ï¼Œä¸ºè®­ç»ƒæ­¥éª¤è®¡æ•°ï¼Œä¿å­˜æ¨¡å‹åˆ°checkpointsä¸­ï¼Œä»checkpointsä¸­è¯»å–æ¨¡å‹ï¼Œå‘TensorBoardä¸­ä¿å­˜summariesï¼ˆéœ€è¦å±•ç¤ºçš„ä¿¡æ¯ï¼‰ã€‚ä¸»workerè¿˜è¦è´Ÿè´£åˆ†å¸ƒå¼è®¡ç®—çš„å®¹é”™æœºåˆ¶ï¼ˆå¦‚æœå‚æ•°æœåŠ¡å™¨æˆ–workeræœåŠ¡å™¨å´©æºƒï¼‰ã€‚</li><li><strong>workeræœåŠ¡å™¨ï¼ˆåŒ…æ‹¬ä¸»workeræœåŠ¡å™¨ï¼‰</strong>ï¼Œç”¨æ¥æ‰§è¡Œè®­ç»ƒæ“ä½œï¼Œå¹¶å‘å‚æ•°æœåŠ¡å™¨å‘é€æ›´æ–°æ“ä½œã€‚(workeræœåŠ¡å™¨åœ¨è¿™é‡Œæ˜¯æŒ‡å¤šä¸ªworkerèŠ‚ç‚¹ï¼Œé›†ç¾¤çš„æ„æ€ï¼Œè§ä¸Šé¢ç»“æ„å›¾ï¼‰</li></ul><blockquote><p>ä¹Ÿå°±æ˜¯è¯´æœ€å°çš„é›†ç¾¤éœ€è¦åŒ…å«ä¸€ä¸ªä¸»workeræœåŠ¡å™¨å’Œä¸€ä¸ªå‚æ•°æœåŠ¡å™¨ã€‚å¯ä»¥å°†å®ƒæ‰©å±•ä¸ºä¸€ä¸ªä¸»workeræœåŠ¡å™¨ï¼Œå¤šä¸ªå‚æ•°æœåŠ¡å™¨å’Œå¤šä¸ªworkeræœåŠ¡å™¨ã€‚æœ€å¥½æœ‰å¤šä¸ªå‚æ•°æœåŠ¡å™¨ï¼Œ<strong>å› ä¸ºworkeræœåŠ¡å™¨å’Œå‚æ•°æœåŠ¡å™¨ä¹‹é—´æœ‰å¤§é‡çš„I/Oé€šä¿¡</strong>ã€‚å¦‚æœåªæœ‰2ä¸ªworkeræœåŠ¡å™¨ï¼Œå¯èƒ½1ä¸ªå‚æ•°æœåŠ¡å™¨å¯ä»¥æ‰›å¾—ä½æ‰€æœ‰çš„è¯»å–å’Œæ›´æ–°è¯·æ±‚ã€‚ä½†å¦‚æœä½ æœ‰10ä¸ªworkerè€Œä¸”ä½ çš„æ¨¡å‹éå¸¸å¤§ï¼Œä¸€ä¸ªå‚æ•°æœåŠ¡å™¨å¯èƒ½å°±ä¸å¤Ÿäº†ã€‚</p></blockquote><p><strong>åœ¨åˆ†å¸ƒå¼TensorFlowä¸­ï¼ŒåŒæ ·çš„ä»£ç ä¼šè¢«å‘é€åˆ°æ‰€æœ‰çš„èŠ‚ç‚¹</strong>ã€‚è™½ç„¶ä½ çš„main.pyã€train.pyç­‰ä¼šè¢«åŒæ—¶å‘é€åˆ°workeræœåŠ¡å™¨å’Œå‚æ•°æœåŠ¡å™¨ï¼Œä½†æ¯ä¸ªèŠ‚ç‚¹ä¼šä¾æ®è‡ªå·±çš„ç¯å¢ƒå˜é‡æ¥æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚</p><h3id="åˆ†å¸ƒå¼tensorflowä»£ç çš„å‡†å¤‡åŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µ">åˆ†å¸ƒå¼TensorFlowä»£ç çš„å‡†å¤‡åŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µ</h3><ol type="1"><li>å®šä¹‰tf.trainClusterSpecå’Œtf.train.Server</li><li>å°†æ¨¡å‹èµ‹ç»™å‚æ•°æœåŠ¡å™¨å’ŒworkeræœåŠ¡å™¨</li><li>é…ç½®å’Œå¯åŠ¨tf.train.MonitoredTrainingSession</li></ol><h2 id="ps-and-worker">PS and Worker</h2><p>å‚è€ƒ: <ahref="https://zhuanlan.zhihu.com/p/35083779">ã€1ã€‘åˆ†å¸ƒå¼TensorFlowå…¥é—¨æ•™ç¨‹</a><ahref="https://github.com/tensorflow/examples/blob/master/community/en/docs/deploy/distributed.md">ã€2ã€‘DistributedTensorFlow</a> <ahref="https://www.oreilly.com/content/distributed-tensorflow/">ã€3ã€‘DistributedTensorFlow</a></p><h3 id="client">Client</h3><p>A client is typically a program that builds a TensorFlow graph andconstructs a tensorflow::Session to interact with a cluster. Clients aretypically written in Python or C++. <strong>A single client process candirectly interact with multiple TensorFlow servers</strong> (see"Replicated training" above), <strong>and a single server can servemultiple clients</strong>.serveråœ¨è¿™é‡Œæ˜¯æœåŠ¡è€…çš„è§’è‰²ï¼Œæ— è®ºæ˜¯psè¿˜æ˜¯workeréƒ½æ˜¯server,æˆ‘ä»¬å¯ä»¥å»ºç«‹å¤šä¸ªserver,æœåŠ¡ä¸å¤šä¸ªclientã€‚æ¯”å¦‚æœ‰ä¸ªworkerserverå·²ç»å»ºç«‹ï¼ŒAç”¨clientå»ºç«‹ä¸€ä¸ªregressionä»»åŠ¡æ˜¯ä½¿ç”¨è¿™ä¸ªserverè®­ç»ƒï¼ŒBç”¨clientå»ºç«‹äº†ä¸€ä¸ªCNNä»»åŠ¡ä¹Ÿä½¿ç”¨äº†è¿™ä¸ªserverï¼Œè¿™ä¸å†²çªï¼Œåœ¨èµ„æºå……è¶³æƒ…å†µä¸‹æ˜¯å¯ä»¥å…ˆåä½¿ç”¨åŒä¸€ä¸ªserverçš„ã€‚### Job A job comprises a list of "tasks", which typically serve acommon purpose. For example, a job named ps (for "parameter server")typically hosts nodes that store and update variables; while a job namedworker typically hosts stateless nodes that perform compute-intensivetasks. The tasks in a job typically run on different machines. The setof job roles is flexible: for example, a worker may maintain some state.æ³¨æ„åŸåˆ™ä¸Špså’Œworkerä¸¤ç§jobåŠŸèƒ½ä¸åŒ</p><ul><li>ps (parameter server)ï¼šhosts nodes that <strong>store</strong> and<strong>update</strong> variables;</li><li>workerï¼šhosts <strong>stateless</strong> nodes that perform<strong>compute-intensive tasks</strong>.è™½ç„¶è§„åˆ™ä¸Šè¿™æ ·å„å¸å…¶èŒï¼Œä½†å®é™…ä¸Šå¹¶ä¸ä¸€å®šéœ€è¦ä¸¥æ ¼è¿™æ ·æ‰§è¡Œï¼Œjobçš„è§’è‰²æ˜¯çµæ´»çš„ï¼Œæ¯”å¦‚ï¼Œworkerä¹Ÿå¯ä»¥ç»´æŠ¤ä¸€äº›çŠ¶æ€ï¼ˆstate)### Master service An RPC service that provides remote access to a setof distributed devices, and <strong>acts as a session target.</strong>The master service implements the tensorflow::Session interface, and isresponsible for coordinating work across one or more "worker services".<strong>All TensorFlow servers implement the master service.</strong>å…·ä½“ç†è§£å‚ç…§ä¸‹é¢çš„ä¾‹å­ï¼š</li></ul><p>åœ¨ã€1ã€‘çš„ä¾‹å­ä¸­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># example.py</span><br><span class="line">import tensorflow as tf</span><br><span class="line"></span><br><span class="line">tf.app.flags.DEFINE_string(&quot;ps_hosts&quot;, &quot;localhost:2222&quot;, &quot;ps hosts&quot;)</span><br><span class="line">tf.app.flags.DEFINE_string(&quot;worker_hosts&quot;, &quot;localhost:2223,localhost:2224&quot;, &quot;worker hosts&quot;)</span><br><span class="line">tf.app.flags.DEFINE_string(&quot;job_name&quot;, &quot;worker&quot;, &quot;&#x27;ps&#x27; or&#x27;worker&#x27;&quot;)</span><br><span class="line">tf.app.flags.DEFINE_integer(&quot;task_index&quot;, 0, &quot;Index of task within the job&quot;)</span><br><span class="line"></span><br><span class="line">FLAGS = tf.app.flags.FLAGS</span><br><span class="line"></span><br><span class="line">def main(_):</span><br><span class="line">    ps_hosts = FLAGS.ps_hosts.split(&quot;,&quot;)</span><br><span class="line">    worker_hosts = FLAGS.worker_hosts.split(&quot;,&quot;)</span><br><span class="line">    # create cluster</span><br><span class="line">    cluster = tf.train.ClusterSpec(&#123;&quot;ps&quot;: ps_hosts, &quot;worker&quot;: worker_hosts&#125;)</span><br><span class="line">    # create the server</span><br><span class="line">    server = tf.train.Server(cluster, job_name=FLAGS.job_name, task_index=FLAGS.task_index)</span><br><span class="line">    server.join()</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    tf.app.run()</span><br></pre></td></tr></table></figure><p>exmple.pyç”¨æ¥å»ºç«‹æ‰§è¡Œä¸åŒåŠŸèƒ½çš„serverï¼Œæ‰§è¡Œä¸Šé¢çš„example.pyæ¥ç”Ÿæˆä¸åŒçš„<strong>server</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python example.py --job_name=ps --task_index=0</span><br><span class="line">python example.py --job_name=worker --task_index=0</span><br><span class="line">python example.py --job_name=worker --task_index=1</span><br></pre></td></tr></table></figure><p>ä»¥work-0ä¸ºä¾‹å­ï¼Œæ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2020-03-20 15:50:24.761196: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:252] Initialize GrpcChannelCache for job ps -&gt; &#123;0 -&gt; localhost:2222&#125;</span><br><span class="line">2020-03-20 15:50:24.761240: I tensorflow/core/distributed_runtime/rpc/grpc_channel.cc:252] Initialize GrpcChannelCache for job worker -&gt; &#123;0 -&gt; localhost:2223, 1 -&gt; localhost:2224&#125;</span><br><span class="line">2020-03-20 15:50:24.762191: I tensorflow/core/distributed_runtime/rpc/grpc_server_lib.cc:391] Started server with target: grpc://localhost:2223</span><br></pre></td></tr></table></figure><p>æ—¥å¿—é‡Œæ˜¾ç¤ºäº†å½“å‰serverçš„grpcåœ°å€ï¼Œä»¥åŠserveræ‰€çŸ¥é“çš„å…¶ä»–é›†ç¾¤ä¿¡æ¯ï¼Œè¿™æ˜¯ç†æ‰€åº”å½“ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åè°ƒåˆ†å¸ƒå¼ä»»åŠ¡ï¼Œå¿…ç„¶éœ€è¦çŸ¥é“å…¶ä»–æœåŠ¡çš„ä¿¡æ¯ï¼Œè¿™æ ·æ‰å¯ä»¥é€šä¿¡åè°ƒå·¥ä½œã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œserverå·²ç»å»ºç«‹ï¼Œä¹Ÿå°±æ„å‘³ç€èµ„æºå·²ç»å»ºç«‹ï¼Œè€Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡clientä½¿ç”¨è¿™äº›èµ„æºæ¥å®Œæˆåˆ†å¸ƒå¼ä»»åŠ¡äº†ã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªclientæ¥æ‰§è¡Œä¸€ä¸ªè®¡ç®—å›¾ï¼Œå¹¶ä¸”é‡‡ç”¨/job:worker/task:0è¿™ä¸ªserveræ‰€å¯¹åº”çš„<strong>master</strong>ï¼Œå³grpc://localhost:2223æ¥åˆ›å»ºSessionï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#client.py</span><br><span class="line">import tensorflow as tf</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    with tf.device(&quot;/job:ps/task:0&quot;):</span><br><span class="line">        x = tf.Variable(tf.ones([2, 2]))</span><br><span class="line">        y = tf.Variable(tf.ones([2, 2]))</span><br><span class="line"></span><br><span class="line">    with tf.device(&quot;/job:worker/task:0&quot;):</span><br><span class="line">        z = tf.matmul(x, y) + x</span><br><span class="line"></span><br><span class="line">    with tf.device(&quot;/job:worker/task:1&quot;):</span><br><span class="line">        z = tf.matmul(z, x) + x</span><br><span class="line"></span><br><span class="line">    with tf.Session(&quot;grpc://localhost:2223&quot;) as sess:</span><br><span class="line">        sess.run(tf.global_variables_initializer())</span><br><span class="line">        val = sess.run(z)</span><br><span class="line">        print(val)</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™ä¸ªclientå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯å…¶åœ¨è®¡ç®—æ—¶éœ€è¦ä¾é clusterä¸­çš„deviceæ¥æ‰§è¡Œéƒ¨åˆ†è®¡ç®—å­å›¾ã€‚è¿™æ—¶å€™å„ä¸ªserverçš„æ—¥å¿—ä¸­ï¼Œåªæœ‰2223çš„æ—¥å¿—å‘ç”Ÿäº†å˜åŒ–ï¼Œå¤šäº†ä¸€è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â€¦â€¦</span><br><span class="line">2020-03-20 15:55:50.796022: I tensorflow/core/distributed_runtime/master_session.cc:1192] Start master session b7f2e9eb1f8c5548 with config:</span><br></pre></td></tr></table></figure><h2 id="between-graph-replication">Between-graph replication</h2><p>åœ¨Between-graphreplicationä¸­ï¼Œå„ä¸ªworkeréƒ½åŒ…å«ä¸€ä¸ªclientï¼Œå®ƒä»¬æ„å»ºç›¸åŒçš„è®¡ç®—å›¾ï¼Œç„¶åæŠŠå‚æ•°æ”¾åœ¨psä¸Šï¼ŒTensorFlowæä¾›äº†ä¸€ä¸ªä¸“é—¨çš„å‡½æ•°tf.train.replica_device_setteræ¥æ–¹ä¾¿Graphæ„å»ºï¼Œå…ˆçœ‹ä»£ç ã€1ã€‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># clusteråŒ…å«ä¸¤ä¸ªps å’Œä¸‰ä¸ª worker</span><br><span class="line">cluster_spec = &#123;</span><br><span class="line">    &quot;ps&quot;: [&quot;ps0:2222&quot;, &quot;ps1:2222&quot;],</span><br><span class="line">    &quot;worker&quot;: [&quot;worker0:2222&quot;, &quot;worker1:2222&quot;, &quot;worker2:2222&quot;]&#125;</span><br><span class="line">cluster = tf.train.ClusterSpec(cluster_spec)</span><br><span class="line">with tf.device(tf.train.replica_device_setter(</span><br><span class="line">                worker_device=&quot;/job:worker/task:%d&quot; % FLAGS.task_index,</span><br><span class="line">               cluster=cluster)):</span><br><span class="line">  # Build your graph</span><br><span class="line">  v1 = tf.Variable(...)  # assigned to /job:ps/task:0</span><br><span class="line">  v2 = tf.Variable(...)  # assigned to /job:ps/task:1</span><br><span class="line">  v3 = tf.Variable(...)  # assigned to /job:ps/task:0</span><br><span class="line">  # Run compute</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<strong>tf.train.replica_device_setter</strong>å¯ä»¥è‡ªåŠ¨æŠŠGraphä¸­çš„Variablesæ”¾åˆ°psä¸Šï¼Œè€ŒåŒæ—¶å°†Graphçš„è®¡ç®—éƒ¨åˆ†æ”¾ç½®åœ¨å½“å‰workerä¸Šï¼Œçœå»äº†å¾ˆå¤šéº»çƒ¦ã€‚ç”±äºpså¾€å¾€ä¸æ­¢ä¸€ä¸ªï¼Œè¿™ä¸ªå‡½æ•°åœ¨ä¸ºå„ä¸ªVariableåˆ†é…psæ—¶é»˜è®¤é‡‡ç”¨ç®€å•çš„round-robinæ–¹å¼ï¼Œå°±æ˜¯æŒ‰æ¬¡åºå°†å‚æ•°æŒ¨ä¸ªæ”¾åˆ°å„ä¸ªpsä¸Šï¼Œä½†è¿™ä¸ªæ–¹å¼å¯èƒ½ä¸èƒ½ä½¿psè´Ÿè½½å‡è¡¡ï¼Œå¦‚æœéœ€è¦æ›´åŠ åˆç†ï¼Œå¯ä»¥é‡‡ç”¨tf.contrib.training.GreedyLoadBalancingStrategyç­–ç•¥ã€‚é‡‡ç”¨Between-graphreplicationæ–¹å¼çš„å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºå„ä¸ªworkeréƒ½ç‹¬ç«‹æ‹¥æœ‰è‡ªå·±çš„clientï¼Œä½†æ˜¯å¯¹äºä¸€äº›å…¬å…±æ“ä½œæ¯”å¦‚æ¨¡å‹å‚æ•°åˆå§‹åŒ–ä¸checkpointæ–‡ä»¶ä¿å­˜ç­‰ï¼Œå¦‚æœæ¯ä¸ªclientéƒ½ç‹¬ç«‹è¿›è¡Œè¿™äº›æ“ä½œï¼Œæ˜¾ç„¶æ˜¯å¯¹èµ„æºçš„æµªè´¹ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬ä¼šæŒ‡å®šä¸€ä¸ªworkerä¸ºchiefworkerï¼Œå®ƒå°†ä½œä¸ºå„ä¸ªworkerçš„ç®¡å®¶ï¼Œåè°ƒå®ƒä»¬ä¹‹é—´çš„è®­ç»ƒï¼Œå¹¶ä¸”å®Œæˆæ¨¡å‹åˆå§‹åŒ–å’Œæ¨¡å‹ä¿å­˜å’Œæ¢å¤ç­‰å…¬å…±æ“ä½œã€‚åœ¨TensorFlowä¸­ï¼Œå¯ä»¥ä½¿ç”¨tf.train.MonitoredTrainingSessionåˆ›å»ºclientçš„Sessionï¼Œå¹¶ä¸”å…¶å¯ä»¥æŒ‡å®šå“ªä¸ªworkeræ˜¯chiefworkerã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;åŸºæœ¬å…ƒç´ &quot;&gt;åŸºæœ¬å…ƒç´ &lt;/h2&gt;
&lt;h3 id=&quot;tf.variable&quot;&gt;tf.Variable(â€¦â€¦)&lt;/h3&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; tensorflow &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; tf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;A = tf.Variable(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, name=&lt;span class=&quot;string&quot;&gt;&amp;quot;number&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;B = tf.Variable([&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;], name=&lt;span class=&quot;string&quot;&gt;&amp;quot;vector&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;C = tf.Variable([[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;],[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]], name=&lt;span class=&quot;string&quot;&gt;&amp;quot;matrix&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;D = tf.Variable(tf.zeros([&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;]), name=&lt;span class=&quot;string&quot;&gt;&amp;quot;zero&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;E = tf.Variable(tf.random_normal([&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;], mean=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, stddev=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, dtype=tf.float32))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥æŠŠå‡½æ•°variable()ç†è§£ä¸ºæ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°çš„ä½¿ç”¨éœ€è¦åˆå§‹å€¼ï¼Œè€Œè¿™ä¸ªåˆå§‹å€¼æ˜¯ä¸€ä¸ªä»»ä½•å½¢çŠ¶ã€ç±»å‹çš„Tensorã€‚
å˜é‡æœ‰ä¸¤ä¸ªé‡è¦çš„æ­¥éª¤ï¼Œå…ˆåä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»º&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å˜é‡åœ¨ä½¿ç”¨å‰ä¸€å®šè¦è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸”å˜é‡çš„åˆå§‹åŒ–å¿…é¡»åœ¨æ¨¡å‹çš„å…¶å®ƒæ“ä½œè¿è¡Œä¹‹å‰å®Œæˆï¼Œé€šå¸¸ï¼Œå˜é‡çš„åˆå§‹åŒ–æœ‰ä¸‰ç§æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1.åˆå§‹åŒ–å…¨éƒ¨å˜é‡
&lt;code&gt;init = tf.global_variables_initializer()&lt;/code&gt;
global_variables_initializer()æ–¹æ³•æ˜¯ä¸ç®¡å…¨å±€æœ‰å¤šå°‘ä¸ªå˜é‡ï¼Œå…¨éƒ¨è¿›è¡Œåˆå§‹åŒ–ï¼Œæ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ–¹å¼ï¼›&lt;/li&gt;
&lt;li&gt;2.åˆå§‹åŒ–å˜é‡çš„å­é›†
&lt;code&gt;init_subset=tf.variables_initializer([b,c], name=&quot;init_subset&quot;)&lt;/code&gt;
variables_initializer()æ˜¯åˆå§‹åŒ–å˜é‡çš„å­é›†ï¼Œç›¸æ¯”äºå…¨éƒ¨åˆå§‹åŒ–åŒ–çš„æ–¹å¼æ›´åŠ èŠ‚çº¦å†…å­˜&lt;/li&gt;
&lt;li&gt;3.åˆå§‹åŒ–å•ä¸ªå˜é‡&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>recommendation_system</title>
    <link href="http://yoursite.com/2024/06/04/recommendation-system/"/>
    <id>http://yoursite.com/2024/06/04/recommendation-system/</id>
    <published>2024-06-04T07:13:36.000Z</published>
    <updated>2025-05-22T05:50:40.080Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨Embeddingç­–ç•¥åœ¨å„ç§ä»»åŠ¡åœºæ™¯ä¸­æå–ç”¨æˆ·ä¿¡æ¯çš„paper ã€ŠModeling UserActivities on the Web using Paragraph Vectorã€‹:ç”¨æˆ·åœ¨æµè§ˆç½‘é¡µçš„æ—¶å€™ä¼šç•™ä¸‹æ¥ä¸€ç³»åˆ—çš„è¡Œä¸ºï¼Œæ¯”æ–¹è¯´ç½‘é¡µæµè§ˆï¼Œæœç´¢é—®é¢˜ï¼Œç‚¹å‡»å¹¿å‘Šç­‰ï¼Œè®¾ç”¨æˆ·<spanclass="math inline">\(i\)</span>ç•™ä¸‹çš„ <spanclass="math inline">\(T\)</span>ä¸ªè¡Œä¸ºè¡¨ç¤ºä¸º<spanclass="math inline">\((a_{i,1},a_{i,2}....,a_{i,Ti})\)</span>)ã€‚æˆ‘ä»¬å¸Œæœ›æ ¹æ®æ‰€æœ‰çš„ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œç”Ÿæˆè¡¨å¾æ¯ä¸€ä¸ªç”¨æˆ·çš„å‘é‡ï¼Œä½¿å…·æœ‰ç›¸åŒè¡Œä¸ºåºåˆ—çš„ç”¨æˆ·è¢«æ˜ å°„åˆ°ç›¸ä¼¼çš„å‘é‡ç©ºé—´ä¹‹ä¸­ã€‚æˆ‘ä»¬å¸Œæœ›æ ¹æ®æ‰€æœ‰çš„ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œç”Ÿæˆè¡¨å¾æ¯ä¸€ä¸ªç”¨æˆ·çš„å‘é‡ï¼Œä½¿å…·æœ‰ç›¸åŒè¡Œä¸ºåºåˆ—çš„ç”¨æˆ·è¢«æ˜ å°„åˆ°ç›¸ä¼¼çš„å‘é‡ç©ºé—´ä¹‹ä¸­ã€‚è¯¥è®ºæ–‡å€Ÿé‰´äº†skip-gram çš„æ€æƒ³</p><h2 id="deep-cross-network-for-ad-click-predictions">Deep &amp; CrossNetwork for Ad Click Predictions</h2><p><a href="https://blog.csdn.net/Dby_freedom/article/details/86502623"class="uri">https://blog.csdn.net/Dby_freedom/article/details/86502623</a><a href="https://blog.csdn.net/qq_40778406/article/details/105009989"class="uri">https://blog.csdn.net/qq_40778406/article/details/105009989</a><a href="https://www.cnblogs.com/LuckPsyduck/p/11995230.html"class="uri">https://www.cnblogs.com/LuckPsyduck/p/11995230.html</a> <ahref="https://zhuanlan.zhihu.com/p/96010464"class="uri">https://zhuanlan.zhihu.com/p/96010464</a></p><span id="more"></span><h2 id="ranknet">RankNet</h2><p><a href="https://www.cnblogs.com/kemaswill/p/kemaswill.html"class="uri">https://www.cnblogs.com/kemaswill/p/kemaswill.html</a></p><p><span class="math display">\[C_{i j}=-\bar{P}_{i j} o_{i j}+\log\left(1+e^{o_{i j}}\right)\]</span> 2019-09-06 15:37:39 vin word2vec #word2vec</p><p>æ ‡ç­¾ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰ï¼š word2vec</p><hr /><p>![word2word][1] å¯¹äºä¸Šå›¾ï¼Œä»¥å‰ç›´è§‰å¯¹äºskip-gramæ¨¡å‹ï¼Œæœ‰è¿™æ ·ä¸€ä¸ªç–‘é—®æ¯”å¦‚ï¼š è¯æ±‡è¡¨æœ‰Vä¸ªï¼Œæ‰€ä»¥æˆ‘ä»¬çš„è¾“å…¥æ˜¯V-dimensionçš„å‘é‡ï¼Œå¯¹äºå¥å­ï¼š â€œwhatare you doing nowâ€ å¯¹äºskip-gramæ–¹å¼ï¼š è¾“å…¥ x æ˜¯ you çš„one-hotå‘é‡ï¼Œè¾“å‡º y æ˜¯ V ç»´åº¦å‘é‡ï¼Œè¿™ä¸ªå‘é‡å¯ä»¥ç›´æ¥æŠŠwhat, are, doing,nowå››ä¸ªè¯çš„indexä½ç½®ç‚¹äº®å”¯1ï¼Œç„¶åè®¡ç®—æŸå¤±å‡½æ•°ï¼Œè¿™æ ·çš„æ–¹å¼ä¸æ˜¯æ›´å¥½å—ï¼Ÿ</p><p>æŸå¤©å›çœ‹word2vecæ¨¡å‹ç»“æ„å›¾çªç„¶æ˜ç™½ï¼Œè¿™æ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºcontextæ˜¯æœ‰â€œåº"çš„ä¿¡æ¯çš„ï¼Œå¦‚æœç±»ä¼¼bag-of-wordsçš„æ–¹å¼å¤„ç†ï¼Œæ‰€è¾¾åˆ°çš„æ•ˆæœ<strong>åªå…³æ³¨wordæ˜¯å¦å‡ºç°ï¼Œè€Œä¸¢æ‰äº†åºçš„ä¿¡æ¯</strong>ã€‚æ‰€ä»¥æ­£ç¡®çš„ç½‘ç»œç»“æ„åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š ![skip-gram][2]</p><p>[2]: <ahref="https://pic1.zhimg.com/80/v2-ca81e19caa378cee6d4ba6d867f4fc7c_hd.jpg"class="uri">https://pic1.zhimg.com/80/v2-ca81e19caa378cee6d4ba6d867f4fc7c_hd.jpg</a>2019-09-12 10:25:43</p><h2 id="ctr">CTR</h2><h3 id="deep-interest-network">Deep Interest Network</h3><p>ã€ŠDeep Interest Network for Click-Through Rate Predictionã€‹ <ahref="https://mp.weixin.qq.com/s/V6tjQzfzsekXuoXhbXbKSQ">ã€ä¼ é€é—¨ã€‘</a></p><p><strong>æ€»ç»“</strong>ï¼š</p><ol type="1"><li><p>ç”¨æˆ·æœ‰å¤šä¸ªå…´è¶£çˆ±å¥½ï¼Œè®¿é—®äº†å¤šä¸ªgood_idï¼Œshop_idã€‚ä¸ºäº†é™ä½çº¬åº¦å¹¶ä½¿å¾—å•†å“åº—é“ºé—´çš„ç®—æœ¯è¿ç®—æœ‰æ„ä¹‰ï¼Œæˆ‘ä»¬å…ˆå¯¹å…¶è¿›è¡ŒEmbedding åµŒå…¥ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å¯¹ç”¨æˆ·å¤šç§å¤šæ ·çš„å…´è¶£å»ºæ¨¡é‚£ï¼Ÿä½¿ç”¨ Pooling å¯¹Embedding Vectoræ±‚å’Œæˆ–è€…æ±‚å¹³å‡ã€‚åŒæ—¶è¿™ä¹Ÿè§£å†³äº†ä¸åŒç”¨æˆ·è¾“å…¥é•¿åº¦ä¸åŒçš„é—®é¢˜ï¼Œå¾—åˆ°äº†ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å‘é‡ã€‚è¿™ä¸ªå‘é‡å°±æ˜¯ç”¨æˆ·è¡¨ç¤ºï¼Œæ˜¯ç”¨æˆ·å…´è¶£çš„ä»£è¡¨ã€‚</p></li><li><p>ä½†æ˜¯ï¼Œç›´æ¥æ±‚ sum æˆ– averageæŸå¤±äº†å¾ˆå¤šä¿¡æ¯ã€‚æ‰€ä»¥ç¨åŠ æ”¹è¿›ï¼Œé’ˆå¯¹ä¸åŒçš„ behavior idèµ‹äºˆä¸åŒçš„æƒé‡ï¼Œè¿™ä¸ªæƒé‡æ˜¯ç”±å½“å‰ behavior idå’Œå€™é€‰å¹¿å‘Šå…±åŒå†³å®šçš„ã€‚è¿™å°±æ˜¯ Attention æœºåˆ¶ï¼Œå®ç°äº† LocalActivationã€‚</p></li><li><p>DIN ä½¿ç”¨ <strong>activation unit</strong> æ¥æ•è· <strong>localactivation</strong> çš„ç‰¹å¾ï¼Œä½¿ç”¨ <strong>weighted sum pooling</strong>æ¥æ•è· <strong>diversity</strong> ç»“æ„ã€‚</p></li><li><p>åœ¨æ¨¡å‹å­¦ä¹ ä¼˜åŒ–ä¸Šï¼ŒDIN æå‡ºäº† Dice æ¿€æ´»å‡½æ•°ã€è‡ªé€‚åº”æ­£åˆ™ï¼Œæ˜¾è‘—çš„æå‡äº†æ¨¡å‹æ€§èƒ½ä¸æ”¶æ•›é€Ÿåº¦ã€‚</p></li></ol><p>å‚è€ƒèµ„æ–™</p><ol type="1"><li><p>Deep Interest Network for Click-Through Rate Prediction</p></li><li><p>Learning piece-wise linear models from large scale data for adclick prediction</p></li><li><p><ahref="https://www.leiphone.com/news/201707/t0AT4sIgyWS2QWVU.html"class="uri">https://www.leiphone.com/news/201707/t0AT4sIgyWS2QWVU.html</a></p></li><li><p><ahref="https://www.leiphone.com/news/201706/pDfOAoMYp8mqNKEC.html"class="uri">https://www.leiphone.com/news/201706/pDfOAoMYp8mqNKEC.html</a></p></li><li><p>ç›–å¤çš„åˆ†äº«è§†é¢‘ <ahref="http://www.itdks.com/dakalive/detail/3166"class="uri">http://www.itdks.com/dakalive/detail/3166</a></p></li></ol><h2 id="bpr">BPR</h2><p><span class="math display">\[\begin{aligned}\text { BPR-OPT } &amp;:=\ln p\left(\Theta \mid&gt;_{u}\right) \\&amp;=\ln p\left(&gt;_{u} \mid \Theta\right) p(\Theta) \\&amp;=\ln \prod_{(u, i, j) \in D_{S}} \sigma\left(\hat{x}_{u i j}\right)p(\Theta) \\&amp;=\sum_{(u, i, j) \in D_{S}} \ln \sigma\left(\hat{x}_{u ij}\right)+\ln p(\Theta) \\&amp;=\sum_{(u, i, j) \in D_{S}} \ln \sigma\left(\hat{x}_{u ij}\right)-\lambda_{\Theta}\|\Theta\|^{2}\end{aligned}\]</span></p><p>Here <span class="math inline">\(\hat{x}_{u i j}(\Theta)\)</span> isan arbitrary real-valued function of the model parameter vector <spanclass="math inline">\(\Theta\)</span> which captures the specialrelationship between user <span class="math inline">\(u\)</span>, item<span class="math inline">\(i\)</span> and item <spanclass="math inline">\(j\)</span>.</p><p>Here,<span class="math inline">\(&gt;u\)</span> is the desired butlatent preference structure for user u. All users are presumed to actindependently of each other.</p><p><a href="https://cloud.tencent.com/developer/article/1164759"class="uri">https://cloud.tencent.com/developer/article/1164759</a>æ’åºæ¨èç®—æ³•å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼Œç¬¬ä¸€ç±»æ’åºç®—æ³•ç±»åˆ«æ˜¯ç‚¹å¯¹æ–¹æ³•(PointwiseApproach)ï¼Œè¿™ç±»ç®—æ³•å°†æ’åºé—®é¢˜è¢«è½¬åŒ–ä¸ºåˆ†ç±»ã€å›å½’ä¹‹ç±»çš„é—®é¢˜ï¼Œå¹¶ä½¿ç”¨ç°æœ‰åˆ†ç±»ã€å›å½’ç­‰æ–¹æ³•è¿›è¡Œå®ç°ã€‚ç¬¬äºŒç±»æ’åºç®—æ³•æ˜¯æˆå¯¹æ–¹æ³•(PairwiseApproach)ï¼Œåœ¨åºåˆ—æ–¹æ³•ä¸­ï¼Œæ’åºè¢«è½¬åŒ–ä¸ºå¯¹åºåˆ—åˆ†ç±»æˆ–å¯¹åºåˆ—å›å½’ã€‚æ‰€è°“çš„pairå°±æ˜¯æˆå¯¹çš„æ’åºï¼Œæ¯”å¦‚(a,b)ä¸€ç»„è¡¨æ˜aæ¯”bæ’çš„é å‰ã€‚ç¬¬ä¸‰ç±»æ’åºç®—æ³•æ˜¯åˆ—è¡¨æ–¹æ³•(ListwiseApproach)ï¼Œå®ƒé‡‡ç”¨æ›´åŠ ç›´æ¥çš„æ–¹æ³•å¯¹æ’åºé—®é¢˜è¿›è¡Œäº†å¤„ç†ã€‚å®ƒåœ¨å­¦ä¹ å’Œé¢„æµ‹è¿‡ç¨‹ä¸­éƒ½å°†æ’åºåˆ—è¡¨ä½œä¸ºä¸€ä¸ªæ ·æœ¬ã€‚æ’åºçš„ç»„ç»“æ„è¢«ä¿æŒæˆ‘ä»¬æ„é€ çš„è®­ç»ƒæ•°æ®æ˜¯&lt;u,i,j&gt;çš„ä¸‰å…ƒç»„ï¼Œiå¯ä»¥æ ¹æ®åˆšæ‰ç”Ÿæˆçš„ç”¨æˆ·è¯„åˆ†å­—å…¸å¾—åˆ°ï¼Œjå¯ä»¥åˆ©ç”¨è´Ÿé‡‡æ ·çš„æ€æƒ³ï¼Œè®¤ä¸ºç”¨æˆ·æ²¡æœ‰çœ‹è¿‡çš„ç”µå½±éƒ½æ˜¯è´Ÿæ ·æœ¬ï¼š</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>1.BPRæ˜¯åŸºäºçŸ©é˜µåˆ†è§£çš„ä¸€ç§æ’åºç®—æ³•ï¼Œå®ƒä¸æ˜¯åšå…¨å±€çš„è¯„åˆ†ä¼˜åŒ–ï¼Œè€Œæ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªç”¨æˆ·è‡ªå·±çš„å•†å“å–œå¥½åˆ†è´åšæ’åºä¼˜åŒ–ã€‚2.å®ƒæ˜¯ä¸€ç§<strong>pairwise</strong>çš„æ’åºç®—æ³•ï¼Œå¯¹äºæ¯ä¸€ä¸ªä¸‰å…ƒç»„&lt;u,i,j&gt;ï¼Œæ¨¡å‹å¸Œæœ›èƒ½å¤Ÿä½¿ç”¨æˆ·uå¯¹ç‰©å“iå’Œjçš„å·®å¼‚æ›´æ˜æ˜¾ã€‚3.åŒæ—¶ï¼Œå¼•å…¥äº†<strong>è´å¶æ–¯å…ˆéªŒ</strong>ï¼Œå‡è®¾å‚æ•°æœä»æ­£æ€åˆ†å¸ƒï¼Œåœ¨è½¬æ¢åå˜ä¸ºäº†L2æ­£åˆ™ï¼Œå‡å°äº†æ¨¡å‹çš„è¿‡æ‹Ÿåˆ</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä½¿ç”¨Embeddingç­–ç•¥åœ¨å„ç§ä»»åŠ¡åœºæ™¯ä¸­æå–ç”¨æˆ·ä¿¡æ¯çš„paper ã€ŠModeling User
Activities on the Web using Paragraph Vectorã€‹
:ç”¨æˆ·åœ¨æµè§ˆç½‘é¡µçš„æ—¶å€™ä¼šç•™ä¸‹æ¥ä¸€ç³»åˆ—çš„è¡Œä¸ºï¼Œæ¯”æ–¹è¯´ç½‘é¡µæµè§ˆï¼Œæœç´¢é—®é¢˜ï¼Œç‚¹å‡»å¹¿å‘Šç­‰ï¼Œè®¾ç”¨æˆ·&lt;span
class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt;ç•™ä¸‹çš„ &lt;span
class=&quot;math inline&quot;&gt;\(T\)&lt;/span&gt;ä¸ªè¡Œä¸ºè¡¨ç¤ºä¸º&lt;span
class=&quot;math inline&quot;&gt;\((a_{i,1},a_{i,2}....,a_{i,Ti})\)&lt;/span&gt;
)ã€‚æˆ‘ä»¬å¸Œæœ›æ ¹æ®æ‰€æœ‰çš„ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œç”Ÿæˆè¡¨å¾æ¯ä¸€ä¸ªç”¨æˆ·çš„å‘é‡ï¼Œä½¿å…·æœ‰ç›¸åŒè¡Œä¸ºåºåˆ—çš„ç”¨æˆ·è¢«æ˜ å°„åˆ°ç›¸ä¼¼çš„å‘é‡ç©ºé—´ä¹‹ä¸­ã€‚æˆ‘ä»¬å¸Œæœ›æ ¹æ®æ‰€æœ‰çš„ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œç”Ÿæˆè¡¨å¾æ¯ä¸€ä¸ªç”¨æˆ·çš„å‘é‡ï¼Œä½¿å…·æœ‰ç›¸åŒè¡Œä¸ºåºåˆ—çš„ç”¨æˆ·è¢«æ˜ å°„åˆ°ç›¸ä¼¼çš„å‘é‡ç©ºé—´ä¹‹ä¸­ã€‚
è¯¥è®ºæ–‡å€Ÿé‰´äº†skip-gram çš„æ€æƒ³&lt;/p&gt;
&lt;h2 id=&quot;deep-cross-network-for-ad-click-predictions&quot;&gt;Deep &amp;amp; Cross
Network for Ad Click Predictions&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/Dby_freedom/article/details/86502623&quot;
class=&quot;uri&quot;&gt;https://blog.csdn.net/Dby_freedom/article/details/86502623&lt;/a&gt;
&lt;a href=&quot;https://blog.csdn.net/qq_40778406/article/details/105009989&quot;
class=&quot;uri&quot;&gt;https://blog.csdn.net/qq_40778406/article/details/105009989&lt;/a&gt;
&lt;a href=&quot;https://www.cnblogs.com/LuckPsyduck/p/11995230.html&quot;
class=&quot;uri&quot;&gt;https://www.cnblogs.com/LuckPsyduck/p/11995230.html&lt;/a&gt; &lt;a
href=&quot;https://zhuanlan.zhihu.com/p/96010464&quot;
class=&quot;uri&quot;&gt;https://zhuanlan.zhihu.com/p/96010464&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>hive</title>
    <link href="http://yoursite.com/2024/06/04/hive/"/>
    <id>http://yoursite.com/2024/06/04/hive/</id>
    <published>2024-06-04T07:11:19.000Z</published>
    <updated>2025-05-22T05:50:40.064Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æŸ¥çœ‹è¡¨çš„ä¿¡æ¯">æŸ¥çœ‹è¡¨çš„ä¿¡æ¯</h2><p>å¯ä»¥çœ‹åˆ°è¡¨çš„ location, tableTypeç­‰ æ ¹æ®TableTypeå€¼å¯ä»¥çŸ¥é“è¡¨æ˜¯å†…éƒ¨è¡¨è¿˜æ˜¯å¤–éƒ¨è¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">describe extended tablename</span><br><span class="line">desc formatted tablename;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¡¨åˆ†åŒº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;show partitions <span class="variable">$&#123;table_name&#125;</span></span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="hive-è¾“å‡ºæ—¥å¿—åˆ†æ">Hive è¾“å‡ºæ—¥å¿—åˆ†æ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â€¦â€¦</span><br><span class="line">Partition xxx&#123;dt=2019-11-12&#125; stats: [numFiles=6, numRows=15677698, totalSize=1281943134, rawDataSize=1266265436]</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><p>numRowsæ˜¯æœ¬æ¬¡hiveæ‰§è¡Œç”Ÿæˆçš„æ•°æ®é‡ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œå®é™…æŸ¥çœ‹è¿™ä¸ªæ•°å­—æ—¶é‡åˆ°ä¸€ä¸ªç°è±¡ï¼šhql-1: insert overwrite 3 line on partition (dt = '2019-11-11') hql-2:insert into 2 line on partition (dt = '2019-11-11')åœ¨æ‰§è¡Œhql-2çš„æ—¶å€™ï¼Œæ—¥å¿—æœ€åæ˜¾ç¤ºçš„numRows=5,åŸæœ¬çš„ç†è§£æ—¶è¿™é‡Œåº”è¯¥æ˜¯2ï¼Œä»æˆ‘è§’åº¦ç†è§£æ¥çœ‹è¿™åº”è¯¥æ˜¯æŒ‡hiveä¼šé‡æ–°æ•´ç†æ•°æ®ï¼Œæ•´ç†çš„æ•°æ®åŒ…æ‹¬ä¸Šä¸€æ¬¡å·²ç»æ’å…¥è¡¨ä¸­çš„3æ¡æ•°æ®ï¼Œæ‰€ä»¥æœ€åäº§ç”Ÿçš„æ•°æ®æ˜¯5ã€‚</p><h2 id="åˆ›å»ºè¡¨">åˆ›å»ºè¡¨</h2><h3 id="create">create</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> $&#123;prod_stat&#125;;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> $&#123;prod_stat&#125;</span><br><span class="line">(</span><br><span class="line">    sku        string,</span><br><span class="line">    cnt        string</span><br><span class="line">)</span><br><span class="line">PARTITIONED <span class="keyword">BY</span> (dt string)</span><br><span class="line"><span class="type">ROW</span> FORMAT DELIMITED</span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\t&#x27;</span></span><br><span class="line">STORED <span class="keyword">AS</span> orc</span><br><span class="line">LOCATION <span class="string">&#x27;$tbl_hdfs&#x27;</span></span><br><span class="line">TBLPROPERTIES (&quot;orc.compress&quot;<span class="operator">=</span>&quot;SNAPPY&quot;);</span><br></pre></td></tr></table></figure><p>åˆ›å»ºåŒå­—æ®µåˆ†åŒºè¡¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create table <span class="keyword">if</span> <span class="keyword">not</span> exists $&#123;overlap_table_name&#125;</span><br><span class="line">(</span><br><span class="line">    expo_uv string,</span><br><span class="line">    clk_pv string,</span><br><span class="line">)</span><br><span class="line">partitioned by (dt string, contain_in_skus boolean)</span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED BY <span class="string">&#x27;\t&#x27;</span></span><br><span class="line">location <span class="string">&#x27;hdfs://ns1013/user/recsys/recpro/tmpr.db/xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ’å…¥æ•°æ®</span></span><br><span class="line"></span><br><span class="line">insert overwrite table $&#123;overlap_table_name&#125; partition(dt=<span class="string">&#x27;$&#123;dt&#125;&#x27;</span>)</span><br><span class="line">select ....</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤è¡¨">åˆ é™¤è¡¨</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> table_name;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_name <span class="keyword">drop</span> <span class="keyword">partition</span> (partition_name<span class="operator">=</span><span class="string">&#x27;yyyy-mm-dd&#x27;</span>)</span><br></pre></td></tr></table></figure><h4id="é™¤hiveå†…éƒ¨è¡¨ä¸ä¼šåˆ é™¤æ•°æ®çš„æ–¹æ³•æ¢ç´¢">é™¤hiveå†…éƒ¨è¡¨ï¼Œä¸ä¼šåˆ é™¤æ•°æ®çš„æ–¹æ³•æ¢ç´¢</h4><p><a href="https://blog.csdn.net/qomoman/article/details/50516560"class="uri">https://blog.csdn.net/qomoman/article/details/50516560</a>äº²æµ‹ç¬¬ä¸€ç§æ–¹æ³•å¯è¡Œ</p><h5 id="æ–¹æ³•ä¸€å°†å†…éƒ¨è¡¨æ”¹æˆå¤–éƒ¨è¡¨">æ–¹æ³•ä¸€ï¼šå°†å†…éƒ¨è¡¨æ”¹æˆå¤–éƒ¨è¡¨</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name set TBLPROPERTIES(&#x27;EXTERNAL&#x27;=&#x27;TRUE&#x27;)Í¾//å†…éƒ¨è¡¨è½¬å¤–éƒ¨è¡¨</span><br><span class="line">drop table table_name</span><br></pre></td></tr></table></figure><h5 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h5><ol type="1"><li>å°†è¡¨çš„åå­—æ”¹æ‰<code>alter table table_name rename to table_name_temp</code></li><li>å°†è¡¨çš„æ•°æ®æ‰€å­˜æ”¾çš„ç›®å½•æ”¹æ‰<code>hadoop   fs -mv  /user/hive/warehouse/table_name_temp /user/hive/warehouse/table_name</code></li><li><code>drop table table_name</code></li></ol><h4 id="åˆ é™¤åˆ†åŒº">åˆ é™¤åˆ†åŒº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table tmpr.table drop partition(dt&gt;=&#x27;2021-01-05&#x27;, dt&lt;=&#x27;2021-03-08&#x27;)</span><br></pre></td></tr></table></figure><h3 id="å†…éƒ¨è¡¨å’Œå¤–éƒ¨è¡¨åŒºåˆ«">å†…éƒ¨è¡¨å’Œå¤–éƒ¨è¡¨åŒºåˆ«</h3><p>1 åˆ é™¤å†…è¡¨æ—¶ï¼Œå†…è¡¨æ•°æ®ä¼šä¸€å¹¶åˆ é™¤ï¼› 2åˆ é™¤å¤–è¡¨æ—¶ï¼Œå¤–è¡¨æ•°æ®ä¾æ—§å­˜åœ¨ã€‚</p><h3 id="like">like</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hql=<span class="string">&quot;drop table <span class="variable">$&#123;hp_few_sku&#125;</span>;</span></span><br><span class="line"><span class="string">create table <span class="variable">$&#123;hp_few_sku&#125;</span></span></span><br><span class="line"><span class="string">like <span class="variable">$&#123;hp_table&#125;</span></span></span><br><span class="line"><span class="string">location &#x27;<span class="variable">$&#123;location&#125;</span>&#x27;</span></span><br><span class="line"><span class="string">;</span></span><br></pre></td></tr></table></figure><h3 id="alter">alter</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> name RENAME <span class="keyword">TO</span> new_name</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> name <span class="keyword">ADD</span> COLUMNS (col_spec[, col_spec ...])</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> name <span class="keyword">DROP</span> [<span class="keyword">COLUMN</span>] column_name</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> name CHANGE column_name new_name new_type</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> name REPLACE COLUMNS (col_spec[, col_spec ...])</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºè¡¨å¯ä»¥åŒ…å«çš„å…³é”®å­—">åˆ›å»ºè¡¨å¯ä»¥åŒ…å«çš„å…³é”®å­—</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name</span><br><span class="line">   [(col_name data_type [COMMENT col_comment], ...)]:æŒ‡å®šè¡¨çš„åç§°å’Œè¡¨çš„å…·ä½“åˆ—ä¿¡æ¯ã€‚</span><br><span class="line">   [COMMENT table_comment] :è¡¨çš„æè¿°ä¿¡æ¯ã€‚</span><br><span class="line">   [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]:è¡¨çš„åˆ†åŒºä¿¡æ¯ã€‚</span><br><span class="line">   [CLUSTERED BY (col_name, col_name, ...) </span><br><span class="line">   [SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS]:è¡¨çš„æ¡¶ä¿¡æ¯ã€‚</span><br><span class="line">   [ROW FORMAT row_format] :è¡¨çš„æ•°æ®åˆ†å‰²ä¿¡æ¯ï¼Œæ ¼å¼åŒ–ä¿¡æ¯ã€‚</span><br><span class="line">   [STORED AS file_format] :è¡¨æ•°æ®çš„å­˜å‚¨åºåˆ—åŒ–ä¿¡æ¯ã€‚</span><br><span class="line">   [LOCATION hdfs_path] :æ•°æ®å­˜å‚¨çš„æ–‡ä»¶å¤¹åœ°å€ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><h2 id="insert">Insert</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT OVERWRITE [ LOCAL ] DIRECTORY directory_path</span><br><span class="line">    [ ROW FORMAT row_format ] [ STORED AS file_format ]</span><br><span class="line">    &#123; VALUES ( &#123; value | NULL &#125; [ , ... ] ) [ , ( ... ) ] | query &#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE [<span class="keyword">LOCAL</span>] DIRECTORY directory1 </span><br><span class="line"><span class="type">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\t&#x27;</span> </span><br><span class="line">select_statement1;</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆæ•°æ®å¸¸ç”¨config">ç”Ÿæˆæ•°æ®å¸¸ç”¨config</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set mapred.max.split.size=524288000;</span><br><span class="line">set mapred.min.split.size=524288000;</span><br><span class="line">set mapred.min.split.size.per.node=524288000;</span><br><span class="line">set mapred.min.split.size.per.rack=524288000;</span><br><span class="line">set hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;</span><br><span class="line">set hive.merge.mapfiles = true;</span><br><span class="line">set hive.merge.mapredfiles = true;</span><br><span class="line">set hive.merge.size.per.task = 256000000;</span><br><span class="line">set hive.merge.smallfiles.avgsize = 104857600;</span><br></pre></td></tr></table></figure><h2 id="ä»æœ¬åœ°å¯¼å…¥æ•°æ®åˆ°è¡¨ä¸­">ä»æœ¬åœ°å¯¼å…¥æ•°æ®åˆ°è¡¨ä¸­</h2><p>load data inpath 'filepath' into table tablenameè¿™é‡Œçš„filepathæ˜¯hdfsè·¯å¾„ï¼Œè€Œéæœ¬åœ°æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼Œæ‰€ä»¥æœ€å¥½å°†æ–‡æœ¬æ–‡ä»¶ä¸Šä¼ è‡³hdfsç›®å½•,ç„¶åå†å¯¼å…¥<ahref="https://blog.csdn.net/xiongbingcool/article/details/82982099">ã€å‚è€ƒã€‘</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -put &#x27;local_file_path&#x27; &#x27;hdfs://â€¦â€¦/user/local/user.login_log&#x27;</span><br></pre></td></tr></table></figure><p>å¯¼å…¥æœ¬åœ°æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA [LOCAL] INPATH &#x27;filepath&#x27; [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä½¿ç”¨çš„æ—¶ï¼šå½“ä½¿ç”¨hdfè·¯å¾„æ—¶ä¸åŠ local,å³ï¼š<code>load data inpath hdfs://xxxx/data/</code>ï¼Œå¹¶ä¸”åœ¨å¯¼å…¥æ•°æ®åä¼š<strong>æºåœ°å€æ•°æ®ä¼šè¢«åˆ é™¤</strong>example</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data inpath &#x27;hdfs://ns1007/user/recsys/recpro/yuanwenwu3/tmpr.feedback_bad_1200_in_15&#x27; overwrite into table tmpr.feedback_bad_1200_in_15 partition(dt=&#x27;2019-09-03&#x27;);</span><br></pre></td></tr></table></figure><h2 id="ç®€ç•¥æµç¨‹">ç®€ç•¥æµç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># step-1 åˆ›å»ºä¸´æ—¶è¡¨</span><br><span class="line">create table if not exists zx_user.temp_ly_sentitive_phone(phone STRING)</span><br><span class="line">row format delimited</span><br><span class="line">fields terminated by &#x27;,&#x27;</span><br><span class="line">stored as textfile;</span><br><span class="line"># step-2 å°†æœ¬åœ°æ•°æ®å¯¼å…¥ä¸´æ—¶è¡¨</span><br><span class="line">LOAD DATA local INPATH &#x27;/home/zx_user/fmd5_0916_1021/sentitive_phone.csv&#x27; INTO TABLE zx_user.temp_ly_sentitive_phone</span><br><span class="line"># step-3 éªŒè¯</span><br><span class="line">select * from zx_user.temp_ly_sentitive_phone_200917 limit 1;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢sqlè¯­å¥">æŸ¥è¯¢SQLè¯­å¥</h2><h3 id="æŒ‰ç…§æ’åºæˆªå–æŒ‡å®šä½ç½®çš„æ•°æ®">æŒ‰ç…§æ’åºæˆªå–æŒ‡å®šä½ç½®çš„æ•°æ®</h3><p>åœºæ™¯ï¼šæŒ‰ç…§æŸä¸€å­—æ®µæ’åºï¼Œç„¶åé€‰æ‹©ç¬¬æ’åº1000ä½ç½®çš„æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> name,</span><br><span class="line">    cnt,</span><br><span class="line">    <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> cnt <span class="keyword">desc</span>) <span class="keyword">as</span> rank </span><br><span class="line">    <span class="keyword">from</span> tmpr.yuan_test</span><br><span class="line">) a </span><br><span class="line"><span class="keyword">where</span> a.rank <span class="operator">=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure><h2 id="ä¸Šä¼ æ–‡ä»¶">ä¸Šä¼ æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -put /home/user/train.tar.gz <span class="string">&#x27;hdfs://ns1013/user/.../train&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ä¸‹è½½æ–‡ä»¶">ä¸‹è½½æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -get <span class="string">&#x27;hdfs://ns1013/user/.../train&#x27;</span> /home/user/train.tar.gz</span><br></pre></td></tr></table></figure><h2 id="hadoop-æŸ¥çœ‹æ–‡ä»¶å¤§å°">hadoop æŸ¥çœ‹æ–‡ä»¶å¤§å°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -<span class="built_in">du</span> -s -h hdfs://ns1013/0530/train/data/</span><br><span class="line"><span class="comment"># -h humanity</span></span><br></pre></td></tr></table></figure><h2 id="hadoop-æ›´æ”¹ç»„æƒé™">hadoop æ›´æ”¹ç»„æƒé™</h2><p>hadoop fs -chgrp -R user1</p><h2 id="left-join-åé¢æ¥andå’Œæ¥whereçš„åŒºåˆ«">LEFT JOINåé¢æ¥ANDå’Œæ¥WHEREçš„åŒºåˆ«</h2><p>å‚è€ƒåšå®¢<ahref="https://blog.csdn.net/henrrywan/article/details/90207961">ä¾‹å­</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[nd1:21000] default&gt; select * from test_user;</span><br><span class="line">+----+------+-----+---------+</span><br><span class="line">| id | name | age | classid | </span><br><span class="line">+----+------+-----+---------+</span><br><span class="line">| 1  | å¼ ä¸‰ | 20  | 1       |</span><br><span class="line">| 2  | æå›› | 21  | 1       |</span><br><span class="line">| 3  | ç‹äº” | 22  | 2       | </span><br><span class="line">| 4  | Lucy | 18  | 3       |</span><br><span class="line">| 5  | Jack | 18  | 3       |</span><br><span class="line">| 6  | Tom  | 18  | 3       |</span><br><span class="line">+----+------+-----+---------+</span><br><span class="line"></span><br><span class="line">[nd1:21000] default&gt; select * from test_class;</span><br><span class="line">+----+----------+</span><br><span class="line">| id | classname|</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | class101 |</span><br><span class="line">| 2  | class102 |</span><br><span class="line">| 3  | class103 |</span><br><span class="line">| 4  | class104 |</span><br><span class="line">+----+----------+</span><br></pre></td></tr></table></figure><h3 id="å¸¦onå’Œandçš„sqlæŸ¥è¯¢">å¸¦ONå’ŒANDçš„SQLæŸ¥è¯¢</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">select t1.id,t1.name,t2.classname from test_user t1</span><br><span class="line">left join test_class t2 </span><br><span class="line">on t1.classid=t2.id and t1.id=1</span><br><span class="line"></span><br><span class="line">+----+------+----------+</span><br><span class="line">| id | name | classname|</span><br><span class="line">+----+------+----------+</span><br><span class="line">| 1  | å¼ ä¸‰ | class101 | </span><br><span class="line">| 2  | æå›› | NULL     | </span><br><span class="line">| 3  | ç‹äº” | NULL     | </span><br><span class="line">| 4  | Lucy | NULL     |</span><br><span class="line">| 5  | Jack | NULL     | </span><br><span class="line">| 6  | Tom  | NULL     | </span><br><span class="line">+----+------+----------+</span><br><span class="line"></span><br><span class="line">--è¿™é‡Œæˆ‘ä»¬æŠŠonåé¢çš„æŸ¥è¯¢æ¡ä»¶æ”¾åœ¨æ‹¬å·é‡Œé¢ï¼Œç»“æœä¸€è‡´ã€‚</span><br><span class="line">select t1.id,t1.name,t2.classname from test_user t1</span><br><span class="line">left join test_class  t2 </span><br><span class="line">on (t1.classid = t2.id and t1.id = 1)</span><br></pre></td></tr></table></figure><p>å¯¹äºleftjoinï¼Œ<strong>onæ¡ä»¶æ˜¯åœ¨ç”Ÿæˆä¸´æ—¶è¡¨æ—¶ä½¿ç”¨çš„æ¡ä»¶(å‚ç…§ä¸Šé¢çš„åšå®¢ï¼Œè¿™é‡Œç”¨æ¥è¿‡æ»¤t2è¡¨çš„æ•°æ®ï¼Œè€Œt1çš„æ•°æ®å…¨éƒ¨æ˜¾ç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´å…³è”ä¸Šäº†å°±æ˜¾ç¤ºt2æ•°æ®ï¼Œå…³è”ä¸ä¸Šå°±æ˜¾ç¤ºNULL)</strong>ï¼Œå®ƒä¸ç®¡onä¸­çš„æ¡ä»¶æ˜¯å¦ä¸ºçœŸï¼Œéƒ½ä¼šè¿”å›å·¦è¾¹è¡¨ä¸­çš„è®°å½•ï¼Œonåé¢çš„åªä½œä¸ºå…³è”æ¡ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select t1.id,t1.name,t2.classname from test_user t1</span><br><span class="line">left join test_class t2</span><br><span class="line">on t1.classid=t2.id</span><br><span class="line">where t1.id=1</span><br><span class="line"></span><br><span class="line">+----+------+----------+</span><br><span class="line">| id | name | classname| </span><br><span class="line">+----+------+----------+</span><br><span class="line">| 1  | å¼ ä¸‰ | class101 |</span><br><span class="line">+----+------+----------+</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>whereæ¡ä»¶æ˜¯åœ¨ä¸´æ—¶è¡¨ç”Ÿæˆå¥½åï¼Œå†å¯¹ä¸´æ—¶è¡¨è¿›è¡Œè¿‡æ»¤çš„æ¡ä»¶ã€‚è¿™æ—¶å·²ç»æ²¡æœ‰leftjoinçš„å«ä¹‰ï¼ˆå¿…é¡»è¿”å›å·¦è¾¹è¡¨çš„è®°å½•ï¼‰äº†ï¼Œæ¡ä»¶ä¸ä¸ºçœŸçš„å°±å…¨éƒ¨è¿‡æ»¤æ‰</strong>å…¶å®æ¯”è¾ƒå¥½çš„å†™æ³•æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select u.id, u.name, c.classname from (select * from test_user where id = 1) u left join test_class c on u.classid=c.id;</span><br></pre></td></tr></table></figure><p>å°½é‡ä½¿ç”¨leftjoin-on-whereæ ‡å‡†å†™æ³•<strong>ï¼Œonåªå‡ºç°è¿æ¥å­—æ®µ</strong>ï¼Œè¿‡æ»¤æ¡ä»¶æ”¾åœ¨whereé‡Œé¢ã€‚</p><p>å¯¹äºinner join åˆ™æ²¡æœ‰è¿™ä¸ªé¡¾è™‘ï¼Œåœ¨joinçš„è¿‡ç¨‹æ­£è¿‡æ»¤æ‰æ•°æ®æœ‰åˆ©äºæé«˜æ•ˆç‡ä¸»è¦ç»“è®ºå¦‚ä¸‹ï¼š</p><ul><li>LEFT JOINåé¢å¦‚æœåªæ¥ONæŸ¥è¯¢ï¼Œä¼šæ˜¾ç¤ºæ‰€æœ‰å·¦è¡¨çš„æ•°æ®ï¼Œå³è¡¨ä¸­çš„æ•°æ®æ˜¯å¦æ˜¾ç¤ºå–å†³äºåé¢çš„æŸ¥è¯¢æ¡ä»¶</li><li>LEFT JOIN åé¢æ¥WHEREæŸ¥è¯¢ï¼Œä¼šæ ¹æ®WHEREæ¡ä»¶å…ˆå¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤</li><li>LEFT JOIN åé¢æ¡ä»¶æŸ¥è¯¢ï¼Œæ¡ä»¶ä¸€å®šä¸è¦æ’ä¸ºçœŸï¼Œå¦åˆ™ä¼šå‡ºç°ç¬›å¡å°”ç§¯</li><li>LEFT JOINåé¢æ¡ä»¶æŸ¥è¯¢ï¼Œæ¡ä»¶ä¸€å®šä¸è¦æ’ä¸ºå‡ï¼Œå¦åˆ™æŸ¥è¯¢ç»“æœä¸­å³è¡¨æ•°æ®å§‹ç»ˆä¸ºNULL</li><li>RIGHT JOIN å’ŒLEFT JOIN ç‰¹æ€§ç›¸åŒï¼ŒINNERJOINæ²¡è¿™ä¸ªç‰¹æ®Šæ€§ï¼Œä¸ç®¡æ¡ä»¶æ˜¯æ”¾åœ¨ONä¸­ï¼Œè¿˜æ˜¯æ”¾åœ¨WHEREä¸­ï¼Œè¿”å›çš„ç»“æœé›†æ˜¯ç›¸åŒçš„</li></ul><h2 id="rack-node-cluster">Rack &amp; Node &amp; cluster</h2><p>å‚è€ƒ<ahref="https://www.quora.com/What-is-the-rack-in-a-Hadoop-cluster-How-does-it-work">å›ç­”</a></p><p>ä¸€ä¸ªnodeå°±æ˜¯ä¸€å°ç”µè„‘ï¼Œä¸€å †nodesçš„å­˜å‚¨ç©ºé—´è¢«ç§°ä½œrackã€‚é€šå¸¸ä¸€ä¸ªrackæ˜¯30-40ä¸ªæœ‰å®é™…ç‰©ç†å­˜å‚¨ç©ºé—´çš„nodesç»„æˆçš„ï¼Œä¸”è¿™äº›nodesä½ç½®æ¯”è¾ƒè¿‘ï¼Œä¸”è¿æ¥äºåŒä¸€ä¸ªnetworkswitch(äº¤æ¢æœº)ã€‚åŸºäºè¿™ä¸ªç»“æ„å¯çŸ¥ï¼šåŒä¸€rackä¸­çš„ä»»æ„ä¸¤ä¸ªnodesä¹‹é—´é€šä¿¡çš„å¸¦å®½å¤§äºä¸åŒranckä¸­çš„nodesã€‚ä¸€ä¸ªHadoopClusterå°±æ˜¯racksçš„é›†åˆã€‚ &gt;Whenever any data is stored in hdfs ,it isreplicated (default 3) in which two copies are in same rack and oneoutside the rack. So that if whole rack goes down then also data can beretrived.</p><p>(ä¸Šé¢è¿™ä¸€ç‚¹å³Data protection against rack failureï¼‰</p><h3 id="rack-awareness">Rack Awareness</h3><p>In a large cluster of Hadoop, in order to improve the network trafficwhile reading/writing HDFS file, <strong>namenode chooses the datanodewhich is closer to the same rack or nearby rack to Read/Writerequest</strong>. Namenode achieves rack information by maintaining therack idâ€™s of each datanode. This concept that chooses closer datanodesbased on the rack information is called <strong>Rack Awareness</strong>in Hadoop.</p><h3 id="node">node</h3><p>A node in hadoop simply means a computer that can be used forprocessing and storing. There are two types of nodes in hadoop Name nodeand Data node. It is called as a node as all these computers areinterconnected.</p><h3 id="namenode-and-datanode"><ahref="https://www.quora.com/What-is-the-difference-between-Namenode-+-Datanode-Jobtracker-+-Tasktracker-Combiners-Shufflers-and-Mappers+Reducers-in-their-technical-functionality-and-physically-ie-whether-they-are-on-the-same-machine-in-a-cluster-while-running-a-job">NameNodeand DataNode</a></h3><p>Technical Sense: NameNode stores MetaData(No of Blocks, On Which Rackwhich DataNode the data is stored and other details) about the databeing stored in DataNodes whereas the DataNode stores the actualData.</p><p>Physical Sense: In a multinode cluster NameNode and DataNodes areusually on different machines. There is only one NameNode in a clusterand many DataNodes; Thats why we call NameNode as a single point offailure. Although There is a Secondary NameNode (SNN) that can exist ondifferent machine which doesn't actually act as a NameNode but storesthe image of primary NameNode at certain checkpoint and is used asbackup to restore NameNode.</p><h3 id="jobtracker-and-tasktracker">JobTracker And TaskTracker</h3><p>Technical Sense: JobTracker is a master which creates and runs thejob. <strong>JobTracker which can run on the NameNode allocates the jobto TaskTrackers which run on DataNodes</strong>; TaskTrackers run thetasks and report the status of task to JobTracker.</p><p>Physical Sense: The JobTracker runs on MasterNode aka NameNodewhereas TaskTrackers run on DataNodes.</p><h2 id="hiveä¸­æ§åˆ¶map-reduceæ•°é‡æ–¹æ³•"><ahref="https://blog.csdn.net/zhong_han_jun/article/details/50814246">hiveä¸­æ§åˆ¶mapreduceæ•°é‡æ–¹æ³•</a></h2><ul><li>map:</li></ul><p>set mapred.max.split.size=256000000; --å†³å®šæ¯ä¸ªmapå¤„ç†çš„æœ€å¤§çš„æ–‡ä»¶å¤§å°ï¼Œå•ä½ä¸ºB setmapred.min.split.size.per.node=1; -- èŠ‚ç‚¹ä¸­å¯ä»¥å¤„ç†çš„æœ€å°çš„æ–‡ä»¶å¤§å° setmapred.min.split.size.per.rack=1; -- æœºæ¶ä¸­å¯ä»¥å¤„ç†çš„æœ€å°çš„æ–‡ä»¶å¤§å°</p><p>å¦‚æœmapred.max.split.size = 240x1024x1024=240M</p><ol type="1"><li>å‡è®¾æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤§å°åˆ†åˆ«ä¸º(256M,280M)è¢«åˆ†é…åˆ°èŠ‚ç‚¹Aï¼Œé‚£ä¹ˆä¼šå¯åŠ¨ä¸¤ä¸ªmapï¼Œå‰©ä½™çš„æ–‡ä»¶å¤§å°ä¸º10MBå’Œ35MBå› ä¸ºæ¯ä¸ªå¤§å°éƒ½ä¸è¶³241MBä¼šå…ˆåšä¿ç•™</li><li>æ ¹æ®å‚æ•°setmapred.min.split.size.per.nodeçœ‹å‰©ä½™çš„å¤§å°æƒ…å†µå¹¶è¿›è¡Œåˆå¹¶,å¦‚æœå€¼ä¸º1ï¼Œè¡¨ç¤ºaä¸­æ¯ä¸ªå‰©ä½™æ–‡ä»¶éƒ½ä¼šè‡ªå·±èµ·ä¸€ä¸ªmapï¼Œè¿™é‡Œä¼šèµ·ä¸¤ä¸ªï¼Œå¦‚æœè®¾ç½®ä¸ºå¤§äº45<em>1024</em>1024åˆ™ä¼šåˆå¹¶æˆä¸€ä¸ªå—ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªmapå¦‚æœmapred.min.split.size.per.nodeä¸º10<em>1024</em>1024ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šä¸€å…±ä¼šæœ‰4ä¸ªmapï¼Œå¤„ç†çš„å¤§å°ä¸º(245MB,245MB,10MB,10MBï¼Œ10MBï¼Œ10MB)ï¼Œä½™ä¸‹9MBå¦‚æœmapred.min.split.size.per.nodeä¸º45<em>1024</em>1024ï¼Œé‚£ä¹ˆä¼šæœ‰ä¸‰ä¸ªmapï¼Œå¤„ç†çš„å¤§å°ä¸º(245MB,245MB,45MB)å®é™…ä¸­mapred.min.split.size.per.nodeæ— æ³•å‡†ç¡®åœ°è®¾ç½®æˆ45<em>1024</em>1024ï¼Œä¼šæœ‰å‰©ä½™å¹¶ä¿ç•™å¸¦ä¸‹ä¸€æ­¥è¿›è¡Œåˆ¤æ–­å¤„ç†</li><li>å¯¹2ä¸­ä½™å‡ºæ¥çš„æ–‡ä»¶ä¸å…¶å®ƒèŠ‚ç‚¹ä½™å‡ºæ¥çš„æ–‡ä»¶æ ¹æ®mapred.min.split.size.per.rackå¤§å°è¿›è¡Œåˆ¤æ–­æ˜¯å¦åˆå¹¶ï¼Œå¯¹å†æ¬¡ä½™å‡ºæ¥çš„æ–‡ä»¶ç‹¬è‡ªäº§ç”Ÿä¸€ä¸ªmapå¤„ç†</li></ol><ul><li>reduce: æ–¹æ³•1 set mapred.reduce.tasks=10; -- è®¾ç½®reduceçš„æ•°é‡ æ–¹æ³•2set hive.exec.reducers.bytes.per.reducer=1073741824 --æ¯ä¸ªreduceå¤„ç†çš„æ•°æ®é‡,é»˜è®¤1GB</li></ul><p>å…¶ä»–æ›´ç»†çš„ä¼˜åŒ–å‚è€ƒä¸‹é¢ä¸¤ä¸ªè¿æ¥æœªå®Œå¾…ç»­ <ahref="https://www.cnblogs.com/xd502djj/p/3799432.html">èµ„æ–™1</a> <ahref="https://www.cnblogs.com/swordfall/p/11037539.html">èµ„æ–™2</a>2019-09-04 18:09:24</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æŸ¥çœ‹è¡¨çš„ä¿¡æ¯&quot;&gt;æŸ¥çœ‹è¡¨çš„ä¿¡æ¯&lt;/h2&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°è¡¨çš„ location, tableTypeç­‰ æ ¹æ®Table
Typeå€¼å¯ä»¥çŸ¥é“è¡¨æ˜¯å†…éƒ¨è¡¨è¿˜æ˜¯å¤–éƒ¨è¡¨&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;describe extended tablename&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;desc formatted tablename;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æŸ¥çœ‹è¡¨åˆ†åŒº&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;show partitions &lt;span class=&quot;variable&quot;&gt;$&amp;#123;table_name&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>data_process</title>
    <link href="http://yoursite.com/2024/06/04/data-process/"/>
    <id>http://yoursite.com/2024/06/04/data-process/</id>
    <published>2024-06-04T06:52:38.000Z</published>
    <updated>2025-05-22T05:50:40.064Z</updated>
    
    <content type="html"><![CDATA[<h1 id="byte-kb-mbçš„ç¬”è®°">Byte, KB, MBçš„ç¬”è®°</h1><p><a href="http://myrepono.com/faq/4"class="uri">http://myrepono.com/faq/4</a></p><blockquote><p>A byte is a sequence of 8 bits (enough to represent one alphanumericcharacter) processed as a single unit of information. A single letter orcharacter would use one byte of memory (8 bits), two characters woulduse two bytes (16 bits).</p></blockquote><p>1024 bytes = 1 KB 1024 KB = 1 MB 1024 MB = 1 GB 1024 GB = 1 TB 1024TB = 1 PB KB = KilobyteM B = MegabyteG B = GigabyteT B = TerabyteP B =Petabyte</p><h2 id="dataframe-ä¼°ç®—å†…å­˜">dataframe ä¼°ç®—å†…å­˜</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memory_usage</span>(<span class="params">df</span>):</span><br><span class="line">    types = df.dtypes</span><br><span class="line">    s = df.memory_usage(deep=<span class="literal">True</span>)</span><br><span class="line">    s = s/<span class="number">1024</span>**<span class="number">2</span></span><br><span class="line">    total_mem = s.<span class="built_in">sum</span>()</span><br><span class="line">    <span class="keyword">for</span> column <span class="keyword">in</span> df.columns:</span><br><span class="line">        <span class="keyword">if</span> s[column] &lt; <span class="number">0.01</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125; = &#123;&#125; KB,  &#123;&#125;&quot;</span>.<span class="built_in">format</span>(column, s[column] * <span class="number">1024</span>, types[column]))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125; = &#123;:1.2f&#125; MB,  &#123;&#125;&quot;</span>.<span class="built_in">format</span>(column, s[column], types[column]))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;totoal memory: &#123;:.2f&#125; MB&quot;</span>.<span class="built_in">format</span>(total_mem))</span><br><span class="line"></span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="è¯»æ–‡ä»¶">è¯»æ–‡ä»¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(live_data_path, names=[<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;index_image&#x27;</span>, <span class="string">&#x27;view_num&#x27;</span>, <span class="string">&#x27;dt&#x27;</span>], dtype=&#123;<span class="string">&#x27;id&#x27;</span>:<span class="built_in">str</span>, <span class="string">&#x27;index_image&#x27;</span>:<span class="built_in">str</span>, <span class="string">&#x27;view_num&#x27;</span>:<span class="built_in">str</span>, <span class="string">&#x27;dt&#x27;</span>:<span class="built_in">str</span>&#125;, parse_dates=[<span class="string">&#x27;dt&#x27;</span>], index_col=[<span class="string">&#x27;id&#x27;</span>])</span><br></pre></td></tr></table></figure><h2 id="dataframe-åˆ—æ•°æ®æ ¼å¼format">dataframe åˆ—æ•°æ®æ ¼å¼format</h2><p>1.è¯»æ–‡ä»¶æ—¶ frame = pandas.DataFrame({..somedata..},dtype=[str,int,int])</p><p>2.è¯»æ–‡ä»¶å frame['some column'] = frame['somecolumn'].astype(float)</p><p>3.é‡åˆ°é”™è¯¯ï¼ˆNULLä¸èƒ½è½¬æ¢æ—¶ï¼‰ df['count'] =df['count'].apply(pd.to_numeric, errors='coerce').fillna(0.0)</p><h2 id="pandas-å–è¡Œåˆ—çš„æ–¹å¼">pandas å–è¡Œï¼Œåˆ—çš„æ–¹å¼</h2><p>pandas æœ‰ä¸¤ç§ç´¢å¼•ï¼š</p><ol type="1"><li>nameï¼ˆindex,columnåç§°)</li><li>int (æ•´æ•°ï¼Œåˆ—æˆ–è¡Œçš„æ•°ç»„ä½ç½®ï¼‰</li></ol><ul><li>df[...]: ç”¨ç´¢å¼•å–</li><li>ix: int å’Œ name æ··ç”¨ï¼Œç°åœ¨å·²ç»deprecated</li><li>loc: name</li><li>iloc: int</li></ul><p>å‚çœ‹<ahref="https://www.cnblogs.com/nxf-rabbit75/p/10105271.html">ã€Špandaså–dataframeç‰¹å®šè¡Œ/åˆ—ã€‹</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> DataFrame</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"> </span><br><span class="line">df=DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>,<span class="number">4</span>)),index=[<span class="string">&#x27;one&#x27;</span>,<span class="string">&#x27;two&#x27;</span>,<span class="string">&#x27;thr&#x27;</span>],columns=<span class="built_in">list</span>(<span class="string">&#x27;abcd&#x27;</span>))</span><br><span class="line"> </span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>]<span class="comment">#å–aåˆ—</span></span><br><span class="line">df[[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>]]<span class="comment">#å–aã€båˆ—</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#ixå¯ä»¥ç”¨æ•°å­—ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ç”¨indexå’Œcolumnç´¢å¼•</span></span><br><span class="line">df.ix[<span class="number">0</span>]<span class="comment">#å–ç¬¬0è¡Œ</span></span><br><span class="line">df.ix[<span class="number">0</span>:<span class="number">1</span>]<span class="comment">#å–ç¬¬0è¡Œ</span></span><br><span class="line">df.ix[<span class="string">&#x27;one&#x27;</span>:<span class="string">&#x27;two&#x27;</span>]<span class="comment">#å–oneã€twoè¡Œ</span></span><br><span class="line">df.ix[<span class="number">0</span>:<span class="number">2</span>,<span class="number">0</span>]<span class="comment">#å–ç¬¬0ã€1è¡Œï¼Œç¬¬0åˆ—</span></span><br><span class="line">df.ix[<span class="number">0</span>:<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>]<span class="comment">#å–ç¬¬0è¡Œï¼Œaåˆ—</span></span><br><span class="line">df.ix[<span class="number">0</span>:<span class="number">2</span>,<span class="string">&#x27;a&#x27;</span>:<span class="string">&#x27;c&#x27;</span>]<span class="comment">#å–ç¬¬0ã€1è¡Œï¼Œabcåˆ—</span></span><br><span class="line">df.ix[<span class="string">&#x27;one&#x27;</span>:<span class="string">&#x27;two&#x27;</span>,<span class="string">&#x27;a&#x27;</span>:<span class="string">&#x27;c&#x27;</span>]<span class="comment">#å–oneã€twoè¡Œï¼Œabcåˆ—</span></span><br><span class="line">df.ix[<span class="number">0</span>:<span class="number">2</span>,<span class="number">0</span>:<span class="number">1</span>]<span class="comment">#å–ç¬¬0ã€1è¡Œï¼Œç¬¬0åˆ—</span></span><br><span class="line">df.ix[<span class="number">0</span>:<span class="number">2</span>,<span class="number">0</span>:<span class="number">2</span>]<span class="comment">#å–ç¬¬0ã€1è¡Œï¼Œç¬¬0ã€1åˆ—</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#locåªèƒ½é€šè¿‡indexå’Œcolumnsæ¥å–ï¼Œä¸èƒ½ç”¨æ•°å­—</span></span><br><span class="line">df.loc[<span class="string">&#x27;one&#x27;</span>,<span class="string">&#x27;a&#x27;</span>]<span class="comment">#oneè¡Œï¼Œaåˆ—</span></span><br><span class="line">df.loc[<span class="string">&#x27;one&#x27;</span>:<span class="string">&#x27;two&#x27;</span>,<span class="string">&#x27;a&#x27;</span>]<span class="comment">#oneåˆ°twoè¡Œï¼Œaåˆ—</span></span><br><span class="line">df.loc[<span class="string">&#x27;one&#x27;</span>:<span class="string">&#x27;two&#x27;</span>,<span class="string">&#x27;a&#x27;</span>:<span class="string">&#x27;c&#x27;</span>]<span class="comment">#oneåˆ°twoè¡Œï¼Œaåˆ°cåˆ—</span></span><br><span class="line">df.loc[<span class="string">&#x27;one&#x27;</span>:<span class="string">&#x27;two&#x27;</span>,[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]]<span class="comment">#oneåˆ°twoè¡Œï¼Œacåˆ—</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#ilocåªèƒ½ç”¨æ•°å­—ç´¢å¼•ï¼Œä¸èƒ½ç”¨ç´¢å¼•å</span></span><br><span class="line">df.iloc[<span class="number">0</span>:<span class="number">2</span>]<span class="comment">#å‰2è¡Œ</span></span><br><span class="line">df.iloc[<span class="number">0</span>]<span class="comment">#ç¬¬0è¡Œ</span></span><br><span class="line">df.iloc[<span class="number">0</span>:<span class="number">2</span>,<span class="number">0</span>:<span class="number">2</span>]<span class="comment">#0ã€1è¡Œï¼Œ0ã€1åˆ—</span></span><br><span class="line">df.iloc[[<span class="number">0</span>,<span class="number">2</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]]<span class="comment">#ç¬¬0ã€2è¡Œï¼Œ1ã€2ã€3åˆ—</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#iatå–æŸä¸ªå•å€¼,åªèƒ½æ•°å­—ç´¢å¼•</span></span><br><span class="line">df.iat[<span class="number">1</span>,<span class="number">1</span>]<span class="comment">#ç¬¬1è¡Œï¼Œ1åˆ—</span></span><br><span class="line"><span class="comment">#atå–æŸä¸ªå•å€¼,åªèƒ½indexå’Œcolumnsç´¢å¼•</span></span><br><span class="line">df.at[<span class="string">&#x27;one&#x27;</span>,<span class="string">&#x27;a&#x27;</span>]<span class="comment">#oneè¡Œï¼Œaåˆ—</span></span><br></pre></td></tr></table></figure><h2 id="æŒ‰è¡Œæ¡ä»¶åˆ¤æ–­å¤„ç†">æŒ‰è¡Œæ¡ä»¶åˆ¤æ–­å¤„ç†</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">50</span>, <span class="number">50</span>], </span><br><span class="line">                   <span class="string">&#x27;B&#x27;</span> : [<span class="number">150</span>, <span class="number">30</span>],</span><br><span class="line">                   <span class="string">&#x27;C&#x27;</span>: [<span class="number">11</span>, <span class="number">40</span>]&#125;)    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">adjust_min</span>(<span class="params">row</span>):</span><br><span class="line">    res = <span class="built_in">min</span>(row[<span class="string">&#x27;A&#x27;</span>], row[<span class="string">&#x27;B&#x27;</span>], row[<span class="string">&#x27;C&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span> res == row[<span class="string">&#x27;A&#x27;</span>]:</span><br><span class="line">        row[<span class="string">&#x27;min&#x27;</span>] = <span class="string">&#x27;A&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> res == row[<span class="string">&#x27;B&#x27;</span>]:</span><br><span class="line">        row[<span class="string">&#x27;min&#x27;</span>] = <span class="string">&#x27;B&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        row[<span class="string">&#x27;min&#x27;</span>] = <span class="string">&#x27;C&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> row[<span class="string">&#x27;min&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df[<span class="string">&#x27;Min&#x27;</span>] = df.apply(adjust_min, axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h2 id="group-by">group by</h2><h3 id="count-sort">count sort</h3><p><ahref="https://stackoverflow.com/questions/40454030/count-and-sort-with-pandas"class="uri">https://stackoverflow.com/questions/40454030/count-and-sort-with-pandas</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;STNAME&#x27;</span>:<span class="built_in">list</span>(<span class="string">&#x27;abscscbcdbcsscae&#x27;</span>),</span><br><span class="line">                   <span class="string">&#x27;CTYNAME&#x27;</span>:[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">5</span>]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (df)</span><br><span class="line">    CTYNAME STNAME</span><br><span class="line"><span class="number">0</span>         <span class="number">4</span>      a</span><br><span class="line"><span class="number">1</span>         <span class="number">5</span>      b</span><br><span class="line"><span class="number">2</span>         <span class="number">6</span>      s</span><br><span class="line"><span class="number">3</span>         <span class="number">5</span>      c</span><br><span class="line"><span class="number">4</span>         <span class="number">6</span>      s</span><br><span class="line"><span class="number">5</span>         <span class="number">2</span>      c</span><br><span class="line"><span class="number">6</span>         <span class="number">3</span>      b</span><br><span class="line"><span class="number">7</span>         <span class="number">4</span>      c</span><br><span class="line"><span class="number">8</span>         <span class="number">5</span>      d</span><br><span class="line"><span class="number">9</span>         <span class="number">6</span>      b</span><br><span class="line"><span class="number">10</span>        <span class="number">4</span>      c</span><br><span class="line"><span class="number">11</span>        <span class="number">5</span>      s</span><br><span class="line"><span class="number">12</span>        <span class="number">4</span>      s</span><br><span class="line"><span class="number">13</span>        <span class="number">3</span>      c</span><br><span class="line"><span class="number">14</span>        <span class="number">6</span>      a</span><br><span class="line"><span class="number">15</span>        <span class="number">5</span>      e</span><br><span class="line"></span><br><span class="line">df = df[[<span class="string">&#x27;STNAME&#x27;</span>,<span class="string">&#x27;CTYNAME&#x27;</span>]].groupby([<span class="string">&#x27;STNAME&#x27;</span>])[<span class="string">&#x27;CTYNAME&#x27;</span>] \</span><br><span class="line">                             .count() \</span><br><span class="line">                             .reset_index(name=<span class="string">&#x27;count&#x27;</span>) \</span><br><span class="line">                             .sort_values([<span class="string">&#x27;count&#x27;</span>], ascending=<span class="literal">False</span>) \</span><br><span class="line">                             .head(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (df)</span><br><span class="line">  STNAME  count</span><br><span class="line"><span class="number">2</span>      c      <span class="number">5</span></span><br><span class="line"><span class="number">5</span>      s      <span class="number">4</span></span><br><span class="line"><span class="number">1</span>      b      <span class="number">3</span></span><br><span class="line"><span class="number">0</span>      a      <span class="number">2</span></span><br><span class="line"><span class="number">3</span>      d      <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="groupby-åä¿ç•™åˆ—">groupby åä¿ç•™åˆ—</h3><p><ahref="https://stackoverflow.com/questions/19202093/how-to-select-columns-from-groupby-object-in-pandas/26668184"class="uri">https://stackoverflow.com/questions/19202093/how-to-select-columns-from-groupby-object-in-pandas/26668184</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>],</span><br><span class="line">                   <span class="string">&#x27;b&#x27;</span>: [<span class="number">4.0</span>, <span class="number">5.5</span>, <span class="number">6.0</span>],</span><br><span class="line">                   <span class="string">&#x27;c&#x27;</span>: [<span class="number">7L</span>, <span class="number">8L</span>, <span class="number">9L</span>],</span><br><span class="line">                   <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>]&#125;)</span><br><span class="line">df.groupby([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;name&#x27;</span>]).median()</span><br><span class="line"><span class="comment"># ä¼šå¾—åˆ°ç»“æœå¦‚ä¸‹</span></span><br><span class="line">            b    c</span><br><span class="line">a name            </span><br><span class="line"><span class="number">1</span> hello  <span class="number">4.75</span>  <span class="number">7.5</span></span><br><span class="line"><span class="number">3</span> foo    <span class="number">6.00</span>  <span class="number">9.0</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡groupbyåå¯èƒ½groupByçš„å­—æ®µæ— æ³•é€šè¿‡df['name']è®¿é—®ï¼Œå› ä¸ºå·²ç»å˜æˆäº†indexå¦‚æœä¿è¯å…¶èƒ½è®¿é—®ï¼Œå¯ä»¥åœ¨groupbyé‡Œè®¾ç½®å‚æ•° groupby(...,<strong>as_index=False</strong>)</p><h2 id="pandas-è¯»å–-excelæ–‡ä»¶">pandas è¯»å– excelæ–‡ä»¶</h2><p>éœ€è¦å®‰è£…xlrd <ahref="https://www.cnblogs.com/yfacesclub/p/11232736.html"class="uri">https://www.cnblogs.com/yfacesclub/p/11232736.html</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pd.read_excel(path, sheet_name=<span class="number">0</span>, header=<span class="number">0</span>, names=<span class="literal">None</span>, index_col=<span class="literal">None</span>, </span><br><span class="line">              usecols=<span class="literal">None</span>, squeeze=<span class="literal">False</span>,dtype=<span class="literal">None</span>, engine=<span class="literal">None</span>, </span><br><span class="line">              converters=<span class="literal">None</span>, true_values=<span class="literal">None</span>, false_values=<span class="literal">None</span>, </span><br><span class="line">              skiprows=<span class="literal">None</span>, nrows=<span class="literal">None</span>, na_values=<span class="literal">None</span>, parse_dates=<span class="literal">False</span>, </span><br><span class="line">              date_parser=<span class="literal">None</span>, thousands=<span class="literal">None</span>, comment=<span class="literal">None</span>, skipfooter=<span class="number">0</span>, </span><br><span class="line">              convert_float=<span class="literal">True</span>, **kwds)</span><br></pre></td></tr></table></figure><h2 id="pandas-printæ ¼å¼è°ƒæ•´">pandas printæ ¼å¼è°ƒæ•´</h2><p><a href="https://blog.csdn.net/weekdawn/article/details/81389865"class="uri">https://blog.csdn.net/weekdawn/article/details/81389865</a><a href="https://www.cnblogs.com/yoyo1216/p/12367713.html"class="uri">https://www.cnblogs.com/yoyo1216/p/12367713.html</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pd.options.display.max_colwidth = 100</span></span><br><span class="line"><span class="comment">#æ˜¾ç¤ºæ‰€æœ‰åˆ—</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.max_columns&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="comment">#æ˜¾ç¤ºæ‰€æœ‰è¡Œ</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.max_rows&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="comment">#è®¾ç½®valueçš„æ˜¾ç¤ºé•¿åº¦ä¸º100ï¼Œé»˜è®¤ä¸º50</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;max_colwidth&#x27;</span>,<span class="number">200</span>)</span><br><span class="line">pd.set_option(<span class="string">&#x27;expand_frame_repr&#x27;</span>, <span class="literal">False</span></span><br></pre></td></tr></table></figure><h2 id="map-filter">map, filter</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">train_logs = glob.glob(<span class="string">&#x27;/data/vinyuan/bpr-models/MSNClick/sgd-unified_event_data_0715_0807*/train.log&#x27;</span>)</span><br><span class="line">train_logs= <span class="built_in">sorted</span>(train_logs, key=<span class="keyword">lambda</span> x: os.path.getmtime(x), reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">text=<span class="string">&#x27;WeightedSample&#x27;</span></span><br><span class="line"></span><br><span class="line">fix_params = [<span class="string">&#x27;UserNegCross=0.2&#x27;</span>, <span class="string">&#x27;PosL2=0.1&#x27;</span>, <span class="string">&#x27;NegL2=0.15&#x27;</span>]</span><br><span class="line">fix_params_str = <span class="string">&quot;\\n&quot;</span>.join(fix_params)+<span class="string">&#x27;\\n&#x27;</span> <span class="keyword">if</span> <span class="built_in">len</span>(fix_params) &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line">pattern=re.<span class="built_in">compile</span>(<span class="string">r&quot;.*&#123;&#125;-(\d+\.?\d*)&quot;</span>.<span class="built_in">format</span>(text))</span><br><span class="line">train_logs = train_logs[:<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_by_fix_param</span>(<span class="params">x</span>):</span><br><span class="line">    value, model_name = x</span><br><span class="line">    <span class="keyword">for</span> param <span class="keyword">in</span> fix_params:</span><br><span class="line">        <span class="keyword">if</span> param <span class="keyword">not</span> <span class="keyword">in</span> model_name:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, model_name</span><br><span class="line">    <span class="keyword">return</span> value, model_name</span><br><span class="line">            </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">x</span>):</span><br><span class="line">    res = pattern.<span class="keyword">match</span>(x)</span><br><span class="line">    model_name = x.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">5</span>]</span><br><span class="line">    <span class="keyword">if</span> res <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> (-<span class="number">1</span>, model_name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        value = <span class="built_in">float</span>(res.group(<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">if</span> value &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="number">0</span>, model_name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> (value, model_name)</span><br><span class="line">        </span><br><span class="line">train_logs = <span class="built_in">map</span>(fun, train_logs)</span><br><span class="line">train_logs = <span class="built_in">filter</span>(filter_by_fix_param, train_logs)</span><br><span class="line">train_logs = <span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="number">0</span>] &gt; <span class="number">0</span>, train_logs)</span><br><span class="line">train_logs = <span class="built_in">sorted</span>(train_logs, key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>], reverse=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2 id="co1-co2-co3---new_col">(co1, co2, co3 -&gt; new_col)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cal_diff</span>(<span class="params">row</span>):</span><br><span class="line">    diff = <span class="built_in">set</span>(row[<span class="string">&#x27;a&#x27;</span>]) - <span class="built_in">set</span>(row[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line">    diff = <span class="built_in">list</span>(diff)</span><br><span class="line">    <span class="keyword">return</span> diff</span><br><span class="line">df[<span class="string">&#x27;c&#x27;</span>] = df.apply(<span class="keyword">lambda</span> row: cal_diff(row), axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h2 id="numpy">Numpy</h2><h2 id="æŒ‰è¡Œå’Œåˆ—å¡«å€¼">æŒ‰è¡Œå’Œåˆ—å¡«å€¼</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = np.zeros([<span class="number">5</span>,<span class="number">3</span>])</span><br><span class="line">a[[<span class="number">0</span>,<span class="number">1</span>],[<span class="number">2</span>,<span class="number">2</span>]] = <span class="number">1</span></span><br><span class="line">a</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">array([[<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">1.</span>],</span><br><span class="line">       [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">1.</span>],</span><br><span class="line">       [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">       [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">       [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>]])</span><br></pre></td></tr></table></figure><h2 id="ä»æ•°å€¼èŒƒå›´åˆ›å»ºé€’å¢æ•°ç»„">ä»æ•°å€¼èŒƒå›´åˆ›å»ºé€’å¢æ•°ç»„</h2><ol type="1"><li>numpy.arange(start, stop, step, dtype)</li><li>np.linspace(start, stop, num=50, endpoint=True, retstep=False,dtype=None)</li><li>numpy.logspace</li></ol><h2 id="dataframe-ç»Ÿè®¡ç©ºå€¼">DataFrame ç»Ÿè®¡ç©ºå€¼</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">data1 = &#123;<span class="string">&#x27;itemId&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], <span class="string">&#x27;other&#x27;</span>:[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]&#125;</span><br><span class="line">data2 = &#123;<span class="string">&#x27;itemId&#x27;</span>:[<span class="number">2</span>,<span class="number">3</span>], <span class="string">&#x27;label&#x27;</span>:[<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>]&#125;</span><br><span class="line">df_data1 = pd.DataFrame(data1)</span><br><span class="line">df_data2 = pd.DataFrame(data2)</span><br><span class="line">df_merge = pd.merge(df_data1, df_data2, on=[<span class="string">&#x27;itemId&#x27;</span>], how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(df_data1)</span><br><span class="line"><span class="built_in">print</span>(df_data2)</span><br><span class="line"><span class="built_in">print</span>(df_merge)</span><br><span class="line">a = df_tmp.where(df_merge[<span class="string">&#x27;label&#x27;</span>].isnull())[<span class="string">&#x27;itemId&#x27;</span>].count()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;byte-kb-mbçš„ç¬”è®°&quot;&gt;Byte, KB, MBçš„ç¬”è®°&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;http://myrepono.com/faq/4&quot;
class=&quot;uri&quot;&gt;http://myrepono.com/faq/4&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A byte is a sequence of 8 bits (enough to represent one alphanumeric
character) processed as a single unit of information. A single letter or
character would use one byte of memory (8 bits), two characters would
use two bytes (16 bits).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;1024 bytes = 1 KB 1024 KB = 1 MB 1024 MB = 1 GB 1024 GB = 1 TB 1024
TB = 1 PB KB = KilobyteM B = MegabyteG B = GigabyteT B = TerabyteP B =
Petabyte&lt;/p&gt;
&lt;h2 id=&quot;dataframe-ä¼°ç®—å†…å­˜&quot;&gt;dataframe ä¼°ç®—å†…å­˜&lt;/h2&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;memory_usage&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;df&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    types = df.dtypes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    s = df.memory_usage(deep=&lt;span class=&quot;literal&quot;&gt;True&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    s = s/&lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;**&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    total_mem = s.&lt;span class=&quot;built_in&quot;&gt;sum&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; column &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; df.columns:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; s[column] &amp;lt; &lt;span class=&quot;number&quot;&gt;0.01&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;&amp;#123;&amp;#125; = &amp;#123;&amp;#125; KB,  &amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;format&lt;/span&gt;(column, s[column] * &lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;, types[column]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;&amp;#123;&amp;#125; = &amp;#123;:1.2f&amp;#125; MB,  &amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;format&lt;/span&gt;(column, s[column], types[column]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;totoal memory: &amp;#123;:.2f&amp;#125; MB&amp;quot;&lt;/span&gt;.&lt;span class=&quot;built_in&quot;&gt;format&lt;/span&gt;(total_mem))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>spark</title>
    <link href="http://yoursite.com/2024/06/04/spark/"/>
    <id>http://yoursite.com/2024/06/04/spark/</id>
    <published>2024-06-04T06:51:08.000Z</published>
    <updated>2025-05-22T05:50:40.080Z</updated>
    
    <content type="html"><![CDATA[<h2 id="pyspark-api">pyspark API</h2><p><ahref="https://spark.apache.org/docs/2.2.1/api/python/search.html?q=dataframe.write"class="uri">https://spark.apache.org/docs/2.2.1/api/python/search.html?q=dataframe.write</a></p><h2 id="ç®€æ˜æ•™ç¨‹">ç®€æ˜æ•™ç¨‹</h2><p><ahref="https://sparkbyexamples.com/pyspark/pyspark-orderby-and-sort-explained/"class="uri">https://sparkbyexamples.com/pyspark/pyspark-orderby-and-sort-explained/</a><a href="http://www.learnbymarketing.com/1100/pyspark-joins-by-example/"class="uri">http://www.learnbymarketing.com/1100/pyspark-joins-by-example/</a></p><span id="more"></span><h2 id="sparkè°ƒä¼˜">Sparkè°ƒä¼˜</h2><p><a href="https://tech.meituan.com/2016/04/29/spark-tuning-basic.html"class="uri">https://tech.meituan.com/2016/04/29/spark-tuning-basic.html</a>èµ„æºå‚æ•°è°ƒä¼˜äº†è§£å®Œäº†Sparkä½œä¸šè¿è¡Œçš„åŸºæœ¬åŸç†ä¹‹åï¼Œå¯¹èµ„æºç›¸å…³çš„å‚æ•°å°±å®¹æ˜“ç†è§£äº†ã€‚æ‰€è°“çš„Sparkèµ„æºå‚æ•°è°ƒä¼˜ï¼Œå…¶å®ä¸»è¦å°±æ˜¯å¯¹Sparkè¿è¡Œè¿‡ç¨‹ä¸­å„ä¸ªä½¿ç”¨èµ„æºçš„åœ°æ–¹ï¼Œé€šè¿‡è°ƒèŠ‚å„ç§å‚æ•°ï¼Œæ¥ä¼˜åŒ–èµ„æºä½¿ç”¨çš„æ•ˆç‡ï¼Œä»è€Œæå‡Sparkä½œä¸šçš„æ‰§è¡Œæ€§èƒ½ã€‚ä»¥ä¸‹å‚æ•°å°±æ˜¯Sparkä¸­ä¸»è¦çš„èµ„æºå‚æ•°ï¼Œæ¯ä¸ªå‚æ•°éƒ½å¯¹åº”ç€ä½œä¸šè¿è¡ŒåŸç†ä¸­çš„æŸä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬åŒæ—¶ä¹Ÿç»™å‡ºäº†ä¸€ä¸ªè°ƒä¼˜çš„å‚è€ƒå€¼ã€‚</p><ul><li>num-executorså‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®Sparkä½œä¸šæ€»å…±è¦ç”¨å¤šå°‘ä¸ªExecutorè¿›ç¨‹æ¥æ‰§è¡Œã€‚Driveråœ¨å‘YARNé›†ç¾¤ç®¡ç†å™¨ç”³è¯·èµ„æºæ—¶ï¼ŒYARNé›†ç¾¤ç®¡ç†å™¨ä¼šå°½å¯èƒ½æŒ‰ç…§ä½ çš„è®¾ç½®æ¥åœ¨é›†ç¾¤çš„å„ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨ç›¸åº”æ•°é‡çš„Executorè¿›ç¨‹ã€‚è¿™ä¸ªå‚æ•°éå¸¸ä¹‹é‡è¦ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤åªä¼šç»™ä½ å¯åŠ¨å°‘é‡çš„Executorè¿›ç¨‹ï¼Œæ­¤æ—¶ä½ çš„Sparkä½œä¸šçš„è¿è¡Œé€Ÿåº¦æ˜¯éå¸¸æ…¢çš„ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šæ¯ä¸ªSparkä½œä¸šçš„è¿è¡Œä¸€èˆ¬è®¾ç½®50~100ä¸ªå·¦å³çš„Executorè¿›ç¨‹æ¯”è¾ƒåˆé€‚ï¼Œè®¾ç½®å¤ªå°‘æˆ–å¤ªå¤šçš„Executorè¿›ç¨‹éƒ½ä¸å¥½ã€‚è®¾ç½®çš„å¤ªå°‘ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨é›†ç¾¤èµ„æºï¼›è®¾ç½®çš„å¤ªå¤šçš„è¯ï¼Œå¤§éƒ¨åˆ†é˜Ÿåˆ—å¯èƒ½æ— æ³•ç»™äºˆå……åˆ†çš„èµ„æºã€‚</li><li>executor-memoryå‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªExecutorè¿›ç¨‹çš„å†…å­˜ã€‚Executorå†…å­˜çš„å¤§å°ï¼Œå¾ˆå¤šæ—¶å€™ç›´æ¥å†³å®šäº†Sparkä½œä¸šçš„æ€§èƒ½ï¼Œè€Œä¸”è·Ÿå¸¸è§çš„JVMOOMå¼‚å¸¸ï¼Œä¹Ÿæœ‰ç›´æ¥çš„å…³è”ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šæ¯ä¸ªExecutorè¿›ç¨‹çš„å†…å­˜è®¾ç½®4G<sub>8Gè¾ƒä¸ºåˆé€‚ã€‚ä½†æ˜¯è¿™åªæ˜¯ä¸€ä¸ªå‚è€ƒå€¼ï¼Œå…·ä½“çš„è®¾ç½®è¿˜æ˜¯å¾—æ ¹æ®ä¸åŒéƒ¨é—¨çš„èµ„æºé˜Ÿåˆ—æ¥å®šã€‚å¯ä»¥çœ‹çœ‹è‡ªå·±å›¢é˜Ÿçš„èµ„æºé˜Ÿåˆ—çš„æœ€å¤§å†…å­˜é™åˆ¶æ˜¯å¤šå°‘ï¼Œnum-executorsä¹˜ä»¥executor-memoryï¼Œæ˜¯ä¸èƒ½è¶…è¿‡é˜Ÿåˆ—çš„æœ€å¤§å†…å­˜é‡çš„ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ æ˜¯è·Ÿå›¢é˜Ÿé‡Œå…¶ä»–äººå…±äº«è¿™ä¸ªèµ„æºé˜Ÿåˆ—ï¼Œé‚£ä¹ˆç”³è¯·çš„å†…å­˜é‡æœ€å¥½ä¸è¦è¶…è¿‡èµ„æºé˜Ÿåˆ—æœ€å¤§æ€»å†…å­˜çš„1/3</sub>1/2ï¼Œé¿å…ä½ è‡ªå·±çš„Sparkä½œä¸šå ç”¨äº†é˜Ÿåˆ—æ‰€æœ‰çš„èµ„æºï¼Œå¯¼è‡´åˆ«çš„åŒå­¦çš„ä½œä¸šæ— æ³•è¿è¡Œã€‚</li><li>executor-cores å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªExecutorè¿›ç¨‹çš„CPUcoreæ•°é‡ã€‚è¿™ä¸ªå‚æ•°å†³å®šäº†æ¯ä¸ªExecutorè¿›ç¨‹å¹¶è¡Œæ‰§è¡Œtaskçº¿ç¨‹çš„èƒ½åŠ›ã€‚å› ä¸ºæ¯ä¸ªCPUcoreåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªtaskçº¿ç¨‹ï¼Œå› æ­¤æ¯ä¸ªExecutorè¿›ç¨‹çš„CPUcoreæ•°é‡è¶Šå¤šï¼Œè¶Šèƒ½å¤Ÿå¿«é€Ÿåœ°æ‰§è¡Œå®Œåˆ†é…ç»™è‡ªå·±çš„æ‰€æœ‰taskçº¿ç¨‹ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šExecutorçš„CPUcoreæ•°é‡è®¾ç½®ä¸º2~4ä¸ªè¾ƒä¸ºåˆé€‚ã€‚åŒæ ·å¾—æ ¹æ®ä¸åŒéƒ¨é—¨çš„èµ„æºé˜Ÿåˆ—æ¥å®šï¼Œå¯ä»¥çœ‹çœ‹è‡ªå·±çš„èµ„æºé˜Ÿåˆ—çš„æœ€å¤§CPUcoreé™åˆ¶æ˜¯å¤šå°‘ï¼Œå†ä¾æ®è®¾ç½®çš„Executoræ•°é‡ï¼Œæ¥å†³å®šæ¯ä¸ªExecutorè¿›ç¨‹å¯ä»¥åˆ†é…åˆ°å‡ ä¸ªCPUcoreã€‚åŒæ ·å»ºè®®ï¼Œå¦‚æœæ˜¯è·Ÿä»–äººå…±äº«è¿™ä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆnum-executors *executor-coresä¸è¦è¶…è¿‡é˜Ÿåˆ—æ€»CPUcoreçš„1/3~1/2å·¦å³æ¯”è¾ƒåˆé€‚ï¼Œä¹Ÿæ˜¯é¿å…å½±å“å…¶ä»–åŒå­¦çš„ä½œä¸šè¿è¡Œã€‚</li><li>driver-memory å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®Driverè¿›ç¨‹çš„å†…å­˜ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šDriverçš„å†…å­˜é€šå¸¸æ¥è¯´ä¸è®¾ç½®ï¼Œæˆ–è€…è®¾ç½®1Gå·¦å³åº”è¯¥å°±å¤Ÿäº†ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨collectç®—å­å°†RDDçš„æ•°æ®å…¨éƒ¨æ‹‰å–åˆ°Driverä¸Šè¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå¿…é¡»ç¡®ä¿Driverçš„å†…å­˜è¶³å¤Ÿå¤§ï¼Œå¦åˆ™ä¼šå‡ºç°OOMå†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚</li><li>spark.default.parallelismå‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªstageçš„é»˜è®¤taskæ•°é‡ã€‚è¿™ä¸ªå‚æ•°æä¸ºé‡è¦ï¼Œå¦‚æœä¸è®¾ç½®å¯èƒ½ä¼šç›´æ¥å½±å“ä½ çš„Sparkä½œä¸šæ€§èƒ½ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šSparkä½œä¸šçš„é»˜è®¤taskæ•°é‡ä¸º500~1000ä¸ªè¾ƒä¸ºåˆé€‚ã€‚å¾ˆå¤šåŒå­¦å¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯å°±æ˜¯ä¸å»è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå¯¼è‡´Sparkè‡ªå·±æ ¹æ®åº•å±‚HDFSçš„blockæ•°é‡æ¥è®¾ç½®taskçš„æ•°é‡ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªHDFSblockå¯¹åº”ä¸€ä¸ªtaskã€‚é€šå¸¸æ¥è¯´ï¼ŒSparké»˜è®¤è®¾ç½®çš„æ•°é‡æ˜¯åå°‘çš„ï¼ˆæ¯”å¦‚å°±å‡ åä¸ªtaskï¼‰ï¼Œå¦‚æœtaskæ•°é‡åå°‘çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä½ å‰é¢è®¾ç½®å¥½çš„Executorçš„å‚æ•°éƒ½å‰åŠŸå°½å¼ƒã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œæ— è®ºä½ çš„Executorè¿›ç¨‹æœ‰å¤šå°‘ä¸ªï¼Œå†…å­˜å’ŒCPUæœ‰å¤šå¤§ï¼Œä½†æ˜¯taskåªæœ‰1ä¸ªæˆ–è€…10ä¸ªï¼Œé‚£ä¹ˆ90%çš„Executorè¿›ç¨‹å¯èƒ½æ ¹æœ¬å°±æ²¡æœ‰taskæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ç™½ç™½æµªè´¹äº†èµ„æºï¼å› æ­¤Sparkå®˜ç½‘å»ºè®®çš„è®¾ç½®åŸåˆ™æ˜¯ï¼Œè®¾ç½®è¯¥å‚æ•°ä¸ºnum-executors* executor-coresçš„2~3å€è¾ƒä¸ºåˆé€‚ï¼Œæ¯”å¦‚Executorçš„æ€»CPUcoreæ•°é‡ä¸º300ä¸ªï¼Œé‚£ä¹ˆè®¾ç½®1000ä¸ªtaskæ˜¯å¯ä»¥çš„ï¼Œæ­¤æ—¶å¯ä»¥å……åˆ†åœ°åˆ©ç”¨Sparké›†ç¾¤çš„èµ„æºã€‚</li><li>spark.storage.memoryFractionå‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®RDDæŒä¹…åŒ–æ•°æ®åœ¨Executorå†…å­˜ä¸­èƒ½å çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯0.6ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤Executor60%çš„å†…å­˜ï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜æŒä¹…åŒ–çš„RDDæ•°æ®ã€‚æ ¹æ®ä½ é€‰æ‹©çš„ä¸åŒçš„æŒä¹…åŒ–ç­–ç•¥ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿæ—¶ï¼Œå¯èƒ½æ•°æ®å°±ä¸ä¼šæŒä¹…åŒ–ï¼Œæˆ–è€…æ•°æ®ä¼šå†™å…¥ç£ç›˜ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šå¦‚æœSparkä½œä¸šä¸­ï¼Œæœ‰è¾ƒå¤šçš„RDDæŒä¹…åŒ–æ“ä½œï¼Œè¯¥å‚æ•°çš„å€¼å¯ä»¥é€‚å½“æé«˜ä¸€äº›ï¼Œä¿è¯æŒä¹…åŒ–çš„æ•°æ®èƒ½å¤Ÿå®¹çº³åœ¨å†…å­˜ä¸­ã€‚é¿å…å†…å­˜ä¸å¤Ÿç¼“å­˜æ‰€æœ‰çš„æ•°æ®ï¼Œå¯¼è‡´æ•°æ®åªèƒ½å†™å…¥ç£ç›˜ä¸­ï¼Œé™ä½äº†æ€§èƒ½ã€‚ä½†æ˜¯å¦‚æœSparkä½œä¸šä¸­çš„shuffleç±»æ“ä½œæ¯”è¾ƒå¤šï¼Œè€ŒæŒä¹…åŒ–æ“ä½œæ¯”è¾ƒå°‘ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°çš„å€¼é€‚å½“é™ä½ä¸€äº›æ¯”è¾ƒåˆé€‚ã€‚æ­¤å¤–ï¼Œå¦‚æœå‘ç°ä½œä¸šç”±äºé¢‘ç¹çš„gcå¯¼è‡´è¿è¡Œç¼“æ…¢ï¼ˆé€šè¿‡sparkwebuiå¯ä»¥è§‚å¯Ÿåˆ°ä½œä¸šçš„gcè€—æ—¶ï¼‰ï¼Œæ„å‘³ç€taskæ‰§è¡Œç”¨æˆ·ä»£ç çš„å†…å­˜ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆåŒæ ·å»ºè®®è°ƒä½è¿™ä¸ªå‚æ•°çš„å€¼ã€‚</li><li>spark.shuffle.memoryFractionå‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®shuffleè¿‡ç¨‹ä¸­ä¸€ä¸ªtaskæ‹‰å–åˆ°ä¸Šä¸ªstageçš„taskçš„è¾“å‡ºåï¼Œè¿›è¡Œèšåˆæ“ä½œæ—¶èƒ½å¤Ÿä½¿ç”¨çš„Executorå†…å­˜çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯0.2ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒExecutoré»˜è®¤åªæœ‰20%çš„å†…å­˜ç”¨æ¥è¿›è¡Œè¯¥æ“ä½œã€‚shuffleæ“ä½œåœ¨è¿›è¡Œèšåˆæ—¶ï¼Œå¦‚æœå‘ç°ä½¿ç”¨çš„å†…å­˜è¶…å‡ºäº†è¿™ä¸ª20%çš„é™åˆ¶ï¼Œé‚£ä¹ˆå¤šä½™çš„æ•°æ®å°±ä¼šæº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­å»ï¼Œæ­¤æ—¶å°±ä¼šæå¤§åœ°é™ä½æ€§èƒ½ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šå¦‚æœSparkä½œä¸šä¸­çš„RDDæŒä¹…åŒ–æ“ä½œè¾ƒå°‘ï¼Œshuffleæ“ä½œè¾ƒå¤šæ—¶ï¼Œå»ºè®®é™ä½æŒä¹…åŒ–æ“ä½œçš„å†…å­˜å æ¯”ï¼Œæé«˜shuffleæ“ä½œçš„å†…å­˜å æ¯”æ¯”ä¾‹ï¼Œé¿å…shuffleè¿‡ç¨‹ä¸­æ•°æ®è¿‡å¤šæ—¶å†…å­˜ä¸å¤Ÿç”¨ï¼Œå¿…é¡»æº¢å†™åˆ°ç£ç›˜ä¸Šï¼Œé™ä½äº†æ€§èƒ½ã€‚æ­¤å¤–ï¼Œå¦‚æœå‘ç°ä½œä¸šç”±äºé¢‘ç¹çš„gcå¯¼è‡´è¿è¡Œç¼“æ…¢ï¼Œæ„å‘³ç€taskæ‰§è¡Œç”¨æˆ·ä»£ç çš„å†…å­˜ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆåŒæ ·å»ºè®®è°ƒä½è¿™ä¸ªå‚æ•°çš„å€¼ã€‚èµ„æºå‚æ•°çš„è°ƒä¼˜ï¼Œæ²¡æœ‰ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œéœ€è¦åŒå­¦ä»¬æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µï¼ˆåŒ…æ‹¬Sparkä½œä¸šä¸­çš„shuffleæ“ä½œæ•°é‡ã€RDDæŒä¹…åŒ–æ“ä½œæ•°é‡ä»¥åŠsparkwebuiä¸­æ˜¾ç¤ºçš„ä½œä¸šgcæƒ…å†µï¼‰ï¼ŒåŒæ—¶å‚è€ƒæœ¬ç¯‡æ–‡ç« ä¸­ç»™å‡ºçš„åŸç†ä»¥åŠè°ƒä¼˜å»ºè®®ï¼Œåˆç†åœ°è®¾ç½®ä¸Šè¿°å‚æ•°ã€‚</li></ul><p>èµ„æºå‚æ•°å‚è€ƒç¤ºä¾‹ä»¥ä¸‹æ˜¯ä¸€ä»½spark-submitå‘½ä»¤çš„ç¤ºä¾‹ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè¿›è¡Œè°ƒèŠ‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/<span class="built_in">bin</span>/spark-submit \</span><br><span class="line">  --master yarn-cluster \</span><br><span class="line">  --num-executors <span class="number">100</span> \</span><br><span class="line">  --executor-memory 6G \</span><br><span class="line">  --executor-cores <span class="number">4</span> \</span><br><span class="line">  --driver-memory 1G \</span><br><span class="line">  --conf spark.default.parallelism=<span class="number">1000</span> \</span><br><span class="line">  --conf spark.storage.memoryFraction=<span class="number">0.5</span> \</span><br><span class="line">  --conf spark.shuffle.memoryFraction=<span class="number">0.3</span> \</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="spark-æœ¬åœ°æ‰§è¡Œ">spark æœ¬åœ°æ‰§è¡Œ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬æœº4ä¸ªCPUæ ¸å¿ƒä¸Šæ‰§è¡Œ</span></span><br><span class="line">./<span class="built_in">bin</span>/pyspark --master local[<span class="number">4</span>]</span><br><span class="line"><span class="comment"># æœ¬æœºæ‰€æœ‰CPUæ ¸å¿ƒä¸Šæ‰§è¡Œ</span></span><br><span class="line">./<span class="built_in">bin</span>/pyspark --master local[*]</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰çš„è¿è¡Œæ¨¡å¼</span></span><br><span class="line"> sc.master</span><br><span class="line"><span class="comment"># è¯»å–æœ¬åœ°æ–‡ä»¶ï¼ˆè·¯å¾„å‰ç”¨file:///)</span></span><br><span class="line">textFile=sc.textFile(<span class="string">&quot;file:///usr/local/spark/README.md&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="spark-tutorial"><ahref="https://www.tutorialspoint.com/pyspark/pyspark_sparkcontext.htm">sparktutorial</a></h1><p>spark-shellä¸ç”¨åˆ›å»ºsparkContextï¼Œé»˜è®¤å·²ç»å¯ç”¨äº†ä¸€ä¸ªï¼Œå¦‚æœå†æ¬¡ç”Ÿæˆä¼šæç¤ºï¼š"ValueError:Cannot run multiple SparkContexts at once".</p><h1id="sparksessionå’Œsparkcontextçš„å…³ç³»">SparkSessionå’ŒSparkContextçš„å…³ç³»</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â””â”€â”€ SparkSession</span><br><span class="line">    â””â”€â”€ SparkContext</span><br><span class="line">        â”œâ”€â”€ RDD1</span><br><span class="line">        â”œâ”€â”€ RDD2</span><br><span class="line">        â””â”€â”€ RDD3</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>SparkSessionæ˜¯Spark2.0å¼•å…¥çš„æ–°æ¦‚å¿µã€‚SparkSessionä¸ºç”¨æˆ·æä¾›äº†ç»Ÿä¸€çš„åˆ‡å…¥ç‚¹ï¼Œæ¥è®©ç”¨æˆ·å­¦ä¹ sparkçš„å„é¡¹åŠŸèƒ½ã€‚åœ¨sparkçš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼ŒSparkContextæ˜¯sparkçš„ä¸»è¦åˆ‡å…¥ç‚¹ï¼Œç”±äºRDDæ˜¯ä¸»è¦çš„APIï¼Œæˆ‘ä»¬é€šè¿‡SparkContextæ¥åˆ›å»ºå’Œæ“ä½œRDDã€‚å¯¹äºæ¯ä¸ªå…¶ä»–çš„APIï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸åŒçš„contextï¼š</p><ul><li>Streamingä½¿ç”¨StreamingContext</li><li>sqlä½¿ç”¨SqlContext</li><li>hiveä½¿ç”¨HiveContext</li></ul><p>ä½†æ˜¯éšç€DataSetå’ŒDataFrameçš„APIé€æ¸æˆä¸ºæ ‡å‡†çš„APIï¼Œå°±éœ€è¦ä¸ºä»–ä»¬å»ºç«‹æ¥å…¥ç‚¹ã€‚æ‰€ä»¥åœ¨spark2.0ä¸­ï¼Œå¼•å…¥SparkSessionä½œä¸ºDataSetå’ŒDataFrameAPIçš„åˆ‡å…¥ç‚¹ã€‚SparkSessionå°è£…äº†SparkContextå’ŒSQLContextã€‚ä¸ºäº†å‘åå…¼å®¹ï¼ŒSQLContextå’ŒHiveContextä¹Ÿè¢«ä¿å­˜ä¸‹æ¥ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼åˆå§‹åŒ–SparkContext;è€Œå°½é‡é€šè¿‡SparkSessionæ¥è®¿é—®å®ƒã€‚ <ahref="https://www.jianshu.com/p/4705988b0c84"class="uri">https://www.jianshu.com/p/4705988b0c84</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Creating a SparkSession in Python</span></span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line">spark = SparkSession.builder.master(<span class="string">&quot;local&quot;</span>).appName(<span class="string">&quot;Word Count&quot;</span>)\</span><br><span class="line">    .config(<span class="string">&quot;spark.some.config.option&quot;</span>, <span class="string">&quot;some-value&quot;</span>)\</span><br><span class="line">    .getOrCreate()</span><br><span class="line">    </span><br><span class="line"><span class="comment"># ä¸Šé¢çš„sparkæ—¶SparkSessionå¯¹è±¡ï¼Œä½¿ç”¨typeå¯ä»¥éªŒè¯</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(spark)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pyspark.sql.session.SparkSession</span><br></pre></td></tr></table></figure><h1 id="spark-cluster-components"><ahref="https://spark.apache.org/docs/latest/cluster-overview.html">SparkCluster Components</a></h1><figure><img src="https://spark.apache.org/docs/latest/img/cluster-overview.png"alt="spark cluster components" /><figcaption aria-hidden="true">spark cluster components</figcaption></figure><p>Spark applications run as independent sets of processes on a cluster,coordinated by the SparkContext object in your main program (called the<strong>driver program</strong>). &gt; driverprogramæ˜¯åè°ƒé›†ç¾¤è¿›ç¨‹çš„hubï¼Œæ‰€ä»¥å½“driverä¸åœ¨é›†ç¾¤é‡Œæ—¶ï¼ˆclientæ¨¡å¼ï¼‰ï¼Œç½‘ç»œå¸¦å®½å»¶è¿Ÿä¼šå¾ˆå½±å“é€šä¿¡ä¸çŠ¶æ€æ›´æ–°ã€‚</p><ol type="1"><li>Specifically, to run on a cluster, the SparkContext can<strong>connect</strong> to several types of <strong>clustermanagers</strong> (either Sparkâ€™s own standalone cluster manager, Mesosor YARN), which allocate resources across applications.</li><li>Once connected, Spark <strong>acquires executors</strong> on nodesin the cluster, which are <strong>processes</strong> that runcomputations and store data for your application.</li><li>Next, it <strong>sends your application code</strong> (defined byJAR or Python files passed to SparkContext) <strong>to theexecutors</strong>.</li><li>Finally, SparkContext <strong>sends tasks</strong> to the executorsto run.</li></ol><h1 id="spark-config">Spark Config</h1><h2 id="spark.sql.shuffle.partitions">spark.sql.shuffle.partitions</h2><p><ahref="http://blog.madhukaraphatak.com/dynamic-spark-shuffle-partitions/"class="uri">http://blog.madhukaraphatak.com/dynamic-spark-shuffle-partitions/</a></p><h1 id="spark-submit">Spark Submit</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/bin/spark-submit \</span><br><span class="line">--class &lt;main-class&gt; \  # ç¨‹åºå…¥å£ï¼Œå¦‚æœæ˜¯javaåˆ™æ˜¯ç±»ï¼Œjava</span><br><span class="line">--master &lt;master-url&gt; \</span><br><span class="line">--deploy-mode &lt;deploy-mode&gt; \ #åˆ†ä¸ºclusterå’Œclientä¸¤ç§</span><br><span class="line">--conf &lt;conf-param&gt; \  #ä¸€äº›é…ç½®å‚æ•°</span><br><span class="line">... # other options</span><br><span class="line">&lt;application-jar&gt; \  # å¯ä»¥æ˜¯jaræˆ–pythonæ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚æœæ˜¯urlåˆ™éœ€è¦æ‰€æœ‰nodeå¯è§</span><br><span class="line">[application-arguments] \ å‚æ•°</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šå½“æäº¤sparkä»»åŠ¡æ—¶ï¼Œå¦‚æœjaråŒ…æœ‰å¤šä¸ªï¼Œç”¨é€—å·éš”å¼€ï¼Œ<strong>é€—å·å‰åä¸èƒ½æœ‰ç©ºæ ¼!,æœ‰é€—å·ä¼šå¯¼è‡´åç»­å‚æ•°è§£æé”™è¯¯ï¼Œå¯èƒ½æäº¤çš„scalarç¨‹åºæç¤ºclassnotFound!</strong> å…·ä½“çš„ä¾‹å­å‚è§<ahref="https://spark.apache.org/docs/latest/submitting-applications.html#submitting-applications">ã€ŠSubmittingApplicationsã€‹</a></p><p>pythonçš„ä¾‹å­ï¼š å¯¹äº main.py ä¾èµ–çš„ util.py, module1.py,module2.pyï¼Œéœ€è¦å…ˆå‹ç¼©æˆä¸€ä¸ª .zip æ–‡ä»¶ï¼Œå†é€šè¿‡ spark-submit çš„--py--files é€‰é¡¹ä¸Šä¼ åˆ° yarnï¼Œmail.py æ‰èƒ½ import è¿™äº›å­æ¨¡å—ã€‚<ahref="https://www.jianshu.com/p/92be93cfbb97">å‘½ä»¤å¦‚ä¸‹</a>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">spark-submit</span> </span><br><span class="line">--master=yarn \</span><br><span class="line">--deploy-mode=cluster \</span><br><span class="line">--jars elasticsearch-hadoop-5.3.1.jar \</span><br><span class="line">--py-files deps.zip \</span><br><span class="line">main.py</span><br></pre></td></tr></table></figure><h2 id="deploy-mode">deploy-mode</h2><p>å…·ä½“å‚è€ƒ<ahref="https://blog.csdn.net/qq_39131779/article/details/83539608">ã€Šstandalonemodeã€‹</a>æ€»ç»“èµ·æ¥å°±ä¸€å¥è¯ï¼š<strong>culster/clientçš„ä¸»è¦åŒºåˆ«å°±æ˜¯driveræ˜¯å¦åœ¨clusteré‡Œ</strong></p><h3 id="cluster-é›†ç¾¤æ¨¡å¼">cluster é›†ç¾¤æ¨¡å¼</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/bin/spark-submit \</span><br><span class="line">--master  spark://node01:7077 \</span><br><span class="line">--class org.apache.spark.examples.SparkPi \</span><br><span class="line">../lib/spark-examples-1.6.0-hadoop2.6.0.jar </span><br><span class="line">100</span><br></pre></td></tr></table></figure><ol type="1"><li>clientæ¨¡å¼æäº¤ä»»åŠ¡åï¼Œä¼šåœ¨å®¢æˆ·ç«¯å¯åŠ¨Driverè¿›ç¨‹ã€‚</li><li>Driverä¼šå‘Masterç”³è¯·å¯åŠ¨Applicationå¯åŠ¨çš„èµ„æºã€‚</li><li>èµ„æºç”³è¯·æˆåŠŸï¼ŒDriverç«¯å°†taskå‘é€åˆ°workerç«¯æ‰§è¡Œã€‚</li><li>workerå°†taskæ‰§è¡Œç»“æœè¿”å›åˆ°Driverç«¯ã€‚(ç”±ä»£ç è®¾ç½®)</li></ol><p>æ€»ç»“ï¼šclientæ¨¡å¼é€‚ç”¨äºæµ‹è¯•è°ƒè¯•ç¨‹åºã€‚<strong>Driverè¿›ç¨‹æ˜¯åœ¨å®¢æˆ·ç«¯å¯åŠ¨çš„</strong>ï¼Œè¿™é‡Œçš„å®¢æˆ·ç«¯å°±æ˜¯æŒ‡æäº¤åº”ç”¨ç¨‹åºçš„å½“å‰èŠ‚ç‚¹ã€‚<strong>åœ¨Driverç«¯å¯ä»¥çœ‹åˆ°taskæ‰§è¡Œçš„æƒ…å†µã€‚ç”Ÿäº§ç¯å¢ƒä¸‹ä¸èƒ½ä½¿ç”¨clientæ¨¡å¼</strong>ï¼Œæ˜¯å› ä¸ºï¼šå‡è®¾è¦æäº¤100ä¸ªapplicationåˆ°é›†ç¾¤è¿è¡Œï¼ŒDriveræ¯æ¬¡éƒ½ä¼šåœ¨clientç«¯å¯åŠ¨ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯100æ¬¡ç½‘å¡æµé‡æš´å¢çš„é—®é¢˜ã€‚ï¼ˆå› ä¸ºè¦ç›‘æ§taskçš„è¿è¡Œæƒ…å†µï¼Œä¼šå ç”¨å¾ˆå¤šç«¯å£ï¼Œå¦‚ä¸Šå›¾çš„ç»“æœå›¾ï¼‰å®¢æˆ·ç«¯ç½‘å¡é€šä¿¡ï¼Œéƒ½è¢«taskç›‘æ§ä¿¡æ¯å ç”¨ã€‚é›†ç¾¤æ¨¡å¼å¦‚æœæ˜¯ç”¨æ¥æœ¬åœ°æ–‡ä»¶ï¼Œéœ€è¦æ·»åŠ --fileså‚æ•° ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ­¤å¤„ä»£ç ä½¿ç”¨äº†æœ¬åœ°æ–‡ä»¶<span class="string">&#x27;stat.conf&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¦‚æœç›´æ¥ä½¿ç”¨ deploy-mode=clusterä¼šæŠ¥é”™æ‰¾ä¸åˆ°stat.conf</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ‰€ä»¥éœ€è¦åœ¨submitæ—¶æ·»åŠ  <span class="string">&quot;--files <span class="variable">$con_file</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">start_day=<span class="string">&#x27;2020-10-01&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">end_day=<span class="string">&#x27;2020-10-02&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">conf_file=<span class="string">&#x27;./stat.conf&#x27;</span></span></span><br><span class="line"></span><br><span class="line">spark-submit --class com.jd.rec.FeatStat\</span><br><span class="line">   --num-executors 500 \</span><br><span class="line">   --executor-memory 45g \</span><br><span class="line">   --driver-memory 10g \</span><br><span class="line">   --executor-cores 6 \</span><br><span class="line">   --master yarn \</span><br><span class="line">   --deploy-mode cluster \</span><br><span class="line">   --conf spark.sql.catalogImplementation=hive \</span><br><span class="line">   --conf spark.sql.shuffle.partitions=10000 \</span><br><span class="line">   --conf spark.shuffle.consolidateFiles=true\</span><br><span class="line">   --jars protobuf-java-3.5.1.jar,proto-1.10.0.jar \</span><br><span class="line">   --conf spark.executor.userClassPathFirst=true \</span><br><span class="line">   --files $conf_file \ # æ³¨æ„æ­¤å¤„</span><br><span class="line">   tfrecord-hadoop-trans-11.0.0.jar $conffile $start_day $end_day</span><br></pre></td></tr></table></figure><h3 id="client">client</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/bin/spark-submit \</span><br><span class="line">--master spark://node01:7077 \</span><br><span class="line">--deploy-mode cluster \</span><br><span class="line">--class org.apache.spark.examples.SparkPi \</span><br><span class="line">../lib/spark-examples-1.6.0-hadoop2.6.0.jar  </span><br><span class="line">100</span><br></pre></td></tr></table></figure><ol type="1"><li>å®¢æˆ·ç«¯ä½¿ç”¨å‘½ä»¤spark-submit --deploy-mode clusteråä¼šå¯åŠ¨spark-submitè¿›ç¨‹</li><li>æ­¤è¿›ç¨‹ä¸ºDriverå‘Masterç”³è¯·èµ„æºï¼ŒDriverè¿›ç¨‹é»˜è®¤éœ€è¦1Gå†…å­˜å’Œ1Coreï¼Œ</li><li>Masterä¼š<strong>éšæœºé€‰æ‹©ä¸€å°</strong>workerèŠ‚ç‚¹æ¥å¯åŠ¨Driverè¿›ç¨‹ï¼ˆè¿™æ ·é€šä¿¡ä¼šè¾ƒè¿‘ï¼Œåˆ©äºä¿¡æ¯ã€çŠ¶æ€æ”¶é›†ï¼‰</li><li><strong>Driverå¯åŠ¨æˆåŠŸåï¼Œspark-submitå…³é—­</strong>ï¼Œç„¶åDriverå‘Masterç”³è¯·èµ„æº</li><li>Masteræ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šåœ¨èµ„æºå……è¶³çš„workerèŠ‚ç‚¹ä¸Šå¯åŠ¨Executorè¿›ç¨‹</li><li>Driveråˆ†å‘Taskåˆ°Executorä¸­æ‰§è¡Œ</li></ol><p>æ€»ç»“ï¼šè¿™ç§æ¨¡å¼ä¼šå°†å•èŠ‚ç‚¹çš„ç½‘å¡æµé‡æ¿€å¢é—®é¢˜åˆ†æ•£åˆ°é›†ç¾¤ä¸­ã€‚åœ¨å®¢æˆ·ç«¯çœ‹ä¸åˆ°taskæ‰§è¡Œæƒ…å†µå’Œç»“æœï¼Œè¦å»<strong>webui</strong>ä¸­çœ‹ã€‚clusteræ¨¡å¼é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼ŒMasteræ¨¡å¼å…ˆå¯åŠ¨Driverï¼Œå†å¯åŠ¨Application</p><p><strong>spark shellæ¨¡å¼æ˜¯ä»¥clientæäº¤çš„</strong>(ç¬¬ä¸€ç§)ï¼Œæ‰€ä»¥ä¸èƒ½åŠ å…¥--deploy-modeclusterçš„(ç¬¬äºŒç§)<strong>clientæ–¹å¼ç”¨äºæµ‹è¯•ç¯å¢ƒï¼Œç”¨äºæ–¹ä¾¿æŸ¥çœ‹ç»“æœ</strong>ï¼Œå› ä¸º sparkshell æ¨¡å¼ä»¥clientæ–¹å¼æäº¤ï¼Œæ‰€ä»¥ spark shell æ¨¡å¼ä¸æ”¯æŒ--deploy-modeclusteræ</p><h1 id="rdd-and-dataframe">RDD and DataFrame</h1><h2 id="transformå‡½æ•°">Transformå‡½æ•°</h2><h3 id="flatmap">flatMap</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df = spark.sql(&quot;select id_feat from table where dt = &#x27;2020-10-01&#x27;&quot;)</span><br><span class="line">df_split = split(df[&#x27;id_feat&#x27;], &#x27;\t&#x27;)</span><br><span class="line">attrs = [&#x27;item_c3&#x27;,&#x27;item_br&#x27;,&#x27;item_c2&#x27;,&#x27;item_sh&#x27;,&#x27;item_pw&#x27;,&#x27;item_sku&#x27;]</span><br><span class="line">#print(&quot;åˆ—åï¼š&quot;, attrs)</span><br><span class="line">for index, value in enumerate(attrs):</span><br><span class="line">    df = df.withColumn(value, df_split.getItem(index))</span><br><span class="line">rdd = df.rdd.flatMap(lambda x: fun(x)).reduceByKey(lambda x, y: x+y)</span><br><span class="line">rdd = rdd.map(lambda x: &quot;&#123;0&#125;,&#123;1&#125;,&#123;2&#125;&quot;.format(x[0][0], x[0][1], x[1]))</span><br></pre></td></tr></table></figure><h2 id="dataframe-é€ŸæŸ¥è¡¨">DataFrame é€ŸæŸ¥è¡¨</h2><p><ahref="https://sparkbyexamples.com/pyspark/pyspark-structtype-and-structfield/"class="uri">https://sparkbyexamples.com/pyspark/pyspark-structtype-and-structfield/</a><a href="https://www.cnblogs.com/liaowuhen1314/p/12792202.html"class="uri">https://www.cnblogs.com/liaowuhen1314/p/12792202.html</a></p><h2 id="dataframe-split-åˆ—ç”Ÿæˆæ–°column">DataFrame Splitåˆ—ç”Ÿæˆæ–°column</h2><p><ahref="https://sparkbyexamples.com/spark/spark-split-dataframe-column-into-multiple-columns/"class="uri">https://sparkbyexamples.com/spark/spark-split-dataframe-column-into-multiple-columns/</a></p><p>[split æ•™ç¨‹][2]</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df = spark.sql(&quot;select * from xxx where dt = &#x27;2020-10-20&#x27;&quot;)</span><br><span class="line">df[]</span><br><span class="line">df_split = split(df[&#x27;id_feat&#x27;], &#x27;\t&#x27;)</span><br><span class="line">attrs = [&#x27;item_c3&#x27;,&#x27;item_br&#x27;,&#x27;item_c2&#x27;]</span><br><span class="line">for index, value in enumerate(attrs):</span><br><span class="line">    df = df.withColumn(value, df_split.getItem(index))</span><br><span class="line">print(df.select(&#x27;item_br&#x27;).take(3))</span><br></pre></td></tr></table></figure><h2 id="dataframe-ç­›é€‰">DataFrame ç­›é€‰</h2><p><ahref="https://blog.csdn.net/sinat_26917383/article/details/80500349"class="uri">https://blog.csdn.net/sinat_26917383/article/details/80500349</a></p><h3 id="join">join</h3><p>ä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a_rdd = sc.parallelize([(&#x27;a&#x27;, 13132), (&#x27;b&#x27;, 121212),(&#x27;c&#x27;,56577)])</span><br><span class="line">b_rdd = sc.parallelize([(&#x27;a&#x27;, 23232), (&#x27;b&#x27;,333333)])</span><br><span class="line">columns = [&#x27;sku&#x27;, &#x27;feat&#x27;]</span><br><span class="line">df_a = a_rdd.toDF(columns)</span><br><span class="line">df_b = b_rdd.toDF(columns)</span><br><span class="line"></span><br><span class="line">df_a.join(df_b, df_a.sku==df_b.sku, &#x27;left&#x27;).where(df_b.sku.isNull()).select(df_a.sku, df_b.feat).show()</span><br></pre></td></tr></table></figure><h3 id="where">Where</h3><p><ahref="https://stackoverflow.com/questions/35870760/filtering-a-pyspark-dataframe-with-sql-like-in-clause"class="uri">https://stackoverflow.com/questions/35870760/filtering-a-pyspark-dataframe-with-sql-like-in-clause</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">df = sc.parallelize([(1, &quot;foo&quot;), (2, &quot;x&quot;), (3, &quot;bar&quot;)]).toDF((&quot;k&quot;, &quot;v&quot;))</span><br><span class="line">df.registerTempTable(&quot;df&quot;)</span><br><span class="line">sqlContext.sql(&quot;SELECT * FROM df WHERE v IN &#123;0&#125;&quot;.format((&quot;foo&quot;, &quot;bar&quot;))).count()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from pyspark.sql.functions import col</span><br><span class="line">df.where(col(&quot;v&quot;).isin(&#123;&quot;foo&quot;, &quot;bar&quot;&#125;)).count()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from pyspark.sql.functions import col</span><br><span class="line">df.where(col(&quot;v&quot;).isin([&quot;foo&quot;, &quot;bar&quot;])).count()</span><br><span class="line"></span><br><span class="line"># example-2</span><br><span class="line">df = df.where((df[&#x27;dt&#x27;] &gt;= &#x27;2020-09-14&#x27;) &amp; (df[&#x27;dt&#x27;] &lt;= &#x27;2020-10-05&#x27;)).groupby(&#x27;dt&#x27;).count()</span><br></pre></td></tr></table></figure><h2 id="dataframe-ç»Ÿè®¡">DataFrame ç»Ÿè®¡</h2><h3 id="groupby">GroupBy</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = df.where((df[&#x27;dt&#x27;] &gt;= &#x27;2020-09-14&#x27;) &amp; (df[&#x27;dt&#x27;] &lt;= &#x27;2020-10-05&#x27;)).groupby(&#x27;dt&#x27;).count()</span><br></pre></td></tr></table></figure><h2 id="dataframe-è½¬-rdd">DataFrame è½¬ rdd</h2><p><ahref="https://blog.csdn.net/helloxiaozhe/article/details/89414735">å‚è€ƒèµ„æ–™</a>DataFrameçš„è¡¨ç›¸å…³æ“ä½œä¸èƒ½å¤„ç†ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚éœ€è¦å¯¹ä¸€äº›æ•°æ®åˆ©ç”¨æŒ‡å®šçš„å‡½æ•°è¿›è¡Œè®¡ç®—æ—¶ï¼Œå°±éœ€è¦å°†DataFrameè½¬æ¢ä¸ºRDDã€‚DataFrameå¯ä»¥ç›´æ¥åˆ©ç”¨df.rddè·å–å¯¹åº”çš„RDDå¯¹è±¡ï¼Œæ­¤RDDå¯¹è±¡çš„æ¯ä¸ªå…ƒç´ ä½¿ç”¨Rowå¯¹è±¡æ¥è¡¨ç¤ºï¼Œ<strong>æ¯åˆ—å€¼ä¼šæˆä¸ºRowå¯¹è±¡çš„ä¸€ä¸ªåŸŸ=&gt;å€¼æ˜ å°„</strong>ã€‚ä¾‹å¦‚:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; lists = [[&#x27;a&#x27;, 1], [&#x27;b&#x27;, 2]]</span><br><span class="line">&gt;&gt;&gt; list_dataframe = sqlContext.createDataFrame(lists,[&#x27;col1&#x27;,&#x27;col2&#x27;])</span><br><span class="line">&gt;&gt;&gt; list_dataframe.show()</span><br><span class="line">+----+----+                                                                     </span><br><span class="line">|col1|col2|</span><br><span class="line">+----+----+</span><br><span class="line">|   a|   1|</span><br><span class="line">|   b|   2|</span><br><span class="line">+----+----+</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; rdd=list_dataframe.rdd</span><br><span class="line">&gt;&gt;&gt; rdd.collect()</span><br><span class="line">[Row(col1=u&#x27;a&#x27;, col2=1), Row(col1=u&#x27;b&#x27;, col2=2)] </span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; rdd.map(lambda x: [x[0], x[1:]]).collect()</span><br><span class="line">[[u&#x27;a&#x27;, (1,)], [u&#x27;b&#x27;, (2,)]]</span><br><span class="line">&gt;&gt;&gt; rdd.map(lambda x: [x[0], x[1]]).collect()</span><br><span class="line">[[u&#x27;a&#x27;, 1], [u&#x27;b&#x27;, 2]]</span><br></pre></td></tr></table></figure><h2 id="dataframeå†™hiveè¡¨">DataFrameå†™Hiveè¡¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. å¤„ç†æ•°æ®</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;/user/recsys/recpro/xxx.csv&#x27;</span>)</span><br><span class="line">df = spark.sql(<span class="string">&quot;select * from tmpr.live_person_attributes_yuanwenwu3&quot;</span>)</span><br><span class="line"><span class="comment"># 3. å†™hiveè¡¨</span></span><br><span class="line">sc = spark.sparkContext</span><br><span class="line">hiveContext = HiveContext(sc)</span><br><span class="line">data_to_hive_df = hiveContext.createDataFrame(df)</span><br><span class="line">data_to_hive_df.partitionBy(<span class="string">&#x27;dt&#x27;</span>).write.<span class="built_in">format</span>(<span class="string">&quot;parquet&quot;</span>).mode(<span class="string">&quot;overwrite&quot;</span>).saveAsTable(<span class="string">&quot;tmpr.output_table&quot;</span>) </span><br></pre></td></tr></table></figure><h2 id="rdd-è½¬-dataframe">rdd è½¬ dataframe</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = sqlContext.createDataFrame(data, schema=None, samplingRatio=None, verifySchema=True)</span><br></pre></td></tr></table></figure><p>schemaï¼šDataFrameå„åˆ—ç±»å‹ä¿¡æ¯ï¼Œåœ¨æå‰çŸ¥é“RDDæ‰€æœ‰ç±»å‹ä¿¡æ¯æ—¶è®¾å®šã€‚ä¾‹å¦‚:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schema = StructType([StructField(&#x27;col1&#x27;, StringType()), StructField(&#x27;col2&#x27;, IntegerType())])</span><br></pre></td></tr></table></figure><h2 id="è¯»å†™æ–‡ä»¶">è¯»å†™æ–‡ä»¶</h2><p><a href="https://zhuanlan.zhihu.com/p/105893298">å‚è€ƒèµ„æ–™1</a> <ahref="https://www.jianshu.com/p/d1f6678db183">å‚è€ƒèµ„æ–™2</a></p><h3 id="è¯»æ–‡ä»¶">è¯»æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = spark.read.csv(filepath, sep=&#x27;,&#x27;, header=True, inferSchema=True)</span><br></pre></td></tr></table></figure><h3 id="rddå†™æ–‡ä»¶">rddå†™æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">## å•ç‹¬ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">data.repartition(1).write.csv(writepath,mode=&quot;overwrite&quot;)</span><br><span class="line">data.coalesce(1).write.csv(writepath,mode=&quot;overwrite&quot;)</span><br><span class="line">## å†™æˆç‰¹æ®Šæ ¼å¼ï¼Œå»æ‰æ‹¬å·</span><br><span class="line">data.map(lambda (k,v): &quot;&#123;0&#125; &#123;1&#125;&quot;.format(k,v)).coalesce(1).write.csv(writepath,mode=&quot;overwrite&quot;)</span><br><span class="line">## åˆ†å—å„¿æ–‡ä»¶</span><br><span class="line">data.repartition(1000).write.csv(writepath,mode=&quot;overwrite&quot;)</span><br><span class="line">data.coalesce(1000).write.csv(writepath,mode=&quot;overwrite&quot;)</span><br></pre></td></tr></table></figure><p>é€šå¸¸rddç›´æ¥writeåˆ°æ–‡ä»¶ï¼Œå†…å®¹ä¼šæ˜¯å¦‚ä¸‹å½¢å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;cat rdd_res.txt</span><br><span class="line">â€¦â€¦</span><br><span class="line">(k1,v1)</span><br><span class="line">(k2,v2)</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><p>rddæƒ³<strong>æ²¡æœ‰æ‹¬å·</strong>è¾“å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data.map(lambda (k,v): &quot;&#123;0&#125; &#123;1&#125;&quot;.format(k,v)).coalesce(1).write.csv(&#x27;path&#x27;)</span><br><span class="line">#æˆ–è€…è½¬æˆDataFrameåœ¨å†™</span><br><span class="line">rdd.toDF().write.csv(&quot;path&quot;)</span><br></pre></td></tr></table></figure><h3 id="dataframeå†™æ–‡ä»¶">DataFrameå†™æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># dataframe å†™csvæ–‡ä»¶</span><br><span class="line">df.write.format(&quot;csv&quot;).option(&quot;header&quot;, &quot;false&quot;).mode(&quot;overwrite&quot;).save(&quot;hdfs://user/xxx/data.csv&quot;)</span><br><span class="line">hadoop fs -getmerge &quot;hdfs://user/xxx/data.csv&quot; &quot;./data.csv&quot;</span><br></pre></td></tr></table></figure><p><strong>option</strong> æ”¯æŒå‚æ•° path: csvæ–‡ä»¶çš„è·¯å¾„ã€‚æ”¯æŒé€šé…ç¬¦;header: csvæ–‡ä»¶çš„headerã€‚é»˜è®¤å€¼æ˜¯false; delimiter: åˆ†éš”ç¬¦ã€‚é»˜è®¤å€¼æ˜¯',';quote: å¼•å·ã€‚é»˜è®¤å€¼æ˜¯""; mode: è§£æçš„æ¨¡å¼ã€‚æ”¯æŒçš„é€‰é¡¹æœ‰ï¼š</p><h2 id="dataframe-æ·»åŠ ä¸€åˆ—">dataframe æ·»åŠ ä¸€åˆ—</h2><p>å¦‚æœæ•°æ®å¾ˆå¤šï¼Œæƒ³åˆ†å—å¤„ç†ï¼Œä»¥æ‰“åˆ°å¦‚ä¸‹ç›®çš„ï¼š</p><h3 id="æ·»åŠ -id-é€‰æ‹©åŒºé—´">æ·»åŠ  id é€‰æ‹©åŒºé—´</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sku_img_df = spark.sql(sql)</span><br><span class="line">def flat(l):</span><br><span class="line">    sku_img = l[0]</span><br><span class="line">    index = l[1]</span><br><span class="line">    return (sku_img[0], sku_img[1], index)</span><br><span class="line">## æ·»åŠ  &#x27;id&#x27; ç”Ÿæˆæ–°çš„dataframe</span><br><span class="line">rdd = sku_img_df.rdd.zipWithIndex()</span><br><span class="line">schema = sku_img_df.schema.add(StructField(&quot;id&quot;, LongType()))</span><br><span class="line">rdd = rdd.map(lambda x: flat(x))</span><br><span class="line">sku_img_df = spark.createDataFrame(rdd, schema)</span><br><span class="line">## åˆ†åŒºé—´å¤„ç†dataframeä¸­çš„è¡Œ</span><br><span class="line">batch_size = 30000000</span><br><span class="line">start_index = 0</span><br><span class="line">while start_index &lt; total_count:</span><br><span class="line">    if start_index + batch_size &lt; total_count:</span><br><span class="line">        batch_data_num = batch_size</span><br><span class="line">    else:</span><br><span class="line">        batch_data_num = total_count - start_index</span><br><span class="line">    extract_batch(sku_img_df, start_index, batch_data_num)</span><br><span class="line">    start_index = start_index + batch_size</span><br></pre></td></tr></table></figure><h2 id="è¯»å–txtæ–‡ä»¶">è¯»å–TXTæ–‡ä»¶</h2><ul><li>spark.sparkContext.textFile(file_path)è¯»å–åˆ°çš„æ˜¯<strong>RDD</strong>(pyspark.rdd.RDD)ï¼Œæ¯ä¸€ä¸ªå…ƒç´ ç›´æ¥æ˜¯å­—ç¬¦ä¸²</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; rdd = spark.sparkContext.textFile(file_path)</span><br><span class="line">&gt;&gt; rdd.take(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">[<span class="string">u&#x27;first line&#x27;</span>,</span><br><span class="line"> <span class="string">u&#x27;second line&#x27;</span>,</span><br><span class="line"> <span class="string">u&#x27;third line&#x27;</span>]</span><br></pre></td></tr></table></figure><ul><li>spark.read.text(file_path) è¯»å–åˆ°çš„æ˜¯<strong>DataFrame</strong>(pyspark.sql.dataframe.DataFrame)ï¼Œæ¯ä¸€ä¸ªå…ƒç´ æ˜¯ Row(pyspark.sql.types.Row)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; df = spark.read.text(file_path)</span><br><span class="line">&gt;&gt; rdd = df.rdd</span><br><span class="line">&gt;&gt; rdd.take(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">[Row(value=<span class="string">u&#x27;first line&#x27;</span>),</span><br><span class="line"> Row(value=<span class="string">u&#x27;second line&#x27;</span>),</span><br><span class="line"> Row(value=<span class="string">u&#x27;third line&#x27;</span>)]</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™é‡Œå¦‚æœç›´æ¥rdd.map(lambda line: line.split(" "))ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ“ä½œçš„å…ƒç´ æ˜¯Rowï¼ŒRowå¯¹è±¡æ²¡æœ‰splitæ–¹æ³•ã€‚</p><h2 id="dataframe-å†™å…¥hiveè¡¨">DataFrame å†™å…¥hiveè¡¨</h2><h3 id="ä¸€èˆ¬æ­¥éª¤">ä¸€èˆ¬æ­¥éª¤</h3><p>å‚è€ƒï¼š<ahref="https://blog.csdn.net/a2639491403/article/details/80044121"class="uri">https://blog.csdn.net/a2639491403/article/details/80044121</a></p><h4 id="åˆ›å»ºæ•°æ®é›†çš„spark-dattaframe">1.åˆ›å»ºæ•°æ®é›†çš„sparkDattaFrame</h4><p><code>df_tmp = spark.createDataFrame(RDD,schema)</code>è¿™é‡Œschemaæ˜¯ç”±StructFiedå‡½æ•°å®šä¹‰çš„</p><h4id="å°†æ•°æ®é›†çš„dataframesæ ¼å¼æ˜ å°„åˆ°é›¶æ—¶è¡¨">2.å°†æ•°æ®é›†çš„DataFramesæ ¼å¼æ˜ å°„åˆ°é›¶æ—¶è¡¨</h4><p><code>df_tmp.createOrReplaceTempView('tempTable')</code></p><h4 id="ç”¨spark-sqlè¯­å¥å°†é›¶æ—¶è¡¨çš„æ•°æ®å¯¼å…¥hiveçš„tmp_tableè¡¨ä¸­">3.ç”¨sparksqlè¯­å¥å°†é›¶æ—¶è¡¨çš„æ•°æ®å¯¼å…¥hiveçš„tmp_tableè¡¨ä¸­</h4><p><code>sqlContext.sql('insert overwrite table des_table select *from tempTable')</code></p><h3 id="å†™å…¥åˆ†åŒºè¡¨">å†™å…¥åˆ†åŒºè¡¨</h3><p>å‚è€ƒï¼š<ahref="https://xinancsd.github.io/Python/pyspark_save_hive_table.html"class="uri">https://xinancsd.github.io/Python/pyspark_save_hive_table.html</a></p><h4 id="df.write.saveastable-æ–¹æ³•">df.write.saveAsTable() æ–¹æ³•</h4><p>éœ€è¦æ³¨æ„çš„æ˜¯hiveè¡¨å<strong>æ˜¯ä¸æ˜æ„Ÿå¤§å°å†™</strong>çš„ï¼Œç»å†è¿‡å¦‚ä¸‹ç°è±¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df = spark.sql(<span class="string">&quot;select tmpr.abc&quot;</span>)</span><br><span class="line">df.write.option(<span class="string">&quot;delimiter&quot;</span>, <span class="string">&#x27;\t&#x27;</span>).saveAsTable(<span class="string">&#x27;tmpr.ABC&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;hive&#x27;</span>, mode=<span class="string">&#x27;append&#x27;</span>, partitionBy=<span class="string">&#x27;dt&#x27;</span>)</span><br><span class="line">ä¼šå†™åˆ°åŸåœ°å€ï¼Œå› ä¸ºå¦‚æœåŸåœ°å€æ˜¯ï¼šhdfs://xxxx/tmpr.db/abcï¼Œåœ¨ä½¿ç”¨æ–°è¡¨tmpr.ABCæ—¶ä¼šä»æ–°åˆ›å»ºåœ°å€ï¼Œæ°å¥½æ˜¯è¿™ä¸€åœ°å€ï¼Œæ‰€ä»¥æ•°æ®åˆå†™å›åŸåœ°å€äº†</span><br><span class="line"></span><br><span class="line">`mode=â€™overwriteâ€™ `æ¨¡å¼æ—¶ï¼Œä¼šåˆ›å»ºæ–°çš„è¡¨ï¼Œè‹¥è¡¨åå·²å­˜åœ¨åˆ™ä¼šè¢«åˆ é™¤ï¼Œæ•´ä¸ªè¡¨è¢«é‡å†™ã€‚è€Œ `mode=â€™appendâ€™` æ¨¡å¼ä¼šåœ¨ç›´æ¥åœ¨åŸæœ‰æ•°æ®å¢åŠ æ–°æ•°æ®ï¼Œè¿™ä¸€æ¨¡å¼å¯ä»¥å†™å…¥å·²å­˜åœ¨çš„è¡¨ã€‚</span><br><span class="line">å½“ä½¿ç”¨overwriteæ—¶ï¼ŒsaveAsTable ä¼šè‡ªåŠ¨åˆ›å»ºhiveè¡¨ï¼ŒpartitionByæŒ‡å®šåˆ†åŒºå­—æ®µï¼Œé»˜è®¤å­˜å‚¨ä¸º parquet æ–‡ä»¶æ ¼å¼ã€‚å¯¹äºä»æ–‡ä»¶ç”Ÿæˆçš„DataFrameï¼Œå­—æ®µç±»å‹ä¹Ÿæ˜¯è‡ªåŠ¨è½¬æ¢çš„ï¼Œæœ‰æ—¶ä¼šè½¬æ¢æˆä¸ç¬¦åˆè¦æ±‚çš„ç±»å‹</span><br><span class="line"><span class="comment">##### format:</span></span><br></pre></td></tr></table></figure><p>hive ï¼ˆhiveé»˜è®¤æ ¼å¼ï¼Œæ•°æ®æ–‡ä»¶çº¯æ–‡æœ¬æ— å‹ç¼©å­˜å‚¨ï¼‰ parquetï¼ˆsparké»˜è®¤é‡‡ç”¨æ ¼å¼ï¼‰ orc json csvtextï¼ˆè‹¥ç”¨saveAsTableåªèƒ½ä¿å­˜åªæœ‰ä¸€ä¸ªåˆ—çš„dfï¼‰ jdbc libsvm</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.write.saveAsTable(save_table, mode=<span class="string">&#x27;append&#x27;</span>, partitionBy=[<span class="string">&#x27;pt_day&#x27;</span>])</span><br><span class="line">éœ€è¦è‡ªå®šä¹‰å­—æ®µç±»å‹çš„ï¼Œå¯ä»¥åœ¨åˆ›å»ºDataFrameæ—¶æŒ‡å®šç±»å‹ï¼š</span><br></pre></td></tr></table></figure><p>from pyspark.sql.types import StringType, StructType, BooleanType,StructField</p><p>schema = StructType([ StructField("vin", StringType(), True),StructField("cust_id", StringType(), True), StructField("is_maintain",BooleanType(), True), StructField("is_wash", BooleanType(), True),StructField("pt_day", StringType(), True), ] )</p><p>data = pd.read_csv('/path/to/data.csv', header=0) df =spark.createDataFrame(data, schema=schema)</p><h1id="å†™å…¥hiveè¡¨æ—¶å°±æ˜¯æŒ‡å®šçš„æ•°æ®ç±»å‹äº†">å†™å…¥hiveè¡¨æ—¶å°±æ˜¯æŒ‡å®šçš„æ•°æ®ç±»å‹äº†</h1><p>df.write.saveAsTable(save_table, mode='append',partitionBy=['pt_day']</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### option(&quot;delimiter&quot;, &#x27;\t&#x27;)</span></span><br><span class="line">å†™å…¥hiveè¡¨éœ€è¦æŒ‡å®šåˆ†å‰²ç¬¦æ—¶å¯ä½¿ç”¨å¦‚ä¸Šæ–¹å¼</span><br><span class="line"></span><br><span class="line"><span class="comment">#### df.partitionBy(&#x27;dt&#x27;)å’Œdf.saveAsTable(partitionBy=[&#x27;dt&#x27;])çš„åŒºåˆ«</span></span><br><span class="line">https://blog.csdn.net/qq_33536353/article/details/<span class="number">106165924</span></span><br><span class="line">å¯¹äºä¸¤ç§å†™å›åˆ†åŒºè¡¨çš„æ–¹æ³•ï¼š</span><br><span class="line">ç¬¬ä¸€ç§ï¼šè¿™ç§ä¼šæ¸…ç†hdfsè·¯å¾„ï¼Œç”Ÿæˆæ–°çš„dtï¼Œ**ä»¥ä¸ºç€é‡åæ—§åˆ†åŒºä¼šè¢«åˆ é™¤ï¼Œåˆ‡è®°**</span><br></pre></td></tr></table></figure><p>df.write.mode("overwrite").format("orc").partitionBy("dt").saveAsTable("aicloud.cust_features")</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬äºŒç§ï¼šè¿™ç§åªä¼šé‡å†™è¦†ç›–çš„åˆ†åŒºï¼Œå…¶ä»–æ—§åˆ†åŒºä¸ä¼šè¢«åˆ é™¤</span><br><span class="line"></span><br><span class="line">df.write.saveAsTable(<span class="string">&quot;aicloud.cust_features&quot;</span>, <span class="built_in">format</span>=<span class="string">&quot;orc&quot;</span>, mode=<span class="string">&quot;overwrite&quot;</span>, partitionBy=<span class="string">&quot;dt&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="scala">Scala</h2><h3 id="scalaåŒ¿åå‡½æ•°ä¸å¯ç”¨return">ScalaåŒ¿åå‡½æ•°ä¸å¯ç”¨return</h3><p>Scala - return in anonymous function <ahref="https://www.jianshu.com/p/2053634328d3"class="uri">https://www.jianshu.com/p/2053634328d3</a></p><p>[2]: <ahref="https://sparkbyexamples.com/pyspark/pyspark-split-dataframe-column-into-multiple-columns/"class="uri">https://sparkbyexamples.com/pyspark/pyspark-split-dataframe-column-into-multiple-columns/</a>2019-12-25 14:26:31 vin Javascript &amp; JQuery # Javascript &amp;JQuery</p><p>æ ‡ç­¾ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰ï¼š javascript</p><hr /><h2 id="jqueryé€‰æ‹©å™¨">JQueryé€‰æ‹©å™¨</h2><p><a href="https://blog.csdn.net/qq_38225558/article/details/83780618"class="uri">https://blog.csdn.net/qq_38225558/article/details/83780618</a></p><h2 id="chrome-è„šæœ¬ç¼–è¾‘å™¨">chrome è„šæœ¬ç¼–è¾‘å™¨</h2><p><a href="https://www.jianshu.com/p/87adbf88e2e3"class="uri">https://www.jianshu.com/p/87adbf88e2e3</a> <ahref="https://www.cnblogs.com/liun1994/p/7265828.html"class="uri">https://www.cnblogs.com/liun1994/p/7265828.html</a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;pyspark-api&quot;&gt;pyspark API&lt;/h2&gt;
&lt;p&gt;&lt;a
href=&quot;https://spark.apache.org/docs/2.2.1/api/python/search.html?q=dataframe.write&quot;
class=&quot;uri&quot;&gt;https://spark.apache.org/docs/2.2.1/api/python/search.html?q=dataframe.write&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;ç®€æ˜æ•™ç¨‹&quot;&gt;ç®€æ˜æ•™ç¨‹&lt;/h2&gt;
&lt;p&gt;&lt;a
href=&quot;https://sparkbyexamples.com/pyspark/pyspark-orderby-and-sort-explained/&quot;
class=&quot;uri&quot;&gt;https://sparkbyexamples.com/pyspark/pyspark-orderby-and-sort-explained/&lt;/a&gt;
&lt;a href=&quot;http://www.learnbymarketing.com/1100/pyspark-joins-by-example/&quot;
class=&quot;uri&quot;&gt;http://www.learnbymarketing.com/1100/pyspark-joins-by-example/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>conda</title>
    <link href="http://yoursite.com/2024/02/29/conda/"/>
    <id>http://yoursite.com/2024/02/29/conda/</id>
    <published>2024-02-29T11:12:02.000Z</published>
    <updated>2025-05-22T05:50:40.064Z</updated>
    
    <content type="html"><![CDATA[<p>conda æ˜¯ Anaconda çš„å·¥å…·ç®±ï¼Œå®ƒæ˜¯ pip å’Œ vitualenvçš„ç»„åˆï¼Œä¹Ÿå°±æ˜¯è¯´ä»–å¯ä»¥åƒpipæ¥ç®¡ç†åŒ…ï¼Œä¹Ÿå¯ä»¥åƒvitualenvæ¥åˆ‡æ¢ç¯å¢ƒ</p><h4 id="installation">installation</h4><p><ahref="https://www.digitalocean.com/community/tutorials/how-to-install-anaconda-on-ubuntu-18-04-quickstart"class="uri">https://www.digitalocean.com/community/tutorials/how-to-install-anaconda-on-ubuntu-18-04-quickstart</a></p><h4 id="åœ¨condaä¸­ä½¿ç”¨pip">åœ¨condaä¸­ä½¿ç”¨pip</h4><p>æ³¨æ„ï¼šå½“åœ¨condaçš„è™šæ‹Ÿç¯å¢ƒä¸­ä½¿ç”¨Pipå®‰è£…åŒ…æ—¶ï¼Œéœ€è¦ä½¿ç”¨<code>pip -V</code>æŸ¥çœ‹Pipæ‰€ä½¿ç”¨çš„è·¯å¾„ï¼Œå¦‚æœcondaæ²¡æœ‰å®‰è£…Pipï¼Œä¼šä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„pipå‘½ä»¤ï¼Œè¿™ç§ç»“æœä½¿å¾—pipå®‰è£…çš„åŒ…è¢«å®‰è£…åˆ°äº†ç³»ç»Ÿåº“ä½ç½®ï¼Œä»è€Œåœ¨å½“å‰è™šæ‹Ÿç¯å¢ƒä¸­çš„pythonä¸‹æ— æ³•ä½¿ç”¨æˆ–æ‰¾ä¸åˆ°ã€‚ä¸€èˆ¬condaçš„è™šæ‹Ÿç¯å¢ƒä¸­è‡ªå¸¦pipï¼Œå¦‚æœä½ æ˜¯ç”¨pip3å®‰è£…ï¼Œå¯èƒ½ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿçš„pipï¼Œè¿™ä¸€ç‚¹è¦æ³¨æ„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(face_detector) âœ  ~ pip -V</span><br><span class="line">pip 9.0.1 from /opt/anaconda3/envs/face_detector/lib/python3.5/site-packages (python 3.5)</span><br><span class="line">(face_detector) âœ  ~ pip3 -V</span><br><span class="line">pip 20.0.2 from /usr/local/lib/python3.7/site-packages/pip (python 3.7)</span><br></pre></td></tr></table></figure><p>çš„å¼€å‘ç¯å¢ƒä¼šè¢«é»˜è®¤å®‰è£…åœ¨ä½ condaç›®å½•ä¸‹çš„envsæ–‡ä»¶ç›®å½•ä¸‹ã€‚å¯ä»¥æŒ‡å®šä¸€ä¸ªå…¶ä»–çš„è·¯å¾„ï¼›å»é€šè¿‡conda create -häº†è§£æ›´æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šå®‰è£…pythonçš„ç‰ˆæœ¬ï¼Œcondaä¼šå®‰è£…æˆ‘ä»¬æœ€åˆå®‰è£…condaæ—¶æ‰€è£…çš„é‚£ä¸ªç‰ˆæœ¬çš„pythonã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—ä¸¾å½“å‰æ‰€æœ‰ç¯å¢ƒ</span></span><br><span class="line">conda info</span><br><span class="line">conda env <span class="built_in">list</span></span><br><span class="line"><span class="comment"># åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">conda create --name new_env_name python=<span class="number">2.7</span><span class="number">.9</span></span><br><span class="line">conda create -n new_env_name python=<span class="number">2.7</span><span class="number">.9</span></span><br><span class="line"><span class="comment"># å…‹éš†ç¯å¢ƒ (ä¾‹å¦‚å½“å‰ç¯å¢ƒæ˜¯base, éœ€è¦å…‹éš†ä¸€ä¸ªcopy_baseï¼Œåœ°å€åœ¨~/path)</span></span><br><span class="line">conda create -n copy_base --clone ~/path</span><br><span class="line"><span class="comment"># æ¿€æ´»ç¯å¢ƒ</span></span><br><span class="line">source activate snowflakes  <span class="comment">#linux</span></span><br><span class="line">activate new_env_name <span class="comment">#windows</span></span><br><span class="line"><span class="comment"># é‡Šæ”¾ç¯å¢ƒ</span></span><br><span class="line">source deactivate <span class="comment">#linux</span></span><br><span class="line">deactivate <span class="comment">#windows</span></span><br><span class="line"><span class="comment"># ç§»é™¤ç¯å¢ƒ</span></span><br><span class="line">conda remove --name new_env_name --<span class="built_in">all</span></span><br><span class="line">conda remove -n new_env_name --<span class="built_in">all</span></span><br><span class="line"><span class="comment"># ä¿å­˜ç¯å¢ƒ\åˆ†äº«ç¯å¢ƒ</span></span><br><span class="line">conda env export &gt; environment.yml</span><br><span class="line"><span class="comment"># æ¢å¤ç¯å¢ƒ</span></span><br><span class="line">conda env create -f environment.yml</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç¯å¢ƒæ‰€æœ‰package</span></span><br><span class="line">conda <span class="built_in">list</span></span><br><span class="line"><span class="comment"># ä¸ºæŒ‡å®šç¯å¢ƒå®‰è£…æŸä¸ªåŒ…</span></span><br><span class="line">conda install -n env_name package_name</span><br><span class="line"><span class="comment"># æŸ¥æ‰¾åŒ…æœ‰å“ªäº›ç‰ˆæœ¬</span></span><br><span class="line">conda search tensorflow-gpu </span><br><span class="line"><span class="comment"># å°†condaæ”¾å…¥PATH</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">&quot;$(/home/yuanwenwu/anaconda3/bin/conda shell.YOUR_SHELL_NAME hook)&quot;</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨python2.7ç¯å¢ƒä¸­å¯åŠ¨notebook ä½¿kernelå˜ä¸ºpython3ã€python2å…±å­˜</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥python2è™šæ‹Ÿç¯å¢ƒï¼Œæ‰§è¡Œä¸‹é¢è¯­å¥ï¼Œç„¶åå¯åŠ¨jupyter notebookå³å¯</span></span><br><span class="line">python -m ipykernel install --user</span><br></pre></td></tr></table></figure><ul><li>é—®é¢˜1ï¼špythonèƒ½æ‰¾åˆ°çš„åŒ…ï¼Œjupyter notebookæ‰¾ä¸åˆ°</li></ul><p>æ˜¯å› ä¸ºpythonæ‰§è¡Œè·¯å¾„ä¸ä¸€è‡´ã€‚ å®šä½è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡sysåŒ…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="built_in">print</span>(sys.executable)</span><br></pre></td></tr></table></figure><p>å¾€å¾€è¿™ä¸ªé—®é¢˜æ˜¯åªå®‰è£…äº†pythonï¼Œä½†è¦ä½¿ç”¨ipythonæˆ–jupyternotebookï¼Œç”±äºè™šæ‹Ÿç¯å¢ƒæ²¡æœ‰ï¼Œä¼šå»ä¸»ç³»ç»Ÿæ‰¾å¯ç”¨ç‰ˆæœ¬å‘¢ï¼Œä»è€Œå¯¼è‡´å¯åŠ¨è·¯å¾„ä¸ä¸€è‡´ï¼Œè§£å†³æ–¹å¼æ˜¯åœ¨è™šæ‹Ÿç¯å¢ƒcondainstalléœ€è¦çš„åŒ…ï¼ˆ ipython or jupyter notebook ) å‚è€ƒï¼š<ahref="https://blog.csdn.net/sunxinyu/article/details/78801534"class="uri">https://blog.csdn.net/sunxinyu/article/details/78801534</a></p><h4 id="conda-æ›´æ¢æº">conda æ›´æ¢æº</h4><h4 id="conda-å®‰è£…æŒ‡å®šversionåŒ…">conda å®‰è£…æŒ‡å®šversionåŒ…</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda search tensorflow</span><br><span class="line">conda install tensorflow-gpu==<span class="number">2.0</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;conda æ˜¯ Anaconda çš„å·¥å…·ç®±ï¼Œå®ƒæ˜¯ pip å’Œ vitualenv
çš„ç»„åˆï¼Œä¹Ÿå°±æ˜¯è¯´ä»–å¯ä»¥åƒpipæ¥ç®¡ç†åŒ…ï¼Œä¹Ÿå¯ä»¥åƒvitualenvæ¥åˆ‡æ¢ç¯å¢ƒ&lt;/p&gt;
&lt;h4 id=&quot;installation&quot;&gt;installation&lt;/h4&gt;
&lt;p&gt;&lt;a
hre</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>matplotlib</title>
    <link href="http://yoursite.com/2024/02/29/matplotlib/"/>
    <id>http://yoursite.com/2024/02/29/matplotlib/</id>
    <published>2024-02-29T11:10:11.000Z</published>
    <updated>2025-05-22T05:50:40.080Z</updated>
    
    <content type="html"><![CDATA[<h2 id="matplotlib">matplotlib</h2><h3 id="pyplot">pyplot</h3><p>â€ƒpyplotè´Ÿè´£ç»˜åˆ¶å›¾åƒï¼Œä¿®é¥°å›¾åƒfigureã€‚æ­¤å¤„åº”å¼ºè°ƒçš„æ˜¯ï¼Œå…¶ä¿æŒmatlabçš„é£æ ¼ï¼Œæ€»æ˜¯è·Ÿè¸ªå½“å‰figure,ç»˜åˆ¶å‡½æ•°ç›´æ¥æŒ‡å‘å½“å‰axes.â€ƒfigure()å‡½æ•°è´Ÿè´£åˆ›å»ºä¸€ä¸ªå›¾åƒï¼Œé»˜è®¤ä¸ç”¨è°ƒç”¨æ­¤å‡½æ•°ï¼Œå¹¶ä¸”ä¸€ä¸ªsubplot(111)ä¹Ÿä¼šé»˜è®¤è¢«åˆ›å»ºå¦‚æœä¸æ‰‹åŠ¨æŒ‡å®šaxesçš„è¯ã€‚figure(i)åˆ›å»ºæ ‡å·ä¸ºiçš„figure</p><span id="more"></span><h3 id="ç»“æ„çŸ¥è¯†">ç»“æ„çŸ¥è¯†</h3><p><a href="https://zhuanlan.zhihu.com/p/93423829">plt, axes,figureä¹‹é—´çš„å…³ç³»</a></p><p>![æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°][1] ![æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°][2]</p><h3 id="ç»˜åˆ¶å­å›¾">ç»˜åˆ¶å­å›¾</h3><p><ahref="https://blog.csdn.net/You_are_my_dream/article/details/53439518"class="uri">https://blog.csdn.net/You_are_my_dream/article/details/53439518</a>dataFrameç»˜åˆ¶åœ¨å­å›¾ä¸Š <ahref="https://blog.csdn.net/htuhxf/article/details/82986440?spm=1001.2014.3001.5502"class="uri">https://blog.csdn.net/htuhxf/article/details/82986440?spm=1001.2014.3001.5502</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.subplots(figsize=(<span class="number">10</span>,<span class="number">10</span>))</span><br><span class="line">fig.suptitle(<span class="string">&quot;whole title&quot;</span>)</span><br><span class="line"><span class="comment"># ç­‰ä»·äºï¼š</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>,<span class="number">10</span>))</span><br><span class="line">ax = fig.add_subplot(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">fig.suptitle(<span class="string">&quot;whole title&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨subplots (<strong>Template</strong> !!!)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># data</span></span><br><span class="line">curve_list = []</span><br><span class="line">x = np.arange(<span class="number">1</span>,<span class="number">100</span>)</span><br><span class="line">curve_list.append((x, x))</span><br><span class="line">curve_list.append((x, -x))</span><br><span class="line">curve_list.append((x, x**<span class="number">2</span>))</span><br><span class="line">curve_list.append((x, np.log(x)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># sub window nums</span></span><br><span class="line">n = <span class="built_in">len</span>(curve_list)</span><br><span class="line">column_num = <span class="number">2</span></span><br><span class="line">row_num = <span class="built_in">int</span>(np.ceil(n/column_num))</span><br><span class="line"></span><br><span class="line"><span class="comment"># construct figure and pre split</span></span><br><span class="line">fig, axes = plt.subplots(row_num, column_num, figsize=(<span class="number">10</span>,<span class="number">10</span>))</span><br><span class="line">fig.suptitle(<span class="string">&quot;curve show&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># draw sub plot on figure</span></span><br><span class="line">index = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> axes:</span><br><span class="line">    <span class="keyword">for</span> ax <span class="keyword">in</span> row:</span><br><span class="line">        x, y = curve_list[index]</span><br><span class="line">        ax.set_title(<span class="string">&quot;curve_&#123;&#125;&quot;</span>.<span class="built_in">format</span>(index))</span><br><span class="line">        <span class="comment"># plot æ—¶è®¾ç½® label, é¢œè‰², çº¿å®½åº¦ç­‰</span></span><br><span class="line">        ax.plot(x, y, <span class="string">&#x27;C&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(index), label=<span class="string">&#x27;curve&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(index), linewidth=<span class="number">2</span>)</span><br><span class="line">        ax.grid(color=<span class="string">&#x27;r&#x27;</span>, linestyle=<span class="string">&#x27;--&#x27;</span>, linewidth=<span class="number">1</span>,alpha=<span class="number">0.3</span>)</span><br><span class="line">        index += <span class="number">1</span> </span><br><span class="line">        <span class="comment"># ax æ˜¾ç¤ºlabel, å¯è®¾ç½®æ˜¾ç¤ºä½ç½®</span></span><br><span class="line">        ax.legend(loc=<span class="string">&#x27;lower right&#x27;</span>, fontsize=<span class="number">10</span>)   </span><br></pre></td></tr></table></figure><ul><li>subplotså’ŒDataFrameç»“åˆ <ahref="https://blog.csdn.net/htuhxf/article/details/82986440?spm=1001.2014.3001.5502"class="uri">https://blog.csdn.net/htuhxf/article/details/82986440?spm=1001.2014.3001.5502</a></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"> </span><br><span class="line">fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">data = pd.Series(np.random.rand(<span class="number">16</span>), index=<span class="built_in">list</span>(<span class="string">&#x27;abcdefghijklmnop&#x27;</span>))</span><br><span class="line">data.plot.bar(ax=axes[<span class="number">1</span>,<span class="number">1</span>], color=<span class="string">&#x27;b&#x27;</span>, alpha = <span class="number">0.5</span>)</span><br><span class="line">data.plot.barh(ax=axes[<span class="number">0</span>,<span class="number">1</span>], color=<span class="string">&#x27;k&#x27;</span>, alpha=<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨add_subplot</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"> </span><br><span class="line">x = np.arange(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line"><span class="comment"># first you have to make the figure</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># now you have to create each subplot individually</span></span><br><span class="line">ax1 = fig.add_subplot(<span class="number">221</span>)</span><br><span class="line">ax1.plot(x, x)</span><br><span class="line">ax2 = fig.add_subplot(<span class="number">222</span>)</span><br><span class="line">ax2.plot(x, -x)</span><br><span class="line">ax3 = fig.add_subplot(<span class="number">223</span>)</span><br><span class="line">ax3.plot(x, x ** <span class="number">2</span>)</span><br><span class="line">ax4 = fig.add_subplot(<span class="number">224</span>)</span><br><span class="line">ax4.plot(x, np.log(x))</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>å¤šä¸ªå­å›¾çš„æ¨¡æ¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">figure = plt.figure(figsize=(<span class="number">8</span>, <span class="number">8</span>))</span><br><span class="line">cols, rows = <span class="number">3</span>, <span class="number">3</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, cols * rows + <span class="number">1</span>):</span><br><span class="line">    sample_idx = torch.randint(<span class="built_in">len</span>(training_data), size=(<span class="number">1</span>,)).item()</span><br><span class="line">    img, label = training_data[sample_idx]</span><br><span class="line">    figure.add_subplot(rows, cols, i)</span><br><span class="line">    plt.title(labels_map[label])</span><br><span class="line">    plt.axis(<span class="string">&quot;off&quot;</span>)</span><br><span class="line">    plt.imshow(img.squeeze(), cmap=<span class="string">&quot;gray&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>code [link][3] ![æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°][4]</p><ul><li>ä½¿ç”¨subplot</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">x = np.arange(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line"><span class="comment"># first you have to make the figure</span></span><br><span class="line">fig = plt.figure(<span class="number">1</span>) </span><br><span class="line"><span class="comment"># now you have to create each subplot individually</span></span><br><span class="line">plt.subplot(<span class="number">221</span>)</span><br><span class="line">plt.plot(x, x)</span><br><span class="line">plt.subplot(<span class="number">222</span>)</span><br><span class="line">plt.plot(x, -x)</span><br><span class="line">plt.subplot(<span class="number">223</span>)</span><br><span class="line">plt.plot(x, x ** <span class="number">2</span>)</span><br><span class="line">plt.subplot(<span class="number">224</span>)</span><br><span class="line">plt.plot(x, np.log(x))</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="comment"># ax1 = plt.subplot(221)</span></span><br><span class="line"><span class="comment"># ax1.plot(x, x)</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h3 id="å®šåˆ¶legend">å®šåˆ¶legend</h3><p>åœºæ™¯ï¼Œä¾‹å¦‚åœ¨ç»˜åˆ¶æ›²çº¿çš„æ˜¯åæƒ³ç»˜åˆ¶æ¯ä¸ªæ›²çº¿çš„æå€¼ç‚¹ï¼ŒåŒäº‹legendæ˜¯"æ›²çº¿å+æå€¼ç‚¹value"è¿™ç§éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨customlegend æ™®é€šplt.plot(x,y)ä¼šè¿”å›ç»˜åˆ¶çš„æ›²çº¿ï¼Œæ˜¯Line2D object,è·å–è¿™äº›objectsåï¼Œä½¿ç”¨ax.legend(lines, legends, loc='lowerright')å¯ä»¥å®šåˆ¶legend ä¾‹å¦‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># simple example</span></span><br><span class="line">lines = plt.plot(data)</span><br><span class="line">plt.legend(lines, [<span class="string">&#x27;line1&#x27;</span>,<span class="string">&#x27;line2&#x27;</span>,<span class="string">&#x27;lin3&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># another simple example</span></span><br><span class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</span><br><span class="line">z = randn(<span class="number">10</span>)</span><br><span class="line">red_dot, = plt.plot(z, <span class="string">&quot;ro&quot;</span>, markersize=<span class="number">15</span>)</span><br><span class="line"><span class="comment"># Put a white cross over some of the data.</span></span><br><span class="line">white_cross, = plt.plot(z[:<span class="number">5</span>], <span class="string">&quot;w+&quot;</span>, markeredgewidth=<span class="number">3</span>, markersize=<span class="number">15</span>)</span><br><span class="line">plt.legend([red_dot, (red_dot, white_cross)], [<span class="string">&quot;Attr A&quot;</span>, <span class="string">&quot;Attr A+B&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># practice example</span></span><br><span class="line"><span class="comment"># æ³¨æ„dataframe.plotä¸è¿”å›Line2Då¯¹è±¡ï¼Œå¦‚æœéœ€è¦æ›²çº¿å¯¹è±¡ï¼Œéœ€è¦ä½¿ç”¨dataframe.plot.line(), æœ€å¥½è¿˜æ˜¯ä½¿ç”¨åŸå§‹çš„ax.plot()åˆ†columnç»˜åˆ¶ï¼Œè¿™æ ·å¥½æ§åˆ¶ä¸€äº›</span></span><br><span class="line">lines = []</span><br><span class="line">legends = []</span><br><span class="line"><span class="keyword">for</span> idx, metric_type <span class="keyword">in</span> <span class="built_in">enumerate</span>(metrics_type_column):</span><br><span class="line">    data = df[metric_type]</span><br><span class="line">    x, y = data.idxmax(), data.<span class="built_in">max</span>()</span><br><span class="line">    line = ax.plot(data, c=<span class="string">&#x27;C%d&#x27;</span>%(idx))</span><br><span class="line">    lines.extend(line)</span><br><span class="line">    ax.scatter(x, y, c=<span class="string">&#x27;C%d&#x27;</span>%(idx), alpha=<span class="number">0.5</span>)</span><br><span class="line">    legends.append(<span class="string">&quot;%s max=%.4f&quot;</span>%(metric_type.replace(<span class="string">&quot;bf_&quot;</span>, <span class="string">&quot;&quot;</span>), y))</span><br><span class="line">ax.legend(lines, legends, loc=<span class="string">&#x27;lower right&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="legend-for-size-of-points">Legend for Size of Points</h4><p><ahref="https://jakevdp.github.io/PythonDataScienceHandbook/04.06-customizing-legends.html"class="uri">https://jakevdp.github.io/PythonDataScienceHandbook/04.06-customizing-legends.html</a></p><h3 id="ç»˜åˆ¶gaussæ›²çº¿">ç»˜åˆ¶gaussæ›²çº¿</h3><p><ahref="http://emredjan.github.io/blog/2017/07/19/plotting-distributions/"class="uri">http://emredjan.github.io/blog/2017/07/19/plotting-distributions/</a></p><h3 id="ç»˜åˆ¶activation-å‡½æ•°æ›²çº¿">ç»˜åˆ¶activation å‡½æ•°æ›²çº¿</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib.widgets <span class="keyword">import</span> Cursor</span><br><span class="line"><span class="comment"># data</span></span><br><span class="line">x = np.arange(-<span class="number">3</span>,<span class="number">3</span>,<span class="number">0.1</span>)</span><br><span class="line">y1 = np.log(np.exp(x)+ <span class="number">1</span>) </span><br><span class="line">y2 = np.maximum(<span class="number">0</span>, x)</span><br><span class="line"><span class="comment"># draw</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">fig.suptitle(<span class="string">&quot;activation function&quot;</span>)</span><br><span class="line">axes = fig.add_subplot()</span><br><span class="line">axes.plot(x, y1, color=<span class="string">&#x27;C0&#x27;</span>, label=<span class="string">&#x27;softplus&#x27;</span>)</span><br><span class="line">axes.plot(x, y2, color=<span class="string">&#x27;C1&#x27;</span>, label=<span class="string">&#x27;relu&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"><span class="comment">#axes.set_ylim((-1,3))</span></span><br><span class="line"><span class="comment">#ax.grid()</span></span><br><span class="line"><span class="comment">#axes.set_yticks(np.arange(-1, max(y+1), 1))</span></span><br><span class="line"><span class="comment">#axes.set_xticks(np.arange(-3, max(x+1), 1))</span></span><br><span class="line"><span class="comment"># æ³¨æ„set_yticksä¼šé€ æˆå›¾ç©ºå‡ºä¸€éƒ¨åˆ†ï¼Œå‡½æ•°è¯´æ˜ä¹Ÿå¾ˆæ˜æ˜¾ï¼šIf necessary, the view limits of the Axis are expanded so that all given ticks are visible.</span></span><br><span class="line">axes.axis([-<span class="number">3</span>,<span class="number">3</span>,-<span class="number">1</span>,<span class="number">3</span>])</span><br><span class="line"><span class="comment"># axis å‡½æ•°åˆ™ç›´æ¥ä¼šæˆªå–åˆ°æŒ‡å®šåŒºé—´ï¼Œä¸ä¼šç©ºä½™å‡ºmargin</span></span><br><span class="line">axes.grid(linestyle=<span class="string">&#x27;--&#x27;</span>, linewidth=<span class="number">1</span>,alpha=<span class="number">0.3</span>)</span><br><span class="line">axes.axvline(x=<span class="number">0</span>, linewidth=<span class="number">1</span>, color=<span class="string">&#x27;black&#x27;</span>,alpha=<span class="number">0.6</span>)</span><br><span class="line">axes.axhline(y=<span class="number">0</span>, linewidth=<span class="number">1</span>,  color=<span class="string">&#x27;black&#x27;</span>,alpha=<span class="number">0.6</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;matplotlib&quot;&gt;matplotlib&lt;/h2&gt;
&lt;h3 id=&quot;pyplot&quot;&gt;pyplot&lt;/h3&gt;
&lt;p&gt;â€ƒpyplotè´Ÿè´£ç»˜åˆ¶å›¾åƒï¼Œä¿®é¥°å›¾åƒfigureã€‚æ­¤å¤„åº”å¼ºè°ƒçš„æ˜¯ï¼Œå…¶ä¿æŒmatlabçš„é£æ ¼ï¼Œæ€»æ˜¯è·Ÿè¸ªå½“å‰figure,ç»˜åˆ¶å‡½æ•°ç›´æ¥æŒ‡å‘å½“å‰axes.
â€ƒfigure()å‡½æ•°è´Ÿè´£åˆ›å»ºä¸€ä¸ªå›¾åƒï¼Œé»˜è®¤ä¸ç”¨è°ƒç”¨æ­¤å‡½æ•°ï¼Œå¹¶ä¸”ä¸€ä¸ªsubplot(111)ä¹Ÿä¼šé»˜è®¤è¢«åˆ›å»ºå¦‚æœä¸æ‰‹åŠ¨æŒ‡å®šaxesçš„è¯ã€‚figure(i)åˆ›å»ºæ ‡å·ä¸ºiçš„figure&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>linux</title>
    <link href="http://yoursite.com/2024/02/29/linux/"/>
    <id>http://yoursite.com/2024/02/29/linux/</id>
    <published>2024-02-29T09:57:34.000Z</published>
    <updated>2025-05-22T05:50:40.080Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ•°ç»„">æ•°ç»„</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºæ•°ç»„(æ³¨æ„ä¸éœ€è¦é€—å·ï¼Œä»¥ç©ºæ ¼åˆ†éš”)</span></span><br><span class="line">array=(1 2 3 4)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è·å–æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">echo $&#123;array[@]&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è·å–ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">echo $&#123;array[0]&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è·å–æ•°ç»„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">echo $&#123;#array[@]&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¦‚æœæŸä¸ªå…ƒç´ æ˜¯å­—ç¬¦ä¸²ï¼Œè¿˜å¯ä»¥é€šè¿‡æŒ‡å®šä¸‹æ ‡çš„æ–¹å¼è·å¾—è¯¥å…ƒç´ çš„é•¿åº¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</span></span><br><span class="line">echo $&#123;#array[2]&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å› ä¸ºå­—ç¬¦ä¸²è·å–é•¿åº¦å¦‚ä¸‹</span></span><br><span class="line">str=&quot;hello world&quot;</span><br><span class="line">echo $&#123;#str&#125;</span><br></pre></td></tr></table></figure><span id="more"></span><h3id="å°†commandç»“æœå­˜å…¥æ•°ç»„ä¸å—ç©ºæ ¼å½±å“">å°†commandç»“æœå­˜å…¥æ•°ç»„(ä¸å—ç©ºæ ¼å½±å“)</h3><p><ahref="https://stackoverflow.com/questions/11426529/reading-output-of-a-command-into-an-array-in-bash"class="uri">https://stackoverflow.com/questions/11426529/reading-output-of-a-command-into-an-array-in-bash</a>The other answers will break if output of command contains spaces (whichis rather frequent) or glob characters like *, ?, [...].</p><p>To get the output of a command in an array, with one line perelement, there are essentially 3 ways:</p><h3 id="with-bash4-use-mapfileits-the-most-efficient">1. With Bashâ‰¥4 usemapfileâ€”it's the most efficient</h3><p>mapfileä½¿ç”¨æ–¹å¼ï¼š<ahref="https://wangchujiang.com/linux-command/c/mapfile.html"class="uri">https://wangchujiang.com/linux-command/c/mapfile.html</a>ç®­å¤´ç´§è´´æ‹¬å·æ˜¯å°†å†…éƒ¨å‘½ä»¤è½¬æ¢ä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œå‚ç…§<ahref="https://tldp.org/LDP/abs/html/process-sub.html"class="uri">https://tldp.org/LDP/abs/html/process-sub.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapfile -t my_array &lt; &lt;( my_command )</span><br></pre></td></tr></table></figure><h3 id="otherwise-a-loop-reading-the-output-slower-but-safe">2.Otherwise, a loop reading the output (slower, but safe)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my_array=()</span><br><span class="line">while IFS= read -r line; do</span><br><span class="line">    my_array+=( &quot;$line&quot; )</span><br><span class="line">done &lt; &lt;( my_command )</span><br></pre></td></tr></table></figure><h3id="as-suggested-by-charles-duffy-in-the-comments-thanks-the-following-might-perform-better-than-the-loop-method-in-number-2">3.As suggested by Charles Duffy in the comments (thanks!), the followingmight perform better than the loop method in number 2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IFS=$&#x27;\n&#x27; read -r -d &#x27;&#x27; -a my_array &lt; &lt;( my_command &amp;&amp; printf &#x27;\0&#x27; )</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹IFSå€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;$IFS&quot; | od -b</span><br><span class="line">0000000 040 011 012 012</span><br><span class="line">0000004</span><br></pre></td></tr></table></figure><h3 id="setå‘½ä»¤">setå‘½ä»¤</h3><p><a href="http://www.ruanyifeng.com/blog/2017/11/bash-set.html"class="uri">http://www.ruanyifeng.com/blog/2017/11/bash-set.html</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">set -eu</span><br><span class="line">set -o pipefail</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">folder=&quot;MSNClick&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">IFS=$<span class="string">&#x27;\n&#x27;</span> <span class="built_in">read</span> -r -d <span class="string">&#x27;&#x27;</span> -a array &lt; &lt;( <span class="built_in">du</span> -d 1 <span class="variable">$folder</span>/* | <span class="built_in">sort</span> -n -t 1 -r &amp;&amp; <span class="built_in">printf</span> <span class="string">&#x27;\0&#x27;</span> )</span></span><br><span class="line">mapfile -t array &lt; &lt;( du -d 1 $folder/* | sort -n -t 1 -r )</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$IFS</span>&quot;</span> | <span class="built_in">od</span> -b</span></span><br><span class="line"></span><br><span class="line">function fun()&#123;</span><br><span class="line">    local IFS=$&#x27; &#x27;</span><br><span class="line"></span><br><span class="line">    #echo -n &quot;$IFS&quot; | od -b</span><br><span class="line"></span><br><span class="line">    for line in $&#123;array[@]&#125;;do</span><br><span class="line">        size=`echo $line |cut -f 1`</span><br><span class="line">        model_dir=`echo $line |cut -f 2`</span><br><span class="line">        debug_case_dir=&quot;$model_dir/debug_case&quot;</span><br><span class="line">        if [[ $size -gt 100000 ]];then</span><br><span class="line">            echo &quot;$model_dir, size=$(($size / 1024))M&quot;</span><br><span class="line">            if [ -d $debug_case_dir ]; then</span><br><span class="line">                echo &quot;rm $model_dir/*.bin&quot;</span><br><span class="line">                rm $model_dir/*.bin</span><br><span class="line">            else</span><br><span class="line">                echo &quot;rm $model_dir/*.tsv&quot;</span><br><span class="line">                rm $model_dir/*.tsv</span><br><span class="line">                echo &quot;rm $model_dir/*.bin&quot;</span><br><span class="line">                rm $model_dir/*.bin</span><br><span class="line">            fi</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line"></span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun</span><br></pre></td></tr></table></figure><h2 id="å‚æ•°åˆ¤ç©º">å‚æ•°åˆ¤ç©º</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if [ ! -n &quot;$end_dt&quot; ];then</span><br><span class="line">    echo &quot;end_dt is None&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h2 id="å‚æ•°æ•°é‡æ ¡éªŒ">å‚æ•°æ•°é‡æ ¡éªŒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">param_len=$#</span><br><span class="line">if [ $param_len != 3 ];then</span><br><span class="line">    echo &quot;train need 3 parameters, now $param_len&quot;</span><br><span class="line">    exit 1;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h2 id="å¾ªç¯æ—¥æœŸ">å¾ªç¯æ—¥æœŸ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">t_end=`date -d &quot;$end_dt&quot; +%s`</span><br><span class="line">cur_dt=$start_dt</span><br><span class="line">while true</span><br><span class="line">do</span><br><span class="line">  t_cur=`date -d &quot;$cur_dt&quot; +%s`</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">å½“å¼€å§‹æ—¶é—´å°äºç»“æŸæ—¶é—´æ—¶ï¼Œç›´æ¥ç»“æŸè„šæœ¬</span></span><br><span class="line">  if [ $t_cur -gt $t_end ]; then</span><br><span class="line">    break</span><br><span class="line">  fi</span><br><span class="line">  echo -e &quot;\n&quot;</span><br><span class="line">  echo &quot;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; $cur_dt &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span><br><span class="line"></span><br><span class="line">  sh run.sh $cur_dt</span><br><span class="line">  check_result &quot;backtrace from rank $cur_dt&quot;</span><br><span class="line">  cur_dt=`date --date &quot;$cur_dt 1 day&quot; +%Y-%m-%d`</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h2 id="åˆ†å‰²æ–‡ä»¶">åˆ†å‰²æ–‡ä»¶</h2><h3 id="splitæ–‡ä»¶">Splitæ–‡ä»¶</h3><p><a href="https://www.cnblogs.com/OliverQin/p/10240222.html"class="uri">https://www.cnblogs.com/OliverQin/p/10240222.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># file contains 5000 lines</span><br><span class="line">split -l 1000 tmp.log -d -a 2 tmp_part_</span><br><span class="line"># will result like below</span><br><span class="line">tmp_part_00</span><br><span class="line">tmp_part_01</span><br><span class="line">...</span><br><span class="line">tmp_part_04</span><br></pre></td></tr></table></figure><h3 id="mergæ–‡ä»¶">Mergæ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat part_dir/tmp_part_* &gt;&gt; tmp.log</span><br></pre></td></tr></table></figure><h2 id="ç»Ÿè®¡ç”¨æˆ·å­˜å‚¨å ç”¨æƒ…å†µsort">ç»Ÿè®¡ç”¨æˆ·å­˜å‚¨å ç”¨æƒ…å†µ(sort)</h2><p>du -sh ./* | sort -rh find ./data -size +200M | xargs ls -lSh</p><h2 id="å­—ç¬¦å¤„ç†">å­—ç¬¦å¤„ç†</h2><h3 id="ç»Ÿè®¡å­—ç¬¦ä¸²å•è¯ä¸ªæ•°">ç»Ÿè®¡å­—ç¬¦ä¸²å•è¯ä¸ªæ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ³•1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;one two three four five&#x27;</span> | <span class="built_in">wc</span> -w</span><br><span class="line"><span class="comment"># æ–¹æ³•2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;one two three four five&#x27;</span> | awk <span class="string">&#x27;&#123;print NF&#125;&#x27;</span></span><br><span class="line"><span class="comment"># æ–¹æ³•3 </span></span><br><span class="line">s=<span class="string">&#x27;one two three four five&#x27;</span> </span><br><span class="line"><span class="built_in">set</span> <span class="variable">$&#123;s&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$#</span></span><br><span class="line"><span class="comment"># æ–¹æ³•4 é€šè¿‡æ•°ç»„æ–¹å¼è·å–</span></span><br><span class="line">=<span class="string">&#x27;one two three four five&#x27;</span> </span><br><span class="line">a=(<span class="variable">$s</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#a[@]&#125;</span></span><br><span class="line"><span class="comment"># æ–¹æ³•5</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;one two three four five&#x27;</span> | <span class="built_in">tr</span> <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;\n&#x27;</span> | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure><h3 id="æå–æ•°å­—">æå–æ•°å­—</h3><p>å¦‚æœæŸä¸€è¡Œå¦‚ä¸‹ file.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â€¦â€¦</span><br><span class="line"> &#123;space&#125;&#123;space&#125;&#123;\t&#125;numRows&#123;space&#125;&#123;\t&#125;122321</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ–‡ä»¶é‡Œæœ‰æŸä¸€è¡Œéœ€è¦æå–numRowsï¼Œä½†æ­¤è¡Œæœ‰ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦,å¦‚æœæƒ³æå–æ•°å­—ä¿å­˜å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨trå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">numRows=`cat file.txt | grep &quot;numRows&quot; | tr -cd [0-9]`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">tr</span> å‘½ä»¤</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">tr</span> -<span class="built_in">cd</span> [<span class="string">&#x27;å­—ç¬¦é›†åˆ&#x27;</span>]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  -dï¼šdeleteï¼›-cï¼šcomplementï¼›-<span class="built_in">cd</span>ï¼šåˆ é™¤åè¾¹çš„å‚æ•°ä»¥å¤–çš„</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  ps: complementæ„å‘³ç€è¡¥é›†</span></span><br></pre></td></tr></table></figure><h3 id="æ‰“å°ä¿¡æ¯">æ‰“å°ä¿¡æ¯</h3><p>echo -e å¯ä»¥è¾“å‡º'</p><h4 id="æ‰“å°ä¸€æ¡çº¿">æ‰“å°ä¸€æ¡çº¿</h4><p><a href="https://blog.csdn.net/u013670453/article/details/113462422"class="uri">https://blog.csdn.net/u013670453/article/details/113462422</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf &#x27;#%.0s&#x27; &#123;1..100&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf &#x27;%100s\n&#x27; | tr &#x27; &#x27; =</span><br></pre></td></tr></table></figure><h3 id="é€‰å®šæŸå‡ è¡Œ">é€‰å®šæŸå‡ è¡Œ</h3><p><ahref="http://www.cnblogs.com/xianghang123/archive/2011/08/03/2125977.html">å‚è€ƒèµ„æ–™</a>ã€ä¸€ã€‘ä»ç¬¬3000è¡Œå¼€å§‹ï¼Œæ˜¾ç¤º1000è¡Œã€‚å³æ˜¾ç¤º3000~3999è¡Œ<code>cat filename | tail -n +3000 | head -n 1000</code>ã€äºŒã€‘æ˜¾ç¤º1000è¡Œåˆ°3000è¡Œ<code>cat filename| head -n 3000 | tail -n +1000</code>*æ³¨æ„ä¸¤ç§æ–¹æ³•çš„é¡ºåº åˆ†è§£ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tail -n 1000ï¼šæ˜¾ç¤ºæœ€å1000è¡Œ</span><br><span class="line">tail -n +1000ï¼šä»1000è¡Œå¼€å§‹æ˜¾ç¤ºï¼Œæ˜¾ç¤º1000è¡Œä»¥åçš„</span><br><span class="line">head -n 1000ï¼šæ˜¾ç¤ºå‰é¢1000è¡Œ</span><br></pre></td></tr></table></figure><p>ã€ä¸‰ã€‘ç”¨sedå‘½ä»¤ <code>sed -n '5,10p' filename</code>è¿™æ ·ä½ å°±å¯ä»¥åªæŸ¥çœ‹æ–‡ä»¶çš„ç¬¬5è¡Œåˆ°ç¬¬10è¡Œã€‚ å¦‚æœä¸åŠ n,ä¼šå°†5,10è¡Œæ‰“å°ä¸€éï¼ŒåŒæ—¶æ‰“å°å…¨éƒ¨æ–‡ä»¶ï¼›åŠ næ˜¯å–æ¶ˆdefault printçš„æ‰§è¡Œ -n,--quiet, --silent: suppress automatic printing of pattern space</p><h3 id="linux-sortuniqcutwcå‘½ä»¤è¯¦è§£">linux sort,uniq,cut,wcå‘½ä»¤è¯¦è§£</h3><p><ahref="https://www.cnblogs.com/ggjucheng/archive/2013/01/13/2858385.html"class="uri">https://www.cnblogs.com/ggjucheng/archive/2013/01/13/2858385.html</a>)</p><h4 id="cut">cut</h4><p><a href="https://www.cnblogs.com/f-ck-need-u/p/7521357.html"class="uri">https://www.cnblogs.com/f-ck-need-u/p/7521357.html</a></p><h4 id="sort">sort</h4><p><a href="https://www.cnblogs.com/ding2016/p/9668425.html"class="uri">https://www.cnblogs.com/ding2016/p/9668425.html</a>sortå¯ä»¥å¯¹è¡Œè¿›è¡Œæ’åºï¼ŒåŒ…æ‹¬æŒ‰æ•°å­—ï¼Œä»¥åŠæŒ‰ç…§splitåæŸä¸€åˆ—æ’åºç­‰å¸¸è§ä¸€ç§æƒ…å†µï¼Œä¾‹å¦‚ç›®å½•æœ‰å¦‚ä¸‹æ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">logs/</span><br><span class="line">â”œâ”€â”€ 202005_0_detect.log</span><br><span class="line">â”œâ”€â”€ 202005_10_detect.log</span><br><span class="line">â”œâ”€â”€ 202005_11_detect.log</span><br><span class="line">â”œâ”€â”€ 202005_1_detect.log</span><br><span class="line">â”œâ”€â”€ 202005_2_detect.log</span><br><span class="line">â”œâ”€â”€ 202005_3_detect.log</span><br><span class="line">â”œâ”€â”€ 202005_4_detect.log</span><br><span class="line">â”œâ”€â”€ 202005_5_detect.log</span><br><span class="line">â”œâ”€â”€ 202005_6_detect.log</span><br><span class="line">â”œâ”€â”€ 202005_7_detect.log</span><br><span class="line">â”œâ”€â”€ 202005_8_detect.log</span><br><span class="line">â””â”€â”€ 202005_9_detect.log</span><br></pre></td></tr></table></figure><p>æƒ³æŒ‰ç…§æ•°å­—æ’åºï¼Œå¦‚æœç›´æ¥ä½¿ç”¨lsä¼šä»¥å­—æ¯åºæ’åºï¼Œå¾—åˆ°çš„ç»“æœä¼šå¦‚ä¸Šæ‰€ç¤ºï¼Œå› ä¸ºlså°†æ•°å­—æŒ‰ç…§å­—ç¬¦ä¸²æ’åºï¼Œå…ˆæ’ç¬¬ä¸€ä½å†æ’ç¬¬äºŒä½ï¼Œç±»ä¼¼åŸºæ•°æ’åºçš„æ€æƒ³ã€‚å¦‚æœæƒ³æŒ‰ç…§æ•°å­—é¡ºåºå°±éœ€è¦sortå‘½ä»¤äº†ï¼Œsortå‘½ä»¤å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sort --help</span><br><span class="line">-n # sort by num æŒ‰æ•°å­—æ’åº</span><br><span class="line">-k # splitåé€‰åˆ™ç¬¬kåˆ—ä½œä¸ºæ’åºä¾æ®</span><br><span class="line">-t # terminate æŒ‡å®šåˆ†éš”ç¬¦</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><p>å½¢æˆçš„å‘½ä»¤å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls logs/*.log | sort -n -k 2 -t _</span><br><span class="line"></span><br><span class="line"># another example</span><br><span class="line"># æŒ‰ç…§ç¬¬å››åˆ—ï¼Œä»¥æ•°å­—æ–¹å¼æ’åˆ—ï¼Œåˆ†å‰²æ–¹å¼æ˜¯Tabé”®ï¼Œ å–æŸä¸€åŒºé—´ç»“æœ</span><br><span class="line">sort -k 4 -n -t$&#x27;\t&#x27; -r userIdMap.tsv | sed -n &#x27;30000, 30500p&#x27; &gt; userIdMapSort.tsv</span><br></pre></td></tr></table></figure><h5 id="å¤„ç†tabé”®åˆ†éš”ç¬¦">å¤„ç†tabé”®åˆ†éš”ç¬¦</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort -n -k 4 -r -t$&#x27;\t&#x27; userIdMap.tsv</span><br></pre></td></tr></table></figure><h5 id="sort-æ’åˆ—æ—¥æœŸå­—ç¬¦ä¸²">sort æ’åˆ—æ—¥æœŸå­—ç¬¦ä¸²</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#ä¾‹å¦‚æ–‡ä»¶å†…å®¹ data.txtï¼š</span><br><span class="line">2020-11-14_2020-12-01/train/2020-11-30_2020-12-01</span><br><span class="line">2020-12-01_2020-12-20/train/2020-12-01_2020-12-02</span><br><span class="line">2020-12-01_2020-12-20/train/2020-12-02_2020-12-03</span><br><span class="line">2020-12-01_2020-12-20/train/2020-12-03_2020-12-04</span><br><span class="line">2020-12-01_2020-12-20/train/2020-12-04_2020-12-05</span><br><span class="line">2020-12-01_2020-12-20/train/2020-12-05_2020-12-06</span><br><span class="line">2020-12-01_2020-12-20/train/2020-12-06_2020-12-07</span><br><span class="line"></span><br><span class="line">sort -n -k 2 -k 3 -k 4 -k 5 -k 7 -k 8 -t &#x27;-&#x27; data.txt </span><br></pre></td></tr></table></figure><h5 id="sort-mac-osæ¢è¡Œç¬¦ä¸èµ·ä½œç”¨">sort MAC OSæ¢è¡Œç¬¦ä¸èµ·ä½œç”¨</h5><p>åŸå› å°±æ˜¯Max OSXä¸Šçš„sedæ˜¯BSDçš„ç‰ˆæœ¬ï¼ŒLinuxä¸Šçš„æ˜¯Gnuçš„ç‰ˆæœ¬ï¼Œå¯¼è‡´çš„ä¸ä¸€è‡´ å¯ä»¥brew installgnu-sedå’Œæ›¿æ¢è°ƒç”¨sedä¸gsedã€‚ å¦‚æœä¸æƒ³åœ¨â€œ gâ€ä¹‹å‰åŠ ä¸Šsedï¼Œå¯ä»¥brew installgnu-sed --with-default-names</p><h5 id="sort-å¤„ç†è´Ÿæ•°">sort å¤„ç†è´Ÿæ•°</h5><p>sort -g æ³¨æ„ä½¿ç”¨äº†-gå°±è¦å»æ‰-nä¸¤è€…æ˜¯å†²çªçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sort -g â€¦â€¦</span><br><span class="line"># or --general-numeric-sort</span><br><span class="line"># or --sort=general-numeric</span><br></pre></td></tr></table></figure><h3 id="xarg">xarg</h3><p><a href="http://www.ruanyifeng.com/blog/2019/08/xargs-tutorial.html"class="uri">http://www.ruanyifeng.com/blog/2019/08/xargs-tutorial.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep /bin/bash | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | xargs -n 1 kill -9</span><br><span class="line"># -nå‚æ•°æŒ‡å®šæ¯æ¬¡å°†å¤šå°‘é¡¹ï¼Œä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ã€‚</span><br><span class="line">$ echo &#123;0..9&#125; | xargs -n 2 echo</span><br><span class="line">0 1</span><br><span class="line">2 3</span><br><span class="line">4 5</span><br><span class="line">6 7</span><br><span class="line">8 9</span><br></pre></td></tr></table></figure><h4id="ä»ä¸€ç³»åˆ—æ—¥å¿—æ–‡ä»¶ä¸­æå–ç›¸åŒä¸€è¡Œå†…å®¹">ä»ä¸€ç³»åˆ—æ—¥å¿—æ–‡ä»¶ä¸­æå–ç›¸åŒä¸€è¡Œå†…å®¹</h4><p>ä¾‹å¦‚ï¼Œä»å¤šä¸ªsparkæ—¥å¿—ä¸­æå–tracking URL</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -t logs/extract_*.log | head -10 | xargs -L 1 grep &quot;tracking URL&quot; -m 1</span><br></pre></td></tr></table></figure><p>å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><ul><li>xargs çš„å½¢å¼æ˜¯ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xargs [-options] [command]</span><br></pre></td></tr></table></figure><ul><li>xargs -L n :å¦‚æœè¾“å…¥æ˜¯å¤šè¡Œï¼Œéœ€è¦ä»¥<strong>å‡ è¡Œ</strong>ä½œä¸ºå‚æ•°ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; cat tmp.txt</span><br><span class="line">img-1.jpeg</span><br><span class="line">img-1-backup.jpeg</span><br><span class="line">img-2.jpeg</span><br><span class="line">img-2-backup.jpeg</span><br><span class="line"></span><br><span class="line">cat tmp.txt | xargs -L 2 cp</span><br><span class="line"># ä¸Šé¢å‘½ä»¤å®ç°ï¼šcp img-d img-d-backupçš„åŠŸèƒ½</span><br></pre></td></tr></table></figure><p>æ„å‘³ç€xargsåé¢éœ€è¦æ¥commandï¼Œå¦‚æœç›´æ¥æ¥ç®¡é“ä¼šå‡ºé”™</p><ul><li>grep å–ç¬¬ä¸€ä¸ªåŒ¹é…ç»“æœ: grrep 'xxx' -m 1</li></ul><h3 id="æŸ¥æ‰¾æ–‡ä»¶å">æŸ¥æ‰¾æ–‡ä»¶å</h3><h4 id="find">Find</h4><p>find <æŒ‡å®šç›®å½•> <æŒ‡å®šæ¡ä»¶> <æŒ‡å®šåŠ¨ä½œ></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">find . -name &#x27;my*&#x27;</span><br><span class="line">find . -name &#x27;my*&#x27; -ls</span><br><span class="line">find . -type f -mmin -10 #æœç´¢å½“å‰ç›®å½•ä¸­ï¼Œæ‰€æœ‰è¿‡å»10åˆ†é’Ÿä¸­æ›´æ–°è¿‡çš„æ™®é€šæ–‡ä»¶ã€‚å¦‚æœä¸åŠ -type få‚æ•°ï¼Œåˆ™æœç´¢æ™®é€šæ–‡ä»¶+ç‰¹æ®Šæ–‡ä»¶+ç›®å½•</span><br><span class="line">find ./ -name &#x27;*.csv&#x27; -maxdepth 1 #è‡³æŸ¥æ‰¾å½“å‰ç›®å½•ï¼Œä¸é€’å½’</span><br></pre></td></tr></table></figure><h4 id="locate">locate</h4><h3 id="æ£€ç´¢å…³é”®å­—">æ£€ç´¢å…³é”®å­—</h3><p>æŒ‡å®šæ–‡ä»¶ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep -rn --include=&#x27;*.åç¼€å&#x27; &quot;æ£€ç´¢è¯&quot;</span><br><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">grep -rn --include=&#x27;*.sh&#x27; &quot;kill command&quot;</span><br></pre></td></tr></table></figure><h3 id="æ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶å¤¹å†…å®¹">æ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶å¤¹å†…å®¹</h3><p><ahref="https://www.tecmint.com/compare-find-difference-between-two-directories-in-linux/"class="uri">https://www.tecmint.com/compare-find-difference-between-two-directories-in-linux/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ diff [OPTION]â€¦ FILES</span><br><span class="line">$ diff options dir1 dir2 </span><br><span class="line"></span><br><span class="line"># éé€’å½’ï¼Œåªå¯¹æ¯”å½“å‰æ–‡ä»¶å†…å®¹</span><br><span class="line">$ diff -q directory-1/ directory-2/</span><br><span class="line"></span><br><span class="line"># é€’å½’å¯¹æ¯”</span><br><span class="line">$ diff -qr directory-1/ directory-2/ </span><br><span class="line"></span><br><span class="line"># æ¯”è¾ƒä¸¤æ–‡ä»¶æŒ‡å®šæ®µè½å†…å®¹</span><br><span class="line">vimdiff &lt;(sed -n &#x27;7088,7122p&#x27; /user/vinyuan/a.txt) &lt;(sed -n &#x27;9022,9043p&#x27; /user/vinyuan/b.txt)</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶åç§°æ›¿æ¢">æ–‡ä»¶åç§°æ›¿æ¢</h3><p><a href="https://www.cnblogs.com/xiaomai333/p/9760304.html"class="uri">https://www.cnblogs.com/xiaomai333/p/9760304.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; var=person.jpg</span><br><span class="line"><span class="comment">#æƒ³æ›¿æ¢æˆperson_large.jpg</span></span><br><span class="line">&gt;&gt; var=<span class="variable">$&#123;var%.*&#125;</span>_large.<span class="variable">$&#123;var##*.&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var</span></span><br><span class="line">&gt;&gt; person_large.jpg</span><br><span class="line"><span class="comment"># $&#123;var##*.&#125;</span></span><br><span class="line"><span class="comment"># $&#123;var#*.&#125;</span></span><br><span class="line"><span class="comment"># $&#123;var%.*&#125;</span></span><br><span class="line"><span class="comment"># $&#123;var%%.*&#125;</span></span><br></pre></td></tr></table></figure><p>å…¶å®<code>$&#123;&#125;</code>å¹¶ä¸æ˜¯ä¸“é—¨ä¸ºæå–æ–‡ä»¶åæˆ–ç›®å½•åçš„ï¼Œå®ƒçš„ä½¿ç”¨æ˜¯å˜é‡çš„æå–å’Œæ›¿æ¢ç­‰ç­‰æ“ä½œï¼Œå®ƒå¯ä»¥æå–éå¸¸å¤šçš„å†…å®¹ï¼Œå¹¶ä¸ä¸€å®šæ˜¯ä¸Šé¢äº”ä¸ªä¾‹å­ä¸­çš„'/'æˆ–'.'ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢çš„ä½¿ç”¨æ–¹æ³•åªæ˜¯å®ƒä½¿ç”¨çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚<strong>è®°å¿†æ–¹å¼ï¼š</strong>æŸ¥çœ‹é”®ç›˜å¸ƒå±€ï¼Œ<code>#</code>åœ¨<code>$</code>çš„å·¦è¾¹ï¼Œ<code>%</code>åœ¨<code>$</code>çš„å³è¾¹</p><h3 id="å­—ç¬¦ä¸²åˆ é™¤æŒ‡å®šéƒ¨åˆ†">å­—ç¬¦ä¸²åˆ é™¤æŒ‡å®šéƒ¨åˆ†</h3><p>[Substring Removal][1]ä¸¤ç§æ–¹å¼éƒ½æ˜¯åˆ é™¤<strong>åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²</strong>ï¼Œå¯¹äºç¬¦å·å³è¾¹çš„é€šé…ç¬¦åŒ¹é…ï¼Œåªè¦åŒ¹é…åˆ°ï¼Œ<strong>åˆ™åˆ é™¤åŒ¹é…åˆ°çš„éƒ¨åˆ†ï¼Œç•™ä¸‹å…¶ä»–éƒ¨åˆ†</strong></p><h4 id="å·çš„ä½¿ç”¨">1.â€#â€œå·çš„ä½¿ç”¨</h4><p><code>$&#123;string#substring&#125;</code> Deletes shortest match of<code>$substring</code> from front of <code>$string</code>.<code>$&#123;string##substring&#125;</code> Deletes longest match of<code>$substring</code> from front of <code>$string</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">stringZ=abcABC123ABCabc</span><br><span class="line">#       |----|          shortest</span><br><span class="line">#       |----------|    longest</span><br><span class="line">echo $&#123;stringZ#a*C&#125;      # 123ABCabc</span><br><span class="line"># Strip out shortest match between &#x27;a&#x27; and &#x27;C&#x27;.</span><br><span class="line"></span><br><span class="line">echo $&#123;stringZ##a*C&#125;     # abc</span><br><span class="line"># Strip out longest match between &#x27;a&#x27; and &#x27;C&#x27;.</span><br><span class="line"></span><br><span class="line"># You can parameterize the substrings.</span><br><span class="line">X=&#x27;a*C&#x27;</span><br><span class="line">echo $&#123;stringZ#$X&#125;      # 123ABCabc</span><br><span class="line">echo $&#123;stringZ##$X&#125;     # abc</span><br><span class="line">                        # As above</span><br></pre></td></tr></table></figure><h3 id="æ•°å€¼è®¡ç®—ä¸åˆ¤æ–­">æ•°å€¼è®¡ç®—ä¸åˆ¤æ–­</h3><p>å¾ªç¯æ˜¯æ ¹æ®å¥‡å¶æ€§åšå‡ºä¸åŒå¤„ç†ï¼Œswitch flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># HOW TO FIND A NUMBER IS EVEN OR ODD IN SHELL SCRIPT</span><br><span class="line"># WRITTEN BY SURAJ MAITY</span><br><span class="line"># TUTORIALSINHAND.COM</span><br><span class="line">clear </span><br><span class="line">echo &quot;---- EVEN OR ODD IN SHELL SCRIPT -----&quot;</span><br><span class="line">echo -n &quot;Enter a number:&quot;</span><br><span class="line">read n</span><br><span class="line">echo -n &quot;RESULT: &quot;</span><br><span class="line">if [ `expr $n % 2` == 0 ]</span><br><span class="line">then</span><br><span class="line"> echo &quot;$n is even&quot;</span><br><span class="line">else</span><br><span class="line"> echo &quot;$n is Odd&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h4 id="å·çš„ä½¿ç”¨-1">2."%"å·çš„ä½¿ç”¨</h4><p><code>$&#123;string%substring&#125;</code> Deletes shortest match of<code>$substring</code> from back of <code>$string</code>.<code>string%%substring&#125;</code> Deletes longest match of<code>$substring</code> from back of <code>$string</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">stringZ=abcABC123ABCabc</span><br><span class="line">#                    ||     shortest</span><br><span class="line">#        |------------|     longest</span><br><span class="line"></span><br><span class="line">echo $&#123;stringZ%b*c&#125;      # abcABC123ABCa</span><br><span class="line"># Strip out shortest match between &#x27;b&#x27; and &#x27;c&#x27;, from back of $stringZ.</span><br><span class="line"></span><br><span class="line">echo $&#123;stringZ%%b*c&#125;     # a</span><br><span class="line"># Strip out longest match between &#x27;b&#x27; and &#x27;c&#x27;, from back of $stringZ.</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤ä¸­é—´åŒ¹é…çš„å­—ç¬¦ä¸²">3.åˆ é™¤ä¸­é—´åŒ¹é…çš„å­—ç¬¦ä¸²</h4><p>è¿™ç§éœ€æ±‚å¯ä»¥ä½¿ç”¨æ›¿æ¢æ¥å®Œæˆ æ›¿æ¢</p><table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr><th>pattern</th><th>explain</th></tr></thead><tbody><tr><td><code>$&#123;string/substring/replacement&#125;</code></td><td>ä½¿ç”¨<code>$replacement</code>,æ¥ä»£æ›¿ç¬¬ä¸€ä¸ªåŒ¹é…çš„<code>$substring</code></td></tr><tr><td><code>$&#123;string//substring/replacement&#125;</code></td><td>ä½¿ç”¨<code>$replacement</code>,ä»£æ›¿æ‰€æœ‰åŒ¹é…çš„<code>$substring</code></td></tr><tr><td><code>$&#123;string/#substring/replacement&#125;</code></td><td>å¦‚æœ<code>$string</code>çš„å‰ç¼€åŒ¹é…<code>$substring</code>,é‚£ä¹ˆå°±ç”¨<code>$replacement</code>æ¥ä»£æ›¿åŒ¹é…åˆ°çš„<code>$substring</code></td></tr><tr><td><code>$&#123;string/%substring/replacement&#125;</code></td><td>å¦‚æœ<code>$string</code>çš„åç¼€åŒ¹é…<code>$substring</code>,é‚£ä¹ˆå°±ç”¨<code>$replacement</code>æ¥ä»£æ›¿åŒ¹é…åˆ°çš„<code>$substring</code></td></tr></tbody></table><h3 id="sed">sed</h3><p><a href="https://www.cnblogs.com/zhangzongjian/p/10708222.html"class="uri">https://www.cnblogs.com/zhangzongjian/p/10708222.html</a></p><h4id="å…ˆæ£€ç´¢æŒ‡å®šä½ç½®ç„¶åæ›¿æ¢éå…¨å±€æ›¿æ¢">å…ˆæ£€ç´¢æŒ‡å®šä½ç½®ï¼Œç„¶åæ›¿æ¢ï¼ˆéå…¨å±€æ›¿æ¢ï¼‰</h4><p><ahref="https://www.golinuxhub.com/2017/09/sed-perform-search-and-replace-only-on/"class="uri">https://www.golinuxhub.com/2017/09/sed-perform-search-and-replace-only-on/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; cat /tmp/file</span><br><span class="line">four five six</span><br><span class="line">one</span><br><span class="line">seve eight nine</span><br><span class="line">one two three</span><br><span class="line">one</span><br><span class="line">ten eleven twelve</span><br><span class="line">one</span><br><span class="line"></span><br><span class="line">&gt;&gt; sed -e &#x27;/two/s/one/replaced/g&#x27; /tmp/file</span><br><span class="line">four five six</span><br><span class="line">one</span><br><span class="line">seve eight nine</span><br><span class="line">replaced two three</span><br><span class="line">one</span><br><span class="line">ten eleven twelve</span><br><span class="line">one</span><br></pre></td></tr></table></figure><p>sed -e â€™command-1' -e 'command-2' -e 'command-3' file.txt sed -eç”¨æ¥æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œï¼Œä¾‹å¦‚å¤šä¸ªæ›¿æ¢ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e &#x27;/seve/s/nine/replaced/g&#x27; -e &#x27;/two/s/one/replaced/g&#x27; /tmp/file</span><br></pre></td></tr></table></figure><p>sed -i -e xxxx åœ¨æ‰§è¡Œå¤šä¸ªçš„åŒæ—¶<strong>æœ¬åœ°æ›¿æ¢</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i -e &quot;/validation_data_path/s#recpro#yuanwenwu3#g&quot; -e &quot;/output_path/s#recpro#yuanwenwu3#g&quot; -e &quot;/summary_path/s#recpro#yuanwenwu3#g&quot; $&#123;conf_path&#125;</span><br><span class="line">sed -i -e &quot;/conf_file/s#conf_file=.*#conf_file=&#x27;$&#123;conf&#125;&#x27;#g&quot; -e &quot;s#&#x27;node&#x27;:.*,#&#x27;node&#x27;:&#x27;$&#123;node&#125;&#x27;,#g&quot; tfconf.py</span><br></pre></td></tr></table></figure><h4 id="åŒ¹é…å¹¶é€‰æ‹©éƒ¨åˆ†æ›¿æ¢">åŒ¹é…å¹¶é€‰æ‹©éƒ¨åˆ†æ›¿æ¢</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;s#\(statPath=\).*#\1$&#123;statPath&#125;#g&quot; $&#123;conf_dir&#125;/stat.conf</span><br><span class="line">sed -i &quot;s#\(output=\).*#\1$&#123;output&#125;#g;s#\(statPath=\).*#\1$&#123;statPath&#125;#g&quot; $&#123;conf_dir&#125;/train.conf</span><br><span class="line">#sed -i &quot;s#\(output=\).*#\1$&#123;output&#125;#g;s#\(statPath=\).*#\1$&#123;statPath&#125;#g;&quot; $&#123;conf_dir&#125;/train_id2i</span><br></pre></td></tr></table></figure><h4 id="å¸¦å˜é‡çš„æ›¿æ¢">å¸¦å˜é‡çš„æ›¿æ¢</h4><p>å¦‚æœæœ‰<strong>shellå˜é‡</strong>ï¼Œåˆ™éœ€è¦ä½¿ç”¨<strong>åŒå¼•å·</strong>å³å¯,å¦‚æœä½¿ç”¨å•å¼•å·åˆ™ä¸ä¼šæ›¿æ¢shellå˜é‡ï¼Œè€Œå°†<code>$&#123;var&#125;</code>è§†ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var=&quot;hello&quot;</span><br><span class="line">sed -n &quot;s/$[var&#125;/word/g&quot; xxx.dat</span><br><span class="line">#sed -n &#x27;s/$&#123;var&#125;/wor/g&#x27; xxx.dat ä¸ä¼šå¾—åˆ°é¢„æœŸç»“æœ</span><br></pre></td></tr></table></figure><h4 id="ä¸€èˆ¬ç”¨æ³•">ä¸€èˆ¬ç”¨æ³•</h4><p>å‚è€ƒ: <a href="http://bbs.linuxtone.org/thread-1731-1-1.html"class="uri">http://bbs.linuxtone.org/thread-1731-1-1.html</a></p><ol type="1"><li>å½“å‰è¡Œè¿›è¡Œæ›¿æ¢:<code>s/XXX/YYY/g</code>XXXæ˜¯éœ€è¦æ›¿æ¢çš„å­—ç¬¦ä¸²,YYYæ˜¯æ›¿æ¢åçš„å­—ç¬¦ä¸²ã€‚</li><li>å…¨å±€æ›¿æ¢:<code>% s/XXX/YYY/g</code>.</li><li>å¯¹æŒ‡å®šéƒ¨åˆ†è¿›è¡Œæ›¿æ¢ç”¨Vè¿›å…¥visualæ¨¡å¼,å†è¿›è¡Œ:<code>s/XXX/YYY/g</code>.<font color="green">ps(å‘½ä»¤æ¨¡å¼ï¼Œæ˜¾ç¤ºçš„<code>:'&lt;,'&gt;</code>çš„æ˜¯åŒºåŸŸé€‰æ‹©çš„æ„æ€ï¼Œä¸è¦åˆ é™¤ï¼Œç´§æ¥ç€åœ¨åé¢ç”¨<code>s/xxx/yyy/g</code>å³å¯)</font></li></ol><p>æ¯”å¦‚ï¼Œè¦å°†ç›®å½•/modulesä¸‹é¢æ‰€æœ‰æ–‡ä»¶ä¸­çš„zhangsanéƒ½ä¿®æ”¹æˆlisiï¼Œè¿™æ ·åšï¼šsed -i "s/zhangsan/lisi/g" <code>grep zhangsan -rl /modules</code></p><p>è§£é‡Šä¸€ä¸‹ï¼š</p><p>-i è¡¨ç¤ºinplace editï¼Œå°±åœ°ä¿®æ”¹æ–‡ä»¶ -r è¡¨ç¤ºæœç´¢å­ç›®å½• -lè¡¨ç¤ºè¾“å‡ºåŒ¹é…çš„æ–‡ä»¶å</p><p>è¿™ä¸ªå‘½ä»¤ç»„åˆå¾ˆå¼ºå¤§ï¼Œè¦æ³¨æ„å¤‡ä»½æ–‡ä»¶ã€‚</p><ol type="1"><li>å­—å…¸æ˜ å°„</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;y/1234567890/ABCDEFGHIJ/&#x27; test_sed</span><br><span class="line">sed &#x27;y/1234567890/ABCDEFGHIJ/&#x27; filename</span><br></pre></td></tr></table></figure><p>ABCDEFGHIJ BCDEFGHIJA CDEFGHIJAB DEFGHIJABCæ³¨æ„å˜æ¢å…³ç³»æ˜¯æŒ‰ä¸¤ä¸ªlistçš„ä½ç½®å¯¹åº”å˜æ¢ å…¶ä¸­ï¼štest_sedçš„å†…å®¹æ˜¯ï¼š1234567890 2345678901 3456789012 4567890123 2. æ›¿æ¢æ¯è¡Œæ‰€æœ‰åŒ¹é…<code>sed 's/01/Ab/g' test_sed</code> 1234567890 23456789Ab 3456789Ab2456789Ab23 æ³¨æ„ï¼šç¬¬ä¸€è¡Œçš„0ï¼Œ1æ²¡æœ‰åˆ†åˆ«æ›¿æ¢ä¸ºA,b</p><h4 id="åˆ é™¤då‘½ä»¤">åˆ é™¤ï¼šdå‘½ä»¤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;2d&#x27; example          #åˆ é™¤exampleæ–‡ä»¶çš„ç¬¬äºŒè¡Œã€‚</span><br><span class="line">sed &#x27;2,$d&#x27; example        #åˆ é™¤exampleæ–‡ä»¶çš„ç¬¬äºŒè¡Œåˆ°æœ«å°¾æ‰€æœ‰è¡Œã€‚</span><br><span class="line">sed &#x27;$d&#x27; example          #åˆ é™¤exampleæ–‡ä»¶çš„æœ€åä¸€è¡Œã€‚</span><br><span class="line">sed &#x27;/test/&#x27;d example     #åŒ¹é…&#x27;test&#x27;å¹¶åˆ é™¤ </span><br></pre></td></tr></table></figure><p>example-----åˆ é™¤exampleæ–‡ä»¶æ‰€æœ‰åŒ…å«testçš„è¡Œã€‚</p><p>æ›¿æ¢ï¼šså‘½ä»¤<code>$ sed 's/test/mytest/g' example</code>-----åœ¨æ•´è¡ŒèŒƒå›´å†…æŠŠtestæ›¿æ¢ä¸ºmytestã€‚å¦‚æœæ²¡æœ‰gæ ‡è®°ï¼Œåˆ™åªæœ‰æ¯è¡Œç¬¬ä¸€ä¸ªåŒ¹é…çš„testè¢«æ›¿æ¢æˆmytestã€‚<code>$ sed -n 's/^test/mytest/p' example</code>-----(-n)é€‰é¡¹å’Œpæ ‡å¿—ä¸€èµ·ä½¿ç”¨è¡¨ç¤ºåªæ‰“å°é‚£äº›å‘ç”Ÿæ›¿æ¢çš„è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸä¸€è¡Œå¼€å¤´çš„testè¢«æ›¿æ¢æˆmytestï¼Œå°±æ‰“å°å®ƒã€‚<code>$ sed 's/^192.168.0.1/&amp;localhost/'example</code>-----&amp;ç¬¦å·è¡¨ç¤ºæ›¿æ¢æ¢å­—ç¬¦ä¸²ä¸­è¢«æ‰¾åˆ°çš„éƒ¨ä»½ã€‚æ‰€æœ‰ä»¥192.168.0.1å¼€å¤´çš„è¡Œéƒ½ä¼šè¢«æ›¿æ¢æˆå®ƒè‡ªå·²åŠ localhostï¼Œå˜æˆ192.168.0.1localhostã€‚<code>$ sed -n 's/\(love\)able/\1rs/p' example</code>-----loveè¢«æ ‡è®°ä¸º1ï¼Œæ‰€æœ‰loveableä¼šè¢«æ›¿æ¢æˆloversï¼Œè€Œä¸”æ›¿æ¢çš„è¡Œä¼šè¢«æ‰“å°å‡ºæ¥ã€‚<code>$ sed 's#10#100#g' example</code>-----ä¸è®ºä»€ä¹ˆå­—ç¬¦ï¼Œç´§è·Ÿç€så‘½ä»¤çš„éƒ½è¢«è®¤ä¸ºæ˜¯æ–°çš„åˆ†éš”ç¬¦ï¼Œæ‰€ä»¥ï¼Œâ€œ#â€åœ¨è¿™é‡Œæ˜¯åˆ†éš”ç¬¦ï¼Œä»£æ›¿äº†é»˜è®¤çš„â€œ/â€åˆ†éš”ç¬¦ã€‚è¡¨ç¤ºæŠŠæ‰€æœ‰10æ›¿æ¢æˆ100ã€‚</p><p>é€‰å®šè¡Œçš„èŒƒå›´ï¼šé€—å·<code>$ sed -n '/test/,/check/p' example</code>-----æ‰€æœ‰åœ¨æ¨¡æ¿testå’Œcheckæ‰€ç¡®å®šçš„èŒƒå›´å†…çš„è¡Œéƒ½è¢«æ‰“å°ã€‚<code>$ sed -n '5,/^test/p' example</code>-----æ‰“å°ä»ç¬¬äº”è¡Œå¼€å§‹åˆ°ç¬¬ä¸€ä¸ªåŒ…å«ä»¥testå¼€å§‹çš„è¡Œä¹‹é—´çš„æ‰€æœ‰è¡Œã€‚<code>$ sed '/test/,/check/s/$/sed test/' example</code>-----å¯¹äºæ¨¡æ¿testå’Œwestä¹‹é—´çš„è¡Œï¼Œæ¯è¡Œçš„æœ«å°¾ç”¨å­—ç¬¦ä¸²sedtestæ›¿æ¢ã€‚</p><p>å¤šç‚¹ç¼–è¾‘ï¼šeå‘½ä»¤<br /><code>$ sed -e '1,5d' -e 's/test/check/'example</code>-----(-e)é€‰é¡¹å…è®¸åœ¨åŒä¸€è¡Œé‡Œæ‰§è¡Œå¤šæ¡å‘½ä»¤ã€‚å¦‚ä¾‹å­æ‰€ç¤ºï¼Œç¬¬ä¸€æ¡å‘½ä»¤åˆ é™¤1è‡³5è¡Œï¼Œç¬¬äºŒæ¡å‘½ä»¤ç”¨checkæ›¿æ¢testã€‚å‘½ä»¤çš„æ‰§è¡Œé¡ºåºå¯¹ç»“æœæœ‰å½±å“ã€‚å¦‚æœä¸¤ä¸ªå‘½ä»¤éƒ½æ˜¯æ›¿æ¢å‘½ä»¤ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ›¿æ¢å‘½ä»¤å°†å½±å“ç¬¬äºŒä¸ªæ›¿æ¢å‘½ä»¤çš„ç»“æœã€‚<code>$ sed --expression='s/test/check/' --expression='/love/d' example</code>-----ä¸€ä¸ªæ¯”-eæ›´å¥½çš„å‘½ä»¤æ˜¯--expressionã€‚å®ƒèƒ½ç»™sedè¡¨è¾¾å¼èµ‹å€¼ã€‚</p><p>ä»æ–‡ä»¶è¯»å…¥ï¼šrå‘½ä»¤<br /><code>$ sed '/test/r file' example</code>-----fileé‡Œçš„å†…å®¹è¢«è¯»è¿›æ¥ï¼Œæ˜¾ç¤ºåœ¨ä¸teståŒ¹é…çš„è¡Œåé¢ï¼Œå¦‚æœåŒ¹é…å¤šè¡Œï¼Œåˆ™fileçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨æ‰€æœ‰åŒ¹é…è¡Œçš„ä¸‹é¢ã€‚</p><p>å†™å…¥æ–‡ä»¶ï¼šwå‘½ä»¤<br /><code>$ sed -n '/test/w file' example</code>-----åœ¨exampleä¸­æ‰€æœ‰åŒ…å«testçš„è¡Œéƒ½è¢«å†™å…¥fileé‡Œã€‚</p><p>è¿½åŠ å‘½ä»¤ï¼šaå‘½ä»¤<br /><code>$ sed '/^test/a\\---&gt;this is a example' example</code>&lt;-----'thisis aexample'è¢«è¿½åŠ åˆ°ä»¥testå¼€å¤´çš„è¡Œåé¢ï¼Œsedè¦æ±‚å‘½ä»¤aåé¢æœ‰ä¸€ä¸ªåæ–œæ ã€‚</p><p>æ’å…¥ï¼šiå‘½ä»¤<code>$ sed '/test/i\\ new line -------------------------' example</code>å¦‚æœtestè¢«åŒ¹é…ï¼Œåˆ™æŠŠåæ–œæ åé¢çš„æ–‡æœ¬æ’å…¥åˆ°åŒ¹é…è¡Œçš„å‰é¢ã€‚ä¸‹ä¸€ä¸ªï¼šnå‘½ä»¤<br /><code>$ sed '/test/&#123; n; s/aa/bb/; &#125;' example</code>-----å¦‚æœtestè¢«åŒ¹é…ï¼Œåˆ™ç§»åŠ¨åˆ°åŒ¹é…è¡Œçš„ä¸‹ä¸€è¡Œï¼Œæ›¿æ¢è¿™ä¸€è¡Œçš„aaï¼Œå˜ä¸ºbbï¼Œå¹¶æ‰“å°è¯¥è¡Œï¼Œç„¶åç»§ç»­ã€‚</p><p>å˜å½¢ï¼šyå‘½ä»¤<br /><code>$ sed '1,10y/abcde/ABCDE/' example</code>-----æŠŠ1--10è¡Œå†…æ‰€æœ‰abcdeè½¬å˜ä¸ºå¤§å†™ï¼Œæ³¨æ„ï¼Œæ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦ä¸èƒ½ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ã€‚</p><p>é€€å‡ºï¼šqå‘½ä»¤<br /><code>$ sed '10q' example</code>-----æ‰“å°å®Œç¬¬10è¡Œåï¼Œé€€å‡ºsedã€‚</p><p>ä¿æŒå’Œè·å–ï¼šhå‘½ä»¤å’ŒGå‘½ä»¤<br /><code>$ sed -e '/test/h' -e</code>example-----åœ¨sedå¤„ç†æ–‡ä»¶çš„æ—¶å€™ï¼Œæ¯ä¸€è¡Œéƒ½è¢«ä¿å­˜åœ¨ä¸€ä¸ªå«æ¨¡å¼ç©ºé—´çš„ä¸´æ—¶ç¼“å†²åŒºä¸­ï¼Œé™¤éè¡Œè¢«åˆ é™¤æˆ–è€…è¾“å‡ºè¢«å–æ¶ˆï¼Œå¦åˆ™æ‰€æœ‰è¢«å¤„ç†çš„è¡Œéƒ½å°†æ‰“å°åœ¨å±å¹•ä¸Šã€‚æ¥ç€æ¨¡å¼ç©ºé—´è¢«æ¸…ç©ºï¼Œå¹¶å­˜å…¥æ–°çš„ä¸€è¡Œç­‰å¾…å¤„ç†ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼ŒåŒ¹é…testçš„è¡Œè¢«æ‰¾åˆ°åï¼Œå°†å­˜å…¥æ¨¡å¼ç©ºé—´ï¼Œhå‘½ä»¤å°†å…¶å¤åˆ¶å¹¶å­˜å…¥ä¸€ä¸ªç§°ä¸ºä¿æŒç¼“å­˜åŒºçš„ç‰¹æ®Šç¼“å†²åŒºå†…ã€‚ç¬¬äºŒæ¡è¯­å¥çš„æ„æ€æ˜¯ï¼Œå½“åˆ°è¾¾æœ€åä¸€è¡Œåï¼ŒGå‘½ä»¤å–å‡ºä¿æŒç¼“å†²åŒºçš„è¡Œï¼Œç„¶åæŠŠå®ƒæ”¾å›æ¨¡å¼ç©ºé—´ä¸­ï¼Œä¸”è¿½åŠ åˆ°ç°åœ¨å·²ç»å­˜åœ¨äºæ¨¡å¼ç©ºé—´ä¸­çš„è¡Œçš„æœ«å°¾ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­å°±æ˜¯è¿½åŠ åˆ°æœ€åä¸€è¡Œã€‚ç®€å•æ¥è¯´ï¼Œä»»ä½•åŒ…å«testçš„è¡Œéƒ½è¢«å¤åˆ¶å¹¶è¿½åŠ åˆ°è¯¥æ–‡ä»¶çš„æœ«å°¾ã€‚</p><p>ä¿æŒå’Œäº’æ¢ï¼šhå‘½ä»¤å’Œxå‘½ä»¤<br /><code>$ sed -e '/test/h' -e '/check/x' example</code>-----äº’æ¢æ¨¡å¼ç©ºé—´å’Œä¿æŒç¼“å†²åŒºçš„å†…å®¹ã€‚ä¹Ÿå°±æ˜¯æŠŠåŒ…å«testä¸checkçš„è¡Œäº’æ¢ã€‚</p><p>7.è„šæœ¬</p><p>Sedè„šæœ¬æ˜¯ä¸€ä¸ªsedçš„å‘½ä»¤æ¸…å•ï¼Œå¯åŠ¨Sedæ—¶ä»¥-fé€‰é¡¹å¼•å¯¼è„šæœ¬æ–‡ä»¶åã€‚Sedå¯¹äºè„šæœ¬ä¸­è¾“å…¥çš„å‘½ä»¤éå¸¸æŒ‘å‰”ï¼Œåœ¨å‘½ä»¤çš„æœ«å°¾ä¸èƒ½æœ‰ä»»ä½•ç©ºç™½æˆ–æ–‡æœ¬ï¼Œå¦‚æœåœ¨ä¸€è¡Œä¸­æœ‰å¤šä¸ªå‘½ä»¤ï¼Œè¦ç”¨åˆ†å·åˆ†éš”ã€‚ä»¥#å¼€å¤´çš„è¡Œä¸ºæ³¨é‡Šè¡Œï¼Œä¸”ä¸èƒ½è·¨è¡Œã€‚</p><p>8.å°æŠ€å·§åœ¨sedçš„å‘½ä»¤è¡Œä¸­å¼•ç”¨shellå˜é‡æ—¶è¦ä½¿ç”¨åŒå¼•å·ï¼Œè€Œä¸æ˜¯é€šå¸¸æ‰€ç”¨çš„å•å¼•å·ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ ¹æ®nameå˜é‡çš„å†…å®¹æ¥åˆ é™¤named.confæ–‡ä»¶ä¸­zoneæ®µçš„è„šæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=&#x27;zone\ &quot;localhost&quot;&#x27;</span><br><span class="line">sed &quot;/$name/,/&#125;;/d&quot; named.conf</span><br><span class="line">sed -i &quot;s/oldstring/newstring/g&quot; `grep oldstring -rl yourdir`</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼šæ›¿æ¢/homeä¸‹æ‰€æœ‰æ–‡ä»¶ä¸­çš„www.itbbs.cnä¸ºchinafar.com</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;s/www.itbbs.cn/chinafar.com/g&quot; `grep www.itbbs.cn -rl /home` </span><br></pre></td></tr></table></figure><h2 id="vim-vi">vim &amp; vi</h2><h3 id="è‡ªå·±ä½¿ç”¨çš„ç®€å•é…ç½®template">è‡ªå·±ä½¿ç”¨çš„ç®€å•é…ç½®template</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># ~/.vimrc</span><br><span class="line">hi CursorLine   cterm=NONE ctermbg=lightgray ctermfg=white guibg=lightgray guifg=white</span><br><span class="line">hi CursorLine term=bold cterm=bold ctermbg=237</span><br><span class="line">hi CursorColumn   cterm=NONE ctermbg=lightgray ctermfg=white guibg=lightgray guifg=white</span><br><span class="line">hi CursorColumn term=bold cterm=bold ctermbg=237</span><br><span class="line"></span><br><span class="line">set ts=4</span><br><span class="line">set expandtab</span><br><span class="line"></span><br><span class="line">set smartindent</span><br><span class="line">set tabstop=4</span><br><span class="line">set shiftwidth=4</span><br><span class="line">set expandtab</span><br><span class="line">set softtabstop=4</span><br><span class="line"></span><br><span class="line"># https://www.dyxmq.cn/linux/vim-setting-mouse-place.html</span><br><span class="line"># è®¾ç½®vimæ‰“å¼€ä¸Šæ¬¡ç¼–è¾‘åœ°æ–¹</span><br><span class="line">au BufReadPost * if line(&quot;&#x27;\&quot;&quot;) &gt; 0 | if line(&quot;&#x27;\&quot;&quot;) &lt;= line(&quot;$&quot;) | exe(&quot;norm &#x27;\&quot;&quot;) | else |exe &quot;norm $&quot;| endif | endif</span><br></pre></td></tr></table></figure><h3 id="å¤šåŠŸèƒ½templete">å¤šåŠŸèƒ½templete</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br></pre></td><td class="code"><pre><span class="line">&quot;=========================================================================</span><br><span class="line">&quot; DesCRiption: é€‚åˆè‡ªå·±ä½¿ç”¨çš„vimrcæ–‡ä»¶ï¼Œfor Linux/Windows, GUI/Console</span><br><span class="line">&quot;</span><br><span class="line">&quot; Last Change: 2010å¹´08æœˆ02æ—¥ 15æ—¶13åˆ†</span><br><span class="line">&quot;</span><br><span class="line">&quot; Version:     1.80</span><br><span class="line">&quot;</span><br><span class="line">&quot;=========================================================================</span><br><span class="line"></span><br><span class="line">set nocompatible            &quot; å…³é—­ vi å…¼å®¹æ¨¡å¼</span><br><span class="line">syntax on                   &quot; è‡ªåŠ¨è¯­æ³•é«˜äº®</span><br><span class="line">&quot;colorscheme molokai         &quot; è®¾å®šé…è‰²æ–¹æ¡ˆ</span><br><span class="line">set number                  &quot; æ˜¾ç¤ºè¡Œå·</span><br><span class="line">set noswapfile                          &quot; ä¸äº§ç”Ÿ.swap, .swoæ–‡ä»¶</span><br><span class="line">&quot;set cursorline              &quot; çªå‡ºæ˜¾ç¤ºå½“å‰è¡Œ</span><br><span class="line">set ruler                   &quot; æ‰“å¼€çŠ¶æ€æ æ ‡å°º</span><br><span class="line">set shiftwidth=4            &quot; è®¾å®š &lt;&lt; å’Œ &gt;&gt; å‘½ä»¤ç§»åŠ¨æ—¶çš„å®½åº¦ä¸º 4</span><br><span class="line">set softtabstop=4           &quot; ä½¿å¾—æŒ‰é€€æ ¼é”®æ—¶å¯ä»¥ä¸€æ¬¡åˆ æ‰ 4 ä¸ªç©ºæ ¼</span><br><span class="line">set tabstop=4               &quot; è®¾å®š tab é•¿åº¦ä¸º 4</span><br><span class="line">set nobackup                &quot; è¦†ç›–æ–‡ä»¶æ—¶ä¸å¤‡ä»½</span><br><span class="line">&quot;set autochdir               &quot; è‡ªåŠ¨åˆ‡æ¢å½“å‰ç›®å½•ä¸ºå½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</span><br><span class="line">filetype plugin indent on   &quot; å¼€å¯æ’ä»¶</span><br><span class="line">set backupcopy=yes          &quot; è®¾ç½®å¤‡ä»½æ—¶çš„è¡Œä¸ºä¸ºè¦†ç›–</span><br><span class="line">set ignorecase smartcase    &quot; æœç´¢æ—¶å¿½ç•¥å¤§å°å†™ï¼Œä½†åœ¨æœ‰ä¸€ä¸ªæˆ–ä»¥ä¸Šå¤§å†™å­—æ¯æ—¶ä»ä¿æŒå¯¹å¤§å°å†™æ•æ„Ÿ</span><br><span class="line">&quot;set nowrapscan              &quot; ç¦æ­¢åœ¨æœç´¢åˆ°æ–‡ä»¶ä¸¤ç«¯æ—¶é‡æ–°æœç´¢</span><br><span class="line">set incsearch               &quot; è¾“å…¥æœç´¢å†…å®¹æ—¶å°±æ˜¾ç¤ºæœç´¢ç»“æœ</span><br><span class="line">set hlsearch                &quot; æœç´¢æ—¶é«˜äº®æ˜¾ç¤ºè¢«æ‰¾åˆ°çš„æ–‡æœ¬</span><br><span class="line">set noerrorbells            &quot; å…³é—­é”™è¯¯ä¿¡æ¯å“é“ƒ</span><br><span class="line">set novisualbell            &quot; å…³é—­ä½¿ç”¨å¯è§†å“é“ƒä»£æ›¿å‘¼å«</span><br><span class="line">set t_vb=                   &quot; ç½®ç©ºé”™è¯¯é“ƒå£°çš„ç»ˆç«¯ä»£ç </span><br><span class="line">&quot; set showmatch               &quot; æ’å…¥æ‹¬å·æ—¶ï¼ŒçŸ­æš‚åœ°è·³è½¬åˆ°åŒ¹é…çš„å¯¹åº”æ‹¬å·</span><br><span class="line">&quot; set matchtime=2             &quot; çŸ­æš‚è·³è½¬åˆ°åŒ¹é…æ‹¬å·çš„æ—¶é—´</span><br><span class="line">set magic                   &quot; è®¾ç½®é­”æœ¯</span><br><span class="line">set hidden                  &quot; å…è®¸åœ¨æœ‰æœªä¿å­˜çš„ä¿®æ”¹æ—¶åˆ‡æ¢ç¼“å†²åŒºï¼Œæ­¤æ—¶çš„ä¿®æ”¹ç”± vim è´Ÿè´£ä¿å­˜</span><br><span class="line">set guioptions-=T           &quot; éšè—å·¥å…·æ </span><br><span class="line">set guioptions-=m           &quot; éšè—èœå•æ </span><br><span class="line">set smartindent             &quot; å¼€å¯æ–°è¡Œæ—¶ä½¿ç”¨æ™ºèƒ½è‡ªåŠ¨ç¼©è¿›</span><br><span class="line">set backspace=indent,eol,start</span><br><span class="line">                            &quot; ä¸è®¾å®šåœ¨æ’å…¥çŠ¶æ€æ— æ³•ç”¨é€€æ ¼é”®å’Œ Delete é”®åˆ é™¤å›è½¦ç¬¦</span><br><span class="line">set cmdheight=1             &quot; è®¾å®šå‘½ä»¤è¡Œçš„è¡Œæ•°ä¸º 1</span><br><span class="line">set laststatus=2            &quot; æ˜¾ç¤ºçŠ¶æ€æ  (é»˜è®¤å€¼ä¸º 1, æ— æ³•æ˜¾ç¤ºçŠ¶æ€æ )</span><br><span class="line">set statusline=\ %&lt;%F[%1*%M%*%n%R%H]%=\ %y\ %0(%&#123;&amp;fileformat&#125;\ %&#123;&amp;encoding&#125;\ %c:%l/%L%)\</span><br><span class="line">                            &quot; è®¾ç½®åœ¨çŠ¶æ€è¡Œæ˜¾ç¤ºçš„ä¿¡æ¯</span><br><span class="line">&quot;set foldenable              &quot; å¼€å§‹æŠ˜å </span><br><span class="line">&quot;set foldmethod=syntax       &quot; è®¾ç½®è¯­æ³•æŠ˜å </span><br><span class="line">&quot;set foldcolumn=0            &quot; è®¾ç½®æŠ˜å åŒºåŸŸçš„å®½åº¦</span><br><span class="line">&quot;setlocal foldlevel=0        &quot; è®¾ç½®æŠ˜å å±‚æ•°ä¸º</span><br><span class="line">&quot;set foldclose=all           &quot; è®¾ç½®ä¸ºè‡ªåŠ¨å…³é—­æŠ˜å </span><br><span class="line">&quot; nnoremap &lt;space&gt; @=((foldclosed(line(&#x27;.&#x27;)) &lt; 0) ? &#x27;zc&#x27; : &#x27;zo&#x27;)&lt;CR&gt;</span><br><span class="line">                            &quot; ç”¨ç©ºæ ¼é”®æ¥å¼€å…³æŠ˜å </span><br><span class="line">au BufReadPost * if line(&quot;&#x27;\&quot;&quot;) &gt; 0 | if line(&quot;&#x27;\&quot;&quot;) &lt;= line(&quot;$&quot;) | exe(&quot;norm &#x27;\&quot;&quot;) | else |exe &quot;norm $&quot;| endif | endif</span><br><span class="line">hi CursorLine   cterm=NONE ctermbg=lightgray ctermfg=white guibg=lightgray guifg=white</span><br><span class="line">hi CursorLine term=bold cterm=bold ctermbg=237</span><br><span class="line">hi CursorColumn   cterm=NONE ctermbg=lightgray ctermfg=white guibg=lightgray guifg=white</span><br><span class="line">hi CursorColumn term=bold cterm=bold ctermbg=237</span><br><span class="line"></span><br><span class="line">&quot; return OS type, eg: windows, or linux, mac, et.st..</span><br><span class="line">function! MySys()</span><br><span class="line">    if has(&quot;win16&quot;) || has(&quot;win32&quot;) || has(&quot;win64&quot;) || has(&quot;win95&quot;)</span><br><span class="line">        return &quot;windows&quot;</span><br><span class="line">    elseif has(&quot;unix&quot;)</span><br><span class="line">        return &quot;linux&quot;</span><br><span class="line">    endif</span><br><span class="line">endfunction</span><br><span class="line"></span><br><span class="line">&quot; ç”¨æˆ·ç›®å½•å˜é‡$VIMFILES</span><br><span class="line">if MySys() == &quot;windows&quot;</span><br><span class="line">    let $VIMFILES = $VIM.&#x27;/vimfiles&#x27;</span><br><span class="line">elseif MySys() == &quot;linux&quot;</span><br><span class="line">    let $VIMFILES = $HOME.&#x27;/.vim&#x27;</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">&quot; è®¾å®šdocæ–‡æ¡£ç›®å½•</span><br><span class="line">let helptags=$VIMFILES.&#x27;/doc&#x27;</span><br><span class="line"></span><br><span class="line">&quot; è®¾ç½®å­—ä½“ ä»¥åŠä¸­æ–‡æ”¯æŒ</span><br><span class="line">if has(&quot;win32&quot;)</span><br><span class="line">    set guifont=Inconsolata:h12:cANSI</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">&quot; é…ç½®å¤šè¯­è¨€ç¯å¢ƒ</span><br><span class="line">if has(&quot;multi_byte&quot;)</span><br><span class="line">    &quot; UTF-8 ç¼–ç </span><br><span class="line">    set encoding=utf-8</span><br><span class="line">    set termencoding=utf-8</span><br><span class="line">    set formatoptions+=mM</span><br><span class="line">    set fencs=utf-8,gbk</span><br><span class="line"></span><br><span class="line">    if v:lang =~? &#x27;^\(zh\)\|\(ja\)\|\(ko\)&#x27;</span><br><span class="line">        set ambiwidth=double</span><br><span class="line">    endif</span><br><span class="line"></span><br><span class="line">    if has(&quot;win32&quot;)</span><br><span class="line">        source $VIMRUNTIME/delmenu.vim</span><br><span class="line">        source $VIMRUNTIME/menu.vim</span><br><span class="line">        language messages zh_CN.utf-8</span><br><span class="line">    endif</span><br><span class="line">else</span><br><span class="line">    echoerr &quot;Sorry, this version of (g)vim was not compiled with +multi_byte&quot;</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">&quot; Buffersæ“ä½œå¿«æ·æ–¹å¼!</span><br><span class="line">nnoremap &lt;C-RETURN&gt; :bnext&lt;CR&gt;</span><br><span class="line">nnoremap &lt;C-S-RETURN&gt; :bprevious&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">&quot; Tabæ“ä½œå¿«æ·æ–¹å¼!</span><br><span class="line">nnoremap &lt;C-TAB&gt; :tabnext&lt;CR&gt;</span><br><span class="line">nnoremap &lt;C-S-TAB&gt; :tabprev&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">&quot;å…³äºtabçš„å¿«æ·é”®</span><br><span class="line">&quot; map tn :tabnext&lt;cr&gt;</span><br><span class="line">&quot; map tp :tabprevious&lt;cr&gt;</span><br><span class="line">&quot; map td :tabnew .&lt;cr&gt;</span><br><span class="line">&quot; map te :tabedit</span><br><span class="line">&quot; map tc :tabclose&lt;cr&gt;</span><br><span class="line"></span><br><span class="line">&quot;çª—å£åˆ†å‰²æ—¶,è¿›è¡Œåˆ‡æ¢çš„æŒ‰é”®çƒ­é”®éœ€è¦è¿æ¥ä¸¤æ¬¡,æ¯”å¦‚ä»ä¸‹æ–¹çª—å£ç§»åŠ¨</span><br><span class="line">&quot;å…‰æ ‡åˆ°ä¸Šæ–¹çª—å£,éœ€è¦&lt;c-w&gt;&lt;c-w&gt;k,éå¸¸éº»çƒ¦,ç°åœ¨é‡æ˜ å°„ä¸º&lt;c-k&gt;,åˆ‡æ¢çš„</span><br><span class="line">&quot;æ—¶å€™ä¼šå˜å¾—éå¸¸æ–¹ä¾¿.</span><br><span class="line">nnoremap &lt;C-h&gt; &lt;C-w&gt;h</span><br><span class="line">nnoremap &lt;C-j&gt; &lt;C-w&gt;j</span><br><span class="line">nnoremap &lt;C-k&gt; &lt;C-w&gt;k</span><br><span class="line">nnoremap &lt;C-l&gt; &lt;C-w&gt;l</span><br><span class="line"></span><br><span class="line">&quot;ä¸€äº›ä¸é”™çš„æ˜ å°„è½¬æ¢è¯­æ³•ï¼ˆå¦‚æœåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æ··åˆäº†ä¸åŒè¯­è¨€æ—¶æœ‰ç”¨ï¼‰</span><br><span class="line">nnoremap &lt;leader&gt;1 :set filetype=xhtml&lt;CR&gt;</span><br><span class="line">nnoremap &lt;leader&gt;2 :set filetype=css&lt;CR&gt;</span><br><span class="line">nnoremap &lt;leader&gt;3 :set filetype=javascript&lt;CR&gt;</span><br><span class="line">nnoremap &lt;leader&gt;4 :set filetype=php&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">&quot; set fileformats=unix,dos,mac</span><br><span class="line">&quot; nmap &lt;leader&gt;fd :se fileformat=dos&lt;CR&gt;</span><br><span class="line">&quot; nmap &lt;leader&gt;fu :se fileformat=unix&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">&quot; use Ctrl+[l|n|p|cc] to list|next|previous|jump to count the result</span><br><span class="line">&quot; map &lt;C-x&gt;l &lt;ESC&gt;:cl&lt;CR&gt;</span><br><span class="line">&quot; map &lt;C-x&gt;n &lt;ESC&gt;:cn&lt;CR&gt;</span><br><span class="line">&quot; map &lt;C-x&gt;p &lt;ESC&gt;:cp&lt;CR&gt;</span><br><span class="line">&quot; map &lt;C-x&gt;c &lt;ESC&gt;:cc&lt;CR&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot; è®© Tohtml äº§ç”Ÿæœ‰ CSS è¯­æ³•çš„ html</span><br><span class="line">&quot; syntax/2html.vimï¼Œå¯ä»¥ç”¨:runtime! syntax/2html.vim</span><br><span class="line">let html_use_css=1</span><br><span class="line"></span><br><span class="line">&quot; Python æ–‡ä»¶çš„ä¸€èˆ¬è®¾ç½®ï¼Œæ¯”å¦‚ä¸è¦ tab ç­‰</span><br><span class="line">autocmd FileType python set tabstop=4 shiftwidth=4 expandtab</span><br><span class="line">autocmd FileType python map &lt;F12&gt; :!python %&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">&quot; é€‰ä¸­çŠ¶æ€ä¸‹ Ctrl+c å¤åˆ¶</span><br><span class="line">vmap &lt;C-c&gt; &quot;+y</span><br><span class="line"></span><br><span class="line">&quot; æ‰“å¼€javascriptæŠ˜å </span><br><span class="line">let b:javascript_fold=1</span><br><span class="line">&quot; æ‰“å¼€javascriptå¯¹domã€htmlå’Œcssçš„æ”¯æŒ</span><br><span class="line">let javascript_enable_domhtmlcss=1</span><br><span class="line">&quot; è®¾ç½®å­—å…¸ ~/.vim/dict/æ–‡ä»¶çš„è·¯å¾„</span><br><span class="line">autocmd filetype javascript set dictionary=$VIMFILES/dict/javascript.dict</span><br><span class="line">autocmd filetype css set dictionary=$VIMFILES/dict/css.dict</span><br><span class="line">autocmd filetype php set dictionary=$VIMFILES/dict/php.dict</span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - bufexplorer.vim Buffersåˆ‡æ¢</span><br><span class="line">&quot; \be å…¨å±æ–¹å¼æŸ¥çœ‹å…¨éƒ¨æ‰“å¼€çš„æ–‡ä»¶åˆ—è¡¨</span><br><span class="line">&quot; \bv å·¦å³æ–¹å¼æŸ¥çœ‹   \bs ä¸Šä¸‹æ–¹å¼æŸ¥çœ‹</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - taglist.vim  æŸ¥çœ‹å‡½æ•°åˆ—è¡¨ï¼Œéœ€è¦ctagsç¨‹åº</span><br><span class="line">&quot; F4 æ‰“å¼€éšè—taglistçª—å£</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">if MySys() == &quot;windows&quot;                &quot; è®¾å®šwindowsç³»ç»Ÿä¸­ctagsç¨‹åºçš„ä½ç½®</span><br><span class="line">    let Tlist_Ctags_Cmd = &#x27;&quot;&#x27;.$VIMRUNTIME.&#x27;/ctags.exe&quot;&#x27;</span><br><span class="line">elseif MySys() == &quot;linux&quot;              &quot; è®¾å®šwindowsç³»ç»Ÿä¸­ctagsç¨‹åºçš„ä½ç½®</span><br><span class="line">    let Tlist_Ctags_Cmd = &#x27;/usr/bin/ctags&#x27;</span><br><span class="line">endif</span><br><span class="line">nnoremap &lt;silent&gt;&lt;F4&gt; :TlistToggle&lt;CR&gt;</span><br><span class="line">let Tlist_Show_One_File = 1            &quot; ä¸åŒæ—¶æ˜¾ç¤ºå¤šä¸ªæ–‡ä»¶çš„tagï¼Œåªæ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„</span><br><span class="line">let Tlist_Exit_OnlyWindow = 1          &quot; å¦‚æœtaglistçª—å£æ˜¯æœ€åä¸€ä¸ªçª—å£ï¼Œåˆ™é€€å‡ºvim</span><br><span class="line">let Tlist_Use_Right_Window = 1         &quot; åœ¨å³ä¾§çª—å£ä¸­æ˜¾ç¤ºtaglistçª—å£</span><br><span class="line">let Tlist_File_Fold_Auto_Close=1       &quot; è‡ªåŠ¨æŠ˜å å½“å‰éç¼–è¾‘æ–‡ä»¶çš„æ–¹æ³•åˆ—è¡¨</span><br><span class="line">let Tlist_Auto_Open = 0</span><br><span class="line">let Tlist_Auto_Update = 1</span><br><span class="line">let Tlist_Hightlight_Tag_On_BufEnter = 1</span><br><span class="line">let Tlist_Enable_Fold_Column = 0</span><br><span class="line">let Tlist_Process_File_Always = 1</span><br><span class="line">let Tlist_Display_Prototype = 0</span><br><span class="line">let Tlist_Compact_Format = 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - mark.vim ç»™å„ç§tagsæ ‡è®°ä¸åŒçš„é¢œè‰²ï¼Œä¾¿äºè§‚çœ‹è°ƒå¼çš„æ’ä»¶ã€‚</span><br><span class="line">&quot; \m  mark or unmark the word under (or before) the cursor</span><br><span class="line">&quot; \r  manually input a regular expression. ç”¨äºæœç´¢.</span><br><span class="line">&quot; \n  clear this mark (i.e. the mark under the cursor), or clear all highlighted marks .</span><br><span class="line">&quot; \*  å½“å‰MarkWordçš„ä¸‹ä¸€ä¸ª     \#  å½“å‰MarkWordçš„ä¸Šä¸€ä¸ª</span><br><span class="line">&quot; \/  æ‰€æœ‰MarkWordsçš„ä¸‹ä¸€ä¸ª    \?  æ‰€æœ‰MarkWordsçš„ä¸Šä¸€ä¸ª</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - NERD_tree.vim ä»¥æ ‘çŠ¶æ–¹å¼æµè§ˆç³»ç»Ÿä¸­çš„æ–‡ä»¶å’Œç›®å½•</span><br><span class="line">&quot; :ERDtree æ‰“å¼€NERD_tree         :NERDtreeClose    å…³é—­NERD_tree</span><br><span class="line">&quot; o æ‰“å¼€å…³é—­æ–‡ä»¶æˆ–è€…ç›®å½•         t åœ¨æ ‡ç­¾é¡µä¸­æ‰“å¼€</span><br><span class="line">&quot; T åœ¨åå°æ ‡ç­¾é¡µä¸­æ‰“å¼€           ! æ‰§è¡Œæ­¤æ–‡ä»¶</span><br><span class="line">&quot; p åˆ°ä¸Šå±‚ç›®å½•                   P åˆ°æ ¹ç›®å½•</span><br><span class="line">&quot; K åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹                 J åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line">&quot; u æ‰“å¼€ä¸Šå±‚ç›®å½•                 m æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿèœå•ï¼ˆæ·»åŠ ã€åˆ é™¤ã€ç§»åŠ¨æ“ä½œï¼‰</span><br><span class="line">&quot; r é€’å½’åˆ·æ–°å½“å‰ç›®å½•             R é€’å½’åˆ·æ–°å½“å‰æ ¹ç›®å½•</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; F3 NERDTree åˆ‡æ¢</span><br><span class="line">map &lt;F3&gt; :NERDTreeToggle&lt;CR&gt;</span><br><span class="line">imap &lt;F3&gt; &lt;ESC&gt;:NERDTreeToggle&lt;CR&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - NERD_commenter.vim   æ³¨é‡Šä»£ç ç”¨çš„ï¼Œ</span><br><span class="line">&quot; [count],cc å…‰æ ‡ä»¥ä¸‹countè¡Œé€è¡Œæ·»åŠ æ³¨é‡Š(7,cc)</span><br><span class="line">&quot; [count],cu å…‰æ ‡ä»¥ä¸‹countè¡Œé€è¡Œå–æ¶ˆæ³¨é‡Š(7,cu)</span><br><span class="line">&quot; [count],cm å…‰æ ‡ä»¥ä¸‹countè¡Œå°è¯•æ·»åŠ å—æ³¨é‡Š(7,cm)</span><br><span class="line">&quot; ,cA åœ¨è¡Œå°¾æ’å…¥ /* */,å¹¶ä¸”è¿›å…¥æ’å…¥æ¨¡å¼ã€‚ è¿™ä¸ªå‘½ä»¤æ–¹ä¾¿å†™æ³¨é‡Šã€‚</span><br><span class="line">&quot; æ³¨ï¼šcountå‚æ•°å¯é€‰ï¼Œæ— åˆ™é»˜è®¤ä¸ºé€‰ä¸­è¡Œæˆ–å½“å‰è¡Œ</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">let NERDSpaceDelims=1       &quot; è®©æ³¨é‡Šç¬¦ä¸è¯­å¥ä¹‹é—´ç•™ä¸€ä¸ªç©ºæ ¼</span><br><span class="line">let NERDCompactSexyComs=1   &quot; å¤šè¡Œæ³¨é‡Šæ—¶æ ·å­æ›´å¥½çœ‹</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - DoxygenToolkit.vim  ç”±æ³¨é‡Šç”Ÿæˆæ–‡æ¡£ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¿«é€Ÿç”Ÿæˆå‡½æ•°æ ‡å‡†æ³¨é‡Š</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">let g:DoxygenToolkit_authorName=&quot;Asins - asinsimple AT gmail DOT com&quot;</span><br><span class="line">let g:DoxygenToolkit_briefTag_funcName=&quot;yes&quot;</span><br><span class="line">map &lt;leader&gt;da :DoxAuthor&lt;CR&gt;</span><br><span class="line">map &lt;leader&gt;df :Dox&lt;CR&gt;</span><br><span class="line">map &lt;leader&gt;db :DoxBlock&lt;CR&gt;</span><br><span class="line">map &lt;leader&gt;dc a /*  */&lt;LEFT&gt;&lt;LEFT&gt;&lt;LEFT&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin â€“ ZenCoding.vim å¾ˆé…·çš„æ’ä»¶ï¼ŒHTMLä»£ç ç”Ÿæˆ</span><br><span class="line">&quot; æ’ä»¶æœ€æ–°ç‰ˆï¼šhttp://github.com/mattn/zencoding-vim</span><br><span class="line">&quot; å¸¸ç”¨å‘½ä»¤å¯çœ‹ï¼šhttp://nootn.com/blog/Tool/23/</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin â€“ checksyntax.vim    JavaScriptå¸¸è§è¯­æ³•é”™è¯¯æ£€æŸ¥</span><br><span class="line">&quot; é»˜è®¤å¿«æ·æ–¹å¼ä¸º F5</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">let g:checksyntax_auto = 0 &quot; ä¸è‡ªåŠ¨æ£€æŸ¥</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - NeoComplCache.vim    è‡ªåŠ¨è¡¥å…¨æ’ä»¶</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">let g:AutoComplPop_NotEnableAtStartup = 1</span><br><span class="line">let g:NeoComplCache_EnableAtStartup = 1</span><br><span class="line">let g:NeoComplCache_SmartCase = 1</span><br><span class="line">let g:NeoComplCache_TagsAutoUpdate = 1</span><br><span class="line">let g:NeoComplCache_EnableInfo = 1</span><br><span class="line">let g:NeoComplCache_EnableCamelCaseCompletion = 1</span><br><span class="line">let g:NeoComplCache_MinSyntaxLength = 3</span><br><span class="line">let g:NeoComplCache_EnableSkipCompletion = 1</span><br><span class="line">let g:NeoComplCache_SkipInputTime = &#x27;0.5&#x27;</span><br><span class="line">let g:NeoComplCache_SnippetsDir = $VIMFILES.&#x27;/snippets&#x27;</span><br><span class="line">&quot; &lt;TAB&gt; completion.</span><br><span class="line">inoremap &lt;expr&gt;&lt;TAB&gt; pumvisible() ? &quot;\&lt;C-n&gt;&quot; : &quot;\&lt;TAB&gt;&quot;</span><br><span class="line">&quot; snippets expand key</span><br><span class="line">imap &lt;silent&gt; &lt;C-e&gt; &lt;Plug&gt;(neocomplcache_snippets_expand)</span><br><span class="line">&quot;smap &lt;silent&gt; &lt;C-e&gt; &lt;Plug&gt;(neocomplcache_snippets_expand)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - matchit.vim   å¯¹%å‘½ä»¤è¿›è¡Œæ‰©å±•ä½¿å¾—èƒ½åœ¨åµŒå¥—æ ‡ç­¾å’Œè¯­å¥ä¹‹é—´è·³è½¬</span><br><span class="line">&quot; % æ­£å‘åŒ¹é…      g% åå‘åŒ¹é…</span><br><span class="line">&quot; [% å®šä½å—é¦–     ]% å®šä½å—å°¾</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - vcscommand.vim   å¯¹%å‘½ä»¤è¿›è¡Œæ‰©å±•ä½¿å¾—èƒ½åœ¨åµŒå¥—æ ‡ç­¾å’Œè¯­å¥ä¹‹é—´è·³è½¬</span><br><span class="line">&quot; SVN/gitç®¡ç†å·¥å…·</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin â€“ a.vim</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">imap &lt;F9&gt; &lt;esc&gt;:tabN&lt;cr&gt;</span><br><span class="line">imap &lt;F10&gt; &lt;esc&gt;:tabn&lt;cr&gt;</span><br><span class="line">nmap &lt;F9&gt; :tabN&lt;cr&gt;</span><br><span class="line">nmap &lt;F10&gt; :tabn&lt;cr&gt;</span><br><span class="line">&quot;set showtabline=1</span><br><span class="line">hi Comment ctermfg=2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">highlight Visual cterm=bold ctermbg=Blue ctermfg=NONE #visual é€‰ä¸­é«˜äº®çš„åº•è‰²å˜æˆæµ…è‰²</span><br></pre></td></tr></table></figure><h3 id="vimdiff">Vimdiff</h3><p>æ›´æ”¹å¯¹æ¯”é¢œè‰²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:colo desert</span><br></pre></td></tr></table></figure><h3 id="viè¯­æ³•é«˜äº®shellè„šæœ¬">viè¯­æ³•é«˜äº®shellè„šæœ¬</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ~/.vimrc</span><br><span class="line">filetype plugin indent on</span><br><span class="line">syntax on</span><br></pre></td></tr></table></figure><h3 id="vim-vi-é…ç½®">vim &amp; vi é…ç½®</h3><p><a href="https://www.dazhuanlan.com/2019/10/02/5d94884599d6c/"class="uri">https://www.dazhuanlan.com/2019/10/02/5d94884599d6c/</a></p><p>åœ¨vimrcä¸­åŠ å…¥:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hi CursorLine term=bold cterm=bold ctermbg=Red</span><br><span class="line"># åœ¨viä¸­ä½¿ç”¨</span><br><span class="line">set cursorline</span><br><span class="line">or</span><br><span class="line">set cul</span><br></pre></td></tr></table></figure><h3 id="æŸ¥æ‰¾">æŸ¥æ‰¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># é«˜äº®æ˜¾ç¤ºæœç´¢åŒ¹é…çš„è¯</span><br><span class="line">:set hlsearch    </span><br><span class="line"></span><br><span class="line"># æ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œæœç´¢ä¸€æ¬¡ï¼Œè¡¨ç°æ˜¯åŒæ—¶é«˜äº®å¤šä¸ªæ­£åˆ™åŒ¹é…</span><br><span class="line"># åœ¨æ™®é€šæœç´¢å‰æ‰§è¡Œæ­¤å‘½ä»¤</span><br><span class="line">:set incsearch</span><br><span class="line"></span><br><span class="line"># å¿½ç•¥å¤§å°å†™</span><br><span class="line">:set ignorecase   </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾å½“å‰å…‰æ ‡æ‰€åœ¨å•è¯: *å‘ä¸‹æŸ¥æ‰¾å…¨éƒ¨åŒ¹é…çš„å­—ç¬¦ä¸²ï¼ˆæŒ‰ä½shift+*é”®ï¼‰ï¼ŒåŒæ—¶å·¦ä¸‹è§’ä¼šæ˜¾ç¤ºç­‰æ•ˆçš„å‘½ä»¤æ¨¡å¼æŒ‡ä»¤#å‘ä¸ŠæŸ¥æ‰¾å…¨éƒ¨åŒ¹é…çš„å­—ç¬¦ï¼ˆæŒ‰ä½shift+#é”®ï¼‰ï¼ŒåŒæ—¶å·¦ä¸‹è§’ä¼šæ˜¾ç¤ºç­‰æ•ˆçš„å‘½ä»¤æ¨¡å¼æŒ‡ä»¤g*å‘ä¸‹æŸ¥æ‰¾åŒ…å«å½“å‰å­—ç¬¦çš„åŒ¹é…å­—ç¬¦ä¸²ï¼ˆæŒ‰ä½shift+*é”®ï¼‰ï¼ŒåŒæ—¶å·¦ä¸‹è§’ä¼šæ˜¾ç¤ºç­‰æ•ˆçš„å‘½ä»¤æ¨¡å¼æŒ‡ä»¤g#å‘ä¸ŠæŸ¥æ‰¾åŒ…å«å½“å‰å­—ç¬¦çš„åŒ¹é…å­—ç¬¦ä¸²ï¼ˆæŒ‰ä½shift+#é”®ï¼‰ï¼ŒåŒæ—¶å·¦ä¸‹è§’ä¼šæ˜¾ç¤ºç­‰æ•ˆçš„å‘½ä»¤æ¨¡å¼æŒ‡ä»¤% æ‹¬å·åŒ¹é… åŒ…æ‹¬ () [] { }.</p><h3 id="å…¨éƒ¨æ›¿æ¢">å…¨éƒ¨æ›¿æ¢</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">:[addr]s/æºå­—ç¬¦ä¸²/ç›®æ ‡å­—ç¬¦ä¸²/[option]</span><br><span class="line"># å…¨å±€æ›¿æ¢</span><br><span class="line">:%s/æºå­—ç¬¦ä¸²/ç›®æ ‡å­—ç¬¦ä¸²/g</span><br><span class="line"></span><br><span class="line"># å…¨éƒ¨æ›¿æ¢å’Œæ·»åŠ ç¡®è®¤ç¯èŠ‚</span><br><span class="line">:%s/search_for_this/replace_with_this/    - search whole file and replace</span><br><span class="line">:%s/search_for_this/replace_with_this/c   - confirm each replace</span><br></pre></td></tr></table></figure><h3 id="cursoré¢œè‰²">cursoré¢œè‰²</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set cursorline</span><br><span class="line">hi CursorLine   cterm=NONE ctermbg=lightgray ctermfg=white guibg=lightgray guifg=white</span><br><span class="line">set cursorcolumn</span><br><span class="line">hi CursorColumn   cterm=NONE ctermbg=lightgray ctermfg=white guibg=lightgray guifg=white</span><br><span class="line"># è®¾ç½®æ›´æµ…çš„ç°è‰²</span><br><span class="line">hi CursorLine term=bold cterm=bold ctermbg=237</span><br></pre></td></tr></table></figure><h3 id="ç©ºæ ¼æ›¿æ¢tab">ç©ºæ ¼æ›¿æ¢tab</h3><p><a href="https://blog.csdn.net/jiang1013nan/article/details/6298727"class="uri">https://blog.csdn.net/jiang1013nan/article/details/6298727</a>åœ¨.vimrcä¸­æ·»åŠ ä»¥ä¸‹ä»£ç åï¼Œé‡å¯vimå³å¯å®ç°æŒ‰TABäº§ç”Ÿ4ä¸ªç©ºæ ¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#~/.vimrc</span><br><span class="line">set ts=4  (æ³¨ï¼štsæ˜¯tabstopçš„ç¼©å†™ï¼Œè®¾TABå®½4ä¸ªç©ºæ ¼)</span><br><span class="line">set expandtab</span><br></pre></td></tr></table></figure><p>å¯¹äºå·²ä¿å­˜çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œç©ºæ ¼å’ŒTABçš„æ›¿æ¢ï¼šTABæ›¿æ¢ä¸ºç©ºæ ¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:set ts=4</span><br><span class="line">:set expandtab</span><br><span class="line">:%retab!</span><br></pre></td></tr></table></figure><p>ç©ºæ ¼æ›¿æ¢ä¸ºTABï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:set ts=4</span><br><span class="line">:set noexpandtab</span><br><span class="line">:%retab!</span><br></pre></td></tr></table></figure><h2 id="åå°è¿è¡Œ">åå°è¿è¡Œ</h2><p>å•çº¯çš„åå¤©è¿è¡Œç›´æ¥ä¼¼ä½¿ç”¨ å‚è€ƒï¼š[link][2]</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">command &amp; #åå°è¿è¡Œ</span><br><span class="line">ctrl + z #å°†ä¸€ä¸ªæ­£åœ¨å‰å°æ‰§è¡Œçš„å‘½ä»¤æ”¾åˆ°åå°ï¼Œå¹¶ä¸”æš‚åœ</span><br><span class="line">jobs -l</span><br><span class="line">fg %1 #å‰å°æ˜¾ç¤º</span><br><span class="line">bg %1 #å°†ä»»åŠ¡åå°è¿è¡Œï¼Œæ¯”å¦‚cltr+zåä¼šæŒ‚èµ·ä»»åŠ¡ï¼Œå¹¶æ˜¾ç¤ºä»»åŠ¡å·ï¼Œæ­¤æ—¶å°±å¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤è®©å…¶åå°è¿è¡Œ</span><br></pre></td></tr></table></figure><h3 id="nohup"><ahref="https://www.cnblogs.com/jinxiao-pu/p/9131057.html">nohup</a></h3><p>nohup å‘½ä»¤è¿è¡Œç”± Commandå‚æ•°å’Œä»»ä½•ç›¸å…³çš„Argå‚æ•°æŒ‡å®šçš„å‘½ä»¤ï¼Œå¿½ç•¥æ‰€æœ‰æŒ‚æ–­ï¼ˆSIGHUPï¼‰ä¿¡å·ã€‚åœ¨æ³¨é”€åä½¿ç”¨ nohupå‘½ä»¤è¿è¡Œåå°ä¸­çš„ç¨‹åºã€‚è¦è¿è¡Œåå°ä¸­çš„ nohup å‘½ä»¤ï¼Œæ·»åŠ  &amp; ï¼ˆè¡¨ç¤ºâ€œandâ€çš„ç¬¦å·ï¼‰åˆ°å‘½ä»¤çš„å°¾éƒ¨ã€‚</p><p><strong>nohup æ˜¯ no hang up çš„ç¼©å†™ï¼Œå°±æ˜¯ä¸æŒ‚æ–­çš„æ„æ€ã€‚</strong></p><h3 id="nohupå’Œ-çš„åŒºåˆ«"><ahref="https://www.cnblogs.com/jinxiao-pu/p/9131057.html">nohupå’Œ &amp;çš„åŒºåˆ«</a></h3><p>&amp; ï¼š æŒ‡åœ¨åå°è¿è¡Œ nohup ï¼šä¸æŒ‚æ–­çš„è¿è¡Œï¼Œæ³¨æ„å¹¶æ²¡æœ‰åå°è¿è¡Œçš„åŠŸèƒ½ï¼Œï¼Œå°±æ˜¯æŒ‡ï¼Œç”¨nohupè¿è¡Œå‘½ä»¤å¯ä»¥ä½¿å‘½ä»¤æ°¸ä¹…çš„æ‰§è¡Œä¸‹å»ï¼Œå’Œç”¨æˆ·ç»ˆç«¯æ²¡æœ‰å…³ç³»ï¼Œä¾‹å¦‚æˆ‘ä»¬æ–­å¼€SSHè¿æ¥éƒ½ä¸ä¼šå½±å“ä»–çš„è¿è¡Œï¼Œæ³¨æ„äº†nohupæ²¡æœ‰åå°è¿è¡Œçš„æ„æ€ï¼›&amp;æ‰æ˜¯åå°è¿è¡Œ</p><h3 id="è·å¾—nohupåå°è¿è¡Œè¿›ç¨‹çš„pid"><ahref="https://www.jianshu.com/p/5a04e2452e3f">è·å¾—nohupåå°è¿è¡Œè¿›ç¨‹çš„PID</a></h3><p>nohup command &gt; logfile.txt &amp; echo $! &gt; pidfile.txtå…¶å®ä¹Ÿå¯ä»¥åœ¨command.shé‡Œé¢å†™å…¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo current pid = $$</span><br></pre></td></tr></table></figure><table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr><th>å˜é‡å</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>$<span class="math inline">\(|Shellæœ¬èº«çš„PIDï¼ˆProcessIDï¼‰||\)</span>!</td><td>Shellæœ€åè¿è¡Œçš„åå°Processçš„PID</td></tr><tr><td><span class="math inline">\(?|æœ€åè¿è¡Œçš„å‘½ä»¤çš„ç»“æŸä»£ç ï¼ˆè¿”å›å€¼ï¼‰||\)</span>-</td><td>ä½¿ç”¨Setå‘½ä»¤è®¾å®šçš„Flagä¸€è§ˆ</td></tr><tr><td><spanclass="math inline">\(*|æ‰€æœ‰å‚æ•°åˆ—è¡¨ã€‚å¦‚&quot;\)</span>*"ç”¨ã€Œ"ã€æ‹¬èµ·æ¥çš„æƒ…å†µã€ä»¥"$1<span class="math inline">\(2 â€¦\)</span>n"çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚</td><td></td></tr><tr><td><spanclass="math inline">\(@|æ‰€æœ‰å‚æ•°åˆ—è¡¨ã€‚å¦‚&quot;\)</span>@"ç”¨ã€Œ"ã€æ‹¬èµ·æ¥çš„æƒ…å†µã€ä»¥"$1""<span class="math inline">\(2&quot; â€¦ &quot;\)</span>n"çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚</td><td></td></tr><tr><td>$#</td><td>æ·»åŠ åˆ°Shellçš„å‚æ•°ä¸ªæ•°</td></tr><tr><td>$0</td><td>Shellæœ¬èº«çš„æ–‡ä»¶å</td></tr><tr><td>$1-$n</td><td>æ·»åŠ åˆ°Shellçš„å„å‚æ•°å€¼ã€‚$1æ˜¯ç¬¬1å‚æ•°ã€$2æ˜¯ç¬¬2å‚æ•°â€¦ã€‚</td></tr></tbody></table><h3 id="è§£æ"><ahref="https://www.cnblogs.com/zzyoucan/p/7764590.html">2&gt;&amp;1è§£æ</a></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmmand &gt;out.file 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><ul><li>command&gt;out.fileæ˜¯å°†commandçš„è¾“å‡ºé‡å®šå‘åˆ°out.fileæ–‡ä»¶ï¼Œå³è¾“å‡ºå†…å®¹ä¸æ‰“å°åˆ°å±å¹•ä¸Šï¼Œè€Œæ˜¯è¾“å‡ºåˆ°out.fileæ–‡ä»¶ä¸­ã€‚</li><li>2&gt;&amp;1æ˜¯å°†æ ‡å‡†å‡ºé”™é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºï¼Œè¿™é‡Œçš„æ ‡å‡†è¾“å‡ºå·²ç»é‡å®šå‘åˆ°äº†out.fileæ–‡ä»¶ï¼Œå³å°†æ ‡å‡†å‡ºé”™ä¹Ÿè¾“å‡ºåˆ°out.fileæ–‡ä»¶ä¸­ã€‚æœ€åä¸€ä¸ª&amp;ï¼Œæ˜¯è®©è¯¥å‘½ä»¤åœ¨åå°æ‰§è¡Œã€‚</li><li>è¯•æƒ³2&gt;1ä»£è¡¨ä»€ä¹ˆï¼Œ2ä¸&gt;ç»“åˆä»£è¡¨é”™è¯¯é‡å®šå‘ï¼Œè€Œ1åˆ™ä»£è¡¨é”™è¯¯é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶1ï¼Œè€Œä¸ä»£è¡¨æ ‡å‡†è¾“å‡ºï¼›æ¢æˆ2&gt;&amp;1ï¼Œ&amp;ä¸1ç»“åˆå°±ä»£è¡¨æ ‡å‡†è¾“å‡ºäº†ï¼Œå°±å˜æˆé”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º.</li></ul><h3 id="æŸ¥çœ‹åå°ä»»åŠ¡æˆ–è¿›ç¨‹"><ahref="https://www.cnblogs.com/baby123/p/6477429.html">æŸ¥çœ‹åå°ä»»åŠ¡æˆ–è¿›ç¨‹</a></h3><ul><li>jobs -ljobså‘½ä»¤åªçœ‹å½“å‰ç»ˆç«¯ç”Ÿæ•ˆçš„ï¼Œå…³é—­ç»ˆç«¯åï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯jobså·²ç»æ— æ³•çœ‹åˆ°åå°è·‘å¾—ç¨‹åºäº†ï¼Œæ­¤æ—¶åˆ©ç”¨psï¼ˆè¿›ç¨‹æŸ¥çœ‹å‘½ä»¤ï¼‰</li><li>ps -ef</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s -aux|grep chat.js</span><br><span class="line"> a:æ˜¾ç¤ºæ‰€æœ‰ç¨‹åº </span><br><span class="line"> u:ä»¥ç”¨æˆ·ä¸ºä¸»çš„æ ¼å¼æ¥æ˜¾ç¤º </span><br><span class="line"> x:æ˜¾ç¤ºæ‰€æœ‰ç¨‹åºï¼Œä¸ä»¥ç»ˆç«¯æœºæ¥åŒºåˆ†</span><br></pre></td></tr></table></figure><h3 id="wait-å‘½ä»¤è·å–ä¸Šä¸€ä¸ªåå°è¿›ç¨‹çš„è¿›ç¨‹å·ä»¥åŠçŠ¶æ€">waitå‘½ä»¤+è·å–ä¸Šä¸€ä¸ªåå°è¿›ç¨‹çš„è¿›ç¨‹å·ä»¥åŠçŠ¶æ€</h3><p><code>wait_test.sh</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">echo &quot;current job pid: &quot; $$</span><br><span class="line"></span><br><span class="line">bash wait_error_job.sh 1 &amp;</span><br><span class="line">job_1=$!</span><br><span class="line">bash wait_error_job.sh 2 &amp;</span><br><span class="line">job_2=$!</span><br><span class="line"></span><br><span class="line">wait $job_1   </span><br><span class="line">job_1_status=$?</span><br><span class="line">wait $job_2</span><br><span class="line">job_2_status=$?</span><br><span class="line"></span><br><span class="line">echo &quot;job 1 pid: &quot; $&#123;job_1&#125; &quot; status: &quot; $&#123;job_1_status&#125;</span><br><span class="line">echo &quot;job 2 pid: &quot; $&#123;job_2&#125; &quot; status: &quot; $&#123;job_2_status&#125;</span><br></pre></td></tr></table></figure><p><code>wait_error_job.sh</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">echo &quot;I am job: &quot; $1 &quot;my pid is: &quot; $$</span><br><span class="line">sleep 5 </span><br><span class="line">if [ $1 -eq 1 ];then</span><br><span class="line">    echo &quot;this is job 1, success&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;this is job 2, failed&quot;</span><br><span class="line">    lls # æ‹¼å†™é”™è¯¯çš„å‘½ä»¤ï¼Œç”¨æ¥æŠ¥é”™</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="disown">disown</h3><p>åœºæ™¯ï¼š<ahref="http://www.ibm.com/developerworks/cn/linux/l-cn-nohup/"class="uri">http://www.ibm.com/developerworks/cn/linux/l-cn-nohup/</a>æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œå¦‚æœäº‹å…ˆåœ¨å‘½ä»¤å‰åŠ ä¸Š nohup æˆ–è€… setsid å°±å¯ä»¥é¿å… HUPä¿¡å·çš„å½±å“ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æœªåŠ ä»»ä½•å¤„ç†å°±å·²ç»æäº¤äº†å‘½ä»¤ï¼Œè¯¥å¦‚ä½•è¡¥æ•‘æ‰èƒ½è®©å®ƒé¿å…HUP ä¿¡å·çš„å½±å“å‘¢ï¼Ÿ è§£å†³æ–¹æ³•ï¼š è¿™æ—¶æƒ³åŠ  nohup æˆ–è€… setsidå·²ç»ä¸ºæ—¶å·²æ™šï¼Œåªèƒ½é€šè¿‡ä½œä¸šè°ƒåº¦å’Œ disown æ¥è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹disown çš„å¸®åŠ©ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">disown [-ar] [-h] [jobspec ...]</span><br><span class="line"> Without options, each jobspec is  removed  from  the  table  of</span><br><span class="line"> active  jobs.   If  the -h option is given, each jobspec is not</span><br><span class="line"> removed from the table, but is marked so  that  SIGHUP  is  not</span><br><span class="line"> sent  to the job if the shell receives a SIGHUP.  If no jobspec</span><br><span class="line"> is present, and neither the -a nor the -r option  is  supplied,</span><br><span class="line"> the  current  job  is  used.  If no jobspec is supplied, the -a</span><br><span class="line"> option means to remove or mark all jobs; the -r option  without</span><br><span class="line"> a  jobspec  argument  restricts operation to running jobs.  The</span><br><span class="line"> return value is 0 unless a jobspec does  not  specify  a  valid</span><br><span class="line"> job.</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼æ¥è¾¾æˆæˆ‘ä»¬çš„ç›®çš„ã€‚ çµæ´»è¿ç”¨ CTRL-zåœ¨æˆ‘ä»¬çš„æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ CTRL-zæ¥å°†å½“å‰è¿›ç¨‹æŒ‚èµ·åˆ°åå°æš‚åœè¿è¡Œï¼Œæ‰§è¡Œä¸€äº›åˆ«çš„æ“ä½œï¼Œç„¶åå†ç”¨ fgæ¥å°†æŒ‚èµ·çš„è¿›ç¨‹é‡æ–°æ”¾å›å‰å°ï¼ˆä¹Ÿå¯ç”¨ bgæ¥å°†æŒ‚èµ·çš„è¿›ç¨‹æ”¾åœ¨åå°ï¼‰ç»§ç»­è¿è¡Œã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸€ä¸ªç»ˆç«¯å†…çµæ´»åˆ‡æ¢è¿è¡Œå¤šä¸ªä»»åŠ¡ï¼Œè¿™ä¸€ç‚¹åœ¨è°ƒè¯•ä»£ç æ—¶å°¤ä¸ºæœ‰ç”¨ã€‚å› ä¸ºå°†ä»£ç ç¼–è¾‘å™¨æŒ‚èµ·åˆ°åå°å†é‡æ–°æ”¾å›æ—¶ï¼Œå…‰æ ‡å®šä½ä»ç„¶åœç•™åœ¨ä¸Šæ¬¡æŒ‚èµ·æ—¶çš„ä½ç½®ï¼Œé¿å…äº†é‡æ–°å®šä½çš„éº»çƒ¦ã€‚ç”¨disown -h jobspecæ¥ä½¿æŸä¸ªä½œä¸šå¿½ç•¥HUPä¿¡å·ã€‚ ç”¨disown -ahæ¥ä½¿æ‰€æœ‰çš„ä½œä¸šéƒ½å¿½ç•¥HUPä¿¡å·ã€‚ ç”¨disown -rhæ¥ä½¿æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¿½ç•¥HUPä¿¡å·ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨è¿‡ disownä¹‹åï¼Œä¼šå°†æŠŠç›®æ ‡ä½œä¸šä»ä½œä¸šåˆ—è¡¨ä¸­ç§»é™¤ï¼Œæˆ‘ä»¬å°†ä¸èƒ½å†ä½¿ç”¨jobsæ¥æŸ¥çœ‹å®ƒï¼Œä½†æ˜¯ä¾ç„¶èƒ½å¤Ÿç”¨ps-efæŸ¥æ‰¾åˆ°å®ƒã€‚ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ç§æ–¹æ³•çš„æ“ä½œå¯¹è±¡æ˜¯ä½œä¸šï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿è¡Œå‘½ä»¤æ—¶åœ¨ç»“å°¾åŠ äº†"&amp;"æ¥ä½¿å®ƒæˆä¸ºä¸€ä¸ªä½œä¸šå¹¶åœ¨åå°è¿è¡Œï¼Œé‚£ä¹ˆå°±ä¸‡äº‹å¤§å‰äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡jobså‘½ä»¤æ¥å¾—åˆ°æ‰€æœ‰ä½œä¸šçš„åˆ—è¡¨ã€‚ä½†æ˜¯å¦‚æœå¹¶æ²¡æœ‰æŠŠå½“å‰å‘½ä»¤ä½œä¸ºä½œä¸šæ¥è¿è¡Œï¼Œå¦‚ä½•æ‰èƒ½å¾—åˆ°å®ƒçš„ä½œä¸šå·å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ç”¨CTRL-zï¼ˆæŒ‰ä½Ctrlé”®çš„åŒæ—¶æŒ‰ä½zé”®ï¼‰äº†ï¼ CTRL-zçš„ç”¨é€”å°±æ˜¯å°†å½“å‰è¿›ç¨‹æŒ‚èµ·ï¼ˆSuspendï¼‰ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç”¨jobså‘½ä»¤æ¥æŸ¥è¯¢å®ƒçš„ä½œä¸šå·ï¼Œå†ç”¨bgjobspecæ¥å°†å®ƒæ”¾å…¥åå°å¹¶ç»§ç»­è¿è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæŒ‚èµ·ä¼šå½±å“å½“å‰è¿›ç¨‹çš„è¿è¡Œç»“æœï¼Œè¯·æ…ç”¨æ­¤æ–¹æ³•ã€‚disownç¤ºä¾‹1ï¼ˆå¦‚æœæäº¤å‘½ä»¤æ—¶å·²ç»ç”¨â€œ&amp;â€å°†å‘½ä»¤æ”¾å…¥åå°è¿è¡Œï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨â€œdisownâ€ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]# cp -r testLargeFile largeFile &amp;</span><br><span class="line">[1] 4825</span><br><span class="line">[root@pvcent107 build]# jobs</span><br><span class="line">[1]+  Running                 cp -i -r testLargeFile largeFile &amp;</span><br><span class="line">[root@pvcent107 build]# disown -h %1</span><br><span class="line">[root@pvcent107 build]# ps -ef |grep largeFile</span><br><span class="line">root      4825   968  1 09:46 pts/4    00:00:00 cp -i -r testLargeFile largeFile</span><br><span class="line">root      4853   968  0 09:46 pts/4    00:00:00 grep largeFile</span><br><span class="line">[root@pvcent107 build]# logout</span><br></pre></td></tr></table></figure><p>disown ç¤ºä¾‹2ï¼ˆå¦‚æœæäº¤å‘½ä»¤æ—¶æœªä½¿ç”¨â€œ&amp;â€å°†å‘½ä»¤æ”¾å…¥åå°è¿è¡Œï¼Œå¯ä½¿ç”¨CTRL-z å’Œâ€œbgâ€å°†å…¶æ”¾å…¥åå°ï¼Œå†ä½¿ç”¨â€œdisownâ€ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]# cp -r testLargeFile largeFile2</span><br><span class="line"></span><br><span class="line">[1]+  Stopped                 cp -i -r testLargeFile largeFile2</span><br><span class="line">[root@pvcent107 build]# bg %1</span><br><span class="line">[1]+ cp -i -r testLargeFile largeFile2 &amp;</span><br><span class="line">[root@pvcent107 build]# jobs</span><br><span class="line">[1]+  Running                 cp -i -r testLargeFile largeFile2 &amp;</span><br><span class="line">[root@pvcent107 build]# disown -h %1</span><br><span class="line">[root@pvcent107 build]# ps -ef |grep largeFile2</span><br><span class="line">root      5790  5577  1 10:04 pts/3    00:00:00 cp -i -r testLargeFile largeFile2</span><br><span class="line">root      5824  5577  0 10:05 pts/3    00:00:00 grep largeFile2</span><br><span class="line">[root@pvcent107 build]#</span><br></pre></td></tr></table></figure><h3 id="screen">screen</h3><p>ç”¨screen -dmS sessionnameæ¥å»ºç«‹ä¸€ä¸ªå¤„äºæ–­å¼€æ¨¡å¼ä¸‹çš„ä¼šè¯ï¼ˆå¹¶æŒ‡å®šå…¶ä¼šè¯åï¼‰ã€‚ ç”¨screen -listæ¥åˆ—å‡ºæ‰€æœ‰ä¼šè¯ã€‚ ç”¨screen -r session nameæ¥é‡æ–°è¿æ¥æŒ‡å®šä¼šè¯ã€‚ç”¨å¿«æ·é”®CTRL-a d æ¥æš‚æ—¶æ–­å¼€å½“å‰ä¼šè¯ã€‚ screen ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@pvcent107 ~]# screen -dmS Urumchi</span><br><span class="line">[root@pvcent107 ~]# screen -list</span><br><span class="line">There is a screen on:</span><br><span class="line">        12842.Urumchi   (Detached)</span><br><span class="line">1 Socket in /tmp/screens/S-root.</span><br><span class="line"></span><br><span class="line">[root@pvcent107 ~]# screen -r Urumchi</span><br></pre></td></tr></table></figure><p>1.æœªä½¿ç”¨ screen æ—¶æ–°è¿›ç¨‹çš„è¿›ç¨‹æ ‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@pvcent107 ~]# ping www.google.com &amp;</span><br><span class="line">[1] 9499</span><br><span class="line">[root@pvcent107 ~]# pstree -H 9499</span><br><span class="line">initâ”€â”¬â”€Xvnc</span><br><span class="line">     â”œâ”€acpid</span><br><span class="line">     â”œâ”€atd</span><br><span class="line">     â”œâ”€2*[sendmail] </span><br><span class="line">     â”œâ”€sshdâ”€â”¬â”€sshdâ”€â”€â”€bashâ”€â”€â”€pstree</span><br><span class="line">     â”‚       â””â”€sshdâ”€â”€â”€bashâ”€â”€â”€ping</span><br><span class="line">æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæœªä½¿ç”¨ screen æ—¶æˆ‘ä»¬æ‰€å¤„çš„ bash æ˜¯ sshd çš„å­è¿›ç¨‹ï¼Œå½“ ssh æ–­å¼€è¿æ¥æ—¶ï¼ŒHUP ä¿¡å·è‡ªç„¶ä¼šå½±å“åˆ°å®ƒä¸‹é¢çš„æ‰€æœ‰å­è¿›ç¨‹ï¼ˆåŒ…æ‹¬æˆ‘ä»¬æ–°å»ºç«‹çš„ ping è¿›ç¨‹ï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>2.ä½¿ç”¨äº† screen åæ–°è¿›ç¨‹çš„è¿›ç¨‹æ ‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@pvcent107 ~]# screen -r Urumchi</span><br><span class="line">[root@pvcent107 ~]# ping www.ibm.com &amp;</span><br><span class="line">[1] 9488</span><br><span class="line">[root@pvcent107 ~]# pstree -H 9488</span><br><span class="line">initâ”€â”¬â”€Xvnc</span><br><span class="line">     â”œâ”€acpid</span><br><span class="line">     â”œâ”€atd</span><br><span class="line">     â”œâ”€screenâ”€â”€â”€bashâ”€â”€â”€ping</span><br><span class="line">     â”œâ”€2*[sendmail]</span><br></pre></td></tr></table></figure><p>è€Œä½¿ç”¨äº† screen åå°±ä¸åŒäº†ï¼Œæ­¤æ—¶ bash æ˜¯ screen çš„å­è¿›ç¨‹ï¼Œè€Œ screenæ˜¯ initï¼ˆPIDä¸º1ï¼‰çš„å­è¿›ç¨‹ã€‚é‚£ä¹ˆå½“ ssh æ–­å¼€è¿æ¥æ—¶ï¼ŒHUP ä¿¡å·è‡ªç„¶ä¸ä¼šå½±å“åˆ°screen ä¸‹é¢çš„å­è¿›ç¨‹äº†ã€‚</p><h2 id="top-å‘½ä»¤">TOP å‘½ä»¤</h2><p><a href="https://www.binarytides.com/linux-top-command/"class="uri">https://www.binarytides.com/linux-top-command/</a> <ahref="https://www.zhihu.com/question/378345922/answer/1069674567"class="uri">https://www.zhihu.com/question/378345922/answer/1069674567</a></p><h2 id="æ‰¹é‡ä¸‹è½½å›¾ç‰‡">æ‰¹é‡ä¸‹è½½å›¾ç‰‡</h2><p><a href="https://www.jb51.net/article/122242.htm">å‚è€ƒä»£ç </a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">while</span> å¾ªç¯è¯»å–æ–‡ä»¶ï¼Œæ–‡ä»¶æ”¾åœ¨ <span class="keyword">done</span> åé¢</span></span><br><span class="line">while read line;</span><br><span class="line">do</span><br><span class="line">    #echo &quot;read line&quot; $i &quot;:&quot; $line | tee -a $log_file</span><br><span class="line">    let &quot;i=$i+1&quot;</span><br><span class="line">    arr=($line)</span><br><span class="line">    rnd=$(rand 0 6)</span><br><span class="line">    curl_cmd=&quot;curl -o $&#123;img_dir&#125;$&#123;arr[0]&#125;.jpg $&#123;host[$rnd]&#125;$&#123;arr[1]&#125;&quot;</span><br><span class="line">    echo $curl_cmd</span><br><span class="line">    eval &quot;$curl_cmd &quot;</span><br><span class="line">done &lt; $sku_info</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="éšæœºæ•°">éšæœºæ•°</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function rand()&#123;</span><br><span class="line">    min=$1</span><br><span class="line">    max=$(($2-$min+1))</span><br><span class="line">    num=$(cat /proc/sys/kernel/random/uuid | cksum | awk -F &#x27; &#x27; &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line">    echo $(($num%$max+$min))</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä½¿ç”¨æ–¹æ³•</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt; rnd=$(rand 0 10) <span class="comment">#0-10å†…çš„æ•´æ•°</span></span></span><br></pre></td></tr></table></figure><h3 id="éšæœºç­›é€‰æ•°æ®">éšæœºç­›é€‰æ•°æ®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shuf dataset.dat -n 20 -o dataset_sample.dat</span><br></pre></td></tr></table></figure><h2 id="åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨">åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</h2><p><a href="https://www.jb51.net/article/122242.htm">å‚è€ƒæ–‡ä»¶</a></p><h3 id="æ–‡ä»¶å¤¹ä¸å­˜åœ¨åˆ™åˆ›å»º">1.æ–‡ä»¶å¤¹ä¸å­˜åœ¨åˆ™åˆ›å»º</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if [ ! -d &quot;/data/&quot; ];then</span><br><span class="line">mkdir /data</span><br><span class="line">else</span><br><span class="line">echo &quot;æ–‡ä»¶å¤¹å·²ç»å­˜åœ¨&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶å­˜åœ¨åˆ™åˆ é™¤">2.æ–‡ä»¶å­˜åœ¨åˆ™åˆ é™¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if [ ! -f &quot;/data/filename&quot; ];then</span><br><span class="line">echo &quot;æ–‡ä»¶ä¸å­˜åœ¨&quot;</span><br><span class="line">else</span><br><span class="line">rm -f /data/filename</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨">3.åˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if [ -d &quot;/data/&quot; ];then</span><br><span class="line">echo &quot;æ–‡ä»¶å¤¹å­˜åœ¨&quot;</span><br><span class="line">else</span><br><span class="line">echo &quot;æ–‡ä»¶å¤¹ä¸å­˜åœ¨&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨-1">4.åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if [ -f &quot;/data/filename&quot; ];then</span><br><span class="line">echo &quot;æ–‡ä»¶å­˜åœ¨&quot;</span><br><span class="line">else</span><br><span class="line">echo &quot;æ–‡ä»¶ä¸å­˜åœ¨&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h2 id="æ—¥æœŸå¤„ç†">æ—¥æœŸå¤„ç†</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">n å¤©åçš„æ—¥æœŸ yyyy-mm-dd</span></span><br><span class="line">n_days_later=`date --date &quot;$&#123;cur_day&#125; n day&quot; +%Y-%m-%d`</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">n å¤©å‰çš„æ—¥æœŸ</span> </span><br><span class="line">n_days_ago=`date --date &quot;$&#123;cur_day&#125; n day ago&quot; +%Y-%m-%d`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># è·å–æ—¶é—´æˆ³ï¼Œç”¨ä»¥æ¯”è¾ƒå¤§å°</span></span></span><br><span class="line">today_t=`date -d &quot;$&#123;today&#125;&quot; +%s`</span><br><span class="line">tomorrow_t=`date -d &quot;$&#123;tomorrow&#125;&quot; +%s`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># å¾ªç¯ä¸€æ®µæ—¶é—´ yyyy-mm-dd</span></span></span><br><span class="line">start_day=2019-09-08</span><br><span class="line">end_day=2019-09-17</span><br><span class="line">dt=$&#123;start_day&#125; </span><br><span class="line">while [ &quot;$&#123;dt&#125;&quot; != &quot;$&#123;end_day&#125;&quot; ];do</span><br><span class="line">    echo &quot;-------------ç»Ÿè®¡æ—¥æœŸ: $&#123;dt&#125;----------------&quot;</span><br><span class="line">    predt=$(date -I -d &quot;$&#123;dt&#125; - 1 day&quot;)</span><br><span class="line">    dt=$(date -I -d &quot;$&#123;dt&#125; + 1 day&quot;)</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ¡ä»¶è¯­å¥ifwhile">æ¡ä»¶è¯­å¥(if,whileï¼‰</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># while æ¡ä»¶è¯­å¥</span></span></span><br><span class="line">while [ $&#123;today_t&#125; -le $&#123;tomorrow&#125; ];</span><br><span class="line">do</span><br><span class="line">    # do sth</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># if æ¡ä»¶è¯­å¥</span></span></span><br><span class="line">if [ $&#123;today_t&#125; -le $&#123;tomorrow_t&#125; ];</span><br><span class="line">then</span><br><span class="line">    #do sth</span><br><span class="line">    else</span><br><span class="line">    #do otherthing</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="if-æ¡ä»¶åˆ¤æ–­å¤§æ‹¬å·ä¸­æ‹¬å·åœ†æ‹¬å·">ifæ¡ä»¶åˆ¤æ–­å¤§æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œåœ†æ‹¬å·</h3><p><a href="https://www.jianshu.com/p/3e1eaaa3fee8"class="uri">https://www.jianshu.com/p/3e1eaaa3fee8</a></p><h3 id="åˆ¤æ–­æ–‡ä»¶æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨">åˆ¤æ–­æ–‡ä»¶ã€æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨</h3><p><a href="https://www.cnblogs.com/emanlee/p/3583769.html"class="uri">https://www.cnblogs.com/emanlee/p/3583769.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if [ ! -d &quot;$folder&quot;]; then</span><br><span class="line">  mkdir &quot;$folder&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºç©º">åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºç©º</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 1.åˆ¤æ–­å˜é‡</span><br><span class="line">if [ ! -n &quot;$var&quot; ];then ...</span><br><span class="line"># 2.åˆ¤æ–­è¾“å…¥å‚æ•°</span><br><span class="line">if [ ! -n &quot;$1&quot; ];then ...</span><br><span class="line"># 3.ç›´æ¥å˜é‡åˆ¤æ–­</span><br><span class="line">if [ ! $var ];then ...</span><br><span class="line"># 4.ä½¿ç”¨teståˆ¤æ–­</span><br><span class="line">if test -z &quot;$var&quot; then ...</span><br><span class="line"># 5.ä½¿ç”¨&quot;&quot;åˆ¤æ–­</span><br><span class="line">if [ &quot;$var&quot; == &quot;&quot; ] then ...</span><br></pre></td></tr></table></figure><ol start="2" type="1"><li></li><li></li></ol><h2 id="æ£€ç´¢">æ£€ç´¢</h2><h3 id="æŸ¥æ‰¾æ–‡ä»¶">æŸ¥æ‰¾æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#find æœç´¢ç›®å½• -name ç›®æ ‡åå­—</span><br><span class="line">#eg.</span><br><span class="line">find / -name filename  # /ä»£è¡¨æ˜¯å…¨ç›˜æœç´¢,ä¹Ÿå¯ä»¥æŒ‡å®šç›®å½•æœç´¢</span><br><span class="line"> </span><br><span class="line">##find æœç´¢æ–‡ä»¶çš„å‘½ä»¤æ ¼å¼ï¼š</span><br><span class="line">##find [æœç´¢èŒƒå›´] [åŒ¹é…æ¡ä»¶]</span><br><span class="line">#é€‰é¡¹ï¼š</span><br><span class="line">#    -name  æ ¹æ®åå­—æŸ¥æ‰¾ï¼ˆç²¾ç¡®æŸ¥æ‰¾ï¼‰</span><br><span class="line">#    -iname æ ¹æ®æ–‡ä»¶åæŸ¥æ‰¾ï¼Œä½†æ˜¯ä¸åŒºåˆ†å¤§å°å†™</span><br><span class="line">#    -size  æ ¹æ®æ–‡ä»¶å¤§å°æŸ¥æ‰¾, +,-:å¤§äºè®¾ç½®çš„å¤§å°,ç›´æ¥å†™å¤§å°æ˜¯ç­‰äº</span><br><span class="line">#    -user  æŸ¥æ‰¾ç”¨æˆ·åçš„æ‰€æœ‰è€…çš„æ‰€æœ‰æ–‡ä»¶</span><br><span class="line">#    -group æ ¹æ®æ‰€å±ç»„æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶</span><br><span class="line">#    -type  æ ¹æ®æ–‡ä»¶ç±»å‹æŸ¥æ‰¾(fæ–‡ä»¶,dç›®å½•,lè½¯é“¾æ¥æ–‡ä»¶)</span><br><span class="line">#    -inum  æ ¹æ®ièŠ‚ç‚¹æŸ¥æ‰¾</span><br><span class="line">#    -amin  è®¿é—®æ—¶é—´access</span><br><span class="line">#    -cmin  æ–‡ä»¶å±æ€§change</span><br><span class="line">#    -mmin  æ–‡ä»¶å†…å®¹modify</span><br><span class="line">#example    </span><br><span class="line">find /etc -iname &quot;*.sh&quot;</span><br><span class="line">find /etc -iname &quot;*.service&quot; 2&gt; /dev/null</span><br></pre></td></tr></table></figure><h2 id="é‡å®šå‘ä¸æ–‡ä»¶æ“ä½œç¬¦">é‡å®šå‘ä¸æ–‡ä»¶æ“ä½œç¬¦</h2><p><a href="https://www.zhihu.com/question/53295083/answer/135258024"class="uri">https://www.zhihu.com/question/53295083/answer/135258024</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># åˆ†å¼€å†™</span><br><span class="line">cmd 2&gt;stderr.txt 1&gt;stdout.txt</span><br><span class="line"># å†™å…¥ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">cmd &gt; output.txt 2&gt;&amp;1</span><br><span class="line">cmd &amp;&gt; output.txt</span><br><span class="line">cmd &gt;&amp; output.txt  # ä¸¤ä¸ªè¡¨è¾¾å¼æ•ˆæœä¸€æ ·å“’~</span><br></pre></td></tr></table></figure><p><a href="https://zhuanlan.zhihu.com/p/58419951"class="uri">https://zhuanlan.zhihu.com/p/58419951</a> find /etc -iname"*.service" 2&gt;&amp;1 1&gt;services.txt è¿™æ˜¯å› ä¸º Bash ä»å·¦åˆ°å³å¤„ç†find çš„æ¯ä¸ªç»“æœã€‚è¿™æ ·æƒ³ï¼šå½“ Bash åˆ°è¾¾ 2&gt;&amp;1 æ—¶ï¼Œstdoutï¼ˆ1ï¼‰ä»ç„¶æ˜¯æŒ‡å‘ç»ˆç«¯çš„é€šé“ã€‚å¦‚æœ find ç»™ Bashçš„ç»“æœåŒ…å«ä¸€ä¸ªé”™è¯¯ï¼Œå®ƒå°†è¢«å¼¹å‡ºåˆ° 2ï¼Œè½¬ç§»åˆ° 1ï¼Œç„¶åç•™åœ¨ç»ˆç«¯ï¼</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨ï¼š find /etc -iname "*.service" 1&gt;services.txt2&gt;&amp;1 1 ä»ä¸€å¼€å§‹å°±æŒ‡å‘ services.txtï¼Œå› æ­¤ä»»ä½•å¼¹å‡ºåˆ° 2çš„å†…å®¹éƒ½ä¼šå¯¼å‘åˆ° 1 ï¼Œè€Œ 1 å·²ç»æŒ‡å‘æœ€ç»ˆå»çš„ä½ç½®services.txtï¼Œè¿™å°±æ˜¯å®ƒå·¥ä½œçš„åŸå› ã€‚</p><p>åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå¦‚ä¸Šæ‰€è¿° &amp;&gt; éƒ½æ˜¯â€œæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯â€çš„ç¼©å†™ï¼Œå³2&gt;&amp;1ã€‚</p><h2 id="shellå‡½æ•°è¿”å›å­—ç¬¦ä¸²å‚æ•°">shellå‡½æ•°è¿”å›å­—ç¬¦ä¸²å‚æ•°</h2><p><ahref="https://roc-wong.github.io/blog/2017/03/shell-%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%96%B9%E6%B3%95.html">å‚è€ƒåšå®¢</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">function</span> å…³é”®å­—å¯ä»¥çœç•¥ï¼Œ<span class="built_in">return</span> valueåªèƒ½æ˜¯æ•´æ•°ï¼Œä»£è¡¨è¿”å›çŠ¶æ€</span></span><br><span class="line">function function_name () &#123;</span><br><span class="line">    list of commands</span><br><span class="line">    [ return value ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">èµ‹å€¼æ–¹å¼</span></span><br><span class="line">function fun1()&#123;</span><br><span class="line">    res=`cmd xxxx`</span><br><span class="line">    echo $res</span><br><span class="line">&#125;</span><br><span class="line">res=`fun1`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¼ å‚èµ‹å€¼æ–¹å¼</span></span><br><span class="line">function fun2()&#123;</span><br><span class="line">    tmp=`res`</span><br><span class="line">    eval &quot;$1=$res&quot;</span><br><span class="line">&#125;</span><br><span class="line">res=&quot;&quot;</span><br><span class="line">fun2 $res</span><br><span class="line">echo $res</span><br></pre></td></tr></table></figure><table><colgroup><col style="width: 75%" /><col style="width: 25%" /></colgroup><thead><tr><th style="text-align: center;">variable</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align: center;">$0</td><td>è„šæœ¬æœ¬èº«çš„åå­—ï¼›</td></tr><tr><td style="text-align: center;">$#</td><td>ä¼ ç»™è„šæœ¬çš„å‚æ•°ä¸ªæ•°ï¼›</td></tr><tr><td style="text-align: center;">$@</td><td>ä¼ ç»™è„šæœ¬çš„æ‰€æœ‰å‚æ•°çš„åˆ—è¡¨ï¼Œå³è¢«æ‰©å±•ä¸ºâ€$1â€ â€œ$2â€ â€œ$3â€ç­‰ï¼›</td></tr><tr><td style="text-align: center;">$*</td><td>ä»¥ä¸€ä¸ªå•å­—ç¬¦ä¸²æ˜¾ç¤ºæ‰€æœ‰å‘è„šæœ¬ä¼ é€’çš„å‚æ•°ï¼Œä¸ä½ç½®å˜é‡ä¸åŒï¼Œå‚æ•°å¯è¶…è¿‡9ä¸ªå³è¢«æ‰©å±•æˆâ€$1c$2c$3â€ï¼Œå…¶ä¸­cæ˜¯IFSçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼›</td></tr><tr><td style="text-align: center;">$$</td><td>æ˜¯è„šæœ¬è¿è¡Œçš„å½“å‰è¿›ç¨‹IDå·ï¼›</td></tr><tr><td style="text-align: center;">$?</td><td>æ˜¯æ˜¾ç¤ºæœ€åå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼Œ0è¡¨ç¤ºæ²¡æœ‰é”™è¯¯ï¼Œå…¶ä»–è¡¨ç¤ºæœ‰é”™è¯¯ï¼›</td></tr><tr><td style="text-align: center;">$n</td><td>è·å–å‚æ•°çš„å€¼ï¼Œ$1è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå½“n&gt;=10æ—¶ï¼Œéœ€è¦ä½¿ç”¨${n}æ¥è·å–å‚æ•°ã€‚</td></tr></tbody></table><h2 id="shell-ä¸­-çš„åŒºåˆ«">Shell ä¸­ $(())", $(), ``, ${} çš„åŒºåˆ«</h2><p>$()å’Œ``ç±»ä¼¼ï¼Œå¯¹å½“ä¸­çš„è¡¨è¾¾å¼è®¡ç®—å¾—å‡ºç»“æœ, $(()) è®¡ç®—æ•°å­¦è¡¨è¾¾å¼å‚è€ƒï¼š<a href="https://www.cnblogs.com/chengd/p/7803664.html"class="uri">https://www.cnblogs.com/chengd/p/7803664.html</a> æ³¨æ„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">file.txt</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hello world</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">this is a <span class="built_in">test</span> file</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸‹é¢è¿™ç§<span class="keyword">for</span>å¾ªç¯ç»“æœå¹¶ä¸æ˜¯æŒ‰è¡Œæ˜¾ç¤ºï¼Œå…¶å®æœªæŒ‰å­—ç¬¦æ˜¾ç¤ºï¼Œä¸»è¦åŸå› æ˜¯`<span class="built_in">cat</span> xxx`å‘½ä»¤çš„åˆ°çš„ç»“æœæ˜¯<span class="string">&quot;hello&#123;space&#125;world&#123;\n&#125;this&#123;sapce&#125;isâ€¦â€¦</span></span></span><br><span class="line">for line in `cat file.txt`</span><br><span class="line">do </span><br><span class="line">echo $line</span><br><span class="line">done;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æ­£ç¡®åº”è¯¥ç”¨å¦‚ä¸‹æ–¹å¼</span></span></span><br><span class="line">while read line</span><br><span class="line">do</span><br><span class="line">echo $line</span><br><span class="line">done &lt; file.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¤šä¸ªå‘½ä»¤å…ˆåæ‰§è¡Œ">å¤šä¸ªå‘½ä»¤å…ˆåæ‰§è¡Œ</h2><p>[åœ¨å‘½ä»¤è¡Œä¸­åŒæ—¶è¾“å…¥å¤šä¸ªè¯­å¥][3]ï¼šç›´æ¥åœ¨linuxå‘½ä»¤è¡Œä¸­å¯ä»¥ä¾æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œå¤šä¸ªå‘½ä»¤é—´å¯é‡‡ç”¨â€œ;â€ã€â€œ&amp;&amp;â€å’Œ"||"åˆ†å‰²ï¼Œä¸‰ä¸ªåˆ†éš”ç¬¦ä½œç”¨ä¸åŒï¼šï¼ˆ1ï¼‰;åˆ†å‰²ç¬¦ï¼šå‰åå‘½ä»¤é—´æ²¡æœ‰å¿…ç„¶çš„è”ç³»ï¼Œå‰ä¸€ä¸ªæ‰§è¡Œç»“æŸåã€å†æ‰§è¡Œç¬¬äºŒä¸ªï¼Œæ²¡æœ‰é€»è¾‘å…³è”ï¼›ï¼ˆ2ï¼‰&amp;&amp;åˆ†éš”ç¬¦ï¼šå‰åå‘½ä»¤æœ‰é€»è¾‘å…³è”ï¼Œåé¢çš„å‘½ä»¤æ˜¯å¦æ‰§è¡Œå–å†³äºå‰é¢çš„å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå‰è€…æ‰§è¡ŒæˆåŠŸï¼Œæ‰ä¼šæ‰§è¡Œåé¢çš„å‘½ä»¤ã€‚ï¼ˆ3ï¼‰||åˆ†éš”ç¬¦ï¼šå‰åå‘½ä»¤æœ‰é€»è¾‘å…³è”ï¼Œä¸&amp;&amp;ç›¸åï¼Œå‰é¢çš„å‘½ä»¤æ‰§è¡Œå¤±è´¥åæ‰èƒ½æ‰§è¡Œåé¢çš„å‘½ä»¤ã€‚</p><p>[3]: <ahref="https://blog.csdn.net/cooperdoctor/article/details/84333686"class="uri">https://blog.csdn.net/cooperdoctor/article/details/84333686</a>"</p><h2 id="selenium">selenium</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> selenium</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">auto_check</span>():</span><br><span class="line"> </span><br><span class="line"> driverOptions = webdriver.ChromeOptions()</span><br><span class="line"> driverOptions.add_argument(<span class="string">r&quot;user-data-dir=C:\Users\yuanwenwu3\AppData\Local\Google\Chrome\User Data&quot;</span>)</span><br><span class="line"> driverOptions.add_argument(<span class="string">&quot;--log-level=3&quot;</span>)</span><br><span class="line"> driver = webdriver.Chrome(<span class="string">&quot;chromedriver&quot;</span>,<span class="number">0</span>,driverOptions)</span><br><span class="line"> </span><br><span class="line"> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> ProfilesIni allProfiles = new ProfilesIni();</span></span><br><span class="line"><span class="string">    FirefoxProfile profile = allProfiles.getProfile(&quot;default&quot;); </span></span><br><span class="line"><span class="string">    WebDriever driver  = new FirefoxDriver(profile)</span></span><br><span class="line"><span class="string"> &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">#driver.get(&quot;http://erp.jd.com/portal/navMenu/subPage?menuId=50570&quot;)</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#driver.find_element_by_css_selector(&quot;#subDiv &gt; div.aside &gt; div.jquery-accordion-menu.jdskin &gt; div &gt; ul &gt; li:nth-child(5) &gt; a&quot;).click()</span></span><br><span class="line"></span><br><span class="line"> driver.get(<span class="string">&quot;http://kaoqin.jd.com/&quot;</span>)</span><br><span class="line"></span><br><span class="line"> time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">try</span>:</span><br><span class="line">  driver.find_element_by_css_selector(<span class="string">&quot;body &gt; div &gt; div &gt; div &gt; div.login_pop_inner.login_withpc.eye-protector-processed &gt; form &gt; div.login_form_row.formsubmit &gt; input&quot;</span>).click()</span><br><span class="line">  driver.find_element_by_css_selector(<span class="string">&quot;#clockIn&quot;</span>).click()</span><br><span class="line"> <span class="keyword">except</span> selenium.common.exceptions.NoSuchElementException <span class="keyword">as</span> e:</span><br><span class="line">  driver.find_element_by_css_selector(<span class="string">&quot;#clockIn&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"> time.sleep(<span class="number">3</span>) </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"> auto_check()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ•°ç»„&quot;&gt;æ•°ç»„&lt;/h2&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;# &lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;åˆ›å»ºæ•°ç»„(æ³¨æ„ä¸éœ€è¦é€—å·ï¼Œä»¥ç©ºæ ¼åˆ†éš”)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;array=(1 2 3 4)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;è·å–æ‰€æœ‰å…ƒç´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $&amp;#123;array[@]&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;è·å–ç¬¬ä¸€ä¸ªå…ƒç´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $&amp;#123;array[0]&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;è·å–æ•°ç»„å…ƒç´ ä¸ªæ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $&amp;#123;#array[@]&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;å¦‚æœæŸä¸ªå…ƒç´ æ˜¯å­—ç¬¦ä¸²ï¼Œè¿˜å¯ä»¥é€šè¿‡æŒ‡å®šä¸‹æ ‡çš„æ–¹å¼è·å¾—è¯¥å…ƒç´ çš„é•¿åº¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $&amp;#123;#array[2]&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;å› ä¸ºå­—ç¬¦ä¸²è·å–é•¿åº¦å¦‚ä¸‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;str=&amp;quot;hello world&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo $&amp;#123;#str&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>linear-algebra</title>
    <link href="http://yoursite.com/2024/02/29/linear-algebra/"/>
    <id>http://yoursite.com/2024/02/29/linear-algebra/</id>
    <published>2024-02-29T09:24:28.000Z</published>
    <updated>2025-05-22T05:50:40.080Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å­¦ä¹ SVMæ—¶ï¼Œé‡åˆ°äº†dotproductçš„é—®é¢˜ï¼Œä¸€æ—¶å¿˜äº†åœ¨algebraä¸‹å®šä¹‰çš„å‘é‡å†…ç§¯å’Œåœ¨geometryä¸‹å®šä¹‰çš„å‘é‡å†…ç§¯ä¸ºä½•ç›¸ç­‰ï¼ŒæŸ¥æ‰¾äº†ä¸€ä¸‹èµ„æ–™ï¼Œå‘ç°å¾ˆæœ‰è¶£ï¼Œæ•…è®°å½•å¦‚ä¸‹ã€‚This operation can be defined either algebraically or geometrically.</p><ul><li>Algebraically, it is the sum of the products of the correspondingentries of the two sequences of numbers.</li><li>Geometrically, it is the product of the Euclidean magnitudes of thetwo vectors and the cosine of the angle between them.</li></ul><h2 id="algebraic-definition">Algebraic definition</h2><p>The dot product of two vectors A = [A1, A2, ..., An] and B = [B1, B2,..., Bn] is defined as: <span class="math display">\[\mathbf{A}\cdot\mathbf{B} = \sum_{i=1}^n A_iB_i = A_1B_1 + A_2B_2 + \cdots +A_nB_n\]</span></p><h2 id="geometric-definition">Geometric definition</h2><p>In Euclidean space, a Euclidean vector is a geometrical object thatpossesses both a magnitude and a direction. A vector can be pictured asan arrow. Its magnitude is its length, and its direction is thedirection that the arrow points. The magnitude of a vector A is denotedby <span class="math inline">\(\|\mathbf{A}\|\)</span>. The dot productof two Euclidean vectors A and B is defined by</p><p><span class="math display">\[\mathbf{A}\cdot\mathbf{B} =|\mathbf{A}||\mathbf{B}|\cos\theta \]</span></p><p>where Î¸ is the angle between A and B.</p><h2 id="equivalence-of-the-definitions">Equivalence of thedefinitions</h2><p>If e1,...,en are the standard basis vectors in Rn, then we may write<span class="math display">\[\begin{align}\mathbf A &amp;= [A_1,\dots,A_n] = \sum_i A_i\mathbf e_i\\\mathbf B &amp;= [B_1,\dots,B_n] = \sum_i B_i\mathbf e_i.\end{align}\]</span></p><p>The vectors <span class="math inline">\(e_i\)</span> are anorthonormal basis, which means that they have unit length and are atright angles to each other. Hence since these vectors have unit length<span class="math inline">\(\mathbf e_i\cdot\mathbf e_i=1\)</span> andsince they form right angles with each other, if <spanclass="math inline">\(i â‰  j\)</span>, <spanclass="math inline">\(\mathbf e_i\cdot\mathbf e_j = 0.\)</span> Also, bythe geometric definition, for any vector ei and a vector A, we note<span class="math inline">\(\mathbf A\cdot\mathbf e_i = \|\mathbfA\|\,\|\mathbf e_i\|\cos\theta = \|\mathbf A\|\cos\theta = A_i\)</span>,where Ai is the component of vector A in the direction of ei. Nowapplying the distributivity of the geometric version of the dot productgives <span class="math display">\[\mathbf A\cdot\mathbf B = \mathbfA\cdot\sum_i B_i\mathbf e_i = \sum_i B_i(\mathbf A\cdot\mathbf e_i) =\sum_i B_iA_i\]</span> which is precisely the algebraic definition ofthe dot product. So the (geometric) dot product equals the (algebraic)dot product.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨å­¦ä¹ SVMæ—¶ï¼Œé‡åˆ°äº†dot
productçš„é—®é¢˜ï¼Œä¸€æ—¶å¿˜äº†åœ¨algebraä¸‹å®šä¹‰çš„å‘é‡å†…ç§¯å’Œåœ¨geometryä¸‹å®šä¹‰çš„å‘é‡å†…ç§¯ä¸ºä½•ç›¸ç­‰ï¼ŒæŸ¥æ‰¾äº†ä¸€ä¸‹èµ„æ–™ï¼Œå‘ç°å¾ˆæœ‰è¶£ï¼Œæ•…è®°å½•å¦‚ä¸‹ã€‚
This operation can be defined either algebrai</summary>
      
    
    
    
    <category term="math" scheme="http://yoursite.com/categories/math/"/>
    
    
    <category term="math" scheme="http://yoursite.com/tags/math/"/>
    
  </entry>
  
  <entry>
    <title>gitNote</title>
    <link href="http://yoursite.com/2024/02/20/gitNote/"/>
    <id>http://yoursite.com/2024/02/20/gitNote/</id>
    <published>2024-02-20T05:28:00.000Z</published>
    <updated>2025-05-22T05:50:40.064Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ–°å»ºå…³è”è¿œç¨‹åˆ†æ”¯">æ–°å»ºï¼ˆå…³è”ï¼‰è¿œç¨‹åˆ†æ”¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Git global setup</span></span><br><span class="line">git config --<span class="keyword">global</span> user.name <span class="string">&quot;yuanwenwu3&quot;</span></span><br><span class="line">git config --<span class="keyword">global</span> user.email <span class="string">&quot;yuanwenwu3@jd.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Create a new repository</span></span><br><span class="line"></span><br><span class="line">git clone git@git.jd.com:yuanwenwu3/draw_tensorboard.git</span><br><span class="line">cd draw_tensorboard</span><br><span class="line">touch README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">&quot;add README&quot;</span></span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line"><span class="comment">### Push an existing folder</span></span><br><span class="line">cd existing_folder</span><br><span class="line">git init</span><br><span class="line">git remote add origin git@git.jd.com:yuanwenwu3/draw_tensorboard.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;Initial commit&quot;</span></span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line"><span class="comment">### Push an existing Git repository</span></span><br><span class="line">cd existing_repo</span><br><span class="line">git remote rename origin old-origin</span><br><span class="line">git remote add origin git@git.jd.com:yuanwenwu3/draw_tensorboard.git</span><br><span class="line">git push -u origin --<span class="built_in">all</span></span><br><span class="line">git push -u origin --tags</span><br><span class="line"></span><br><span class="line"><span class="comment">### è¿ç§»é¡¹ç›®</span></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªç©ºçš„repository, ä¾‹å¦‚åœ°å€ä¸ºurl-destination</span></span><br><span class="line"><span class="comment"># åœ¨å½“å‰é¡¹ç›®ä¸»åˆ†æ”¯ä¸Š</span></span><br><span class="line">git remote add destination $&#123;url-destination&#125;</span><br><span class="line">git push -u origin --<span class="built_in">all</span></span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="å·²ç»commitçš„å›é€€åˆ°addçŠ¶æ€">å·²ç»commitçš„å›é€€åˆ°addçŠ¶æ€</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --soft HEAD~<span class="number">1</span></span><br></pre></td></tr></table></figure><h2id="æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹äº†é‚£äº›æ–‡ä»¶åˆ—è¡¨å½¢å¼å±•ç¤º">æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹äº†é‚£äº›æ–‡ä»¶ï¼ˆåˆ—è¡¨å½¢å¼å±•ç¤º)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git diff --name-only HEAD^ HEAD</span><br><span class="line">git log --name-only <span class="comment">#ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">git log --stat <span class="comment">#ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨, åŠæ–‡ä»¶ä¿®æ”¹çš„ç»Ÿè®¡</span></span><br><span class="line">git log --name-status <span class="comment">#ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨, æ˜¾ç¤ºçŠ¶æ€</span></span><br></pre></td></tr></table></figure><h2 id="git-æŸ¥çœ‹æ—¥å¿—ç²¾ç®€">git æŸ¥çœ‹æ—¥å¿—ç²¾ç®€</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git log --pretty=oneline --author=<span class="string">&quot;vinyuan&quot;</span></span><br><span class="line"></span><br><span class="line">15f3e2fa840fa49d0a576eb5e3f63a295a0ea522 Merged PR <span class="number">1211</span>: fix shopping bpr large scale dag file</span><br><span class="line">c1a323928e399357c427ec507c3b6c7927e3f60f Merged PR <span class="number">1208</span>: shopping_bpr modify lookbackwindow</span><br><span class="line">945c30534c71fee996757a3fb730cc9f7ee3bf67 Merged PR <span class="number">1207</span>: shopping bpr fix scope timezone problem</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><h2 id="git-è¡¥å……commit">Git è¡¥å……commit</h2><p>https://blog.csdn.net/chilun8494/article/details/100645862</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ç¬¬ä¸€æ¬¡commitå†…å®¹</span><br><span class="line">$ echo &#x27;Hello world&#x27; &gt; README.md</span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -m &quot;Add README.md&quot;</span><br><span class="line">$ git log --oneline</span><br><span class="line">c56f680 Add README.md</span><br><span class="line"># ä¿®æ”¹æ–‡ä»¶å†…å®¹å¹¶åˆå¹¶åˆ°ä¸Šä¸€æ¬¡çš„commitå˜æ›´å½“ä¸­</span><br><span class="line">$ echo &#x27;Hello voidint&#x27; &gt;&gt; README.md</span><br><span class="line">$ git add .</span><br><span class="line">$ git commit --amend --no-edit</span><br><span class="line">$ git log --oneline</span><br><span class="line">eb6c8cb Add README.md // hashå€¼å‘ç”Ÿäº†å˜åŒ–</span><br></pre></td></tr></table></figure><h2 id="sshé…ç½®å¤šä¸ªgitè´¦æˆ·">sshé…ç½®å¤šä¸ªgitè´¦æˆ·</h2><p>æƒ…æ™¯ï¼š<ahref="https://blog.csdn.net/onTheRoadToMine/article/details/79029331">ã€å‚è€ƒåšå®¢ã€‘</a>åŒä¸€å°æœºå™¨æœ‰å¤šä¸ªgitè´¦æˆ·çš„é—®é¢˜ã€‚åœ¨é…ç½®gitæƒé™æ—¶ï¼Œéœ€è¦é…ç½®ssh-keygenï¼Œä¼šè¿è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;vinyuan@microsoft.com&quot;</span></span><br></pre></td></tr></table></figure><p>å‘½ä»¤ä¼šåœ¨<code>~/.ssh/</code>ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶: <code>id_rsa</code>å’Œ<code>id_rsa.pub</code>ï¼Œç„¶åå°†<code>id_rsa.pub</code>çš„å†…å®¹å¤åˆ¶åˆ°gitæˆ–è€…gitLabä¸­çš„<code>ssh setting</code>ä¸­å³å¯ã€‚ä½†å¦‚æœæœ‰å¤šä¸ªç”¨æˆ·å°±ä¼šé¢ä¸´å¦‚ä¸‹é—®é¢˜ï¼šæ¯ä¸ªç”¨æˆ·éƒ½éœ€è¦é…ç½®è‡ªå·±çš„sshsettingï¼Œç”Ÿæˆä¸€ä¸ªç§é’¥å°±ä¼šè¦†ç›–ä¹‹å‰çš„ <code>id_rsa</code>å’Œ<code>id_ras.pub</code>ã€‚å¦‚ä½•é¿å…ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯åœ¨ â€œ~/.ssh/configâ€ (å¦‚æœæ²¡æœ‰å¯ä»¥å»ºä¸€ä¸ªï¼‰ä¸­é…ç½®ã€‚ ~/.ssh/configçš„è§„åˆ™å¯ä»¥æŸ¥çœ‹<ahref="https://deepzz.com/post/how-to-setup-ssh-config.html">ã€å‚è€ƒé“¾æ¥ã€‘</a>å¸¸ç”¨çš„å‚æ•°æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host example                       <span class="comment"># å…³é”®è¯</span></span><br><span class="line">    HostName example.com           <span class="comment"># ä¸»æœºåœ°å€</span></span><br><span class="line">    User root                      <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">    IdentityFile ~/.ssh/id_ecdsa <span class="comment"># è®¤è¯æ–‡ä»¶</span></span><br><span class="line">    Port <span class="number">22</span>                      <span class="comment"># æŒ‡å®šç«¯å£</span></span><br></pre></td></tr></table></figure><p>~/.ssh/configçš„ä½œç”¨å¯ä½¿ä½ é€šè¿‡åˆ«åï¼ˆå³å…³é”®è¯ï¼‰ç™»å½•ç›®æ ‡æœåŠ¡å™¨ï¼Œä¾‹å¦‚<code>ssh example</code>è€Œä¸å¿…<code>ssh -p xxx admin@xxx.xxx.xxx.xxx</code>è¿™ä¸ªæ–‡ä»¶è¿˜å¯ä»¥ç”¨æ¥ç®¡ç†å¤šgitç”¨æˆ·ã€‚ ä»¥ä¸¤ä¸ªç”¨æˆ·user1,user2ä¸ºä¾‹ï¼Œå…ˆåç”Ÿæˆå„è‡ªçš„å…¬é’¥ã€å¯†é’¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">**ssh-keygen -t rsa -C <span class="string">&quot;user1@hotmail.com&quot;</span>**</span><br><span class="line"> å¡«å†™å¯†é’¥å­˜æ”¾ä½ç½®ï¼šä¾‹å¦‚<span class="string">&quot;~/.ssh/user1_id_rsa</span></span><br><span class="line"><span class="string"> ssh-keygen -t rsa -C &quot;</span>user2@gmail.com<span class="string">&quot;</span></span><br><span class="line"><span class="string"> å¡«å†™å¯†é’¥å­˜æ”¾ä½ç½®ï¼šä¾‹å¦‚&quot;</span>~/.ssh/user2_id_rsa</span><br><span class="line"> ç”Ÿæˆå®Œæˆåä¼šåœ¨~/.ssh/ä¸‹å‡ºç°å››ä¸ªæ–‡ä»¶</span><br><span class="line"> ls ~/.ssh/</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ user1_id_rsa</span><br><span class="line">â”œâ”€â”€ user1_id_rsa.pub</span><br><span class="line">â”œâ”€â”€ user2_id_rsa</span><br><span class="line">â””â”€â”€ user2_id_rsa.pub</span><br></pre></td></tr></table></figure><p>ä¹‹åå¯ä»¥åœ¨~/.ssh/config é…ç½®ä¸åŒç”¨æˆ·çš„sshè¿æ¥æ–¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">github user1@hotmail.com</span><br><span class="line">host github.com  <span class="comment">#åˆ«åï¼Œéšä¾¿å®š åé¢é…ç½®åœ°å€æœ‰ç”¨</span></span><br><span class="line">    Hostname github.com <span class="comment">#è¦è¿æ¥çš„æœåŠ¡å™¨</span></span><br><span class="line">    User user1 <span class="comment">#ç”¨æˆ·å</span></span><br><span class="line">    IdentityFile ~/.ssh/user1_id_rsa  <span class="comment">#å¯†é’¥æ–‡ä»¶çš„åœ°å€ï¼Œæ³¨æ„æ˜¯ç§é’¥</span></span><br><span class="line"></span><br><span class="line">github user2@gmail.com</span><br><span class="line">host user2 <span class="comment">#åˆ«åï¼Œéšä¾¿å®š</span></span><br><span class="line">    Hostname github.com</span><br><span class="line">    User user2</span><br><span class="line">    IdentityFile ~/.ssh/user2_id_rsa</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨sshçš„ssh-addå‘½ä»¤å°†å¯†é’¥æ·»åŠ åˆ° ssh-agentçš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œè¿™æ ·åœ¨å½“å‰ä¼šè¯ä¸­å°±ä¸éœ€è¦å†æ¬¡è¾“å…¥å¯†ç äº† ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> ssh-agent bash</span><br><span class="line">//Aè´¦æˆ·çš„ç§é’¥</span><br><span class="line">ssh-add ~/.ssh/user1_id_rsa</span><br><span class="line">//Bè´¦æˆ·çš„ç§é’¥</span><br><span class="line"> ssh-add ~/.ssh/user2_id_rsa</span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåå¯ä»¥ä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@user1</span><br><span class="line">ä¼šè¿”å› Welcome to GitLab, @user1!</span><br></pre></td></tr></table></figure><p>æ¥æµ‹è¯•è¿æ¥ æ¯ä¸ªgit projectç›®å½•ä¸‹é¢éƒ½æœ‰ä¸€ä¸ª".git/config"æ–‡ä»¶ï¼Œé‡Œé¢é…ç½®äº†è¿œç¨‹ä»“åº“çš„åœ°å€,è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹è·Ÿå¯†é’¥å¯¹åº”çš„åœ°å€ï¼Œä¸Šé¢åœ¨é…ç½®sshæ—¶ï¼Œä¸ºæ¯ä¸ªHostnameé…ç½®äº†ä¸€ä¸ªhostçš„åˆ«åï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨åŸæ¥çš„Hostnameæ¥æäº¤äº†ï¼Œè¦ç”¨åˆ«åæ¥ä»£æ›¿Hostnameã€‚</p><blockquote><p>url = git@<strong>github.com</strong>:user2/Sample.git æ”¹æˆ url =git@<strong>user2</strong>:user2/Sample.git</p></blockquote><p>å¯ä»¥çœ‹åˆ°hostèµ·åˆ°äº†åˆ«åçš„ä½œç”¨ï¼Œå¹¶ä¸”åœ¨ä¸åŒçš„é¡¹ç›®ä¸åŒçš„è´¦æˆ·å¯ä»¥é…ç½®è‡ªå·±çš„ç§é’¥æ–¹å¼ï¼Œé€šè¿‡é…ç½®ä¸åŒçš„xxx_id_rsaï¼Œè¾¾åˆ°äº’ä¸å½±å“çš„æ•ˆæœã€‚</p><p>ç»è¿‡è¿™æ ·é…ç½®åï¼Œå†gitpushæ—¶å°±ä¼šç»è¿‡ä¸åŒçš„å…¬é’¥ï¼Œç§é’¥éªŒè¯è€Œäº’ä¸å½±å“äº†</p><h3 id="å®é™…æ¡ˆä¾‹">å®é™…æ¡ˆä¾‹</h3><h4 id="ç”Ÿæˆå¯†é’¥">1. ç”Ÿæˆå¯†é’¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C â€œyuanwenwu3@jd.comâ€</span><br></pre></td></tr></table></figure><h4 id="å ¡å’æœºé…ç½®.sshconfig">2.å ¡å’æœºé…ç½®~/.ssh/config</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host yuanwenwu3</span><br><span class="line">    HostName git.jd.com</span><br><span class="line">    User yuanwenwu3</span><br><span class="line">    IdentityFile /home/rec/yuanwenwu3/.ssh/id_rsa</span><br><span class="line">    IdentitiesOnly yes</span><br></pre></td></tr></table></figure><h4 id="å ¡å’æœºgité¡¹ç›®ä¸‹.gitconfigé…ç½®">3.å ¡å’æœºgité¡¹ç›®ä¸‹.git/configé…ç½®</h4><p>æ³¨æ„ä¸‹é¢<code>git@git.jd.com</code>è¢«æ¢æˆäº†<code>git@yuanwenwu3</code>ï¼Œå¯¹åº”ä¸Šé¢Hoståç§°</p><p>```python [core] repositoryformatversion = 0 filemode = true bare =false logallrefupdates = true [remote "origin"] url =git@yuanwenwu3:yuanwenwu3/dnn-convert-tfrecord.git fetch =+refs/heads/<em>:refs/remotes/origin/</em> [branch "master"] remote =origin merge = refs/heads/master [user] name = yuanwenwu3 email =yuanwenwu3@jd.com</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ–°å»ºå…³è”è¿œç¨‹åˆ†æ”¯&quot;&gt;æ–°å»ºï¼ˆå…³è”ï¼‰è¿œç¨‹åˆ†æ”¯&lt;/h2&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### Git global setup&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git config --&lt;span class=&quot;keyword&quot;&gt;global&lt;/span&gt; user.name &lt;span class=&quot;string&quot;&gt;&amp;quot;yuanwenwu3&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git config --&lt;span class=&quot;keyword&quot;&gt;global&lt;/span&gt; user.email &lt;span class=&quot;string&quot;&gt;&amp;quot;yuanwenwu3@jd.com&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### Create a new repository&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git clone git@git.jd.com:yuanwenwu3/draw_tensorboard.git&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd draw_tensorboard&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;touch README.md&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git add README.md&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git commit -m &lt;span class=&quot;string&quot;&gt;&amp;quot;add README&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git push -u origin master&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### Push an existing folder&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd existing_folder&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git remote add origin git@git.jd.com:yuanwenwu3/draw_tensorboard.git&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git add .&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git commit -m &lt;span class=&quot;string&quot;&gt;&amp;quot;Initial commit&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git push -u origin master&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### Push an existing Git repository&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd existing_repo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git remote rename origin old-origin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git remote add origin git@git.jd.com:yuanwenwu3/draw_tensorboard.git&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git push -u origin --&lt;span class=&quot;built_in&quot;&gt;all&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git push -u origin --tags&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### è¿ç§»é¡¹ç›®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# æ–°å»ºä¸€ä¸ªç©ºçš„repository, ä¾‹å¦‚åœ°å€ä¸ºurl-destination&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# åœ¨å½“å‰é¡¹ç›®ä¸»åˆ†æ”¯ä¸Š&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git remote add destination $&amp;#123;url-destination&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git push -u origin --&lt;span class=&quot;built_in&quot;&gt;all&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>hexoNote</title>
    <link href="http://yoursite.com/2024/02/20/hexoNote/"/>
    <id>http://yoursite.com/2024/02/20/hexoNote/</id>
    <published>2024-02-20T04:44:32.000Z</published>
    <updated>2025-05-22T05:50:40.064Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¸¸ç”¨hexo-å‘½ä»¤">å¸¸ç”¨hexo å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hexo new xxx ==&gt; hexo n xxx, #æ–°å»ºæ–‡ç« </span><br><span class="line">hexo generate ==&gt; hexo g,  #ç”Ÿæˆé™æ€é¡µé¢è‡³publicç›®å½•</span><br><span class="line">hexo server ==&gt; hexo s,  #å¼€å¯é¢„è§ˆè®¿é—®ç«¯å£</span><br><span class="line">hexo deploy ==&gt; hexo d,  #éƒ¨ç½²åˆ°GitHub</span><br><span class="line">hexo help  #æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">hexo version  #æŸ¥çœ‹Hexoçš„ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><h2 id="ç»„åˆå‘½ä»¤">ç»„åˆå‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo s -g # ç”Ÿæˆæœ¬åœ°é¢„è§ˆ</span><br><span class="line">hexo d -g # ç”Ÿæˆå¹¶ä¸Šä¼ </span><br></pre></td></tr></table></figure><h2 id="é¢„è§ˆéƒ¨åˆ†æ–‡å­—">é¢„è§ˆéƒ¨åˆ†æ–‡å­—</h2><p>&lt; !-- more -- &gt; in your article to break your article manually,which is recommended by Hexo.</p><h2 id="é‡åˆ°hexo-generation-å‡ºé”™å¤„ç†">é‡åˆ°hexo generation å‡ºé”™å¤„ç†</h2><p>æ£€æŸ¥Markedown (vscode markdownè¯­æ³•æ£€æŸ¥)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo --debug</span><br><span class="line">hexo generate</span><br></pre></td></tr></table></figure><h2 id="clone-whole-repository-in-a-new-machine">clone whole repositoryin a new machine</h2><p><ahref="https://iphysresearch.github.io/blog/post/programing/git/git_submodule/"class="uri">https://iphysresearch.github.io/blog/post/programing/git/git_submodule/</a>since there is submodule in main repository ( the theme/next)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone xxxx (main repository)</span><br><span class="line">git submodule init # åˆå§‹åŒ–å­æ¨¡å—</span><br><span class="line">git submodule update # æ›´æ–°å­æ¨¡å—</span><br><span class="line">npm install</span><br><span class="line">hexo generate or hexo s</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è°ƒè¯•çš„æ—¶å€™é‡åˆ°ä¸åæ›²é—®é¢˜ï¼Œå¯ä»¥å®‰è£…pandoc, https://pandoc.org/installing.html</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™ä¼šæŒ‡ç¤ºé‚£ä¸€ä¸ªæ–‡ä»¶çš„å“ªä¸€è¡Œå‡ºé”™äº†</span></span><br></pre></td></tr></table></figure><p><a href="https://hexo.io/zh-cn/docs/commands.html"class="uri">https://hexo.io/zh-cn/docs/commands.html</a></p><span id="more"></span><h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2><p>æ•´ä½“é…ç½®ï¼š<a href="https://learnku.com/articles/45697"class="uri">https://learnku.com/articles/45697</a></p><p>latex: (<ahref="https://www.jianshu.com/p/d95a4795f3a8?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation"class="uri">https://www.jianshu.com/p/d95a4795f3a8?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation</a>)</p><p>hexo: <a href="https://github.com/next-theme/hexo-theme-next"class="uri">https://github.com/next-theme/hexo-theme-next</a></p><p>hexo post settings: <ahref="https://theme-next.js.org/docs/theme-settings/posts"class="uri">https://theme-next.js.org/docs/theme-settings/posts</a></p><h2 id="qa">Q&amp;A</h2><p>hexo generateç¼–è¯‘å‡ºé”™è®°å½• markdown æ–‡ä»¶æœ‰ä¸åˆæ³•çš„link, æ¯”å¦‚:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ„Ÿå¹å·+[æŸæ¾åˆ†éƒ¨ ç»Ÿè®¡å‡ºç°è½¦è¾†æ•°](https://newonlinecourses.science.psu.edu/stat414/sites/onlinecourses.science.psu.edu.stat414/files/lesson52/147882_traffic/index.jpg)</span><br><span class="line">[<span class="number">1</span>]. &lt;https://newonlinecourses.science.psu.edu/stat414/node/<span class="number">241</span>/&gt;</span><br><span class="line">å¤§æ¦‚ç‡æ˜¯å¤§æ‹¬å·çš„é—®é¢˜</span><br><span class="line">&lt;200b&gt;ç¬¦å·</span><br></pre></td></tr></table></figure></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å¸¸ç”¨hexo-å‘½ä»¤&quot;&gt;å¸¸ç”¨hexo å‘½ä»¤&lt;/h2&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hexo new xxx ==&amp;gt; hexo n xxx, #æ–°å»ºæ–‡ç« &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hexo generate ==&amp;gt; hexo g,  #ç”Ÿæˆé™æ€é¡µé¢è‡³publicç›®å½•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hexo server ==&amp;gt; hexo s,  #å¼€å¯é¢„è§ˆè®¿é—®ç«¯å£&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hexo deploy ==&amp;gt; hexo d,  #éƒ¨ç½²åˆ°GitHub&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hexo help  #æŸ¥çœ‹å¸®åŠ©&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hexo version  #æŸ¥çœ‹Hexoçš„ç‰ˆæœ¬&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;ç»„åˆå‘½ä»¤&quot;&gt;ç»„åˆå‘½ä»¤&lt;/h2&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hexo s -g # ç”Ÿæˆæœ¬åœ°é¢„è§ˆ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hexo d -g # ç”Ÿæˆå¹¶ä¸Šä¼ &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;é¢„è§ˆéƒ¨åˆ†æ–‡å­—&quot;&gt;é¢„è§ˆéƒ¨åˆ†æ–‡å­—&lt;/h2&gt;
&lt;p&gt;&amp;lt; !-- more -- &amp;gt; in your article to break your article manually,
which is recommended by Hexo.&lt;/p&gt;
&lt;h2 id=&quot;é‡åˆ°hexo-generation-å‡ºé”™å¤„ç†&quot;&gt;é‡åˆ°hexo generation å‡ºé”™å¤„ç†&lt;/h2&gt;
&lt;p&gt;æ£€æŸ¥Markedown (vscode markdownè¯­æ³•æ£€æŸ¥)&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hexo clean&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hexo --debug&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hexo generate&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;clone-whole-repository-in-a-new-machine&quot;&gt;clone whole repository
in a new machine&lt;/h2&gt;
&lt;p&gt;&lt;a
href=&quot;https://iphysresearch.github.io/blog/post/programing/git/git_submodule/&quot;
class=&quot;uri&quot;&gt;https://iphysresearch.github.io/blog/post/programing/git/git_submodule/&lt;/a&gt;
since there is submodule in main repository ( the theme/next)&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git clone xxxx (main repository)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git submodule init # åˆå§‹åŒ–å­æ¨¡å—&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git submodule update # æ›´æ–°å­æ¨¡å—&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;npm install&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hexo generate or hexo s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;# &lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;è°ƒè¯•çš„æ—¶å€™é‡åˆ°ä¸åæ›²é—®é¢˜ï¼Œå¯ä»¥å®‰è£…pandoc, https://pandoc.org/installing.html&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta prompt_&quot;&gt;# &lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;è¿™ä¼šæŒ‡ç¤ºé‚£ä¸€ä¸ªæ–‡ä»¶çš„å“ªä¸€è¡Œå‡ºé”™äº†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;a href=&quot;https://hexo.io/zh-cn/docs/commands.html&quot;
class=&quot;uri&quot;&gt;https://hexo.io/zh-cn/docs/commands.html&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="hexo" scheme="http://yoursite.com/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>object-detection</title>
    <link href="http://yoursite.com/2019/07/22/object-detection/"/>
    <id>http://yoursite.com/2019/07/22/object-detection/</id>
    <published>2019-07-22T11:10:32.000Z</published>
    <updated>2025-05-22T05:50:40.080Z</updated>
    
    <content type="html"><![CDATA[<h2 id="fast-rcnn-ä¸­region-of-interestçš„æ˜ å°„">Fast-RCNN ä¸­region ofinterestçš„æ˜ å°„</h2><p>é¦–å…ˆåœ¨åŸå›¾ä¸Šç”¨selectivesearchå¾—åˆ°æŸä¸ªæ¨èæ¡†ï¼Œå‡è®¾æ¨èç›®æ ‡åœ¨ä¸€ä¸ªåŒºåŸŸå†…ï¼Œè¿™ä¸ªåŒºåŸŸçš„å·¦ä¸Šç‚¹åæ ‡ä¸ºï¼ˆx1,y1ï¼‰ï¼Œå³ä¸‹è§’åæ ‡ä¸ºï¼ˆx2,y2ï¼‰ã€‚é‚£ä¹ˆæŒ‰ç…§ZF-5çš„ç½‘ç»œæ¨¡å‹æ±‚å‡º <span class="math display">\[S=2*2*2*2\]</span> (æ‰€æœ‰strideçš„è¿ç»­ä¹˜ç§¯ï¼Œåœ¨conv5ä¹‹å‰ï¼ŒåŒ…æ‹¬conv5 ) <a href="#fn1"class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>æ‰€ä»¥å…·ä½“è½å®åˆ°featuremapä¸Šï¼Œå°±åº”è¯¥æ˜¯ï¼ˆ(x1/16)+1,(y1/16)+1ï¼‰;ï¼ˆ(x2/16)-1,(y2/16)-1ï¼‰ã€‚</p><h3 id="caffeä¸­çš„å®ç°">Caffeä¸­çš„å®ç°</h3><p>æˆ‘ä»¬å¯ä»¥æ‰“å¼€roi_pooling_layerå±‚ï¼š è¿™é‡Œçš„æºç æ˜¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> roi_start_w = <span class="built_in">round</span>(bottom_rois[<span class="number">1</span>] * spatial_scale_);</span><br><span class="line"><span class="type">int</span> roi_start_h = <span class="built_in">round</span>(bottom_rois[<span class="number">2</span>] * spatial_scale_);</span><br><span class="line"><span class="type">int</span> roi_end_w = <span class="built_in">round</span>(bottom_rois[<span class="number">3</span>] * spatial_scale_);</span><br><span class="line"><span class="type">int</span> roi_end_h = <span class="built_in">round</span>(bottom_rois[<span class="number">4</span>] * spatial_scale_);</span><br></pre></td></tr></table></figure><p>spatial_scale_å…¶å®å°±æ˜¯strideè¿ç»­ä¹˜ç§¯çš„å€’æ•°ã€‚è¿™é‡Œç”¨çš„è¿™ä¸ªround()æœ‰ç‚¹æ„æ€ï¼Œå¾—åˆ°å°æ•°çš„æœ€é‚»è¿‘æ•´æ•°ï¼Œå°±å¯ä»¥ç†è§£ä¸ºå››èˆäº”å…¥ï¼Œå¹¶æ²¡æœ‰åƒSpp-Netä¸­æ‰€è¿°çš„å·¦ä¸Šè§’+1ï¼Œå³ä¸‹è§’-1ã€‚æˆ‘è®¤ä¸ºè¿™ä¸¤ç§æ–¹å¼å…¶å®éƒ½æ˜¯å¯è¡Œçš„ã€‚+1æˆ–-1æ›´å¤šçš„æ˜¯ä»£è¡¨é˜²æ­¢è¿‡ç•Œï¼ˆæˆ–è€…æ˜¯å–æ•´æ–¹å¼çš„ä¸åŒï¼‰ï¼Œå…³é”®è¿˜æ˜¯é™¤ä»¥Sã€‚</p><p>å¯ä»¥ç†è§£ä¸ºåœ¨ä¸åŒç»´åº¦ä¸Šå¯¹å›¾åƒçš„ç¼©æ”¾ï¼Œè€Œstrideæ­£å¥½ä»£è¡¨äº†è¿™ä¸ªç¼©æ”¾å› å­ï¼ˆçœ‹å‰é¢ç‰¹å¾å›¾å¤§å°çš„è®¡ç®—ï¼‰ï¼Œæ‰€ä»¥ç›¸åº”çš„roiä¹Ÿéœ€è¦è·Ÿç€å›¾åƒç¼©å°è¿™ä¹ˆå¤šå€ã€‚</p><h4 id="ç¤ºä¾‹2">ç¤ºä¾‹ï¼š<a href="#fn2" class="footnote-ref" id="fnref2"role="doc-noteref"><sup>2</sup></a></h4><p>åœ¨ä½¿ç”¨fast rcnnä»¥åŠfasterrcnnåšæ£€æµ‹ä»»åŠ¡çš„æ—¶å€™ï¼Œæ¶‰åŠåˆ°ä»å›¾åƒçš„roiåŒºåŸŸåˆ°featuremapä¸­roiçš„æ˜ å°„ï¼Œç„¶åå†è¿›è¡Œroi_poolingä¹‹ç±»çš„æ“ä½œã€‚æ¯”å¦‚å›¾åƒçš„å¤§å°æ˜¯ï¼ˆ600,800ï¼‰ï¼Œåœ¨ç»è¿‡ä¸€ç³»åˆ—çš„å·ç§¯ä»¥åŠpoolingæ“ä½œä¹‹ååœ¨æŸä¸€ä¸ªå±‚ä¸­å¾—åˆ°çš„featuremapå¤§å°æ˜¯ï¼ˆ38,50ï¼‰ï¼Œé‚£ä¹ˆåœ¨åŸå›¾ä¸­roiæ˜¯ï¼ˆ30,40,200,400ï¼‰ï¼Œ åœ¨featuremapä¸­å¯¹åº”çš„roiåŒºåŸŸåº”è¯¥æ˜¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">roi_start_w = <span class="built_in">round</span>(<span class="number">30</span> * spatial_scale);</span><br><span class="line">roi_start_h = <span class="built_in">round</span>(<span class="number">40</span> * spatial_scale);</span><br><span class="line">roi_end_w = <span class="built_in">round</span>(<span class="number">200</span> * spatial_scale);</span><br><span class="line">roi_end_h = <span class="built_in">round</span>(<span class="number">400</span> * spatial_scale);</span><br></pre></td></tr></table></figure><p>å…¶ä¸­spatial_scaleçš„è®¡ç®—æ–¹å¼æ˜¯spatial_scale=round(38/600)=round(50/800)=0.0625ï¼Œæ‰€ä»¥åœ¨featuremapä¸­çš„roiåŒºåŸŸ[roi_start_w,roi_start_h,roi_end_w,roi_end_h]=[2,3,13,25];</p><h2 id="faster-r-cnn">Faster R-CNN</h2><p>è®ºæ–‡ä¸­æåˆ°å¦‚æœç”¨3x3 çš„ slice windowï¼Œå…¶å¯¹åº”åˆ°åŸå›¾çš„æ„Ÿå—é‡(effetctivereceptive field)åœ¨VGGå’ŒZFæ¨¡å‹ä¸Šåˆ†åˆ«æ˜¯228 pixelsï¼Œ171 pixelsã€‚å¯¹äºVGG16æ¥è¯´ï¼ˆå›¾ç‰‡æ¥æº:<ahref="https://www.kaggle.com/shivamb/cnn-architectures-vgg-resnet-inception-tl">kaggle</a>)<imgsrc="http://ww1.sinaimg.cn/large/6bf0a364ly1g59wophostj20m808bac7.jpg" />In Faster-rcnn, the effective receptive field can be calculated asfollow (VGG16): Img-&gt; Conv1(3)-&gt;Conv1(3)-&gt;Pool1(2) ==&gt;Conv2(3)-&gt;Conv2(3)-&gt;Pool2(2) ==&gt;Conv3(3)-&gt;Conv3(3)-&gt;Conv3(3)-&gt;Pool3(2) ==&gt;Conv4(3)-&gt;Conv4(3)-&gt;Conv4(3)-&gt;Pool4(2) ==&gt;Conv5(3)-&gt;Conv5(3)-&gt;Conv5(3) ====&gt; a 3 * 3 window in featuremap. Lets take one dimension for simplicity. If we derive back from size3, the original receptive field: 1). in the beginning of Conv5: 3 + 2 +2 + 2 = 9 2). in the beginning of Conv4: 9 * 2 + 2 + 2 + 2 = 24 3). inthe beginning of Conv3: 24 * 2 + 2 + 2 + 2 = 54 4). in the beginning ofConv2: 54 * 2 + 2 + 2 = 112 5). in the beginning of Conv1 (originalinput): 112 * 2 + 2 + 2 = 228</p><section id="footnotes" class="footnotes footnotes-end-of-document"role="doc-endnotes"><hr /><ol><li id="fn1"><p><ahref="http://www.voidcn.com/article/p-rrugdtwl-bps.html"class="uri">http://www.voidcn.com/article/p-rrugdtwl-bps.html</a><ahref="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li><li id="fn2"><p><a href="https://www.cnblogs.com/ymjyqsx/p/7592590.html"class="uri">https://www.cnblogs.com/ymjyqsx/p/7592590.html</a><ahref="#fnref2" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li></ol></section>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;fast-rcnn-ä¸­region-of-interestçš„æ˜ å°„&quot;&gt;Fast-RCNN ä¸­region of
interestçš„æ˜ å°„&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆåœ¨åŸå›¾ä¸Šç”¨selective
searchå¾—åˆ°æŸä¸ªæ¨èæ¡†ï¼Œå‡è®¾æ¨èç›®æ ‡åœ¨ä¸€ä¸ªåŒºåŸŸå†…ï¼Œè¿™ä¸ªåŒºåŸŸçš„å·¦ä¸Šç‚¹åæ ‡</summary>
      
    
    
    
    <category term="object_detection" scheme="http://yoursite.com/categories/object-detection/"/>
    
    
    <category term="object_detection" scheme="http://yoursite.com/tags/object-detection/"/>
    
  </entry>
  
</feed>
